import{g as le}from"./D7C5tOZ4.js";import{n as te,s as I}from"./1DkUAA9P.js";const fe=e=>{te.update(t=>t.filter(n=>n.id!==e))},de=(e,t="info",n=5e3)=>{const r=crypto.randomUUID();te.update(u=>[...u,{id:r,msg:e,type:t,timeout:n}]);const o=setTimeout(()=>{fe(r),clearTimeout(o)},n);return r},N=(e,t)=>t.some(n=>e instanceof n);let Z,X;function pe(){return Z||(Z=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ye(){return X||(X=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const _=new WeakMap,T=new WeakMap,O=new WeakMap;function be(e){const t=new Promise((n,r)=>{const o=()=>{e.removeEventListener("success",u),e.removeEventListener("error",a)},u=()=>{n(F(e.result)),o()},a=()=>{r(e.error),o()};e.addEventListener("success",u),e.addEventListener("error",a)});return O.set(t,e),t}function he(e){if(_.has(e))return;const t=new Promise((n,r)=>{const o=()=>{e.removeEventListener("complete",u),e.removeEventListener("error",a),e.removeEventListener("abort",a)},u=()=>{n(),o()},a=()=>{r(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",u),e.addEventListener("error",a),e.addEventListener("abort",a)});_.set(e,t)}let J={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return _.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return F(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function ne(e){J=e(J)}function ge(e){return ye().includes(e)?function(...t){return e.apply(z(this),t),F(this.request)}:function(...t){return F(e.apply(z(this),t))}}function Ce(e){return typeof e=="function"?ge(e):(e instanceof IDBTransaction&&he(e),N(e,pe())?new Proxy(e,J):e)}function F(e){if(e instanceof IDBRequest)return be(e);if(T.has(e))return T.get(e);const t=Ce(e);return t!==e&&(T.set(e,t),O.set(t,e)),t}const z=e=>O.get(e);function Ee(e,t,{blocked:n,upgrade:r,blocking:o,terminated:u}={}){const a=indexedDB.open(e,t),s=F(a);return r&&a.addEventListener("upgradeneeded",i=>{r(F(a.result),i.oldVersion,i.newVersion,F(a.transaction),i)}),n&&a.addEventListener("blocked",i=>n(i.oldVersion,i.newVersion,i)),s.then(i=>{u&&i.addEventListener("close",()=>u()),o&&i.addEventListener("versionchange",d=>o(d.oldVersion,d.newVersion,d))}).catch(()=>{}),s}const we=["get","getKey","getAll","getAllKeys","count"],me=["put","add","delete","clear"],R=new Map;function Y(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(R.get(t))return R.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=me.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(o||we.includes(n)))return;const u=async function(a,...s){const i=this.transaction(a,o?"readwrite":"readonly");let d=i.store;return r&&(d=d.index(s.shift())),(await Promise.all([d[n](...s),o&&i.done]))[0]};return R.set(t,u),u}ne(e=>({...e,get:(t,n,r)=>Y(t,n)||e.get(t,n,r),has:(t,n)=>!!Y(t,n)||e.has(t,n)}));const Ae=["continue","continuePrimaryKey","advance"],Q={},V=new WeakMap,re=new WeakMap,Se={get(e,t){if(!Ae.includes(t))return e[t];let n=Q[t];return n||(n=Q[t]=function(...r){V.set(this,re.get(this)[t](...r))}),n}};async function*Ie(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,Se);for(re.set(n,t),O.set(n,z(t));t;)yield n,t=await(V.get(n)||t.continue()),V.delete(n)}function H(e,t){return t===Symbol.asyncIterator&&N(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&N(e,[IDBIndex,IDBObjectStore])}ne(e=>({...e,get(t,n,r){return H(t,n)?Ie:e.get(t,n,r)},has(t,n){return H(t,n)||e.has(t,n)}}));const Fe="myseelia-crypto-store",P="keys",L="user-asymmetric-keys";let K=null;function G(){return K||(K=Ee(Fe,1,{upgrade(e){e.objectStoreNames.contains(P)||e.createObjectStore(P)}})),K}async function Pe(e){const n=(await G()).transaction(P,"readwrite");await n.objectStore(P).put({publicKey:e.publicKey,privateKey:e.privateKey},L),await n.done,console.log("Key pair stored in IndexedDB")}async function x(){try{const t=await(await G()).get(P,L);return t&&t.publicKey instanceof CryptoKey&&t.privateKey instanceof CryptoKey?(console.log("Key pair retrieved from IndexedDB"),{publicKey:t.publicKey,privateKey:t.privateKey}):(console.log("No key pair found in IndexedDB"),null)}catch(e){return console.error("Error retrieving key pair:",e),null}}async function M(){const t=(await G()).transaction(P,"readwrite");await t.objectStore(P).delete(L),await t.done,console.log("Key pair cleared from IndexedDB")}async function xe(){console.log("Generating RSA-OAEP key pair...");const e=await crypto.subtle.generateKey({name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},!0,["encrypt","decrypt"]);return console.log("RSA-OAEP key pair generated."),e}async function Rt(){console.log("Generating AES-GCM key...");const e=await crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return console.log("AES-GCM key generated."),e}async function Kt(e,t){const n=crypto.getRandomValues(new Uint8Array(12));console.log("Encrypting data with AES-GCM...");const r=await crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,e);return console.log("Data encrypted."),{ciphertext:r,iv:n}}async function Ut(e,t,n){console.log("Decrypting data with AES-GCM...");try{const r=await crypto.subtle.decrypt({name:"AES-GCM",iv:n},t,e);return console.log("Data decrypted."),new Uint8Array(r)}catch(r){throw console.error("AES decryption failed:",r),new Error("Decryption failed. Invalid key or ciphertext?")}}async function Nt(e,t){console.log("Encrypting AES key with RSA public key...");const n=await crypto.subtle.exportKey("raw",e),r=await crypto.subtle.encrypt({name:"RSA-OAEP"},t,n);return console.log("AES key encrypted."),r}async function _t(e,t){console.log("Decrypting AES key with RSA private key...");try{const n=await crypto.subtle.decrypt({name:"RSA-OAEP"},t,e),r=await crypto.subtle.importKey("raw",n,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return console.log("AES key decrypted."),r}catch(n){throw console.error("RSA decryption of AES key failed:",n),new Error("Failed to decrypt symmetric key.")}}async function W(e){return crypto.subtle.exportKey("jwk",e)}async function ve(e){return crypto.subtle.exportKey("jwk",e)}function Be(e){return globalThis.Buffer!=null?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function ke(e=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Be(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function Me(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var o=0;o<e.length;o++){var u=e.charAt(o),a=u.charCodeAt(0);if(n[a]!==255)throw new TypeError(u+" is ambiguous");n[a]=o}var s=e.length,i=e.charAt(0),d=Math.log(s)/Math.log(256),b=Math.log(256)/Math.log(s);function B(D){if(D instanceof Uint8Array||(ArrayBuffer.isView(D)?D=new Uint8Array(D.buffer,D.byteOffset,D.byteLength):Array.isArray(D)&&(D=Uint8Array.from(D))),!(D instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(D.length===0)return"";for(var l=0,S=0,p=0,h=D.length;p!==h&&D[p]===0;)p++,l++;for(var g=(h-p)*b+1>>>0,f=new Uint8Array(g);p!==h;){for(var C=D[p],w=0,y=g-1;(C!==0||w<S)&&y!==-1;y--,w++)C+=256*f[y]>>>0,f[y]=C%s>>>0,C=C/s>>>0;if(C!==0)throw new Error("Non-zero carry");S=w,p++}for(var E=g-S;E!==g&&f[E]===0;)E++;for(var k=i.repeat(l);E<g;++E)k+=e.charAt(f[E]);return k}function $(D){if(typeof D!="string")throw new TypeError("Expected String");if(D.length===0)return new Uint8Array;var l=0;if(D[l]!==" "){for(var S=0,p=0;D[l]===i;)S++,l++;for(var h=(D.length-l)*d+1>>>0,g=new Uint8Array(h);D[l];){var f=n[D.charCodeAt(l)];if(f===255)return;for(var C=0,w=h-1;(f!==0||C<p)&&w!==-1;w--,C++)f+=s*g[w]>>>0,g[w]=f%256>>>0,f=f/256>>>0;if(f!==0)throw new Error("Non-zero carry");p=C,l++}if(D[l]!==" "){for(var y=h-p;y!==h&&g[y]===0;)y++;for(var E=new Uint8Array(S+(h-y)),k=S;y!==h;)E[k++]=g[y++];return E}}}function ce(D){var l=$(D);if(l)return l;throw new Error(`Non-${t} character`)}return{encode:B,decodeUnsafe:$,decode:ce}}var Oe=Me,je=Oe;const Te=e=>{if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},Re=e=>new TextEncoder().encode(e),Ke=e=>new TextDecoder().decode(e);class Ue{constructor(t,n,r){this.name=t,this.prefix=n,this.baseEncode=r}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class Ne{constructor(t,n,r){if(this.name=t,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=r}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return oe(this,t)}}class _e{constructor(t){this.decoders=t}or(t){return oe(this,t)}decode(t){const n=t[0],r=this.decoders[n];if(r)return r.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const oe=(e,t)=>new _e({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class Je{constructor(t,n,r,o){this.name=t,this.prefix=n,this.baseEncode=r,this.baseDecode=o,this.encoder=new Ue(t,n,r),this.decoder=new Ne(t,n,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const j=({name:e,prefix:t,encode:n,decode:r})=>new Je(e,t,n,r),v=({prefix:e,name:t,alphabet:n})=>{const{encode:r,decode:o}=je(n,t);return j({prefix:e,name:t,encode:r,decode:u=>Te(o(u))})},ze=(e,t,n,r)=>{const o={};for(let b=0;b<t.length;++b)o[t[b]]=b;let u=e.length;for(;e[u-1]==="=";)--u;const a=new Uint8Array(u*n/8|0);let s=0,i=0,d=0;for(let b=0;b<u;++b){const B=o[e[b]];if(B===void 0)throw new SyntaxError(`Non-${r} character`);i=i<<n|B,s+=n,s>=8&&(s-=8,a[d++]=255&i>>s)}if(s>=n||255&i<<8-s)throw new SyntaxError("Unexpected end of data");return a},Ve=(e,t,n)=>{const r=t[t.length-1]==="=",o=(1<<n)-1;let u="",a=0,s=0;for(let i=0;i<e.length;++i)for(s=s<<8|e[i],a+=8;a>n;)a-=n,u+=t[o&s>>a];if(a&&(u+=t[o&s<<n-a]),r)for(;u.length*n&7;)u+="=";return u},c=({name:e,prefix:t,bitsPerChar:n,alphabet:r})=>j({prefix:t,name:e,encode(o){return Ve(o,r,n)},decode(o){return ze(o,r,n,e)}}),Le=j({prefix:"\0",name:"identity",encode:e=>Ke(e),decode:e=>Re(e)}),Ge=Object.freeze(Object.defineProperty({__proto__:null,identity:Le},Symbol.toStringTag,{value:"Module"})),We=c({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),$e=Object.freeze(Object.defineProperty({__proto__:null,base2:We},Symbol.toStringTag,{value:"Module"})),Ze=c({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Xe=Object.freeze(Object.defineProperty({__proto__:null,base8:Ze},Symbol.toStringTag,{value:"Module"})),Ye=v({prefix:"9",name:"base10",alphabet:"0123456789"}),Qe=Object.freeze(Object.defineProperty({__proto__:null,base10:Ye},Symbol.toStringTag,{value:"Module"})),He=c({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),qe=c({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),et=Object.freeze(Object.defineProperty({__proto__:null,base16:He,base16upper:qe},Symbol.toStringTag,{value:"Module"})),tt=c({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),nt=c({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),rt=c({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ot=c({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ut=c({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),at=c({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),it=c({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),st=c({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Dt=c({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),ct=Object.freeze(Object.defineProperty({__proto__:null,base32:tt,base32hex:ut,base32hexpad:it,base32hexpadupper:st,base32hexupper:at,base32pad:rt,base32padupper:ot,base32upper:nt,base32z:Dt},Symbol.toStringTag,{value:"Module"})),lt=v({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ft=v({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),dt=Object.freeze(Object.defineProperty({__proto__:null,base36:lt,base36upper:ft},Symbol.toStringTag,{value:"Module"})),pt=v({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),yt=v({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),bt=Object.freeze(Object.defineProperty({__proto__:null,base58btc:pt,base58flickr:yt},Symbol.toStringTag,{value:"Module"})),ht=c({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),gt=c({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ct=c({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Et=c({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),wt=Object.freeze(Object.defineProperty({__proto__:null,base64:ht,base64pad:gt,base64url:Ct,base64urlpad:Et},Symbol.toStringTag,{value:"Module"})),ue=Array.from("ðŸš€ðŸªâ˜„ðŸ›°ðŸŒŒðŸŒ‘ðŸŒ’ðŸŒ“ðŸŒ”ðŸŒ•ðŸŒ–ðŸŒ—ðŸŒ˜ðŸŒðŸŒðŸŒŽðŸ‰â˜€ðŸ’»ðŸ–¥ðŸ’¾ðŸ’¿ðŸ˜‚â¤ðŸ˜ðŸ¤£ðŸ˜ŠðŸ™ðŸ’•ðŸ˜­ðŸ˜˜ðŸ‘ðŸ˜…ðŸ‘ðŸ˜ðŸ”¥ðŸ¥°ðŸ’”ðŸ’–ðŸ’™ðŸ˜¢ðŸ¤”ðŸ˜†ðŸ™„ðŸ’ªðŸ˜‰â˜ºðŸ‘ŒðŸ¤—ðŸ’œðŸ˜”ðŸ˜ŽðŸ˜‡ðŸŒ¹ðŸ¤¦ðŸŽ‰ðŸ’žâœŒâœ¨ðŸ¤·ðŸ˜±ðŸ˜ŒðŸŒ¸ðŸ™ŒðŸ˜‹ðŸ’—ðŸ’šðŸ˜ðŸ’›ðŸ™‚ðŸ’“ðŸ¤©ðŸ˜„ðŸ˜€ðŸ–¤ðŸ˜ƒðŸ’¯ðŸ™ˆðŸ‘‡ðŸŽ¶ðŸ˜’ðŸ¤­â£ðŸ˜œðŸ’‹ðŸ‘€ðŸ˜ªðŸ˜‘ðŸ’¥ðŸ™‹ðŸ˜žðŸ˜©ðŸ˜¡ðŸ¤ªðŸ‘ŠðŸ¥³ðŸ˜¥ðŸ¤¤ðŸ‘‰ðŸ’ƒðŸ˜³âœ‹ðŸ˜šðŸ˜ðŸ˜´ðŸŒŸðŸ˜¬ðŸ™ƒðŸ€ðŸŒ·ðŸ˜»ðŸ˜“â­âœ…ðŸ¥ºðŸŒˆðŸ˜ˆðŸ¤˜ðŸ’¦âœ”ðŸ˜£ðŸƒðŸ’â˜¹ðŸŽŠðŸ’˜ðŸ˜ â˜ðŸ˜•ðŸŒºðŸŽ‚ðŸŒ»ðŸ˜ðŸ–•ðŸ’ðŸ™ŠðŸ˜¹ðŸ—£ðŸ’«ðŸ’€ðŸ‘‘ðŸŽµðŸ¤žðŸ˜›ðŸ”´ðŸ˜¤ðŸŒ¼ðŸ˜«âš½ðŸ¤™â˜•ðŸ†ðŸ¤«ðŸ‘ˆðŸ˜®ðŸ™†ðŸ»ðŸƒðŸ¶ðŸ’ðŸ˜²ðŸŒ¿ðŸ§¡ðŸŽâš¡ðŸŒžðŸŽˆâŒâœŠðŸ‘‹ðŸ˜°ðŸ¤¨ðŸ˜¶ðŸ¤ðŸš¶ðŸ’°ðŸ“ðŸ’¢ðŸ¤ŸðŸ™ðŸš¨ðŸ’¨ðŸ¤¬âœˆðŸŽ€ðŸºðŸ¤“ðŸ˜™ðŸ’ŸðŸŒ±ðŸ˜–ðŸ‘¶ðŸ¥´â–¶âž¡â“ðŸ’ŽðŸ’¸â¬‡ðŸ˜¨ðŸŒšðŸ¦‹ðŸ˜·ðŸ•ºâš ðŸ™…ðŸ˜ŸðŸ˜µðŸ‘ŽðŸ¤²ðŸ¤ ðŸ¤§ðŸ“ŒðŸ”µðŸ’…ðŸ§ðŸ¾ðŸ’ðŸ˜—ðŸ¤‘ðŸŒŠðŸ¤¯ðŸ·â˜ŽðŸ’§ðŸ˜¯ðŸ’†ðŸ‘†ðŸŽ¤ðŸ™‡ðŸ‘â„ðŸŒ´ðŸ’£ðŸ¸ðŸ’ŒðŸ“ðŸ¥€ðŸ¤¢ðŸ‘…ðŸ’¡ðŸ’©ðŸ‘ðŸ“¸ðŸ‘»ðŸ¤ðŸ¤®ðŸŽ¼ðŸ¥µðŸš©ðŸŽðŸŠðŸ‘¼ðŸ’ðŸ“£ðŸ¥‚"),mt=ue.reduce((e,t,n)=>(e[n]=t,e),[]),At=ue.reduce((e,t,n)=>(e[t.codePointAt(0)]=n,e),[]);function St(e){return e.reduce((t,n)=>(t+=mt[n],t),"")}function It(e){const t=[];for(const n of e){const r=At[n.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${n}`);t.push(r)}return new Uint8Array(t)}const Ft=j({prefix:"ðŸš€",name:"base256emoji",encode:St,decode:It}),Pt=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Ft},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const q={...Ge,...$e,...Xe,...Qe,...et,...ct,...dt,...bt,...wt,...Pt};function ae(e,t,n,r){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:n},decoder:{decode:r}}}const ee=ae("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),U=ae("ascii","a",e=>{let t="a";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},e=>{e=e.substring(1);const t=ke(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}),xt={utf8:ee,"utf-8":ee,hex:q.base16,latin1:U,ascii:U,binary:U,...q};function vt(e,t="utf8"){const n=xt[t];if(!n)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8"):n.encoder.encode(e).substring(1)}const ie="https://api.pinata.cloud",Bt="https://gateway.pinata.cloud/ipfs/";function se(){return"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySW5mb3JtYXRpb24iOnsiaWQiOiJhZjhjMTk5MS03YzAwLTQ3ZTctOGU5OS1jZmMwODY1YzRjYjkiLCJlbWFpbCI6InphbGRhcnJlbkBnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwicGluX3BvbGljeSI6eyJyZWdpb25zIjpbeyJkZXNpcmVkUmVwbGljYXRpb25Db3VudCI6MSwiaWQiOiJGUkExIn0seyJkZXNpcmVkUmVwbGljYXRpb25Db3VudCI6MSwiaWQiOiJOWUMxIn1dLCJ2ZXJzaW9uIjoxfSwibWZhX2VuYWJsZWQiOmZhbHNlLCJzdGF0dXMiOiJBQ1RJVkUifSwiYXV0aGVudGljYXRpb25UeXBlIjoic2NvcGVkS2V5Iiwic2NvcGVkS2V5S2V5IjoiMmMyMWJhNjAzODgzMzliMTZmZmEiLCJzY29wZWRLZXlTZWNyZXQiOiI1MzlhYmIzNDUzN2UwZDE4MGFlMzVkZGNmMzc2OTc5ODI4MmVkMjU3NWVhYzZmNDNjMTFhMDU2ZWM4ODViODAzIiwiZXhwIjoxNzc2ODk3MTk0fQ.SWoKMWlNqSwCZcVKyh2PwnD0GsF9RuCRFIz-VvvmT9c"}async function Jt(e,t){const n=se();if(!n)return null;console.log("Pinning data to IPFS via Pinata...");try{const r=new FormData,o=new Blob([e]);r.append("file",o),t&&r.append("pinataMetadata",JSON.stringify(t));const u=await fetch(`${ie}/pinning/pinFileToIPFS`,{method:"POST",headers:{Authorization:`Bearer ${n}`},body:r});if(!u.ok){const i=await u.text();throw new Error(`Pinata API error (${u.status}): ${i}`)}const a=await u.json();if(!a.IpfsHash)throw new Error("Pinata API response did not include IpfsHash");const s=a.IpfsHash;return console.log("Data pinned successfully. CID:",s),s}catch(r){return console.error("Failed to pin data to Pinata:",r),null}}async function De(e,t){const n=se();if(!n)return null;console.log("Pinning JSON to IPFS via Pinata...");try{const r=await fetch(`${ie}/pinning/pinJSONToIPFS`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({pinataContent:e,...t&&{pinataMetadata:t}})});if(!r.ok){const a=await r.text();throw new Error(`Pinata API error (${r.status}): ${a}`)}const o=await r.json();if(!o.IpfsHash)throw new Error("Pinata API response did not include IpfsHash");const u=o.IpfsHash;return console.log("JSON pinned successfully. CID:",u),u}catch(r){return console.error("Failed to pin JSON to Pinata:",r),null}}async function kt(e){console.log(`Fetching data from IPFS for CID: ${e}...`);try{const t=await fetch(`${Bt}${e}`);if(!t.ok)throw new Error(`IPFS gateway error (${t.status}): ${t.statusText}`);const n=await t.arrayBuffer();return console.log(`Data fetched successfully for CID: ${e}`),new Uint8Array(n)}catch(t){return console.error(`Failed to fetch data from IPFS for CID ${e}:`,t),null}}async function Mt(e){const t=await kt(e);if(!t)return null;try{const n=vt(t,"utf8");return JSON.parse(n)}catch(n){return console.error(`Failed to parse JSON from IPFS CID ${e}:`,n),null}}const m=()=>typeof window<"u",A="myseelia-manifest-cid";async function zt(e){console.log("[Register] Function called.");try{console.log("[Register] Entering try block."),console.log("[Register] Checking for existing keys...");let t=await x();if(t){console.warn("[Register] Keys already exist. Attempting login..."),await Ot();const u=le(I);return console.log("[Register] Login attempt finished. isAuthenticated:",u.isAuthenticated),u.isAuthenticated}console.log("[Register] No existing keys found."),console.log("[Register] Generating RSA key pair..."),t=await xe(),console.log("[Register] RSA key pair generated."),console.log("[Register] Storing key pair..."),await Pe(t),console.log("[Register] Key pair stored."),console.log("[Register] Exporting public key...");const n=await W(t.publicKey);console.log("[Register] Public key exported."),console.log("[Register] Creating initial manifest...");const r={publicKey:n,files:{}};console.log("[Register] Initial manifest created."),console.log("[Register] Pinning initial manifest to IPFS...");const o=await De(r,{name:"myseelia-user-manifest-initial"});return console.log("[Register] Pinning attempt finished. CID result:",o),o?(console.log("[Register] Initial manifest pinned successfully. CID:",o),console.log("[Register] Storing manifest CID locally..."),m()?(localStorage.setItem(A,o),console.log("[Register] Manifest CID stored.")):console.warn("[Register] Cannot store manifest CID outside browser environment."),console.log("[Register] Updating session store..."),I.set({username:n.n,isAuthenticated:!0,isLoading:!1,error:null,backupCreated:null}),console.log("Registration successful, session updated."),!0):(console.error("[Register] Failed to pin initial manifest to IPFS."),await M(),!1)}catch(t){return console.error("Error during registration:",t),await M(),m()&&localStorage.removeItem(A),I.set({username:null,isAuthenticated:!1,isLoading:!1,error:"Registration failed.",backupCreated:null}),!1}}async function Ot(){console.log("Attempting to load account (Web Crypto)...");try{const e=await x();if(!e){console.log("No local key pair found. User is not logged in."),I.set({username:null,isAuthenticated:!1,isLoading:!1,error:null,backupCreated:null}),m()&&localStorage.removeItem(A);return}let t=null;if(m()&&(t=localStorage.getItem(A)),!t){console.error("Keys found, but manifest CID is missing from local storage. Cannot load account state."),await M(),I.set({username:null,isAuthenticated:!1,isLoading:!1,error:"Account state corrupted (missing manifest CID). Please register again.",backupCreated:null});return}console.log(`Manifest CID found: ${t}. Verifying access...`);const n=await W(e.publicKey);I.set({username:n.n,isAuthenticated:!0,isLoading:!1,error:null,backupCreated:null}),console.log("Account loaded successfully.")}catch(e){console.error("Error loading account:",e),I.set({username:null,isAuthenticated:!1,isLoading:!1,error:"Failed to load account.",backupCreated:null}),await M(),m()&&localStorage.removeItem(A)}}async function Vt(){console.log("Exporting credentials for sync...");try{const e=await x();if(!e)throw new Error("Cannot export: User not logged in.");let t=null;if(m()&&(t=localStorage.getItem(A)),!t)throw new Error("Cannot export: Manifest CID not found.");const r={privateKeyJwk:await ve(e.privateKey),manifestCid:t};return console.log("Credentials exported successfully."),JSON.stringify(r)}catch(e){return console.error("Error exporting credentials:",e),de("Failed to prepare sync data.","error"),null}}async function Lt(){if(!await x())return console.log("Not logged in, cannot get manifest."),null;let t=null;if(m()&&(t=localStorage.getItem(A)),!t)return console.error("Logged in, but manifest CID missing."),null;const n=await Mt(t);return n&&typeof n=="object"&&"publicKey"in n&&"files"in n?n:(console.error("Fetched manifest data is invalid or null."),null)}async function Gt(e){const t=await x();if(!t)return console.error("Not logged in, cannot update manifest."),null;const n=await W(t.publicKey);if(JSON.stringify(e.publicKey)!==JSON.stringify(n))return console.error("Manifest update rejected: Public key mismatch."),null;const r=await De(e,{name:"myseelia-user-manifest-update"});return r?(console.log("Manifest updated on IPFS. New CID:",r),m()&&localStorage.setItem(A,r)):console.error("Failed to pin updated manifest."),r}export{xt as B,Be as a,Ut as b,Rt as c,_t as d,Kt as e,kt as f,Lt as g,Nt as h,de as i,zt as j,Vt as k,Ot as l,Jt as p,x as r,vt as t,Gt as u};
