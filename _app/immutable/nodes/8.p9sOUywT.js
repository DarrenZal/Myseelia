var yy=Object.defineProperty;var gy=(r,e,t)=>e in r?yy(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ns=(r,e,t)=>gy(r,typeof e!="symbol"?e+"":e,t);import{t as template,a as append}from"../chunks/BPyiyC_m.js";import"../chunks/B2YF9tyq.js";import{aq as push,m as first_child,s as sibling,e as child,n as next,r as reset,ar as pop,t as template_effect,Z as set$1,C as mutable_source,q as get$7}from"../chunks/CpwNkmoQ.js";import{i as if_block}from"../chunks/BmgNgRVt.js";import{r as remove_input_defaults}from"../chunks/jM2rXxed.js";import{i as init$3}from"../chunks/D3sFF71D.js";import{s as store_get,a as setup_stores}from"../chunks/VC3jnv3y.js";import{g as goto}from"../chunks/C2QfFUSc.js";import{p as page}from"../chunks/DSR-_Ax7.js";import{i as addNotification,l as loadAccount}from"../chunks/CWPP9cGa.js";import{c as commonjsGlobal,a as getDefaultExportFromCjs}from"../chunks/_d1bhYXs.js";import{r as require$$0}from"../chunks/C08jCxmb.js";import{F as FilesystemActivity}from"../chunks/BwE9HQGT.js";import{s as set_text}from"../chunks/BAHnar9m.js";import{e as event}from"../chunks/DpYJPrsp.js";import{p as prop}from"../chunks/BkUCjqIG.js";import{c as createEventDispatcher}from"../chunks/DkizDD9N.js";import{a as appName}from"../chunks/CVqB8m0L.js";import{e as extractSearchParam}from"../chunks/Dp_QmVq8.js";function commonjsRequire(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var localforage$1={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/var hasRequiredLocalforage;function requireLocalforage(){return hasRequiredLocalforage||(hasRequiredLocalforage=1,function(r,e){(function(t){r.exports=t()})(function(){return function t(n,i,s){function u(g,_){if(!i[g]){if(!n[g]){var f=typeof commonjsRequire=="function"&&commonjsRequire;if(!_&&f)return f(g,!0);if(c)return c(g,!0);var l=new Error("Cannot find module '"+g+"'");throw l.code="MODULE_NOT_FOUND",l}var h=i[g]={exports:{}};n[g][0].call(h.exports,function(p){var y=n[g][1][p];return u(y||p)},h,h.exports,t,n,i,s)}return i[g].exports}for(var c=typeof commonjsRequire=="function"&&commonjsRequire,d=0;d<s.length;d++)u(s[d]);return u}({1:[function(t,n,i){(function(s){var u=s.MutationObserver||s.WebKitMutationObserver,c;if(u){var d=0,g=new u(p),_=s.document.createTextNode("");g.observe(_,{characterData:!0}),c=function(){_.data=d=++d%2}}else if(!s.setImmediate&&typeof s.MessageChannel<"u"){var f=new s.MessageChannel;f.port1.onmessage=p,c=function(){f.port2.postMessage(0)}}else"document"in s&&"onreadystatechange"in s.document.createElement("script")?c=function(){var w=s.document.createElement("script");w.onreadystatechange=function(){p(),w.onreadystatechange=null,w.parentNode.removeChild(w),w=null},s.document.documentElement.appendChild(w)}:c=function(){setTimeout(p,0)};var l,h=[];function p(){l=!0;for(var w,v,C=h.length;C;){for(v=h,h=[],w=-1;++w<C;)v[w]();C=h.length}l=!1}n.exports=y;function y(w){h.push(w)===1&&!l&&c()}}).call(this,typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(t,n,i){var s=t(1);function u(){}var c={},d=["REJECTED"],g=["FULFILLED"],_=["PENDING"];n.exports=f;function f(F){if(typeof F!="function")throw new TypeError("resolver must be a function");this.state=_,this.queue=[],this.outcome=void 0,F!==u&&y(this,F)}f.prototype.catch=function(F){return this.then(null,F)},f.prototype.then=function(F,k){if(typeof F!="function"&&this.state===g||typeof k!="function"&&this.state===d)return this;var B=new this.constructor(u);if(this.state!==_){var H=this.state===g?F:k;h(B,H,this.outcome)}else this.queue.push(new l(B,F,k));return B};function l(F,k,B){this.promise=F,typeof k=="function"&&(this.onFulfilled=k,this.callFulfilled=this.otherCallFulfilled),typeof B=="function"&&(this.onRejected=B,this.callRejected=this.otherCallRejected)}l.prototype.callFulfilled=function(F){c.resolve(this.promise,F)},l.prototype.otherCallFulfilled=function(F){h(this.promise,this.onFulfilled,F)},l.prototype.callRejected=function(F){c.reject(this.promise,F)},l.prototype.otherCallRejected=function(F){h(this.promise,this.onRejected,F)};function h(F,k,B){s(function(){var H;try{H=k(B)}catch(re){return c.reject(F,re)}H===F?c.reject(F,new TypeError("Cannot resolve promise with itself")):c.resolve(F,H)})}c.resolve=function(F,k){var B=w(p,k);if(B.status==="error")return c.reject(F,B.value);var H=B.value;if(H)y(F,H);else{F.state=g,F.outcome=k;for(var re=-1,le=F.queue.length;++re<le;)F.queue[re].callFulfilled(k)}return F},c.reject=function(F,k){F.state=d,F.outcome=k;for(var B=-1,H=F.queue.length;++B<H;)F.queue[B].callRejected(k);return F};function p(F){var k=F&&F.then;if(F&&(typeof F=="object"||typeof F=="function")&&typeof k=="function")return function(){k.apply(F,arguments)}}function y(F,k){var B=!1;function H(He){B||(B=!0,c.reject(F,He))}function re(He){B||(B=!0,c.resolve(F,He))}function le(){k(re,H)}var me=w(le);me.status==="error"&&H(me.value)}function w(F,k){var B={};try{B.value=F(k),B.status="success"}catch(H){B.status="error",B.value=H}return B}f.resolve=v;function v(F){return F instanceof this?F:c.resolve(new this(u),F)}f.reject=C;function C(F){var k=new this(u);return c.reject(k,F)}f.all=P;function P(F){var k=this;if(Object.prototype.toString.call(F)!=="[object Array]")return this.reject(new TypeError("must be an array"));var B=F.length,H=!1;if(!B)return this.resolve([]);for(var re=new Array(B),le=0,me=-1,He=new this(u);++me<B;)ct(F[me],me);return He;function ct(lt,dt){k.resolve(lt).then(gt,function(Ee){H||(H=!0,c.reject(He,Ee))});function gt(Ee){re[dt]=Ee,++le===B&&!H&&(H=!0,c.resolve(He,re))}}}f.race=R;function R(F){var k=this;if(Object.prototype.toString.call(F)!=="[object Array]")return this.reject(new TypeError("must be an array"));var B=F.length,H=!1;if(!B)return this.resolve([]);for(var re=-1,le=new this(u);++re<B;)me(F[re]);return le;function me(He){k.resolve(He).then(function(ct){H||(H=!0,c.resolve(le,ct))},function(ct){H||(H=!0,c.reject(le,ct))})}}},{1:1}],3:[function(t,n,i){(function(s){typeof s.Promise!="function"&&(s.Promise=t(2))}).call(this,typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(t,n,i){var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T};function u(T,U){if(!(T instanceof U))throw new TypeError("Cannot call a class as a function")}function c(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var d=c();function g(){try{if(!d||!d.open)return!1;var T=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),U=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!T||U)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function _(T,U){T=T||[],U=U||{};try{return new Blob(T,U)}catch(Q){if(Q.name!=="TypeError")throw Q;for(var I=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,W=new I,Y=0;Y<T.length;Y+=1)W.append(T[Y]);return W.getBlob(U.type)}}typeof Promise>"u"&&t(3);var f=Promise;function l(T,U){U&&T.then(function(I){U(null,I)},function(I){U(I)})}function h(T,U,I){typeof U=="function"&&T.then(U),typeof I=="function"&&T.catch(I)}function p(T){return typeof T!="string"&&(console.warn(T+" used as a key, but it is not a string."),T=String(T)),T}function y(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var w="local-forage-detect-blob-support",v=void 0,C={},P=Object.prototype.toString,R="readonly",F="readwrite";function k(T){for(var U=T.length,I=new ArrayBuffer(U),W=new Uint8Array(I),Y=0;Y<U;Y++)W[Y]=T.charCodeAt(Y);return I}function B(T){return new f(function(U){var I=T.transaction(w,F),W=_([""]);I.objectStore(w).put(W,"key"),I.onabort=function(Y){Y.preventDefault(),Y.stopPropagation(),U(!1)},I.oncomplete=function(){var Y=navigator.userAgent.match(/Chrome\/(\d+)/),Q=navigator.userAgent.match(/Edge\//);U(Q||!Y||parseInt(Y[1],10)>=43)}}).catch(function(){return!1})}function H(T){return typeof v=="boolean"?f.resolve(v):B(T).then(function(U){return v=U,v})}function re(T){var U=C[T.name],I={};I.promise=new f(function(W,Y){I.resolve=W,I.reject=Y}),U.deferredOperations.push(I),U.dbReady?U.dbReady=U.dbReady.then(function(){return I.promise}):U.dbReady=I.promise}function le(T){var U=C[T.name],I=U.deferredOperations.pop();if(I)return I.resolve(),I.promise}function me(T,U){var I=C[T.name],W=I.deferredOperations.pop();if(W)return W.reject(U),W.promise}function He(T,U){return new f(function(I,W){if(C[T.name]=C[T.name]||Qe(),T.db)if(U)re(T),T.db.close();else return I(T.db);var Y=[T.name];U&&Y.push(T.version);var Q=d.open.apply(d,Y);U&&(Q.onupgradeneeded=function(ue){var N=Q.result;try{N.createObjectStore(T.storeName),ue.oldVersion<=1&&N.createObjectStore(w)}catch(pe){if(pe.name==="ConstraintError")console.warn('The database "'+T.name+'" has been upgraded from version '+ue.oldVersion+" to version "+ue.newVersion+', but the storage "'+T.storeName+'" already exists.');else throw pe}}),Q.onerror=function(ue){ue.preventDefault(),W(Q.error)},Q.onsuccess=function(){var ue=Q.result;ue.onversionchange=function(N){N.target.close()},I(ue),le(T)}})}function ct(T){return He(T,!1)}function lt(T){return He(T,!0)}function dt(T,U){if(!T.db)return!0;var I=!T.db.objectStoreNames.contains(T.storeName),W=T.version<T.db.version,Y=T.version>T.db.version;if(W&&(T.version!==U&&console.warn('The database "'+T.name+`" can't be downgraded from version `+T.db.version+" to version "+T.version+"."),T.version=T.db.version),Y||I){if(I){var Q=T.db.version+1;Q>T.version&&(T.version=Q)}return!0}return!1}function gt(T){return new f(function(U,I){var W=new FileReader;W.onerror=I,W.onloadend=function(Y){var Q=btoa(Y.target.result||"");U({__local_forage_encoded_blob:!0,data:Q,type:T.type})},W.readAsBinaryString(T)})}function Ee(T){var U=k(atob(T.data));return _([U],{type:T.type})}function z(T){return T&&T.__local_forage_encoded_blob}function ne(T){var U=this,I=U._initReady().then(function(){var W=C[U._dbInfo.name];if(W&&W.dbReady)return W.dbReady});return h(I,T,T),I}function ee(T){re(T);for(var U=C[T.name],I=U.forages,W=0;W<I.length;W++){var Y=I[W];Y._dbInfo.db&&(Y._dbInfo.db.close(),Y._dbInfo.db=null)}return T.db=null,ct(T).then(function(Q){return T.db=Q,dt(T)?lt(T):Q}).then(function(Q){T.db=U.db=Q;for(var ue=0;ue<I.length;ue++)I[ue]._dbInfo.db=Q}).catch(function(Q){throw me(T,Q),Q})}function ve(T,U,I,W){W===void 0&&(W=1);try{var Y=T.db.transaction(T.storeName,U);I(null,Y)}catch(Q){if(W>0&&(!T.db||Q.name==="InvalidStateError"||Q.name==="NotFoundError"))return f.resolve().then(function(){if(!T.db||Q.name==="NotFoundError"&&!T.db.objectStoreNames.contains(T.storeName)&&T.version<=T.db.version)return T.db&&(T.version=T.db.version+1),lt(T)}).then(function(){return ee(T).then(function(){ve(T,U,I,W-1)})}).catch(I);I(Q)}}function Qe(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function Me(T){var U=this,I={db:null};if(T)for(var W in T)I[W]=T[W];var Y=C[I.name];Y||(Y=Qe(),C[I.name]=Y),Y.forages.push(U),U._initReady||(U._initReady=U.ready,U.ready=ne);var Q=[];function ue(){return f.resolve()}for(var N=0;N<Y.forages.length;N++){var pe=Y.forages[N];pe!==U&&Q.push(pe._initReady().catch(ue))}var ye=Y.forages.slice(0);return f.all(Q).then(function(){return I.db=Y.db,ct(I)}).then(function(_e){return I.db=_e,dt(I,U._defaultConfig.version)?lt(I):_e}).then(function(_e){I.db=Y.db=_e,U._dbInfo=I;for(var Ce=0;Ce<ye.length;Ce++){var Pe=ye[Ce];Pe!==U&&(Pe._dbInfo.db=I.db,Pe._dbInfo.version=I.version)}})}function it(T,U){var I=this;T=p(T);var W=new f(function(Y,Q){I.ready().then(function(){ve(I._dbInfo,R,function(ue,N){if(ue)return Q(ue);try{var pe=N.objectStore(I._dbInfo.storeName),ye=pe.get(T);ye.onsuccess=function(){var _e=ye.result;_e===void 0&&(_e=null),z(_e)&&(_e=Ee(_e)),Y(_e)},ye.onerror=function(){Q(ye.error)}}catch(_e){Q(_e)}})}).catch(Q)});return l(W,U),W}function Ne(T,U){var I=this,W=new f(function(Y,Q){I.ready().then(function(){ve(I._dbInfo,R,function(ue,N){if(ue)return Q(ue);try{var pe=N.objectStore(I._dbInfo.storeName),ye=pe.openCursor(),_e=1;ye.onsuccess=function(){var Ce=ye.result;if(Ce){var Pe=Ce.value;z(Pe)&&(Pe=Ee(Pe));var je=T(Pe,Ce.key,_e++);je!==void 0?Y(je):Ce.continue()}else Y()},ye.onerror=function(){Q(ye.error)}}catch(Ce){Q(Ce)}})}).catch(Q)});return l(W,U),W}function De(T,U,I){var W=this;T=p(T);var Y=new f(function(Q,ue){var N;W.ready().then(function(){return N=W._dbInfo,P.call(U)==="[object Blob]"?H(N.db).then(function(pe){return pe?U:gt(U)}):U}).then(function(pe){ve(W._dbInfo,F,function(ye,_e){if(ye)return ue(ye);try{var Ce=_e.objectStore(W._dbInfo.storeName);pe===null&&(pe=void 0);var Pe=Ce.put(pe,T);_e.oncomplete=function(){pe===void 0&&(pe=null),Q(pe)},_e.onabort=_e.onerror=function(){var je=Pe.error?Pe.error:Pe.transaction.error;ue(je)}}catch(je){ue(je)}})}).catch(ue)});return l(Y,I),Y}function Dt(T,U){var I=this;T=p(T);var W=new f(function(Y,Q){I.ready().then(function(){ve(I._dbInfo,F,function(ue,N){if(ue)return Q(ue);try{var pe=N.objectStore(I._dbInfo.storeName),ye=pe.delete(T);N.oncomplete=function(){Y()},N.onerror=function(){Q(ye.error)},N.onabort=function(){var _e=ye.error?ye.error:ye.transaction.error;Q(_e)}}catch(_e){Q(_e)}})}).catch(Q)});return l(W,U),W}function bt(T){var U=this,I=new f(function(W,Y){U.ready().then(function(){ve(U._dbInfo,F,function(Q,ue){if(Q)return Y(Q);try{var N=ue.objectStore(U._dbInfo.storeName),pe=N.clear();ue.oncomplete=function(){W()},ue.onabort=ue.onerror=function(){var ye=pe.error?pe.error:pe.transaction.error;Y(ye)}}catch(ye){Y(ye)}})}).catch(Y)});return l(I,T),I}function Nt(T){var U=this,I=new f(function(W,Y){U.ready().then(function(){ve(U._dbInfo,R,function(Q,ue){if(Q)return Y(Q);try{var N=ue.objectStore(U._dbInfo.storeName),pe=N.count();pe.onsuccess=function(){W(pe.result)},pe.onerror=function(){Y(pe.error)}}catch(ye){Y(ye)}})}).catch(Y)});return l(I,T),I}function fr(T,U){var I=this,W=new f(function(Y,Q){if(T<0){Y(null);return}I.ready().then(function(){ve(I._dbInfo,R,function(ue,N){if(ue)return Q(ue);try{var pe=N.objectStore(I._dbInfo.storeName),ye=!1,_e=pe.openKeyCursor();_e.onsuccess=function(){var Ce=_e.result;if(!Ce){Y(null);return}T===0||ye?Y(Ce.key):(ye=!0,Ce.advance(T))},_e.onerror=function(){Q(_e.error)}}catch(Ce){Q(Ce)}})}).catch(Q)});return l(W,U),W}function Ut(T){var U=this,I=new f(function(W,Y){U.ready().then(function(){ve(U._dbInfo,R,function(Q,ue){if(Q)return Y(Q);try{var N=ue.objectStore(U._dbInfo.storeName),pe=N.openKeyCursor(),ye=[];pe.onsuccess=function(){var _e=pe.result;if(!_e){W(ye);return}ye.push(_e.key),_e.continue()},pe.onerror=function(){Y(pe.error)}}catch(_e){Y(_e)}})}).catch(Y)});return l(I,T),I}function Yt(T,U){U=y.apply(this,arguments);var I=this.config();T=typeof T!="function"&&T||{},T.name||(T.name=T.name||I.name,T.storeName=T.storeName||I.storeName);var W=this,Y;if(!T.name)Y=f.reject("Invalid arguments");else{var Q=T.name===I.name&&W._dbInfo.db,ue=Q?f.resolve(W._dbInfo.db):ct(T).then(function(N){var pe=C[T.name],ye=pe.forages;pe.db=N;for(var _e=0;_e<ye.length;_e++)ye[_e]._dbInfo.db=N;return N});T.storeName?Y=ue.then(function(N){if(N.objectStoreNames.contains(T.storeName)){var pe=N.version+1;re(T);var ye=C[T.name],_e=ye.forages;N.close();for(var Ce=0;Ce<_e.length;Ce++){var Pe=_e[Ce];Pe._dbInfo.db=null,Pe._dbInfo.version=pe}var je=new f(function(Xe,Je){var rt=d.open(T.name,pe);rt.onerror=function(xt){var St=rt.result;St.close(),Je(xt)},rt.onupgradeneeded=function(){var xt=rt.result;xt.deleteObjectStore(T.storeName)},rt.onsuccess=function(){var xt=rt.result;xt.close(),Xe(xt)}});return je.then(function(Xe){ye.db=Xe;for(var Je=0;Je<_e.length;Je++){var rt=_e[Je];rt._dbInfo.db=Xe,le(rt._dbInfo)}}).catch(function(Xe){throw(me(T,Xe)||f.resolve()).catch(function(){}),Xe})}}):Y=ue.then(function(N){re(T);var pe=C[T.name],ye=pe.forages;N.close();for(var _e=0;_e<ye.length;_e++){var Ce=ye[_e];Ce._dbInfo.db=null}var Pe=new f(function(je,Xe){var Je=d.deleteDatabase(T.name);Je.onerror=function(){var rt=Je.result;rt&&rt.close(),Xe(Je.error)},Je.onblocked=function(){console.warn('dropInstance blocked for database "'+T.name+'" until all open connections are closed')},Je.onsuccess=function(){var rt=Je.result;rt&&rt.close(),je(rt)}});return Pe.then(function(je){pe.db=je;for(var Xe=0;Xe<ye.length;Xe++){var Je=ye[Xe];le(Je._dbInfo)}}).catch(function(je){throw(me(T,je)||f.resolve()).catch(function(){}),je})})}return l(Y,U),Y}var Zt={_driver:"asyncStorage",_initStorage:Me,_support:g(),iterate:Ne,getItem:it,setItem:De,removeItem:Dt,clear:bt,length:Nt,key:fr,keys:Ut,dropInstance:Yt};function qt(){return typeof openDatabase=="function"}var Xt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",zr="~~local_forage_type~",Wt=/^~~local_forage_type~([^~]+)~/,mr="__lfsc__:",sr=mr.length,er="arbf",kt="blob",Rt="si08",ar="ui08",Er="uic8",Bt="si16",ce="si32",S="ur16",b="ui32",E="fl32",q="fl64",X=sr+er.length,Z=Object.prototype.toString;function se(T){var U=T.length*.75,I=T.length,W,Y=0,Q,ue,N,pe;T[T.length-1]==="="&&(U--,T[T.length-2]==="="&&U--);var ye=new ArrayBuffer(U),_e=new Uint8Array(ye);for(W=0;W<I;W+=4)Q=Xt.indexOf(T[W]),ue=Xt.indexOf(T[W+1]),N=Xt.indexOf(T[W+2]),pe=Xt.indexOf(T[W+3]),_e[Y++]=Q<<2|ue>>4,_e[Y++]=(ue&15)<<4|N>>2,_e[Y++]=(N&3)<<6|pe&63;return ye}function Se(T){var U=new Uint8Array(T),I="",W;for(W=0;W<U.length;W+=3)I+=Xt[U[W]>>2],I+=Xt[(U[W]&3)<<4|U[W+1]>>4],I+=Xt[(U[W+1]&15)<<2|U[W+2]>>6],I+=Xt[U[W+2]&63];return U.length%3===2?I=I.substring(0,I.length-1)+"=":U.length%3===1&&(I=I.substring(0,I.length-2)+"=="),I}function qe(T,U){var I="";if(T&&(I=Z.call(T)),T&&(I==="[object ArrayBuffer]"||T.buffer&&Z.call(T.buffer)==="[object ArrayBuffer]")){var W,Y=mr;T instanceof ArrayBuffer?(W=T,Y+=er):(W=T.buffer,I==="[object Int8Array]"?Y+=Rt:I==="[object Uint8Array]"?Y+=ar:I==="[object Uint8ClampedArray]"?Y+=Er:I==="[object Int16Array]"?Y+=Bt:I==="[object Uint16Array]"?Y+=S:I==="[object Int32Array]"?Y+=ce:I==="[object Uint32Array]"?Y+=b:I==="[object Float32Array]"?Y+=E:I==="[object Float64Array]"?Y+=q:U(new Error("Failed to get type for BinaryArray"))),U(Y+Se(W))}else if(I==="[object Blob]"){var Q=new FileReader;Q.onload=function(){var ue=zr+T.type+"~"+Se(this.result);U(mr+kt+ue)},Q.readAsArrayBuffer(T)}else try{U(JSON.stringify(T))}catch(ue){console.error("Couldn't convert value into a JSON string: ",T),U(null,ue)}}function Ue(T){if(T.substring(0,sr)!==mr)return JSON.parse(T);var U=T.substring(X),I=T.substring(sr,X),W;if(I===kt&&Wt.test(U)){var Y=U.match(Wt);W=Y[1],U=U.substring(Y[0].length)}var Q=se(U);switch(I){case er:return Q;case kt:return _([Q],{type:W});case Rt:return new Int8Array(Q);case ar:return new Uint8Array(Q);case Er:return new Uint8ClampedArray(Q);case Bt:return new Int16Array(Q);case S:return new Uint16Array(Q);case ce:return new Int32Array(Q);case b:return new Uint32Array(Q);case E:return new Float32Array(Q);case q:return new Float64Array(Q);default:throw new Error("Unkown type: "+I)}}var ht={serialize:qe,deserialize:Ue,stringToBuffer:se,bufferToString:Se};function mt(T,U,I,W){T.executeSql("CREATE TABLE IF NOT EXISTS "+U.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],I,W)}function Qr(T){var U=this,I={db:null};if(T)for(var W in T)I[W]=typeof T[W]!="string"?T[W].toString():T[W];var Y=new f(function(Q,ue){try{I.db=openDatabase(I.name,String(I.version),I.description,I.size)}catch(N){return ue(N)}I.db.transaction(function(N){mt(N,I,function(){U._dbInfo=I,Q()},function(pe,ye){ue(ye)})},ue)});return I.serializer=ht,Y}function _r(T,U,I,W,Y,Q){T.executeSql(I,W,Y,function(ue,N){N.code===N.SYNTAX_ERR?ue.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[U.storeName],function(pe,ye){ye.rows.length?Q(pe,N):mt(pe,U,function(){pe.executeSql(I,W,Y,Q)},Q)},Q):Q(ue,N)},Q)}function gn(T,U){var I=this;T=p(T);var W=new f(function(Y,Q){I.ready().then(function(){var ue=I._dbInfo;ue.db.transaction(function(N){_r(N,ue,"SELECT * FROM "+ue.storeName+" WHERE key = ? LIMIT 1",[T],function(pe,ye){var _e=ye.rows.length?ye.rows.item(0).value:null;_e&&(_e=ue.serializer.deserialize(_e)),Y(_e)},function(pe,ye){Q(ye)})})}).catch(Q)});return l(W,U),W}function Sn(T,U){var I=this,W=new f(function(Y,Q){I.ready().then(function(){var ue=I._dbInfo;ue.db.transaction(function(N){_r(N,ue,"SELECT * FROM "+ue.storeName,[],function(pe,ye){for(var _e=ye.rows,Ce=_e.length,Pe=0;Pe<Ce;Pe++){var je=_e.item(Pe),Xe=je.value;if(Xe&&(Xe=ue.serializer.deserialize(Xe)),Xe=T(Xe,je.key,Pe+1),Xe!==void 0){Y(Xe);return}}Y()},function(pe,ye){Q(ye)})})}).catch(Q)});return l(W,U),W}function Tn(T,U,I,W){var Y=this;T=p(T);var Q=new f(function(ue,N){Y.ready().then(function(){U===void 0&&(U=null);var pe=U,ye=Y._dbInfo;ye.serializer.serialize(U,function(_e,Ce){Ce?N(Ce):ye.db.transaction(function(Pe){_r(Pe,ye,"INSERT OR REPLACE INTO "+ye.storeName+" (key, value) VALUES (?, ?)",[T,_e],function(){ue(pe)},function(je,Xe){N(Xe)})},function(Pe){if(Pe.code===Pe.QUOTA_ERR){if(W>0){ue(Tn.apply(Y,[T,pe,I,W-1]));return}N(Pe)}})})}).catch(N)});return l(Q,I),Q}function $r(T,U,I){return Tn.apply(this,[T,U,I,1])}function Nr(T,U){var I=this;T=p(T);var W=new f(function(Y,Q){I.ready().then(function(){var ue=I._dbInfo;ue.db.transaction(function(N){_r(N,ue,"DELETE FROM "+ue.storeName+" WHERE key = ?",[T],function(){Y()},function(pe,ye){Q(ye)})})}).catch(Q)});return l(W,U),W}function Hr(T){var U=this,I=new f(function(W,Y){U.ready().then(function(){var Q=U._dbInfo;Q.db.transaction(function(ue){_r(ue,Q,"DELETE FROM "+Q.storeName,[],function(){W()},function(N,pe){Y(pe)})})}).catch(Y)});return l(I,T),I}function sn(T){var U=this,I=new f(function(W,Y){U.ready().then(function(){var Q=U._dbInfo;Q.db.transaction(function(ue){_r(ue,Q,"SELECT COUNT(key) as c FROM "+Q.storeName,[],function(N,pe){var ye=pe.rows.item(0).c;W(ye)},function(N,pe){Y(pe)})})}).catch(Y)});return l(I,T),I}function mn(T,U){var I=this,W=new f(function(Y,Q){I.ready().then(function(){var ue=I._dbInfo;ue.db.transaction(function(N){_r(N,ue,"SELECT key FROM "+ue.storeName+" WHERE id = ? LIMIT 1",[T+1],function(pe,ye){var _e=ye.rows.length?ye.rows.item(0).key:null;Y(_e)},function(pe,ye){Q(ye)})})}).catch(Q)});return l(W,U),W}function Dn(T){var U=this,I=new f(function(W,Y){U.ready().then(function(){var Q=U._dbInfo;Q.db.transaction(function(ue){_r(ue,Q,"SELECT key FROM "+Q.storeName,[],function(N,pe){for(var ye=[],_e=0;_e<pe.rows.length;_e++)ye.push(pe.rows.item(_e).key);W(ye)},function(N,pe){Y(pe)})})}).catch(Y)});return l(I,T),I}function zn(T){return new f(function(U,I){T.transaction(function(W){W.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(Y,Q){for(var ue=[],N=0;N<Q.rows.length;N++)ue.push(Q.rows.item(N).name);U({db:T,storeNames:ue})},function(Y,Q){I(Q)})},function(W){I(W)})})}function tr(T,U){U=y.apply(this,arguments);var I=this.config();T=typeof T!="function"&&T||{},T.name||(T.name=T.name||I.name,T.storeName=T.storeName||I.storeName);var W=this,Y;return T.name?Y=new f(function(Q){var ue;T.name===I.name?ue=W._dbInfo.db:ue=openDatabase(T.name,"","",0),T.storeName?Q({db:ue,storeNames:[T.storeName]}):Q(zn(ue))}).then(function(Q){return new f(function(ue,N){Q.db.transaction(function(pe){function ye(je){return new f(function(Xe,Je){pe.executeSql("DROP TABLE IF EXISTS "+je,[],function(){Xe()},function(rt,xt){Je(xt)})})}for(var _e=[],Ce=0,Pe=Q.storeNames.length;Ce<Pe;Ce++)_e.push(ye(Q.storeNames[Ce]));f.all(_e).then(function(){ue()}).catch(function(je){N(je)})},function(pe){N(pe)})})}):Y=f.reject("Invalid arguments"),l(Y,U),Y}var In={_driver:"webSQLStorage",_initStorage:Qr,_support:qt(),iterate:Sn,getItem:gn,setItem:$r,removeItem:Nr,clear:Hr,length:sn,key:mn,keys:Dn,dropInstance:tr};function A(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function L(T,U){var I=T.name+"/";return T.storeName!==U.storeName&&(I+=T.storeName+"/"),I}function O(){var T="_localforage_support_test";try{return localStorage.setItem(T,!0),localStorage.removeItem(T),!1}catch{return!0}}function x(){return!O()||localStorage.length>0}function K(T){var U=this,I={};if(T)for(var W in T)I[W]=T[W];return I.keyPrefix=L(T,U._defaultConfig),x()?(U._dbInfo=I,I.serializer=ht,f.resolve()):f.reject()}function ie(T){var U=this,I=U.ready().then(function(){for(var W=U._dbInfo.keyPrefix,Y=localStorage.length-1;Y>=0;Y--){var Q=localStorage.key(Y);Q.indexOf(W)===0&&localStorage.removeItem(Q)}});return l(I,T),I}function ae(T,U){var I=this;T=p(T);var W=I.ready().then(function(){var Y=I._dbInfo,Q=localStorage.getItem(Y.keyPrefix+T);return Q&&(Q=Y.serializer.deserialize(Q)),Q});return l(W,U),W}function we(T,U){var I=this,W=I.ready().then(function(){for(var Y=I._dbInfo,Q=Y.keyPrefix,ue=Q.length,N=localStorage.length,pe=1,ye=0;ye<N;ye++){var _e=localStorage.key(ye);if(_e.indexOf(Q)===0){var Ce=localStorage.getItem(_e);if(Ce&&(Ce=Y.serializer.deserialize(Ce)),Ce=T(Ce,_e.substring(ue),pe++),Ce!==void 0)return Ce}}});return l(W,U),W}function Te(T,U){var I=this,W=I.ready().then(function(){var Y=I._dbInfo,Q;try{Q=localStorage.key(T)}catch{Q=null}return Q&&(Q=Q.substring(Y.keyPrefix.length)),Q});return l(W,U),W}function We(T){var U=this,I=U.ready().then(function(){for(var W=U._dbInfo,Y=localStorage.length,Q=[],ue=0;ue<Y;ue++){var N=localStorage.key(ue);N.indexOf(W.keyPrefix)===0&&Q.push(N.substring(W.keyPrefix.length))}return Q});return l(I,T),I}function ke(T){var U=this,I=U.keys().then(function(W){return W.length});return l(I,T),I}function Et(T,U){var I=this;T=p(T);var W=I.ready().then(function(){var Y=I._dbInfo;localStorage.removeItem(Y.keyPrefix+T)});return l(W,U),W}function Be(T,U,I){var W=this;T=p(T);var Y=W.ready().then(function(){U===void 0&&(U=null);var Q=U;return new f(function(ue,N){var pe=W._dbInfo;pe.serializer.serialize(U,function(ye,_e){if(_e)N(_e);else try{localStorage.setItem(pe.keyPrefix+T,ye),ue(Q)}catch(Ce){(Ce.name==="QuotaExceededError"||Ce.name==="NS_ERROR_DOM_QUOTA_REACHED")&&N(Ce),N(Ce)}})})});return l(Y,I),Y}function Ze(T,U){if(U=y.apply(this,arguments),T=typeof T!="function"&&T||{},!T.name){var I=this.config();T.name=T.name||I.name,T.storeName=T.storeName||I.storeName}var W=this,Y;return T.name?Y=new f(function(Q){T.storeName?Q(L(T,W._defaultConfig)):Q(T.name+"/")}).then(function(Q){for(var ue=localStorage.length-1;ue>=0;ue--){var N=localStorage.key(ue);N.indexOf(Q)===0&&localStorage.removeItem(N)}}):Y=f.reject("Invalid arguments"),l(Y,U),Y}var ot={_driver:"localStorageWrapper",_initStorage:K,_support:A(),iterate:we,getItem:ae,setItem:Be,removeItem:Et,clear:ie,length:ke,key:Te,keys:We,dropInstance:Ze},ft=function(U,I){return U===I||typeof U=="number"&&typeof I=="number"&&isNaN(U)&&isNaN(I)},st=function(U,I){for(var W=U.length,Y=0;Y<W;){if(ft(U[Y],I))return!0;Y++}return!1},et=Array.isArray||function(T){return Object.prototype.toString.call(T)==="[object Array]"},Ye={},tt={},Re={INDEXEDDB:Zt,WEBSQL:In,LOCALSTORAGE:ot},Ve=[Re.INDEXEDDB._driver,Re.WEBSQL._driver,Re.LOCALSTORAGE._driver],Ie=["dropInstance"],Le=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Ie),Ke={description:"",driver:Ve.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Fe(T,U){T[U]=function(){var I=arguments;return T.ready().then(function(){return T[U].apply(T,I)})}}function fe(){for(var T=1;T<arguments.length;T++){var U=arguments[T];if(U)for(var I in U)U.hasOwnProperty(I)&&(et(U[I])?arguments[0][I]=U[I].slice():arguments[0][I]=U[I])}return arguments[0]}var de=function(){function T(U){u(this,T);for(var I in Re)if(Re.hasOwnProperty(I)){var W=Re[I],Y=W._driver;this[I]=Y,Ye[Y]||this.defineDriver(W)}this._defaultConfig=fe({},Ke),this._config=fe({},this._defaultConfig,U),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return T.prototype.config=function(I){if((typeof I>"u"?"undefined":s(I))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var W in I){if(W==="storeName"&&(I[W]=I[W].replace(/\W/g,"_")),W==="version"&&typeof I[W]!="number")return new Error("Database version must be a number.");this._config[W]=I[W]}return"driver"in I&&I.driver?this.setDriver(this._config.driver):!0}else return typeof I=="string"?this._config[I]:this._config},T.prototype.defineDriver=function(I,W,Y){var Q=new f(function(ue,N){try{var pe=I._driver,ye=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!I._driver){N(ye);return}for(var _e=Le.concat("_initStorage"),Ce=0,Pe=_e.length;Ce<Pe;Ce++){var je=_e[Ce],Xe=!st(Ie,je);if((Xe||I[je])&&typeof I[je]!="function"){N(ye);return}}var Je=function(){for(var St=function(ai){return function(){var Qi=new Error("Method "+ai+" is not implemented by the current driver"),ui=f.reject(Qi);return l(ui,arguments[arguments.length-1]),ui}},Lt=0,Vt=Ie.length;Lt<Vt;Lt++){var Kt=Ie[Lt];I[Kt]||(I[Kt]=St(Kt))}};Je();var rt=function(St){Ye[pe]&&console.info("Redefining LocalForage driver: "+pe),Ye[pe]=I,tt[pe]=St,ue()};"_support"in I?I._support&&typeof I._support=="function"?I._support().then(rt,N):rt(!!I._support):rt(!0)}catch(xt){N(xt)}});return h(Q,W,Y),Q},T.prototype.driver=function(){return this._driver||null},T.prototype.getDriver=function(I,W,Y){var Q=Ye[I]?f.resolve(Ye[I]):f.reject(new Error("Driver not found."));return h(Q,W,Y),Q},T.prototype.getSerializer=function(I){var W=f.resolve(ht);return h(W,I),W},T.prototype.ready=function(I){var W=this,Y=W._driverSet.then(function(){return W._ready===null&&(W._ready=W._initDriver()),W._ready});return h(Y,I,I),Y},T.prototype.setDriver=function(I,W,Y){var Q=this;et(I)||(I=[I]);var ue=this._getSupportedDrivers(I);function N(){Q._config.driver=Q.driver()}function pe(Ce){return Q._extend(Ce),N(),Q._ready=Q._initStorage(Q._config),Q._ready}function ye(Ce){return function(){var Pe=0;function je(){for(;Pe<Ce.length;){var Xe=Ce[Pe];return Pe++,Q._dbInfo=null,Q._ready=null,Q.getDriver(Xe).then(pe).catch(je)}N();var Je=new Error("No available storage method found.");return Q._driverSet=f.reject(Je),Q._driverSet}return je()}}var _e=this._driverSet!==null?this._driverSet.catch(function(){return f.resolve()}):f.resolve();return this._driverSet=_e.then(function(){var Ce=ue[0];return Q._dbInfo=null,Q._ready=null,Q.getDriver(Ce).then(function(Pe){Q._driver=Pe._driver,N(),Q._wrapLibraryMethodsWithReady(),Q._initDriver=ye(ue)})}).catch(function(){N();var Ce=new Error("No available storage method found.");return Q._driverSet=f.reject(Ce),Q._driverSet}),h(this._driverSet,W,Y),this._driverSet},T.prototype.supports=function(I){return!!tt[I]},T.prototype._extend=function(I){fe(this,I)},T.prototype._getSupportedDrivers=function(I){for(var W=[],Y=0,Q=I.length;Y<Q;Y++){var ue=I[Y];this.supports(ue)&&W.push(ue)}return W},T.prototype._wrapLibraryMethodsWithReady=function(){for(var I=0,W=Le.length;I<W;I++)Fe(this,Le[I])},T.prototype.createInstance=function(I){return new T(I)},T}(),$e=new de;n.exports=$e},{3:3}]},{},[4])(4)})}(localforage$1)),localforage$1.exports}var localforageExports=requireLocalforage();const localforage=getDefaultExportFromCjs(localforageExports),isBrowser=typeof self<"u"&&typeof self.location=="object",assertBrowser=r=>{if(!isBrowser)throw new Error(`Must be in browser to use method. Provide a node-compatible implementation for ${r}`)},getItem$1=r=>(assertBrowser("storage.getItem"),localforage.getItem(r)),setItem$1=(r,e)=>(assertBrowser("storage.setItem"),localforage.setItem(r,e)),removeItem=r=>(assertBrowser("storage.removeItem"),localforage.removeItem(r)),clear$4=()=>(assertBrowser("storage.clear"),localforage.clear()),IMPLEMENTATION$1={getItem:getItem$1,setItem:setItem$1,removeItem,clear:clear$4};let impl$4=IMPLEMENTATION$1;const getItem=r=>impl$4.getItem(r),setItem=(r,e)=>impl$4.setItem(r,e),encode$h=(r,e,t)=>({major:r,minor:e,patch:t}),fromString$a=r=>{const e=r.split(".").map(t=>parseInt(t));return e.length!==3||e.some(t=>typeof t!="number")?null:{major:e[0],minor:e[1],patch:e[2]}},toString$c=r=>{const{major:e,minor:t,patch:n}=r;return`${e}.${t}.${n}`},equals$6=(r,e)=>r.major===e.major&&r.minor===e.minor&&r.patch===e.patch,isSmallerThan=(r,e)=>r.major!=e.major?r.major<e.major:r.minor!=e.minor?r.minor<e.minor:r.patch<e.patch,isBiggerThan=(r,e)=>isSmallerThan(e,r),isSupported=r=>isSmallerThan(r,latest)?"too-low":isBiggerThan(r,wnfsWasm)?"too-high":!0,v0=encode$h(0,0,0),latest=encode$h(2,0,0),wnfsWasm=encode$h(3,0,0),supported=[latest,wnfsWasm],setup={debug:!1,endpoints:{api:"https://runfission.com",apiVersion:"v2",apiUrl:null,lobby:"https://auth.fission.codes",user:"fission.name"},getApiEndpoint:()=>`${setup.endpoints.api}/${setup.endpoints.apiVersion}/api`,userMessages:{versionMismatch:{newer:async()=>alertIfPossible(`Sorry, we can't sync your filesystem with this app. This app only understands older versions of filesystems.

Please try to hard refresh this site or let this app's developer know.

Feel free to contact Fission support: support@fission.codes`),older:async()=>alertIfPossible(`Sorry, we can't sync your filesystem with this app. Your filesystem version is out-dated and it needs to be migrated.

Run a migration (https://guide.fission.codes/accounts/account-signup/account-migration) or talk to Fission support: support@fission.codes`)}},shouldPin:!1,fsVersion:toString$c(latest),wnfsWasmLookup:r=>fetch(`https://unpkg.com/wnfs@${r}/wasm_wnfs_bg.wasm`)};function alertIfPossible(r){globalThis.alert!=null&&globalThis.alert(r)}const FS_CID_LOG_PREFIX="webnative.wnfs_cid_log";function key(){return FS_CID_LOG_PREFIX+"-"+setup.endpoints.lobby}async function get$6(){return await getItem(key())||[]}async function index$1(r){const e=await get$6();return[e.indexOf(r),e.length]}async function newest(){return(await get$6())[0]}async function add$2(r){const e=await get$6(),t=[r,...e].slice(0,1e3);await setItem(key(),t)}async function lookupTxtRecord$1(r){return Promise.any([googleLookup(r),cloudflareLookup(r)])}async function googleLookup(r){return dnsOverHttps(`https://dns.google/resolve?name=${r}&type=txt`)}function cloudflareLookup(r){return dnsOverHttps(`https://cloudflare-dns.com/dns-query?name=${r}&type=txt`)}function dnsOverHttps(r){return fetch(r,{headers:{accept:"application/dns-json"}}).then(e=>e.json()).then(e=>{if(e.Answer){const t=e.Answer.map(n=>(n.data||"").replace(/^"+|"+$/g,""));return t[0][3]===";"?t.sort((n,i)=>n.slice(0,4).localeCompare(i.slice(0,4))).map(n=>n.slice(4)).join(""):t.join("")}else return null})}async function lookupDnsLink$1(r){const e=await lookupTxtRecord$1(r.startsWith("_dnslink.")?r:`_dnslink.${r}`);return e&&!e.includes("/ipns/")?e.replace(/^dnslink=/,"").replace(/^\/ipfs\//,""):null}const HTTP_IMPLEMENTATION={dns:{lookupDnsLink:lookupDnsLink$1,lookupTxtRecord:lookupTxtRecord$1}};let impl$3=HTTP_IMPLEMENTATION.dns;const lookupTxtRecord=async r=>impl$3.lookupTxtRecord(r),lookupDnsLink=async r=>impl$3.lookupDnsLink(r),didCache={did:null,host:null,lastFetched:0};async function did(){let r;try{r=new URL(setup.getApiEndpoint()).host}catch{throw new Error("Unable to parse API Endpoint")}const e=Date.now();if((didCache.host!==r||didCache.lastFetched+1e3*60*60*3<=e)&&(didCache.did=await lookupTxtRecord("_did."+r),didCache.host=r,didCache.lastFetched=e),!didCache.did)throw new Error("Couldn't get the Fission API DID");return didCache.did}const equal=(r,e)=>{const t=new Uint8Array(r),n=new Uint8Array(e);if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==n[i])return!1;return!0};function compare$1(r,e){for(let t=0;t<r.byteLength;t++){if(r[t]<e[t])return-1;if(r[t]>e[t])return 1}return r.byteLength>e.byteLength?1:r.byteLength<e.byteLength?-1:0}function asUint8Array$2(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function allocUnsafe$2(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?asUint8Array$2(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function concat$2(r,e){e||(e=r.reduce((i,s)=>i+s.length,0));const t=allocUnsafe$2(e);let n=0;for(const i of r)t.set(i,n),n+=i.length;return asUint8Array$2(t)}function equals$5(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function base$4(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),u=s.charCodeAt(0);if(t[u]!==255)throw new TypeError(s+" is ambiguous");t[u]=i}var c=r.length,d=r.charAt(0),g=Math.log(c)/Math.log(256),_=Math.log(256)/Math.log(c);function f(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var y=0,w=0,v=0,C=p.length;v!==C&&p[v]===0;)v++,y++;for(var P=(C-v)*_+1>>>0,R=new Uint8Array(P);v!==C;){for(var F=p[v],k=0,B=P-1;(F!==0||k<w)&&B!==-1;B--,k++)F+=256*R[B]>>>0,R[B]=F%c>>>0,F=F/c>>>0;if(F!==0)throw new Error("Non-zero carry");w=k,v++}for(var H=P-w;H!==P&&R[H]===0;)H++;for(var re=d.repeat(y);H<P;++H)re+=r.charAt(R[H]);return re}function l(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var y=0;if(p[y]!==" "){for(var w=0,v=0;p[y]===d;)w++,y++;for(var C=(p.length-y)*g+1>>>0,P=new Uint8Array(C);p[y];){var R=t[p.charCodeAt(y)];if(R===255)return;for(var F=0,k=C-1;(R!==0||F<v)&&k!==-1;k--,F++)R+=c*P[k]>>>0,P[k]=R%256>>>0,R=R/256>>>0;if(R!==0)throw new Error("Non-zero carry");v=F,y++}if(p[y]!==" "){for(var B=C-v;B!==C&&P[B]===0;)B++;for(var H=new Uint8Array(w+(C-B)),re=w;B!==C;)H[re++]=P[B++];return H}}}function h(p){var y=l(p);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:l,decode:h}}var src$4=base$4,_brrp__multiformats_scope_baseX$4=src$4;const equals$4=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},coerce$4=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},fromString$9=r=>new TextEncoder().encode(r),toString$b=r=>new TextDecoder().decode(r);let Encoder$4=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Decoder$4=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or$4(this,e)}},ComposedDecoder$4=class{constructor(e){this.decoders=e}or(e){return or$4(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const or$4=(r,e)=>new ComposedDecoder$4({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let Codec$4=class{constructor(e,t,n,i){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Encoder$4(e,t,n),this.decoder=new Decoder$4(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const from$5=({name:r,prefix:e,encode:t,decode:n})=>new Codec$4(r,e,t,n),baseX$4=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:i}=_brrp__multiformats_scope_baseX$4(t,e);return from$5({prefix:r,name:e,encode:n,decode:s=>coerce$4(i(s))})},decode$l=(r,e,t,n)=>{const i={};for(let _=0;_<e.length;++_)i[e[_]]=_;let s=r.length;for(;r[s-1]==="=";)--s;const u=new Uint8Array(s*t/8|0);let c=0,d=0,g=0;for(let _=0;_<s;++_){const f=i[r[_]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);d=d<<t|f,c+=t,c>=8&&(c-=8,u[g++]=255&d>>c)}if(c>=t||255&d<<8-c)throw new SyntaxError("Unexpected end of data");return u},encode$g=(r,e,t)=>{const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",u=0,c=0;for(let d=0;d<r.length;++d)for(c=c<<8|r[d],u+=8;u>t;)u-=t,s+=e[i&c>>u];if(u&&(s+=e[i&c<<t-u]),n)for(;s.length*t&7;)s+="=";return s},rfc4648$4=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>from$5({prefix:e,name:r,encode(i){return encode$g(i,n,t)},decode(i){return decode$l(i,n,t,r)}}),identity$4=from$5({prefix:"\0",name:"identity",encode:r=>toString$b(r),decode:r=>fromString$9(r)}),identityBase$3=Object.freeze(Object.defineProperty({__proto__:null,identity:identity$4},Symbol.toStringTag,{value:"Module"})),base2$6=rfc4648$4({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$7=Object.freeze(Object.defineProperty({__proto__:null,base2:base2$6},Symbol.toStringTag,{value:"Module"})),base8$6=rfc4648$4({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$7=Object.freeze(Object.defineProperty({__proto__:null,base8:base8$6},Symbol.toStringTag,{value:"Module"})),base10$6=baseX$4({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$7=Object.freeze(Object.defineProperty({__proto__:null,base10:base10$6},Symbol.toStringTag,{value:"Module"})),base16$6=rfc4648$4({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper$3=rfc4648$4({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$7=Object.freeze(Object.defineProperty({__proto__:null,base16:base16$6,base16upper:base16upper$3},Symbol.toStringTag,{value:"Module"})),base32$7=rfc4648$4({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper$3=rfc4648$4({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad$3=rfc4648$4({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper$3=rfc4648$4({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex$3=rfc4648$4({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper$3=rfc4648$4({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad$3=rfc4648$4({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper$3=rfc4648$4({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z$3=rfc4648$4({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$8=Object.freeze(Object.defineProperty({__proto__:null,base32:base32$7,base32hex:base32hex$3,base32hexpad:base32hexpad$3,base32hexpadupper:base32hexpadupper$3,base32hexupper:base32hexupper$3,base32pad:base32pad$3,base32padupper:base32padupper$3,base32upper:base32upper$3,base32z:base32z$3},Symbol.toStringTag,{value:"Module"})),base36$6=baseX$4({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper$3=baseX$4({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$7=Object.freeze(Object.defineProperty({__proto__:null,base36:base36$6,base36upper:base36upper$3},Symbol.toStringTag,{value:"Module"})),base58btc$4=baseX$4({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr$3=baseX$4({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58$3=Object.freeze(Object.defineProperty({__proto__:null,base58btc:base58btc$4,base58flickr:base58flickr$3},Symbol.toStringTag,{value:"Module"})),base64$8=rfc4648$4({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad$3=rfc4648$4({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url$3=rfc4648$4({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad$3=rfc4648$4({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$9=Object.freeze(Object.defineProperty({__proto__:null,base64:base64$8,base64pad:base64pad$3,base64url:base64url$3,base64urlpad:base64urlpad$3},Symbol.toStringTag,{value:"Module"})),alphabet$3=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),alphabetBytesToChars$3=alphabet$3.reduce((r,e,t)=>(r[t]=e,r),[]),alphabetCharsToBytes$3=alphabet$3.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function encode$f(r){return r.reduce((e,t)=>(e+=alphabetBytesToChars$3[t],e),"")}function decode$k(r){const e=[];for(const t of r){const n=alphabetCharsToBytes$3[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const base256emoji$6=from$5({prefix:"🚀",name:"base256emoji",encode:encode$f,decode:decode$k}),base256emoji$7=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:base256emoji$6},Symbol.toStringTag,{value:"Module"}));var encode_1$2=encode$e,MSB$2=128,MSBALL$1=-128,INT$1=Math.pow(2,31);function encode$e(r,e,t){e=e||[],t=t||0;for(var n=t;r>=INT$1;)e[t++]=r&255|MSB$2,r/=128;for(;r&MSBALL$1;)e[t++]=r&255|MSB$2,r>>>=7;return e[t]=r|0,encode$e.bytes=t-n+1,e}var decode$j=read$1,MSB$1$1=128,REST$1$1=127;function read$1(r,n){var t=0,n=n||0,i=0,s=n,u,c=r.length;do{if(s>=c)throw read$1.bytes=0,new RangeError("Could not decode varint");u=r[s++],t+=i<28?(u&REST$1$1)<<i:(u&REST$1$1)*Math.pow(2,i),i+=7}while(u>=MSB$1$1);return read$1.bytes=s-n,t}var N1$1=Math.pow(2,7),N2$1=Math.pow(2,14),N3$1=Math.pow(2,21),N4$1=Math.pow(2,28),N5$1=Math.pow(2,35),N6$1=Math.pow(2,42),N7$1=Math.pow(2,49),N8$1=Math.pow(2,56),N9$1=Math.pow(2,63),length$3=function(r){return r<N1$1?1:r<N2$1?2:r<N3$1?3:r<N4$1?4:r<N5$1?5:r<N6$1?6:r<N7$1?7:r<N8$1?8:r<N9$1?9:10},varint$3={encode:encode_1$2,decode:decode$j,encodingLength:length$3},_brrp_varint$1=varint$3;const decode$i=(r,e=0)=>[_brrp_varint$1.decode(r,e),_brrp_varint$1.decode.bytes],encodeTo$1=(r,e,t=0)=>(_brrp_varint$1.encode(r,e,t),e),encodingLength$1=r=>_brrp_varint$1.encodingLength(r),create$3=(r,e)=>{const t=e.byteLength,n=encodingLength$1(r),i=n+encodingLength$1(t),s=new Uint8Array(i+t);return encodeTo$1(r,s,0),encodeTo$1(t,s,n),s.set(e,i),new Digest$1(r,t,e,s)},decode$h=r=>{const e=coerce$4(r),[t,n]=decode$i(e),[i,s]=decode$i(e.subarray(n)),u=e.subarray(n+s);if(u.byteLength!==i)throw new Error("Incorrect length");return new Digest$1(t,i,u,e)},equals$3=(r,e)=>r===e?!0:r.code===e.code&&r.size===e.size&&equals$4(r.bytes,e.bytes);let Digest$1=class{constructor(e,t,n,i){this.code=e,this.size=t,this.digest=n,this.bytes=i}};const from$4=({name:r,code:e,encode:t})=>new Hasher(r,e,t);class Hasher{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?create$3(this.code,t):t.then(n=>create$3(this.code,n))}else throw Error("Unknown type, must be binary type")}}const sha=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),sha256=from$4({name:"sha2-256",code:18,encode:sha("SHA-256")}),code$3=0,identity$3={code:code$3},name$2="raw",code$2=85,encode$d=r=>coerce$4(r),decode$g=r=>coerce$4(r),raw=Object.freeze(Object.defineProperty({__proto__:null,code:code$2,decode:decode$g,encode:encode$d,name:name$2},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;let CID$1=class gr{constructor(e,t,n,i){this.code=t,this.version=e,this.multihash=n,this.bytes=i,this.byteOffset=i.byteOffset,this.byteLength=i.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:hidden,byteLength:hidden,code:readonly$1,version:readonly$1,multihash:readonly$1,bytes:readonly$1,_baseCache:hidden,asCID:hidden})}toV0(){switch(this.version){case 0:return this;default:{const{code:e,multihash:t}=this;if(e!==DAG_PB_CODE$1)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==SHA_256_CODE$1)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return gr.createV0(t)}}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=create$3(e,t);return gr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&equals$3(this.multihash,e.multihash)}toString(e){const{bytes:t,version:n,_baseCache:i}=this;switch(n){case 0:return toStringV0$1(t,i,e||base58btc$4.encoder);default:return toStringV1$1(t,i,e||base32$7.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return deprecate(/^0\.0/,IS_CID_DEPRECATION),!!(e&&(e[cidSymbol$1]||e.asCID===e))}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof gr)return e;if(e!=null&&e.asCID===e){const{version:t,code:n,multihash:i,bytes:s}=e;return new gr(t,n,i,s||encodeCID$1(t,n,i.bytes))}else if(e!=null&&e[cidSymbol$1]===!0){const{version:t,multihash:n,code:i}=e,s=decode$h(n);return gr.create(t,i,s)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");switch(e){case 0:{if(t!==DAG_PB_CODE$1)throw new Error(`Version 0 CID must use dag-pb (code: ${DAG_PB_CODE$1}) block encoding`);return new gr(e,t,n,n.bytes)}case 1:{const i=encodeCID$1(e,t,n.bytes);return new gr(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return gr.create(0,DAG_PB_CODE$1,e)}static createV1(e,t){return gr.create(1,e,t)}static decode(e){const[t,n]=gr.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=gr.inspectBytes(e),n=t.size-t.multihashSize,i=coerce$4(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),u=new Digest$1(t.multihashCode,t.digestSize,s,i);return[t.version===0?gr.createV0(u):gr.createV1(t.codec,u),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[f,l]=decode$i(e.subarray(t));return t+=l,f};let i=n(),s=DAG_PB_CODE$1;if(i===18?(i=0,t=0):i===1&&(s=n()),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const u=t,c=n(),d=n(),g=t+d,_=g-u;return{version:i,codec:s,multihashCode:c,digestSize:d,multihashSize:_,size:g}}static parse(e,t){const[n,i]=parseCIDtoBytes$1(e,t),s=gr.decode(i);return s._baseCache.set(n,e),s}};const parseCIDtoBytes$1=(r,e)=>{switch(r[0]){case"Q":{const t=e||base58btc$4;return[base58btc$4.prefix,t.decode(`${base58btc$4.prefix}${r}`)]}case base58btc$4.prefix:{const t=e||base58btc$4;return[base58btc$4.prefix,t.decode(r)]}case base32$7.prefix:{const t=e||base32$7;return[base32$7.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},toStringV0$1=(r,e,t)=>{const{prefix:n}=t;if(n!==base58btc$4.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i},toStringV1$1=(r,e,t)=>{const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i},DAG_PB_CODE$1=112,SHA_256_CODE$1=18,encodeCID$1=(r,e,t)=>{const n=encodingLength$1(r),i=n+encodingLength$1(e),s=new Uint8Array(i+t.byteLength);return encodeTo$1(r,s,0),encodeTo$1(e,s,n),s.set(t,i),s},cidSymbol$1=Symbol.for("@ipld/js-cid/CID"),readonly$1={writable:!1,configurable:!1,enumerable:!0},hidden={writable:!1,enumerable:!1,configurable:!1},version$1="0.0.0-dev",deprecate=(r,e)=>{if(r.test(version$1))console.warn(e);else throw new Error(e)},IS_CID_DEPRECATION=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`,bases$3={...identityBase$3,...base2$7,...base8$7,...base10$7,...base16$7,...base32$8,...base36$7,...base58$3,...base64$9,...base256emoji$7};function createCodec$2(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}const string$2=createCodec$2("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),ascii$2=createCodec$2("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=allocUnsafe$2(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),BASES$2={utf8:string$2,"utf-8":string$2,hex:bases$3.base16,latin1:ascii$2,ascii:ascii$2,binary:ascii$2,...bases$3};function fromString$8(r,e="utf8"){const t=BASES$2[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?asUint8Array$2(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}function toString$a(r,e="utf8"){const t=BASES$2[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}function decode$f(r){return toString$a(fromString$8(r,"base64pad"))}function encode$c(r){return toString$a(fromString$8(r),"base64pad")}function urlDecode(r){return decode$f(makeUrlUnsafe(r))}function urlEncode(r){return makeUrlSafe(encode$c(r))}function makeUrlSafe(r){return r.replace(/\//g,"_").replace(/\+/g,"-").replace(/=+$/,"")}function makeUrlUnsafe(r){return r.replace(/_/g,"/").replace(/-/g,"+")}const toUint8Array=async r=>new Promise((e,t)=>{const n=()=>t(new Error("Failed to read file")),i=new FileReader;i.addEventListener("load",s=>{var c;const u=((c=s==null?void 0:s.target)==null?void 0:c.result)||null;if(u==null){n();return}if(typeof u=="string"){e(fromString$8(u));return}e(new Uint8Array(u))}),i.addEventListener("error",()=>i.abort()),i.addEventListener("abort",n),i.readAsArrayBuffer(r)});function decodeCID(r){const e=CID$1.asCID(r);if(e)return e;if(typeof r=="string")return CID$1.parse(r);if(typeof r=="object"&&"version"in r&&"code"in r&&"multihash"in r)return CID$1.create(r.version,r.code,r.multihash);throw new Error(`Could not decode CID: ${r}`)}function hasProp(r,e){return typeof r=="object"&&r!=null&&e in r}const isDefined=r=>r!==void 0,notNull=r=>r!==null,isJust=notNull,isValue=r=>isDefined(r)&&notNull(r),isBool=r=>typeof r=="boolean",isNum=r=>typeof r=="number",isString=r=>typeof r=="string",isObject=r=>r!==null&&typeof r=="object",isBlob=r=>{var e;return typeof Blob>"u"?!1:r instanceof Blob||isObject(r)&&((e=r==null?void 0:r.constructor)==null?void 0:e.name)==="Blob"},removeKeyFromObj=(r,e)=>{const{[e]:t,...n}=r;return n},mapObj=(r,e)=>{const t={};return Object.entries(r).forEach(([n,i])=>{t[n]=e(i,n)}),t},WASM_WNFS_VERSION="0.1.7",UCANS_STORAGE_KEY="webnative.auth_ucans",USERNAME_STORAGE_KEY="webnative.auth_username";async function authenticatedUsername(){return getItem(USERNAME_STORAGE_KEY).then(r=>r||null)}async function authenticatedUserDomain({withFiles:r}={}){const e=await authenticatedUsername();return e?e+"."+(r?"files.":"")+setup.endpoints.user:null}function log$9(...r){}function warn(...r){}let dictionary={};function getDictionary(){return dictionary}function setDictionary(r){dictionary=r}const _globalReference=globalThis||window||self,webcrypto=_globalReference.crypto;var CryptoSystem;(function(r){r.ECC="ecc",r.RSA="rsa"})(CryptoSystem||(CryptoSystem={}));var EccCurve;(function(r){r.P_256="P-256",r.P_384="P-384",r.P_521="P-521"})(EccCurve||(EccCurve={}));var RsaSize;(function(r){r[r.B1024=1024]="B1024",r[r.B2048=2048]="B2048",r[r.B4096=4096]="B4096"})(RsaSize||(RsaSize={}));var SymmAlg;(function(r){r.AES_CTR="AES-CTR",r.AES_CBC="AES-CBC",r.AES_GCM="AES-GCM"})(SymmAlg||(SymmAlg={}));var SymmKeyLength;(function(r){r[r.B128=128]="B128",r[r.B192=192]="B192",r[r.B256=256]="B256"})(SymmKeyLength||(SymmKeyLength={}));var HashAlg;(function(r){r.SHA_1="SHA-1",r.SHA_256="SHA-256",r.SHA_384="SHA-384",r.SHA_512="SHA-512"})(HashAlg||(HashAlg={}));var CharSize;(function(r){r[r.B8=8]="B8",r[r.B16=16]="B16"})(CharSize||(CharSize={}));var KeyUse;(function(r){r.Exchange="exchange",r.Write="write"})(KeyUse||(KeyUse={}));const types=Object.freeze(Object.defineProperty({__proto__:null,get CharSize(){return CharSize},get CryptoSystem(){return CryptoSystem},get EccCurve(){return EccCurve},get HashAlg(){return HashAlg},get KeyUse(){return KeyUse},get RsaSize(){return RsaSize},get SymmAlg(){return SymmAlg},get SymmKeyLength(){return SymmKeyLength}},Symbol.toStringTag,{value:"Module"})),KeyDoesNotExist=new Error("Key does not exist. Make sure you properly instantiated the keystore."),NotKeyPair=new Error("Retrieved a symmetric key when an asymmetric keypair was expected. Please use a different key name."),NotKey=new Error("Retrieved an asymmetric keypair when an symmetric key was expected. Please use a different key name."),ECCNotEnabled=new Error("ECC is not enabled for this browser. Please use RSA instead."),UnsupportedCrypto=new Error("Cryptosystem not supported. Please use ECC or RSA"),InvalidKeyUse=new Error("Invalid key use. Please use 'exchange' or 'write"),InvalidMaxValue=new Error("Max must be less than 256 and greater than 0");function checkIsKeyPair(r){if(!r||r===null)throw KeyDoesNotExist;if(r.privateKey===void 0)throw NotKeyPair;return r}function checkIsKey(r){if(!r||r===null)throw KeyDoesNotExist;if(r.privateKey!==void 0||r.algorithm===void 0)throw NotKey;return r}function checkValidCryptoSystem(r){checkValid(r,[CryptoSystem.ECC,CryptoSystem.RSA],UnsupportedCrypto)}function checkValidKeyUse(r){checkValid(r,[KeyUse.Exchange,KeyUse.Write],InvalidKeyUse)}function checkValid(r,e,t){if(!e.some(i=>i===r))throw t}const errors$1={InvalidMaxValue};function arrBufToStr(r,e){const t=e===8?new Uint8Array(r):new Uint16Array(r);return Array.from(t).map(n=>String.fromCharCode(n)).join("")}function arrBufToBase64(r){return toString$a(new Uint8Array(r),"base64pad")}function strToArrBuf(r,e){const t=e===8?new Uint8Array(r.length):new Uint16Array(r.length);for(let n=0,i=r.length;n<i;n++)t[n]=r.charCodeAt(n);return t.buffer}function base64ToArrBuf(r){return fromString$8(r,"base64pad").buffer}function publicExponent(){return new Uint8Array([1,0,1])}function randomBuf(r,{max:e}={max:255}){if(e<1||e>255)throw errors$1.InvalidMaxValue;const t=new Uint8Array(r);if(e==255)return webcrypto.getRandomValues(t),t.buffer;let n=0;const i=e+1,s=Math.floor(256/i)*i,u=new Uint8Array(1);for(;n<t.length;)webcrypto.getRandomValues(u),u[0]<s&&(t[n]=u[0]%i,n++);return t.buffer}function joinBufs(r,e){const t=new Uint8Array(r),n=new Uint8Array(e),i=new Uint8Array(t.length+n.length);return i.set(t),i.set(n,t.length),i.buffer}const normalizeUtf8ToBuf=r=>normalizeToBuf(r,e=>strToArrBuf(e,CharSize.B8)),normalizeUtf16ToBuf=r=>normalizeToBuf(r,e=>strToArrBuf(e,CharSize.B16)),normalizeBase64ToBuf=r=>normalizeToBuf(r,base64ToArrBuf),normalizeUnicodeToBuf=(r,e)=>{switch(e){case 8:return normalizeUtf8ToBuf(r);default:return normalizeUtf16ToBuf(r)}},normalizeToBuf=(r,e)=>{if(typeof r=="string")return e(r);if(typeof r=="object"&&r.byteLength!==void 0)return new Uint8Array(r).buffer;throw new Error("Improper value. Must be a string, ArrayBuffer, Uint8Array")};async function structuralClone(r){return new Promise(e=>{const{port1:t,port2:n}=new MessageChannel;n.onmessage=i=>e(i.data),t.postMessage(r)})}const utils$1={arrBufToStr,arrBufToBase64,strToArrBuf,base64ToArrBuf,publicExponent,randomBuf,joinBufs,normalizeUtf8ToBuf,normalizeUtf16ToBuf,normalizeBase64ToBuf,normalizeToBuf,structuralClone},utils$2=Object.freeze(Object.defineProperty({__proto__:null,arrBufToBase64,arrBufToStr,base64ToArrBuf,default:utils$1,joinBufs,normalizeBase64ToBuf,normalizeToBuf,normalizeUnicodeToBuf,normalizeUtf16ToBuf,normalizeUtf8ToBuf,publicExponent,randomBuf,strToArrBuf,structuralClone},Symbol.toStringTag,{value:"Module"})),ECC_EXCHANGE_ALG="ECDH",ECC_WRITE_ALG="ECDSA",RSA_EXCHANGE_ALG="RSA-OAEP",RSA_WRITE_ALG="RSASSA-PKCS1-v1_5",SALT_LENGTH=128,DEFAULT_CRYPTOSYSTEM="ecc",DEFAULT_ECC_CURVE=EccCurve.P_256,DEFAULT_RSA_SIZE=RsaSize.B2048,DEFAULT_SYMM_ALG=SymmAlg.AES_CTR,DEFAULT_SYMM_LEN=SymmKeyLength.B256,DEFAULT_CTR_LEN=64,DEFAULT_HASH_ALG=HashAlg.SHA_256,DEFAULT_CHAR_SIZE=CharSize.B16,DEFAULT_STORE_NAME="keystore",DEFAULT_EXCHANGE_KEY_NAME="exchange-key",DEFAULT_WRITE_KEY_NAME="write-key",constants={ECC_EXCHANGE_ALG,ECC_WRITE_ALG,RSA_EXCHANGE_ALG,RSA_WRITE_ALG,SALT_LENGTH,DEFAULT_CRYPTOSYSTEM,DEFAULT_ECC_CURVE,DEFAULT_RSA_SIZE,DEFAULT_SYMM_ALG,DEFAULT_CTR_LEN,DEFAULT_HASH_ALG,DEFAULT_CHAR_SIZE,DEFAULT_STORE_NAME,DEFAULT_EXCHANGE_KEY_NAME,DEFAULT_WRITE_KEY_NAME},constants$1=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_CHAR_SIZE,DEFAULT_CRYPTOSYSTEM,DEFAULT_CTR_LEN,DEFAULT_ECC_CURVE,DEFAULT_EXCHANGE_KEY_NAME,DEFAULT_HASH_ALG,DEFAULT_RSA_SIZE,DEFAULT_STORE_NAME,DEFAULT_SYMM_ALG,DEFAULT_SYMM_LEN,DEFAULT_WRITE_KEY_NAME,ECC_EXCHANGE_ALG,ECC_WRITE_ALG,RSA_EXCHANGE_ALG,RSA_WRITE_ALG,SALT_LENGTH,default:constants},Symbol.toStringTag,{value:"Module"}));async function makeKey(r){return webcrypto.subtle.generateKey({name:(r==null?void 0:r.alg)||DEFAULT_SYMM_ALG,length:(r==null?void 0:r.length)||DEFAULT_SYMM_LEN},!0,["encrypt","decrypt"])}async function importKey(r,e){const t=utils$1.base64ToArrBuf(r);return webcrypto.subtle.importKey("raw",t,{name:(e==null?void 0:e.alg)||DEFAULT_SYMM_ALG,length:(e==null?void 0:e.length)||DEFAULT_SYMM_LEN},!0,["encrypt","decrypt"])}const keys$2={makeKey,importKey};async function encryptBytes(r,e,t){const n=utils$1.normalizeUtf16ToBuf(r),i=typeof e=="string"?await keys$2.importKey(e,t):e,s=(t==null?void 0:t.alg)||DEFAULT_SYMM_ALG,u=(t==null?void 0:t.iv)||utils$1.randomBuf(16),c=await webcrypto.subtle.encrypt({name:s,iv:s===SymmAlg.AES_CTR?void 0:u,counter:s===SymmAlg.AES_CTR?new Uint8Array(u):void 0,length:s===SymmAlg.AES_CTR?DEFAULT_CTR_LEN:void 0},i,n);return utils$1.joinBufs(u,c)}async function decryptBytes(r,e,t){const n=utils$1.normalizeBase64ToBuf(r),i=typeof e=="string"?await keys$2.importKey(e,t):e,s=(t==null?void 0:t.alg)||DEFAULT_SYMM_ALG,u=n.slice(0,16),c=n.slice(16);return await webcrypto.subtle.decrypt({name:s,iv:s===SymmAlg.AES_CTR?void 0:u,counter:s===SymmAlg.AES_CTR?new Uint8Array(u):void 0,length:s===SymmAlg.AES_CTR?DEFAULT_CTR_LEN:void 0},i,c)}async function encrypt$2(r,e,t){const n=await encryptBytes(r,e,t);return utils$1.arrBufToBase64(n)}async function decrypt$2(r,e,t){const n=await decryptBytes(r,e,t);return utils$1.arrBufToStr(n,16)}async function exportKey(r){const e=await webcrypto.subtle.exportKey("raw",r);return utils$1.arrBufToBase64(e)}const operations$2={encryptBytes,decryptBytes,encrypt:encrypt$2,decrypt:decrypt$2,exportKey},aes$1={...keys$2,...operations$2};var naclFast={exports:{}},hasRequiredNaclFast;function requireNaclFast(){return hasRequiredNaclFast||(hasRequiredNaclFast=1,function(r){(function(e){var t=function(A){var L,O=new Float64Array(16);if(A)for(L=0;L<A.length;L++)O[L]=A[L];return O},n=function(){throw new Error("no PRNG")},i=new Uint8Array(16),s=new Uint8Array(32);s[0]=9;var u=t(),c=t([1]),d=t([56129,1]),g=t([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),_=t([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),f=t([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),l=t([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),h=t([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function p(A,L,O,x){A[L]=O>>24&255,A[L+1]=O>>16&255,A[L+2]=O>>8&255,A[L+3]=O&255,A[L+4]=x>>24&255,A[L+5]=x>>16&255,A[L+6]=x>>8&255,A[L+7]=x&255}function y(A,L,O,x,K){var ie,ae=0;for(ie=0;ie<K;ie++)ae|=A[L+ie]^O[x+ie];return(1&ae-1>>>8)-1}function w(A,L,O,x){return y(A,L,O,x,16)}function v(A,L,O,x){return y(A,L,O,x,32)}function C(A,L,O,x){for(var K=x[0]&255|(x[1]&255)<<8|(x[2]&255)<<16|(x[3]&255)<<24,ie=O[0]&255|(O[1]&255)<<8|(O[2]&255)<<16|(O[3]&255)<<24,ae=O[4]&255|(O[5]&255)<<8|(O[6]&255)<<16|(O[7]&255)<<24,we=O[8]&255|(O[9]&255)<<8|(O[10]&255)<<16|(O[11]&255)<<24,Te=O[12]&255|(O[13]&255)<<8|(O[14]&255)<<16|(O[15]&255)<<24,We=x[4]&255|(x[5]&255)<<8|(x[6]&255)<<16|(x[7]&255)<<24,ke=L[0]&255|(L[1]&255)<<8|(L[2]&255)<<16|(L[3]&255)<<24,Et=L[4]&255|(L[5]&255)<<8|(L[6]&255)<<16|(L[7]&255)<<24,Be=L[8]&255|(L[9]&255)<<8|(L[10]&255)<<16|(L[11]&255)<<24,Ze=L[12]&255|(L[13]&255)<<8|(L[14]&255)<<16|(L[15]&255)<<24,ot=x[8]&255|(x[9]&255)<<8|(x[10]&255)<<16|(x[11]&255)<<24,ft=O[16]&255|(O[17]&255)<<8|(O[18]&255)<<16|(O[19]&255)<<24,st=O[20]&255|(O[21]&255)<<8|(O[22]&255)<<16|(O[23]&255)<<24,et=O[24]&255|(O[25]&255)<<8|(O[26]&255)<<16|(O[27]&255)<<24,Ye=O[28]&255|(O[29]&255)<<8|(O[30]&255)<<16|(O[31]&255)<<24,tt=x[12]&255|(x[13]&255)<<8|(x[14]&255)<<16|(x[15]&255)<<24,Re=K,Ve=ie,Ie=ae,Le=we,Ke=Te,Fe=We,fe=ke,de=Et,$e=Be,T=Ze,U=ot,I=ft,W=st,Y=et,Q=Ye,ue=tt,N,pe=0;pe<20;pe+=2)N=Re+W|0,Ke^=N<<7|N>>>25,N=Ke+Re|0,$e^=N<<9|N>>>23,N=$e+Ke|0,W^=N<<13|N>>>19,N=W+$e|0,Re^=N<<18|N>>>14,N=Fe+Ve|0,T^=N<<7|N>>>25,N=T+Fe|0,Y^=N<<9|N>>>23,N=Y+T|0,Ve^=N<<13|N>>>19,N=Ve+Y|0,Fe^=N<<18|N>>>14,N=U+fe|0,Q^=N<<7|N>>>25,N=Q+U|0,Ie^=N<<9|N>>>23,N=Ie+Q|0,fe^=N<<13|N>>>19,N=fe+Ie|0,U^=N<<18|N>>>14,N=ue+I|0,Le^=N<<7|N>>>25,N=Le+ue|0,de^=N<<9|N>>>23,N=de+Le|0,I^=N<<13|N>>>19,N=I+de|0,ue^=N<<18|N>>>14,N=Re+Le|0,Ve^=N<<7|N>>>25,N=Ve+Re|0,Ie^=N<<9|N>>>23,N=Ie+Ve|0,Le^=N<<13|N>>>19,N=Le+Ie|0,Re^=N<<18|N>>>14,N=Fe+Ke|0,fe^=N<<7|N>>>25,N=fe+Fe|0,de^=N<<9|N>>>23,N=de+fe|0,Ke^=N<<13|N>>>19,N=Ke+de|0,Fe^=N<<18|N>>>14,N=U+T|0,I^=N<<7|N>>>25,N=I+U|0,$e^=N<<9|N>>>23,N=$e+I|0,T^=N<<13|N>>>19,N=T+$e|0,U^=N<<18|N>>>14,N=ue+Q|0,W^=N<<7|N>>>25,N=W+ue|0,Y^=N<<9|N>>>23,N=Y+W|0,Q^=N<<13|N>>>19,N=Q+Y|0,ue^=N<<18|N>>>14;Re=Re+K|0,Ve=Ve+ie|0,Ie=Ie+ae|0,Le=Le+we|0,Ke=Ke+Te|0,Fe=Fe+We|0,fe=fe+ke|0,de=de+Et|0,$e=$e+Be|0,T=T+Ze|0,U=U+ot|0,I=I+ft|0,W=W+st|0,Y=Y+et|0,Q=Q+Ye|0,ue=ue+tt|0,A[0]=Re>>>0&255,A[1]=Re>>>8&255,A[2]=Re>>>16&255,A[3]=Re>>>24&255,A[4]=Ve>>>0&255,A[5]=Ve>>>8&255,A[6]=Ve>>>16&255,A[7]=Ve>>>24&255,A[8]=Ie>>>0&255,A[9]=Ie>>>8&255,A[10]=Ie>>>16&255,A[11]=Ie>>>24&255,A[12]=Le>>>0&255,A[13]=Le>>>8&255,A[14]=Le>>>16&255,A[15]=Le>>>24&255,A[16]=Ke>>>0&255,A[17]=Ke>>>8&255,A[18]=Ke>>>16&255,A[19]=Ke>>>24&255,A[20]=Fe>>>0&255,A[21]=Fe>>>8&255,A[22]=Fe>>>16&255,A[23]=Fe>>>24&255,A[24]=fe>>>0&255,A[25]=fe>>>8&255,A[26]=fe>>>16&255,A[27]=fe>>>24&255,A[28]=de>>>0&255,A[29]=de>>>8&255,A[30]=de>>>16&255,A[31]=de>>>24&255,A[32]=$e>>>0&255,A[33]=$e>>>8&255,A[34]=$e>>>16&255,A[35]=$e>>>24&255,A[36]=T>>>0&255,A[37]=T>>>8&255,A[38]=T>>>16&255,A[39]=T>>>24&255,A[40]=U>>>0&255,A[41]=U>>>8&255,A[42]=U>>>16&255,A[43]=U>>>24&255,A[44]=I>>>0&255,A[45]=I>>>8&255,A[46]=I>>>16&255,A[47]=I>>>24&255,A[48]=W>>>0&255,A[49]=W>>>8&255,A[50]=W>>>16&255,A[51]=W>>>24&255,A[52]=Y>>>0&255,A[53]=Y>>>8&255,A[54]=Y>>>16&255,A[55]=Y>>>24&255,A[56]=Q>>>0&255,A[57]=Q>>>8&255,A[58]=Q>>>16&255,A[59]=Q>>>24&255,A[60]=ue>>>0&255,A[61]=ue>>>8&255,A[62]=ue>>>16&255,A[63]=ue>>>24&255}function P(A,L,O,x){for(var K=x[0]&255|(x[1]&255)<<8|(x[2]&255)<<16|(x[3]&255)<<24,ie=O[0]&255|(O[1]&255)<<8|(O[2]&255)<<16|(O[3]&255)<<24,ae=O[4]&255|(O[5]&255)<<8|(O[6]&255)<<16|(O[7]&255)<<24,we=O[8]&255|(O[9]&255)<<8|(O[10]&255)<<16|(O[11]&255)<<24,Te=O[12]&255|(O[13]&255)<<8|(O[14]&255)<<16|(O[15]&255)<<24,We=x[4]&255|(x[5]&255)<<8|(x[6]&255)<<16|(x[7]&255)<<24,ke=L[0]&255|(L[1]&255)<<8|(L[2]&255)<<16|(L[3]&255)<<24,Et=L[4]&255|(L[5]&255)<<8|(L[6]&255)<<16|(L[7]&255)<<24,Be=L[8]&255|(L[9]&255)<<8|(L[10]&255)<<16|(L[11]&255)<<24,Ze=L[12]&255|(L[13]&255)<<8|(L[14]&255)<<16|(L[15]&255)<<24,ot=x[8]&255|(x[9]&255)<<8|(x[10]&255)<<16|(x[11]&255)<<24,ft=O[16]&255|(O[17]&255)<<8|(O[18]&255)<<16|(O[19]&255)<<24,st=O[20]&255|(O[21]&255)<<8|(O[22]&255)<<16|(O[23]&255)<<24,et=O[24]&255|(O[25]&255)<<8|(O[26]&255)<<16|(O[27]&255)<<24,Ye=O[28]&255|(O[29]&255)<<8|(O[30]&255)<<16|(O[31]&255)<<24,tt=x[12]&255|(x[13]&255)<<8|(x[14]&255)<<16|(x[15]&255)<<24,Re=K,Ve=ie,Ie=ae,Le=we,Ke=Te,Fe=We,fe=ke,de=Et,$e=Be,T=Ze,U=ot,I=ft,W=st,Y=et,Q=Ye,ue=tt,N,pe=0;pe<20;pe+=2)N=Re+W|0,Ke^=N<<7|N>>>25,N=Ke+Re|0,$e^=N<<9|N>>>23,N=$e+Ke|0,W^=N<<13|N>>>19,N=W+$e|0,Re^=N<<18|N>>>14,N=Fe+Ve|0,T^=N<<7|N>>>25,N=T+Fe|0,Y^=N<<9|N>>>23,N=Y+T|0,Ve^=N<<13|N>>>19,N=Ve+Y|0,Fe^=N<<18|N>>>14,N=U+fe|0,Q^=N<<7|N>>>25,N=Q+U|0,Ie^=N<<9|N>>>23,N=Ie+Q|0,fe^=N<<13|N>>>19,N=fe+Ie|0,U^=N<<18|N>>>14,N=ue+I|0,Le^=N<<7|N>>>25,N=Le+ue|0,de^=N<<9|N>>>23,N=de+Le|0,I^=N<<13|N>>>19,N=I+de|0,ue^=N<<18|N>>>14,N=Re+Le|0,Ve^=N<<7|N>>>25,N=Ve+Re|0,Ie^=N<<9|N>>>23,N=Ie+Ve|0,Le^=N<<13|N>>>19,N=Le+Ie|0,Re^=N<<18|N>>>14,N=Fe+Ke|0,fe^=N<<7|N>>>25,N=fe+Fe|0,de^=N<<9|N>>>23,N=de+fe|0,Ke^=N<<13|N>>>19,N=Ke+de|0,Fe^=N<<18|N>>>14,N=U+T|0,I^=N<<7|N>>>25,N=I+U|0,$e^=N<<9|N>>>23,N=$e+I|0,T^=N<<13|N>>>19,N=T+$e|0,U^=N<<18|N>>>14,N=ue+Q|0,W^=N<<7|N>>>25,N=W+ue|0,Y^=N<<9|N>>>23,N=Y+W|0,Q^=N<<13|N>>>19,N=Q+Y|0,ue^=N<<18|N>>>14;A[0]=Re>>>0&255,A[1]=Re>>>8&255,A[2]=Re>>>16&255,A[3]=Re>>>24&255,A[4]=Fe>>>0&255,A[5]=Fe>>>8&255,A[6]=Fe>>>16&255,A[7]=Fe>>>24&255,A[8]=U>>>0&255,A[9]=U>>>8&255,A[10]=U>>>16&255,A[11]=U>>>24&255,A[12]=ue>>>0&255,A[13]=ue>>>8&255,A[14]=ue>>>16&255,A[15]=ue>>>24&255,A[16]=fe>>>0&255,A[17]=fe>>>8&255,A[18]=fe>>>16&255,A[19]=fe>>>24&255,A[20]=de>>>0&255,A[21]=de>>>8&255,A[22]=de>>>16&255,A[23]=de>>>24&255,A[24]=$e>>>0&255,A[25]=$e>>>8&255,A[26]=$e>>>16&255,A[27]=$e>>>24&255,A[28]=T>>>0&255,A[29]=T>>>8&255,A[30]=T>>>16&255,A[31]=T>>>24&255}function R(A,L,O,x){C(A,L,O,x)}function F(A,L,O,x){P(A,L,O,x)}var k=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function B(A,L,O,x,K,ie,ae){var we=new Uint8Array(16),Te=new Uint8Array(64),We,ke;for(ke=0;ke<16;ke++)we[ke]=0;for(ke=0;ke<8;ke++)we[ke]=ie[ke];for(;K>=64;){for(R(Te,we,ae,k),ke=0;ke<64;ke++)A[L+ke]=O[x+ke]^Te[ke];for(We=1,ke=8;ke<16;ke++)We=We+(we[ke]&255)|0,we[ke]=We&255,We>>>=8;K-=64,L+=64,x+=64}if(K>0)for(R(Te,we,ae,k),ke=0;ke<K;ke++)A[L+ke]=O[x+ke]^Te[ke];return 0}function H(A,L,O,x,K){var ie=new Uint8Array(16),ae=new Uint8Array(64),we,Te;for(Te=0;Te<16;Te++)ie[Te]=0;for(Te=0;Te<8;Te++)ie[Te]=x[Te];for(;O>=64;){for(R(ae,ie,K,k),Te=0;Te<64;Te++)A[L+Te]=ae[Te];for(we=1,Te=8;Te<16;Te++)we=we+(ie[Te]&255)|0,ie[Te]=we&255,we>>>=8;O-=64,L+=64}if(O>0)for(R(ae,ie,K,k),Te=0;Te<O;Te++)A[L+Te]=ae[Te];return 0}function re(A,L,O,x,K){var ie=new Uint8Array(32);F(ie,x,K,k);for(var ae=new Uint8Array(8),we=0;we<8;we++)ae[we]=x[we+16];return H(A,L,O,ae,ie)}function le(A,L,O,x,K,ie,ae){var we=new Uint8Array(32);F(we,ie,ae,k);for(var Te=new Uint8Array(8),We=0;We<8;We++)Te[We]=ie[We+16];return B(A,L,O,x,K,Te,we)}var me=function(A){this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.leftover=0,this.fin=0;var L,O,x,K,ie,ae,we,Te;L=A[0]&255|(A[1]&255)<<8,this.r[0]=L&8191,O=A[2]&255|(A[3]&255)<<8,this.r[1]=(L>>>13|O<<3)&8191,x=A[4]&255|(A[5]&255)<<8,this.r[2]=(O>>>10|x<<6)&7939,K=A[6]&255|(A[7]&255)<<8,this.r[3]=(x>>>7|K<<9)&8191,ie=A[8]&255|(A[9]&255)<<8,this.r[4]=(K>>>4|ie<<12)&255,this.r[5]=ie>>>1&8190,ae=A[10]&255|(A[11]&255)<<8,this.r[6]=(ie>>>14|ae<<2)&8191,we=A[12]&255|(A[13]&255)<<8,this.r[7]=(ae>>>11|we<<5)&8065,Te=A[14]&255|(A[15]&255)<<8,this.r[8]=(we>>>8|Te<<8)&8191,this.r[9]=Te>>>5&127,this.pad[0]=A[16]&255|(A[17]&255)<<8,this.pad[1]=A[18]&255|(A[19]&255)<<8,this.pad[2]=A[20]&255|(A[21]&255)<<8,this.pad[3]=A[22]&255|(A[23]&255)<<8,this.pad[4]=A[24]&255|(A[25]&255)<<8,this.pad[5]=A[26]&255|(A[27]&255)<<8,this.pad[6]=A[28]&255|(A[29]&255)<<8,this.pad[7]=A[30]&255|(A[31]&255)<<8};me.prototype.blocks=function(A,L,O){for(var x=this.fin?0:2048,K,ie,ae,we,Te,We,ke,Et,Be,Ze,ot,ft,st,et,Ye,tt,Re,Ve,Ie,Le=this.h[0],Ke=this.h[1],Fe=this.h[2],fe=this.h[3],de=this.h[4],$e=this.h[5],T=this.h[6],U=this.h[7],I=this.h[8],W=this.h[9],Y=this.r[0],Q=this.r[1],ue=this.r[2],N=this.r[3],pe=this.r[4],ye=this.r[5],_e=this.r[6],Ce=this.r[7],Pe=this.r[8],je=this.r[9];O>=16;)K=A[L+0]&255|(A[L+1]&255)<<8,Le+=K&8191,ie=A[L+2]&255|(A[L+3]&255)<<8,Ke+=(K>>>13|ie<<3)&8191,ae=A[L+4]&255|(A[L+5]&255)<<8,Fe+=(ie>>>10|ae<<6)&8191,we=A[L+6]&255|(A[L+7]&255)<<8,fe+=(ae>>>7|we<<9)&8191,Te=A[L+8]&255|(A[L+9]&255)<<8,de+=(we>>>4|Te<<12)&8191,$e+=Te>>>1&8191,We=A[L+10]&255|(A[L+11]&255)<<8,T+=(Te>>>14|We<<2)&8191,ke=A[L+12]&255|(A[L+13]&255)<<8,U+=(We>>>11|ke<<5)&8191,Et=A[L+14]&255|(A[L+15]&255)<<8,I+=(ke>>>8|Et<<8)&8191,W+=Et>>>5|x,Be=0,Ze=Be,Ze+=Le*Y,Ze+=Ke*(5*je),Ze+=Fe*(5*Pe),Ze+=fe*(5*Ce),Ze+=de*(5*_e),Be=Ze>>>13,Ze&=8191,Ze+=$e*(5*ye),Ze+=T*(5*pe),Ze+=U*(5*N),Ze+=I*(5*ue),Ze+=W*(5*Q),Be+=Ze>>>13,Ze&=8191,ot=Be,ot+=Le*Q,ot+=Ke*Y,ot+=Fe*(5*je),ot+=fe*(5*Pe),ot+=de*(5*Ce),Be=ot>>>13,ot&=8191,ot+=$e*(5*_e),ot+=T*(5*ye),ot+=U*(5*pe),ot+=I*(5*N),ot+=W*(5*ue),Be+=ot>>>13,ot&=8191,ft=Be,ft+=Le*ue,ft+=Ke*Q,ft+=Fe*Y,ft+=fe*(5*je),ft+=de*(5*Pe),Be=ft>>>13,ft&=8191,ft+=$e*(5*Ce),ft+=T*(5*_e),ft+=U*(5*ye),ft+=I*(5*pe),ft+=W*(5*N),Be+=ft>>>13,ft&=8191,st=Be,st+=Le*N,st+=Ke*ue,st+=Fe*Q,st+=fe*Y,st+=de*(5*je),Be=st>>>13,st&=8191,st+=$e*(5*Pe),st+=T*(5*Ce),st+=U*(5*_e),st+=I*(5*ye),st+=W*(5*pe),Be+=st>>>13,st&=8191,et=Be,et+=Le*pe,et+=Ke*N,et+=Fe*ue,et+=fe*Q,et+=de*Y,Be=et>>>13,et&=8191,et+=$e*(5*je),et+=T*(5*Pe),et+=U*(5*Ce),et+=I*(5*_e),et+=W*(5*ye),Be+=et>>>13,et&=8191,Ye=Be,Ye+=Le*ye,Ye+=Ke*pe,Ye+=Fe*N,Ye+=fe*ue,Ye+=de*Q,Be=Ye>>>13,Ye&=8191,Ye+=$e*Y,Ye+=T*(5*je),Ye+=U*(5*Pe),Ye+=I*(5*Ce),Ye+=W*(5*_e),Be+=Ye>>>13,Ye&=8191,tt=Be,tt+=Le*_e,tt+=Ke*ye,tt+=Fe*pe,tt+=fe*N,tt+=de*ue,Be=tt>>>13,tt&=8191,tt+=$e*Q,tt+=T*Y,tt+=U*(5*je),tt+=I*(5*Pe),tt+=W*(5*Ce),Be+=tt>>>13,tt&=8191,Re=Be,Re+=Le*Ce,Re+=Ke*_e,Re+=Fe*ye,Re+=fe*pe,Re+=de*N,Be=Re>>>13,Re&=8191,Re+=$e*ue,Re+=T*Q,Re+=U*Y,Re+=I*(5*je),Re+=W*(5*Pe),Be+=Re>>>13,Re&=8191,Ve=Be,Ve+=Le*Pe,Ve+=Ke*Ce,Ve+=Fe*_e,Ve+=fe*ye,Ve+=de*pe,Be=Ve>>>13,Ve&=8191,Ve+=$e*N,Ve+=T*ue,Ve+=U*Q,Ve+=I*Y,Ve+=W*(5*je),Be+=Ve>>>13,Ve&=8191,Ie=Be,Ie+=Le*je,Ie+=Ke*Pe,Ie+=Fe*Ce,Ie+=fe*_e,Ie+=de*ye,Be=Ie>>>13,Ie&=8191,Ie+=$e*pe,Ie+=T*N,Ie+=U*ue,Ie+=I*Q,Ie+=W*Y,Be+=Ie>>>13,Ie&=8191,Be=(Be<<2)+Be|0,Be=Be+Ze|0,Ze=Be&8191,Be=Be>>>13,ot+=Be,Le=Ze,Ke=ot,Fe=ft,fe=st,de=et,$e=Ye,T=tt,U=Re,I=Ve,W=Ie,L+=16,O-=16;this.h[0]=Le,this.h[1]=Ke,this.h[2]=Fe,this.h[3]=fe,this.h[4]=de,this.h[5]=$e,this.h[6]=T,this.h[7]=U,this.h[8]=I,this.h[9]=W},me.prototype.finish=function(A,L){var O=new Uint16Array(10),x,K,ie,ae;if(this.leftover){for(ae=this.leftover,this.buffer[ae++]=1;ae<16;ae++)this.buffer[ae]=0;this.fin=1,this.blocks(this.buffer,0,16)}for(x=this.h[1]>>>13,this.h[1]&=8191,ae=2;ae<10;ae++)this.h[ae]+=x,x=this.h[ae]>>>13,this.h[ae]&=8191;for(this.h[0]+=x*5,x=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=x,x=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=x,O[0]=this.h[0]+5,x=O[0]>>>13,O[0]&=8191,ae=1;ae<10;ae++)O[ae]=this.h[ae]+x,x=O[ae]>>>13,O[ae]&=8191;for(O[9]-=8192,K=(x^1)-1,ae=0;ae<10;ae++)O[ae]&=K;for(K=~K,ae=0;ae<10;ae++)this.h[ae]=this.h[ae]&K|O[ae];for(this.h[0]=(this.h[0]|this.h[1]<<13)&65535,this.h[1]=(this.h[1]>>>3|this.h[2]<<10)&65535,this.h[2]=(this.h[2]>>>6|this.h[3]<<7)&65535,this.h[3]=(this.h[3]>>>9|this.h[4]<<4)&65535,this.h[4]=(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14)&65535,this.h[5]=(this.h[6]>>>2|this.h[7]<<11)&65535,this.h[6]=(this.h[7]>>>5|this.h[8]<<8)&65535,this.h[7]=(this.h[8]>>>8|this.h[9]<<5)&65535,ie=this.h[0]+this.pad[0],this.h[0]=ie&65535,ae=1;ae<8;ae++)ie=(this.h[ae]+this.pad[ae]|0)+(ie>>>16)|0,this.h[ae]=ie&65535;A[L+0]=this.h[0]>>>0&255,A[L+1]=this.h[0]>>>8&255,A[L+2]=this.h[1]>>>0&255,A[L+3]=this.h[1]>>>8&255,A[L+4]=this.h[2]>>>0&255,A[L+5]=this.h[2]>>>8&255,A[L+6]=this.h[3]>>>0&255,A[L+7]=this.h[3]>>>8&255,A[L+8]=this.h[4]>>>0&255,A[L+9]=this.h[4]>>>8&255,A[L+10]=this.h[5]>>>0&255,A[L+11]=this.h[5]>>>8&255,A[L+12]=this.h[6]>>>0&255,A[L+13]=this.h[6]>>>8&255,A[L+14]=this.h[7]>>>0&255,A[L+15]=this.h[7]>>>8&255},me.prototype.update=function(A,L,O){var x,K;if(this.leftover){for(K=16-this.leftover,K>O&&(K=O),x=0;x<K;x++)this.buffer[this.leftover+x]=A[L+x];if(O-=K,L+=K,this.leftover+=K,this.leftover<16)return;this.blocks(this.buffer,0,16),this.leftover=0}if(O>=16&&(K=O-O%16,this.blocks(A,L,K),L+=K,O-=K),O){for(x=0;x<O;x++)this.buffer[this.leftover+x]=A[L+x];this.leftover+=O}};function He(A,L,O,x,K,ie){var ae=new me(ie);return ae.update(O,x,K),ae.finish(A,L),0}function ct(A,L,O,x,K,ie){var ae=new Uint8Array(16);return He(ae,0,O,x,K,ie),w(A,L,ae,0)}function lt(A,L,O,x,K){var ie;if(O<32)return-1;for(le(A,0,L,0,O,x,K),He(A,16,A,32,O-32,A),ie=0;ie<16;ie++)A[ie]=0;return 0}function dt(A,L,O,x,K){var ie,ae=new Uint8Array(32);if(O<32||(re(ae,0,32,x,K),ct(L,16,L,32,O-32,ae)!==0))return-1;for(le(A,0,L,0,O,x,K),ie=0;ie<32;ie++)A[ie]=0;return 0}function gt(A,L){var O;for(O=0;O<16;O++)A[O]=L[O]|0}function Ee(A){var L,O,x=1;for(L=0;L<16;L++)O=A[L]+x+65535,x=Math.floor(O/65536),A[L]=O-x*65536;A[0]+=x-1+37*(x-1)}function z(A,L,O){for(var x,K=~(O-1),ie=0;ie<16;ie++)x=K&(A[ie]^L[ie]),A[ie]^=x,L[ie]^=x}function ne(A,L){var O,x,K,ie=t(),ae=t();for(O=0;O<16;O++)ae[O]=L[O];for(Ee(ae),Ee(ae),Ee(ae),x=0;x<2;x++){for(ie[0]=ae[0]-65517,O=1;O<15;O++)ie[O]=ae[O]-65535-(ie[O-1]>>16&1),ie[O-1]&=65535;ie[15]=ae[15]-32767-(ie[14]>>16&1),K=ie[15]>>16&1,ie[14]&=65535,z(ae,ie,1-K)}for(O=0;O<16;O++)A[2*O]=ae[O]&255,A[2*O+1]=ae[O]>>8}function ee(A,L){var O=new Uint8Array(32),x=new Uint8Array(32);return ne(O,A),ne(x,L),v(O,0,x,0)}function ve(A){var L=new Uint8Array(32);return ne(L,A),L[0]&1}function Qe(A,L){var O;for(O=0;O<16;O++)A[O]=L[2*O]+(L[2*O+1]<<8);A[15]&=32767}function Me(A,L,O){for(var x=0;x<16;x++)A[x]=L[x]+O[x]}function it(A,L,O){for(var x=0;x<16;x++)A[x]=L[x]-O[x]}function Ne(A,L,O){var x,K,ie=0,ae=0,we=0,Te=0,We=0,ke=0,Et=0,Be=0,Ze=0,ot=0,ft=0,st=0,et=0,Ye=0,tt=0,Re=0,Ve=0,Ie=0,Le=0,Ke=0,Fe=0,fe=0,de=0,$e=0,T=0,U=0,I=0,W=0,Y=0,Q=0,ue=0,N=O[0],pe=O[1],ye=O[2],_e=O[3],Ce=O[4],Pe=O[5],je=O[6],Xe=O[7],Je=O[8],rt=O[9],xt=O[10],St=O[11],Lt=O[12],Vt=O[13],Kt=O[14],Jt=O[15];x=L[0],ie+=x*N,ae+=x*pe,we+=x*ye,Te+=x*_e,We+=x*Ce,ke+=x*Pe,Et+=x*je,Be+=x*Xe,Ze+=x*Je,ot+=x*rt,ft+=x*xt,st+=x*St,et+=x*Lt,Ye+=x*Vt,tt+=x*Kt,Re+=x*Jt,x=L[1],ae+=x*N,we+=x*pe,Te+=x*ye,We+=x*_e,ke+=x*Ce,Et+=x*Pe,Be+=x*je,Ze+=x*Xe,ot+=x*Je,ft+=x*rt,st+=x*xt,et+=x*St,Ye+=x*Lt,tt+=x*Vt,Re+=x*Kt,Ve+=x*Jt,x=L[2],we+=x*N,Te+=x*pe,We+=x*ye,ke+=x*_e,Et+=x*Ce,Be+=x*Pe,Ze+=x*je,ot+=x*Xe,ft+=x*Je,st+=x*rt,et+=x*xt,Ye+=x*St,tt+=x*Lt,Re+=x*Vt,Ve+=x*Kt,Ie+=x*Jt,x=L[3],Te+=x*N,We+=x*pe,ke+=x*ye,Et+=x*_e,Be+=x*Ce,Ze+=x*Pe,ot+=x*je,ft+=x*Xe,st+=x*Je,et+=x*rt,Ye+=x*xt,tt+=x*St,Re+=x*Lt,Ve+=x*Vt,Ie+=x*Kt,Le+=x*Jt,x=L[4],We+=x*N,ke+=x*pe,Et+=x*ye,Be+=x*_e,Ze+=x*Ce,ot+=x*Pe,ft+=x*je,st+=x*Xe,et+=x*Je,Ye+=x*rt,tt+=x*xt,Re+=x*St,Ve+=x*Lt,Ie+=x*Vt,Le+=x*Kt,Ke+=x*Jt,x=L[5],ke+=x*N,Et+=x*pe,Be+=x*ye,Ze+=x*_e,ot+=x*Ce,ft+=x*Pe,st+=x*je,et+=x*Xe,Ye+=x*Je,tt+=x*rt,Re+=x*xt,Ve+=x*St,Ie+=x*Lt,Le+=x*Vt,Ke+=x*Kt,Fe+=x*Jt,x=L[6],Et+=x*N,Be+=x*pe,Ze+=x*ye,ot+=x*_e,ft+=x*Ce,st+=x*Pe,et+=x*je,Ye+=x*Xe,tt+=x*Je,Re+=x*rt,Ve+=x*xt,Ie+=x*St,Le+=x*Lt,Ke+=x*Vt,Fe+=x*Kt,fe+=x*Jt,x=L[7],Be+=x*N,Ze+=x*pe,ot+=x*ye,ft+=x*_e,st+=x*Ce,et+=x*Pe,Ye+=x*je,tt+=x*Xe,Re+=x*Je,Ve+=x*rt,Ie+=x*xt,Le+=x*St,Ke+=x*Lt,Fe+=x*Vt,fe+=x*Kt,de+=x*Jt,x=L[8],Ze+=x*N,ot+=x*pe,ft+=x*ye,st+=x*_e,et+=x*Ce,Ye+=x*Pe,tt+=x*je,Re+=x*Xe,Ve+=x*Je,Ie+=x*rt,Le+=x*xt,Ke+=x*St,Fe+=x*Lt,fe+=x*Vt,de+=x*Kt,$e+=x*Jt,x=L[9],ot+=x*N,ft+=x*pe,st+=x*ye,et+=x*_e,Ye+=x*Ce,tt+=x*Pe,Re+=x*je,Ve+=x*Xe,Ie+=x*Je,Le+=x*rt,Ke+=x*xt,Fe+=x*St,fe+=x*Lt,de+=x*Vt,$e+=x*Kt,T+=x*Jt,x=L[10],ft+=x*N,st+=x*pe,et+=x*ye,Ye+=x*_e,tt+=x*Ce,Re+=x*Pe,Ve+=x*je,Ie+=x*Xe,Le+=x*Je,Ke+=x*rt,Fe+=x*xt,fe+=x*St,de+=x*Lt,$e+=x*Vt,T+=x*Kt,U+=x*Jt,x=L[11],st+=x*N,et+=x*pe,Ye+=x*ye,tt+=x*_e,Re+=x*Ce,Ve+=x*Pe,Ie+=x*je,Le+=x*Xe,Ke+=x*Je,Fe+=x*rt,fe+=x*xt,de+=x*St,$e+=x*Lt,T+=x*Vt,U+=x*Kt,I+=x*Jt,x=L[12],et+=x*N,Ye+=x*pe,tt+=x*ye,Re+=x*_e,Ve+=x*Ce,Ie+=x*Pe,Le+=x*je,Ke+=x*Xe,Fe+=x*Je,fe+=x*rt,de+=x*xt,$e+=x*St,T+=x*Lt,U+=x*Vt,I+=x*Kt,W+=x*Jt,x=L[13],Ye+=x*N,tt+=x*pe,Re+=x*ye,Ve+=x*_e,Ie+=x*Ce,Le+=x*Pe,Ke+=x*je,Fe+=x*Xe,fe+=x*Je,de+=x*rt,$e+=x*xt,T+=x*St,U+=x*Lt,I+=x*Vt,W+=x*Kt,Y+=x*Jt,x=L[14],tt+=x*N,Re+=x*pe,Ve+=x*ye,Ie+=x*_e,Le+=x*Ce,Ke+=x*Pe,Fe+=x*je,fe+=x*Xe,de+=x*Je,$e+=x*rt,T+=x*xt,U+=x*St,I+=x*Lt,W+=x*Vt,Y+=x*Kt,Q+=x*Jt,x=L[15],Re+=x*N,Ve+=x*pe,Ie+=x*ye,Le+=x*_e,Ke+=x*Ce,Fe+=x*Pe,fe+=x*je,de+=x*Xe,$e+=x*Je,T+=x*rt,U+=x*xt,I+=x*St,W+=x*Lt,Y+=x*Vt,Q+=x*Kt,ue+=x*Jt,ie+=38*Ve,ae+=38*Ie,we+=38*Le,Te+=38*Ke,We+=38*Fe,ke+=38*fe,Et+=38*de,Be+=38*$e,Ze+=38*T,ot+=38*U,ft+=38*I,st+=38*W,et+=38*Y,Ye+=38*Q,tt+=38*ue,K=1,x=ie+K+65535,K=Math.floor(x/65536),ie=x-K*65536,x=ae+K+65535,K=Math.floor(x/65536),ae=x-K*65536,x=we+K+65535,K=Math.floor(x/65536),we=x-K*65536,x=Te+K+65535,K=Math.floor(x/65536),Te=x-K*65536,x=We+K+65535,K=Math.floor(x/65536),We=x-K*65536,x=ke+K+65535,K=Math.floor(x/65536),ke=x-K*65536,x=Et+K+65535,K=Math.floor(x/65536),Et=x-K*65536,x=Be+K+65535,K=Math.floor(x/65536),Be=x-K*65536,x=Ze+K+65535,K=Math.floor(x/65536),Ze=x-K*65536,x=ot+K+65535,K=Math.floor(x/65536),ot=x-K*65536,x=ft+K+65535,K=Math.floor(x/65536),ft=x-K*65536,x=st+K+65535,K=Math.floor(x/65536),st=x-K*65536,x=et+K+65535,K=Math.floor(x/65536),et=x-K*65536,x=Ye+K+65535,K=Math.floor(x/65536),Ye=x-K*65536,x=tt+K+65535,K=Math.floor(x/65536),tt=x-K*65536,x=Re+K+65535,K=Math.floor(x/65536),Re=x-K*65536,ie+=K-1+37*(K-1),K=1,x=ie+K+65535,K=Math.floor(x/65536),ie=x-K*65536,x=ae+K+65535,K=Math.floor(x/65536),ae=x-K*65536,x=we+K+65535,K=Math.floor(x/65536),we=x-K*65536,x=Te+K+65535,K=Math.floor(x/65536),Te=x-K*65536,x=We+K+65535,K=Math.floor(x/65536),We=x-K*65536,x=ke+K+65535,K=Math.floor(x/65536),ke=x-K*65536,x=Et+K+65535,K=Math.floor(x/65536),Et=x-K*65536,x=Be+K+65535,K=Math.floor(x/65536),Be=x-K*65536,x=Ze+K+65535,K=Math.floor(x/65536),Ze=x-K*65536,x=ot+K+65535,K=Math.floor(x/65536),ot=x-K*65536,x=ft+K+65535,K=Math.floor(x/65536),ft=x-K*65536,x=st+K+65535,K=Math.floor(x/65536),st=x-K*65536,x=et+K+65535,K=Math.floor(x/65536),et=x-K*65536,x=Ye+K+65535,K=Math.floor(x/65536),Ye=x-K*65536,x=tt+K+65535,K=Math.floor(x/65536),tt=x-K*65536,x=Re+K+65535,K=Math.floor(x/65536),Re=x-K*65536,ie+=K-1+37*(K-1),A[0]=ie,A[1]=ae,A[2]=we,A[3]=Te,A[4]=We,A[5]=ke,A[6]=Et,A[7]=Be,A[8]=Ze,A[9]=ot,A[10]=ft,A[11]=st,A[12]=et,A[13]=Ye,A[14]=tt,A[15]=Re}function De(A,L){Ne(A,L,L)}function Dt(A,L){var O=t(),x;for(x=0;x<16;x++)O[x]=L[x];for(x=253;x>=0;x--)De(O,O),x!==2&&x!==4&&Ne(O,O,L);for(x=0;x<16;x++)A[x]=O[x]}function bt(A,L){var O=t(),x;for(x=0;x<16;x++)O[x]=L[x];for(x=250;x>=0;x--)De(O,O),x!==1&&Ne(O,O,L);for(x=0;x<16;x++)A[x]=O[x]}function Nt(A,L,O){var x=new Uint8Array(32),K=new Float64Array(80),ie,ae,we=t(),Te=t(),We=t(),ke=t(),Et=t(),Be=t();for(ae=0;ae<31;ae++)x[ae]=L[ae];for(x[31]=L[31]&127|64,x[0]&=248,Qe(K,O),ae=0;ae<16;ae++)Te[ae]=K[ae],ke[ae]=we[ae]=We[ae]=0;for(we[0]=ke[0]=1,ae=254;ae>=0;--ae)ie=x[ae>>>3]>>>(ae&7)&1,z(we,Te,ie),z(We,ke,ie),Me(Et,we,We),it(we,we,We),Me(We,Te,ke),it(Te,Te,ke),De(ke,Et),De(Be,we),Ne(we,We,we),Ne(We,Te,Et),Me(Et,we,We),it(we,we,We),De(Te,we),it(We,ke,Be),Ne(we,We,d),Me(we,we,ke),Ne(We,We,we),Ne(we,ke,Be),Ne(ke,Te,K),De(Te,Et),z(we,Te,ie),z(We,ke,ie);for(ae=0;ae<16;ae++)K[ae+16]=we[ae],K[ae+32]=We[ae],K[ae+48]=Te[ae],K[ae+64]=ke[ae];var Ze=K.subarray(32),ot=K.subarray(16);return Dt(Ze,Ze),Ne(ot,ot,Ze),ne(A,ot),0}function fr(A,L){return Nt(A,L,s)}function Ut(A,L){return n(L,32),fr(A,L)}function Yt(A,L,O){var x=new Uint8Array(32);return Nt(x,O,L),F(A,i,x,k)}var Zt=lt,qt=dt;function Xt(A,L,O,x,K,ie){var ae=new Uint8Array(32);return Yt(ae,K,ie),Zt(A,L,O,x,ae)}function zr(A,L,O,x,K,ie){var ae=new Uint8Array(32);return Yt(ae,K,ie),qt(A,L,O,x,ae)}var Wt=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function mr(A,L,O,x){for(var K=new Int32Array(16),ie=new Int32Array(16),ae,we,Te,We,ke,Et,Be,Ze,ot,ft,st,et,Ye,tt,Re,Ve,Ie,Le,Ke,Fe,fe,de,$e,T,U,I,W=A[0],Y=A[1],Q=A[2],ue=A[3],N=A[4],pe=A[5],ye=A[6],_e=A[7],Ce=L[0],Pe=L[1],je=L[2],Xe=L[3],Je=L[4],rt=L[5],xt=L[6],St=L[7],Lt=0;x>=128;){for(Ke=0;Ke<16;Ke++)Fe=8*Ke+Lt,K[Ke]=O[Fe+0]<<24|O[Fe+1]<<16|O[Fe+2]<<8|O[Fe+3],ie[Ke]=O[Fe+4]<<24|O[Fe+5]<<16|O[Fe+6]<<8|O[Fe+7];for(Ke=0;Ke<80;Ke++)if(ae=W,we=Y,Te=Q,We=ue,ke=N,Et=pe,Be=ye,Ze=_e,ot=Ce,ft=Pe,st=je,et=Xe,Ye=Je,tt=rt,Re=xt,Ve=St,fe=_e,de=St,$e=de&65535,T=de>>>16,U=fe&65535,I=fe>>>16,fe=(N>>>14|Je<<18)^(N>>>18|Je<<14)^(Je>>>9|N<<23),de=(Je>>>14|N<<18)^(Je>>>18|N<<14)^(N>>>9|Je<<23),$e+=de&65535,T+=de>>>16,U+=fe&65535,I+=fe>>>16,fe=N&pe^~N&ye,de=Je&rt^~Je&xt,$e+=de&65535,T+=de>>>16,U+=fe&65535,I+=fe>>>16,fe=Wt[Ke*2],de=Wt[Ke*2+1],$e+=de&65535,T+=de>>>16,U+=fe&65535,I+=fe>>>16,fe=K[Ke%16],de=ie[Ke%16],$e+=de&65535,T+=de>>>16,U+=fe&65535,I+=fe>>>16,T+=$e>>>16,U+=T>>>16,I+=U>>>16,Ie=U&65535|I<<16,Le=$e&65535|T<<16,fe=Ie,de=Le,$e=de&65535,T=de>>>16,U=fe&65535,I=fe>>>16,fe=(W>>>28|Ce<<4)^(Ce>>>2|W<<30)^(Ce>>>7|W<<25),de=(Ce>>>28|W<<4)^(W>>>2|Ce<<30)^(W>>>7|Ce<<25),$e+=de&65535,T+=de>>>16,U+=fe&65535,I+=fe>>>16,fe=W&Y^W&Q^Y&Q,de=Ce&Pe^Ce&je^Pe&je,$e+=de&65535,T+=de>>>16,U+=fe&65535,I+=fe>>>16,T+=$e>>>16,U+=T>>>16,I+=U>>>16,Ze=U&65535|I<<16,Ve=$e&65535|T<<16,fe=We,de=et,$e=de&65535,T=de>>>16,U=fe&65535,I=fe>>>16,fe=Ie,de=Le,$e+=de&65535,T+=de>>>16,U+=fe&65535,I+=fe>>>16,T+=$e>>>16,U+=T>>>16,I+=U>>>16,We=U&65535|I<<16,et=$e&65535|T<<16,Y=ae,Q=we,ue=Te,N=We,pe=ke,ye=Et,_e=Be,W=Ze,Pe=ot,je=ft,Xe=st,Je=et,rt=Ye,xt=tt,St=Re,Ce=Ve,Ke%16===15)for(Fe=0;Fe<16;Fe++)fe=K[Fe],de=ie[Fe],$e=de&65535,T=de>>>16,U=fe&65535,I=fe>>>16,fe=K[(Fe+9)%16],de=ie[(Fe+9)%16],$e+=de&65535,T+=de>>>16,U+=fe&65535,I+=fe>>>16,Ie=K[(Fe+1)%16],Le=ie[(Fe+1)%16],fe=(Ie>>>1|Le<<31)^(Ie>>>8|Le<<24)^Ie>>>7,de=(Le>>>1|Ie<<31)^(Le>>>8|Ie<<24)^(Le>>>7|Ie<<25),$e+=de&65535,T+=de>>>16,U+=fe&65535,I+=fe>>>16,Ie=K[(Fe+14)%16],Le=ie[(Fe+14)%16],fe=(Ie>>>19|Le<<13)^(Le>>>29|Ie<<3)^Ie>>>6,de=(Le>>>19|Ie<<13)^(Ie>>>29|Le<<3)^(Le>>>6|Ie<<26),$e+=de&65535,T+=de>>>16,U+=fe&65535,I+=fe>>>16,T+=$e>>>16,U+=T>>>16,I+=U>>>16,K[Fe]=U&65535|I<<16,ie[Fe]=$e&65535|T<<16;fe=W,de=Ce,$e=de&65535,T=de>>>16,U=fe&65535,I=fe>>>16,fe=A[0],de=L[0],$e+=de&65535,T+=de>>>16,U+=fe&65535,I+=fe>>>16,T+=$e>>>16,U+=T>>>16,I+=U>>>16,A[0]=W=U&65535|I<<16,L[0]=Ce=$e&65535|T<<16,fe=Y,de=Pe,$e=de&65535,T=de>>>16,U=fe&65535,I=fe>>>16,fe=A[1],de=L[1],$e+=de&65535,T+=de>>>16,U+=fe&65535,I+=fe>>>16,T+=$e>>>16,U+=T>>>16,I+=U>>>16,A[1]=Y=U&65535|I<<16,L[1]=Pe=$e&65535|T<<16,fe=Q,de=je,$e=de&65535,T=de>>>16,U=fe&65535,I=fe>>>16,fe=A[2],de=L[2],$e+=de&65535,T+=de>>>16,U+=fe&65535,I+=fe>>>16,T+=$e>>>16,U+=T>>>16,I+=U>>>16,A[2]=Q=U&65535|I<<16,L[2]=je=$e&65535|T<<16,fe=ue,de=Xe,$e=de&65535,T=de>>>16,U=fe&65535,I=fe>>>16,fe=A[3],de=L[3],$e+=de&65535,T+=de>>>16,U+=fe&65535,I+=fe>>>16,T+=$e>>>16,U+=T>>>16,I+=U>>>16,A[3]=ue=U&65535|I<<16,L[3]=Xe=$e&65535|T<<16,fe=N,de=Je,$e=de&65535,T=de>>>16,U=fe&65535,I=fe>>>16,fe=A[4],de=L[4],$e+=de&65535,T+=de>>>16,U+=fe&65535,I+=fe>>>16,T+=$e>>>16,U+=T>>>16,I+=U>>>16,A[4]=N=U&65535|I<<16,L[4]=Je=$e&65535|T<<16,fe=pe,de=rt,$e=de&65535,T=de>>>16,U=fe&65535,I=fe>>>16,fe=A[5],de=L[5],$e+=de&65535,T+=de>>>16,U+=fe&65535,I+=fe>>>16,T+=$e>>>16,U+=T>>>16,I+=U>>>16,A[5]=pe=U&65535|I<<16,L[5]=rt=$e&65535|T<<16,fe=ye,de=xt,$e=de&65535,T=de>>>16,U=fe&65535,I=fe>>>16,fe=A[6],de=L[6],$e+=de&65535,T+=de>>>16,U+=fe&65535,I+=fe>>>16,T+=$e>>>16,U+=T>>>16,I+=U>>>16,A[6]=ye=U&65535|I<<16,L[6]=xt=$e&65535|T<<16,fe=_e,de=St,$e=de&65535,T=de>>>16,U=fe&65535,I=fe>>>16,fe=A[7],de=L[7],$e+=de&65535,T+=de>>>16,U+=fe&65535,I+=fe>>>16,T+=$e>>>16,U+=T>>>16,I+=U>>>16,A[7]=_e=U&65535|I<<16,L[7]=St=$e&65535|T<<16,Lt+=128,x-=128}return x}function sr(A,L,O){var x=new Int32Array(8),K=new Int32Array(8),ie=new Uint8Array(256),ae,we=O;for(x[0]=1779033703,x[1]=3144134277,x[2]=1013904242,x[3]=2773480762,x[4]=1359893119,x[5]=2600822924,x[6]=528734635,x[7]=1541459225,K[0]=4089235720,K[1]=2227873595,K[2]=4271175723,K[3]=1595750129,K[4]=2917565137,K[5]=725511199,K[6]=4215389547,K[7]=327033209,mr(x,K,L,O),O%=128,ae=0;ae<O;ae++)ie[ae]=L[we-O+ae];for(ie[O]=128,O=256-128*(O<112?1:0),ie[O-9]=0,p(ie,O-8,we/536870912|0,we<<3),mr(x,K,ie,O),ae=0;ae<8;ae++)p(A,8*ae,x[ae],K[ae]);return 0}function er(A,L){var O=t(),x=t(),K=t(),ie=t(),ae=t(),we=t(),Te=t(),We=t(),ke=t();it(O,A[1],A[0]),it(ke,L[1],L[0]),Ne(O,O,ke),Me(x,A[0],A[1]),Me(ke,L[0],L[1]),Ne(x,x,ke),Ne(K,A[3],L[3]),Ne(K,K,_),Ne(ie,A[2],L[2]),Me(ie,ie,ie),it(ae,x,O),it(we,ie,K),Me(Te,ie,K),Me(We,x,O),Ne(A[0],ae,we),Ne(A[1],We,Te),Ne(A[2],Te,we),Ne(A[3],ae,We)}function kt(A,L,O){var x;for(x=0;x<4;x++)z(A[x],L[x],O)}function Rt(A,L){var O=t(),x=t(),K=t();Dt(K,L[2]),Ne(O,L[0],K),Ne(x,L[1],K),ne(A,x),A[31]^=ve(O)<<7}function ar(A,L,O){var x,K;for(gt(A[0],u),gt(A[1],c),gt(A[2],c),gt(A[3],u),K=255;K>=0;--K)x=O[K/8|0]>>(K&7)&1,kt(A,L,x),er(L,A),er(A,A),kt(A,L,x)}function Er(A,L){var O=[t(),t(),t(),t()];gt(O[0],f),gt(O[1],l),gt(O[2],c),Ne(O[3],f,l),ar(A,O,L)}function Bt(A,L,O){var x=new Uint8Array(64),K=[t(),t(),t(),t()],ie;for(O||n(L,32),sr(x,L,32),x[0]&=248,x[31]&=127,x[31]|=64,Er(K,x),Rt(A,K),ie=0;ie<32;ie++)L[ie+32]=A[ie];return 0}var ce=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function S(A,L){var O,x,K,ie;for(x=63;x>=32;--x){for(O=0,K=x-32,ie=x-12;K<ie;++K)L[K]+=O-16*L[x]*ce[K-(x-32)],O=Math.floor((L[K]+128)/256),L[K]-=O*256;L[K]+=O,L[x]=0}for(O=0,K=0;K<32;K++)L[K]+=O-(L[31]>>4)*ce[K],O=L[K]>>8,L[K]&=255;for(K=0;K<32;K++)L[K]-=O*ce[K];for(x=0;x<32;x++)L[x+1]+=L[x]>>8,A[x]=L[x]&255}function b(A){var L=new Float64Array(64),O;for(O=0;O<64;O++)L[O]=A[O];for(O=0;O<64;O++)A[O]=0;S(A,L)}function E(A,L,O,x){var K=new Uint8Array(64),ie=new Uint8Array(64),ae=new Uint8Array(64),we,Te,We=new Float64Array(64),ke=[t(),t(),t(),t()];sr(K,x,32),K[0]&=248,K[31]&=127,K[31]|=64;var Et=O+64;for(we=0;we<O;we++)A[64+we]=L[we];for(we=0;we<32;we++)A[32+we]=K[32+we];for(sr(ae,A.subarray(32),O+32),b(ae),Er(ke,ae),Rt(A,ke),we=32;we<64;we++)A[we]=x[we];for(sr(ie,A,O+64),b(ie),we=0;we<64;we++)We[we]=0;for(we=0;we<32;we++)We[we]=ae[we];for(we=0;we<32;we++)for(Te=0;Te<32;Te++)We[we+Te]+=ie[we]*K[Te];return S(A.subarray(32),We),Et}function q(A,L){var O=t(),x=t(),K=t(),ie=t(),ae=t(),we=t(),Te=t();return gt(A[2],c),Qe(A[1],L),De(K,A[1]),Ne(ie,K,g),it(K,K,A[2]),Me(ie,A[2],ie),De(ae,ie),De(we,ae),Ne(Te,we,ae),Ne(O,Te,K),Ne(O,O,ie),bt(O,O),Ne(O,O,K),Ne(O,O,ie),Ne(O,O,ie),Ne(A[0],O,ie),De(x,A[0]),Ne(x,x,ie),ee(x,K)&&Ne(A[0],A[0],h),De(x,A[0]),Ne(x,x,ie),ee(x,K)?-1:(ve(A[0])===L[31]>>7&&it(A[0],u,A[0]),Ne(A[3],A[0],A[1]),0)}function X(A,L,O,x){var K,ie=new Uint8Array(32),ae=new Uint8Array(64),we=[t(),t(),t(),t()],Te=[t(),t(),t(),t()];if(O<64||q(Te,x))return-1;for(K=0;K<O;K++)A[K]=L[K];for(K=0;K<32;K++)A[K+32]=x[K];if(sr(ae,A,O),b(ae),ar(we,Te,ae),Er(Te,L.subarray(32)),er(we,Te),Rt(ie,we),O-=64,v(L,0,ie,0)){for(K=0;K<O;K++)A[K]=0;return-1}for(K=0;K<O;K++)A[K]=L[K+64];return O}var Z=32,se=24,Se=32,qe=16,Ue=32,ht=32,mt=32,Qr=32,_r=32,gn=se,Sn=Se,Tn=qe,$r=64,Nr=32,Hr=64,sn=32,mn=64;e.lowlevel={crypto_core_hsalsa20:F,crypto_stream_xor:le,crypto_stream:re,crypto_stream_salsa20_xor:B,crypto_stream_salsa20:H,crypto_onetimeauth:He,crypto_onetimeauth_verify:ct,crypto_verify_16:w,crypto_verify_32:v,crypto_secretbox:lt,crypto_secretbox_open:dt,crypto_scalarmult:Nt,crypto_scalarmult_base:fr,crypto_box_beforenm:Yt,crypto_box_afternm:Zt,crypto_box:Xt,crypto_box_open:zr,crypto_box_keypair:Ut,crypto_hash:sr,crypto_sign:E,crypto_sign_keypair:Bt,crypto_sign_open:X,crypto_secretbox_KEYBYTES:Z,crypto_secretbox_NONCEBYTES:se,crypto_secretbox_ZEROBYTES:Se,crypto_secretbox_BOXZEROBYTES:qe,crypto_scalarmult_BYTES:Ue,crypto_scalarmult_SCALARBYTES:ht,crypto_box_PUBLICKEYBYTES:mt,crypto_box_SECRETKEYBYTES:Qr,crypto_box_BEFORENMBYTES:_r,crypto_box_NONCEBYTES:gn,crypto_box_ZEROBYTES:Sn,crypto_box_BOXZEROBYTES:Tn,crypto_sign_BYTES:$r,crypto_sign_PUBLICKEYBYTES:Nr,crypto_sign_SECRETKEYBYTES:Hr,crypto_sign_SEEDBYTES:sn,crypto_hash_BYTES:mn,gf:t,D:g,L:ce,pack25519:ne,unpack25519:Qe,M:Ne,A:Me,S:De,Z:it,pow2523:bt,add:er,set25519:gt,modL:S,scalarmult:ar,scalarbase:Er};function Dn(A,L){if(A.length!==Z)throw new Error("bad key size");if(L.length!==se)throw new Error("bad nonce size")}function zn(A,L){if(A.length!==mt)throw new Error("bad public key size");if(L.length!==Qr)throw new Error("bad secret key size")}function tr(){for(var A=0;A<arguments.length;A++)if(!(arguments[A]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}function In(A){for(var L=0;L<A.length;L++)A[L]=0}e.randomBytes=function(A){var L=new Uint8Array(A);return n(L,A),L},e.secretbox=function(A,L,O){tr(A,L,O),Dn(O,L);for(var x=new Uint8Array(Se+A.length),K=new Uint8Array(x.length),ie=0;ie<A.length;ie++)x[ie+Se]=A[ie];return lt(K,x,x.length,L,O),K.subarray(qe)},e.secretbox.open=function(A,L,O){tr(A,L,O),Dn(O,L);for(var x=new Uint8Array(qe+A.length),K=new Uint8Array(x.length),ie=0;ie<A.length;ie++)x[ie+qe]=A[ie];return x.length<32||dt(K,x,x.length,L,O)!==0?null:K.subarray(Se)},e.secretbox.keyLength=Z,e.secretbox.nonceLength=se,e.secretbox.overheadLength=qe,e.scalarMult=function(A,L){if(tr(A,L),A.length!==ht)throw new Error("bad n size");if(L.length!==Ue)throw new Error("bad p size");var O=new Uint8Array(Ue);return Nt(O,A,L),O},e.scalarMult.base=function(A){if(tr(A),A.length!==ht)throw new Error("bad n size");var L=new Uint8Array(Ue);return fr(L,A),L},e.scalarMult.scalarLength=ht,e.scalarMult.groupElementLength=Ue,e.box=function(A,L,O,x){var K=e.box.before(O,x);return e.secretbox(A,L,K)},e.box.before=function(A,L){tr(A,L),zn(A,L);var O=new Uint8Array(_r);return Yt(O,A,L),O},e.box.after=e.secretbox,e.box.open=function(A,L,O,x){var K=e.box.before(O,x);return e.secretbox.open(A,L,K)},e.box.open.after=e.secretbox.open,e.box.keyPair=function(){var A=new Uint8Array(mt),L=new Uint8Array(Qr);return Ut(A,L),{publicKey:A,secretKey:L}},e.box.keyPair.fromSecretKey=function(A){if(tr(A),A.length!==Qr)throw new Error("bad secret key size");var L=new Uint8Array(mt);return fr(L,A),{publicKey:L,secretKey:new Uint8Array(A)}},e.box.publicKeyLength=mt,e.box.secretKeyLength=Qr,e.box.sharedKeyLength=_r,e.box.nonceLength=gn,e.box.overheadLength=e.secretbox.overheadLength,e.sign=function(A,L){if(tr(A,L),L.length!==Hr)throw new Error("bad secret key size");var O=new Uint8Array($r+A.length);return E(O,A,A.length,L),O},e.sign.open=function(A,L){if(tr(A,L),L.length!==Nr)throw new Error("bad public key size");var O=new Uint8Array(A.length),x=X(O,A,A.length,L);if(x<0)return null;for(var K=new Uint8Array(x),ie=0;ie<K.length;ie++)K[ie]=O[ie];return K},e.sign.detached=function(A,L){for(var O=e.sign(A,L),x=new Uint8Array($r),K=0;K<x.length;K++)x[K]=O[K];return x},e.sign.detached.verify=function(A,L,O){if(tr(A,L,O),L.length!==$r)throw new Error("bad signature size");if(O.length!==Nr)throw new Error("bad public key size");var x=new Uint8Array($r+A.length),K=new Uint8Array($r+A.length),ie;for(ie=0;ie<$r;ie++)x[ie]=L[ie];for(ie=0;ie<A.length;ie++)x[ie+$r]=A[ie];return X(K,x,x.length,O)>=0},e.sign.keyPair=function(){var A=new Uint8Array(Nr),L=new Uint8Array(Hr);return Bt(A,L),{publicKey:A,secretKey:L}},e.sign.keyPair.fromSecretKey=function(A){if(tr(A),A.length!==Hr)throw new Error("bad secret key size");for(var L=new Uint8Array(Nr),O=0;O<L.length;O++)L[O]=A[32+O];return{publicKey:L,secretKey:new Uint8Array(A)}},e.sign.keyPair.fromSeed=function(A){if(tr(A),A.length!==sn)throw new Error("bad seed size");for(var L=new Uint8Array(Nr),O=new Uint8Array(Hr),x=0;x<32;x++)O[x]=A[x];return Bt(L,O,!0),{publicKey:L,secretKey:O}},e.sign.publicKeyLength=Nr,e.sign.secretKeyLength=Hr,e.sign.seedLength=sn,e.sign.signatureLength=$r,e.hash=function(A){tr(A);var L=new Uint8Array(mn);return sr(L,A,A.length),L},e.hash.hashLength=mn,e.verify=function(A,L){return tr(A,L),A.length===0||L.length===0||A.length!==L.length?!1:y(A,0,L,0,A.length)===0},e.setPRNG=function(A){n=A},function(){var A=typeof self<"u"?self.crypto||self.msCrypto:null;if(A&&A.getRandomValues){var L=65536;e.setPRNG(function(O,x){var K,ie=new Uint8Array(x);for(K=0;K<x;K+=L)A.getRandomValues(ie.subarray(K,K+Math.min(x-K,L)));for(K=0;K<x;K++)O[K]=ie[K];In(ie)})}else typeof commonjsRequire<"u"&&(A=require$$0,A&&A.randomBytes&&e.setPRNG(function(O,x){var K,ie=A.randomBytes(x);for(K=0;K<x;K++)O[K]=ie[K];In(ie)}))}()})(r.exports?r.exports:self.nacl=self.nacl||{})}(naclFast)),naclFast.exports}var naclFastExports=requireNaclFast();const tweetnacl=getDefaultExportFromCjs(naclFastExports);async function makeKeypair$1(r,e,t){checkValidKeyUse(t);const n=t===KeyUse.Exchange?RSA_EXCHANGE_ALG:RSA_WRITE_ALG,i=t===KeyUse.Exchange?["encrypt","decrypt"]:["sign","verify"];return webcrypto.subtle.generateKey({name:n,modulusLength:r,publicExponent:utils$1.publicExponent(),hash:{name:e}},!1,i)}function stripKeyHeader(r){return r.replace(`-----BEGIN PUBLIC KEY-----
`,"").replace(`
-----END PUBLIC KEY-----`,"")}async function importPublicKey$1(r,e,t){checkValidKeyUse(t);const n=t===KeyUse.Exchange?RSA_EXCHANGE_ALG:RSA_WRITE_ALG,i=t===KeyUse.Exchange?["encrypt"]:["verify"],s=utils$1.base64ToArrBuf(stripKeyHeader(r));return webcrypto.subtle.importKey("spki",s,{name:n,hash:{name:e}},!0,i)}const keys$1={makeKeypair:makeKeypair$1,importPublicKey:importPublicKey$1};async function sign$2(r,e,t=DEFAULT_CHAR_SIZE){return webcrypto.subtle.sign({name:RSA_WRITE_ALG,saltLength:SALT_LENGTH},e,normalizeUnicodeToBuf(r,t))}async function verify$1(r,e,t,n=DEFAULT_CHAR_SIZE,i=DEFAULT_HASH_ALG){return webcrypto.subtle.verify({name:RSA_WRITE_ALG,saltLength:SALT_LENGTH},typeof t=="string"?await keys$1.importPublicKey(t,i,KeyUse.Write):t,normalizeBase64ToBuf(e),normalizeUnicodeToBuf(r,n))}async function encrypt$1(r,e,t=DEFAULT_CHAR_SIZE,n=DEFAULT_HASH_ALG){return webcrypto.subtle.encrypt({name:RSA_EXCHANGE_ALG},typeof e=="string"?await keys$1.importPublicKey(e,n,KeyUse.Exchange):e,normalizeUnicodeToBuf(r,t))}async function decrypt$1(r,e){const t=normalizeBase64ToBuf(r);return webcrypto.subtle.decrypt({name:RSA_EXCHANGE_ALG},e,t)}async function getPublicKey$1(r){const e=await webcrypto.subtle.exportKey("spki",r.publicKey);return utils$1.arrBufToBase64(e)}const operations$1={sign:sign$2,verify:verify$1,encrypt:encrypt$1,decrypt:decrypt$1,getPublicKey:getPublicKey$1};function createStore(r){return localforage.createInstance({name:r})}async function createIfDoesNotExist(r,e,t=localforage){if(await exists(r,t))return;const n=await e();await put(r,n,t)}async function put(r,e,t=localforage){return t.setItem(r,e)}async function getKeypair(r,e=localforage){return get$5(r,checkIsKeyPair,e)}async function getKey(r,e=localforage){return get$5(r,checkIsKey,e)}async function get$5(r,e,t=localforage){const n=await t.getItem(r);return n===null?null:e(n)}async function exists(r,e=localforage){return await e.getItem(r)!==null}async function rm(r,e=localforage){return e.removeItem(r)}async function dropStore(r){return r.dropInstance()}async function clear$3(r){return r?dropStore(r):localforage.clear()}const IDB={createStore,createIfDoesNotExist,put,getKeypair,getKey,exists,rm,dropStore,clear:clear$3},idb=Object.freeze(Object.defineProperty({__proto__:null,clear:clear$3,createIfDoesNotExist,createStore,default:IDB,dropStore,exists,get:get$5,getKey,getKeypair,put,rm},Symbol.toStringTag,{value:"Module"}));async function makeKeypair(r,e){checkValidKeyUse(e);const t=e===KeyUse.Exchange?ECC_EXCHANGE_ALG:ECC_WRITE_ALG,n=e===KeyUse.Exchange?["deriveKey","deriveBits"]:["sign","verify"];return webcrypto.subtle.generateKey({name:t,namedCurve:r},!1,n)}async function importPublicKey(r,e,t){checkValidKeyUse(t);const n=t===KeyUse.Exchange?ECC_EXCHANGE_ALG:ECC_WRITE_ALG,i=t===KeyUse.Exchange?[]:["verify"],s=utils$1.base64ToArrBuf(r);return webcrypto.subtle.importKey("raw",s,{name:n,namedCurve:e},!0,i)}const keys={makeKeypair,importPublicKey},defaultConfig={type:DEFAULT_CRYPTOSYSTEM,curve:DEFAULT_ECC_CURVE,rsaSize:DEFAULT_RSA_SIZE,symmAlg:DEFAULT_SYMM_ALG,symmLen:DEFAULT_SYMM_LEN,hashAlg:DEFAULT_HASH_ALG,charSize:DEFAULT_CHAR_SIZE,storeName:DEFAULT_STORE_NAME,exchangeKeyName:DEFAULT_EXCHANGE_KEY_NAME,writeKeyName:DEFAULT_WRITE_KEY_NAME};function normalize(r,e=!0){let t;return r?t={...defaultConfig,...r}:t=defaultConfig,r!=null&&r.type||(t.type=e?CryptoSystem.ECC:CryptoSystem.RSA),t}async function eccEnabled(){const r=await keys.makeKeypair(DEFAULT_ECC_CURVE,KeyUse.Exchange);try{await utils$1.structuralClone(r)}catch{return!1}return!0}function merge$2(r,e={}){return{...r,...e}}function symmKeyOpts(r){return{alg:r.symmAlg,length:r.symmLen}}const config$1={defaultConfig,normalize,eccEnabled,merge:merge$2,symmKeyOpts},config$2=Object.freeze(Object.defineProperty({__proto__:null,default:config$1,defaultConfig,eccEnabled,merge:merge$2,normalize,symmKeyOpts},Symbol.toStringTag,{value:"Module"}));class KeyStoreBase{constructor(e,t){this.cfg=e,this.store=t}async writeKey(){const e=await IDB.getKeypair(this.cfg.writeKeyName,this.store);return checkIsKeyPair(e)}async exchangeKey(){const e=await IDB.getKeypair(this.cfg.exchangeKeyName,this.store);return checkIsKeyPair(e)}async getSymmKey(e,t){const n=config$1.merge(this.cfg,t),i=await IDB.getKey(e,this.store);if(i!==null)return i;const s=await aes$1.makeKey(config$1.symmKeyOpts(n));return await IDB.put(e,s,this.store),s}async keyExists(e){return await IDB.getKey(e,this.store)!==null}async deleteKey(e){return IDB.rm(e,this.store)}async destroy(){return IDB.dropStore(this.store)}async importSymmKey(e,t,n){const i=config$1.merge(this.cfg,n),s=await aes$1.importKey(e,config$1.symmKeyOpts(i));await IDB.put(t,s,this.store)}async exportSymmKey(e,t){const n=await this.getSymmKey(e,t);return aes$1.exportKey(n)}async encryptWithSymmKey(e,t,n){const i=config$1.merge(this.cfg,n),s=await this.getSymmKey(t,n),u=await aes$1.encryptBytes(utils$1.strToArrBuf(e,i.charSize),s,config$1.symmKeyOpts(i));return utils$1.arrBufToBase64(u)}async decryptWithSymmKey(e,t,n){const i=config$1.merge(this.cfg,n),s=await this.getSymmKey(t,n),u=await aes$1.decryptBytes(utils$1.base64ToArrBuf(e),s,config$1.symmKeyOpts(i));return utils$1.arrBufToStr(u,i.charSize)}}class RSAKeyStore extends KeyStoreBase{static async init(e){const t=config$1.normalize({...e||{},type:CryptoSystem.RSA}),{rsaSize:n,hashAlg:i,storeName:s,exchangeKeyName:u,writeKeyName:c}=t,d=IDB.createStore(s);return await IDB.createIfDoesNotExist(u,()=>keys$1.makeKeypair(n,i,KeyUse.Exchange),d),await IDB.createIfDoesNotExist(c,()=>keys$1.makeKeypair(n,i,KeyUse.Write),d),new RSAKeyStore(t,d)}async sign(e,t){const n=config$1.merge(this.cfg,t),i=await this.writeKey();return utils$1.arrBufToBase64(await operations$1.sign(e,i.privateKey,n.charSize))}async verify(e,t,n,i){const s=config$1.merge(this.cfg,i);return operations$1.verify(e,t,n,s.charSize,s.hashAlg)}async encrypt(e,t,n){const i=config$1.merge(this.cfg,n);return utils$1.arrBufToBase64(await operations$1.encrypt(e,t,i.charSize,i.hashAlg))}async decrypt(e,t,n){const i=await this.exchangeKey(),s=config$1.merge(this.cfg,n);return utils$1.arrBufToStr(await operations$1.decrypt(e,i.privateKey),s.charSize)}async publicExchangeKey(){const e=await this.exchangeKey();return operations$1.getPublicKey(e)}async publicWriteKey(){const e=await this.writeKey();return operations$1.getPublicKey(e)}}const rsa$1={...keys$1,...operations$1,...RSAKeyStore},rsa$2=Object.freeze(Object.defineProperty({__proto__:null,RSAKeyStore,decrypt:decrypt$1,default:rsa$1,encrypt:encrypt$1,getPublicKey:getPublicKey$1,importPublicKey:importPublicKey$1,makeKeypair:makeKeypair$1,sign:sign$2,verify:verify$1},Symbol.toStringTag,{value:"Module"}));async function sign$1(r,e,t=DEFAULT_CHAR_SIZE,n=DEFAULT_HASH_ALG){return webcrypto.subtle.sign({name:ECC_WRITE_ALG,hash:{name:n}},e,normalizeUnicodeToBuf(r,t))}async function verify(r,e,t,n=DEFAULT_CHAR_SIZE,i=DEFAULT_ECC_CURVE,s=DEFAULT_HASH_ALG){return webcrypto.subtle.verify({name:ECC_WRITE_ALG,hash:{name:s}},typeof t=="string"?await keys.importPublicKey(t,i,KeyUse.Write):t,normalizeBase64ToBuf(e),normalizeUnicodeToBuf(r,n))}async function encrypt(r,e,t,n=DEFAULT_CHAR_SIZE,i=DEFAULT_ECC_CURVE,s){const u=typeof t=="string"?await keys.importPublicKey(t,i,KeyUse.Exchange):t,c=await getSharedKey(e,u,s);return aes$1.encryptBytes(normalizeUnicodeToBuf(r,n),c,s)}async function decrypt(r,e,t,n=DEFAULT_ECC_CURVE,i){const s=typeof t=="string"?await keys.importPublicKey(t,n,KeyUse.Exchange):t,u=await getSharedKey(e,s,i);return aes$1.decryptBytes(normalizeBase64ToBuf(r),u,i)}async function getPublicKey(r){const e=await webcrypto.subtle.exportKey("raw",r.publicKey);return utils$1.arrBufToBase64(e)}async function getSharedKey(r,e,t){return webcrypto.subtle.deriveKey({name:ECC_EXCHANGE_ALG,public:e},r,{name:(t==null?void 0:t.alg)||DEFAULT_SYMM_ALG,length:(t==null?void 0:t.length)||DEFAULT_SYMM_LEN},!1,["encrypt","decrypt"])}const operations={sign:sign$1,verify,encrypt,decrypt,getPublicKey,getSharedKey};class ECCKeyStore extends KeyStoreBase{static async init(e){const t=config$1.normalize({...e||{},type:CryptoSystem.ECC}),{curve:n,storeName:i,exchangeKeyName:s,writeKeyName:u}=t,c=IDB.createStore(i);return await IDB.createIfDoesNotExist(s,()=>keys.makeKeypair(n,KeyUse.Exchange),c),await IDB.createIfDoesNotExist(u,()=>keys.makeKeypair(n,KeyUse.Write),c),new ECCKeyStore(t,c)}async sign(e,t){const n=config$1.merge(this.cfg,t),i=await this.writeKey();return utils$1.arrBufToBase64(await operations.sign(e,i.privateKey,n.charSize,n.hashAlg))}async verify(e,t,n,i){const s=config$1.merge(this.cfg,i);return operations.verify(e,t,n,s.charSize,s.curve,s.hashAlg)}async encrypt(e,t,n){const i=config$1.merge(this.cfg,n),s=await this.exchangeKey();return utils$1.arrBufToBase64(await operations.encrypt(e,s.privateKey,t,i.charSize,i.curve))}async decrypt(e,t,n){const i=config$1.merge(this.cfg,n),s=await this.exchangeKey();return utils$1.arrBufToStr(await operations.decrypt(e,s.privateKey,t,i.curve),i.charSize)}async publicExchangeKey(){const e=await this.exchangeKey();return operations.getPublicKey(e)}async publicWriteKey(){const e=await this.writeKey();return operations.getPublicKey(e)}}async function init$2(r){const e=await config$1.eccEnabled();if(!e&&(r==null?void 0:r.type)==="ecc")throw ECCNotEnabled;const t=config$1.normalize(r,e);return checkValidCryptoSystem(t.type),t.type==="ecc"?ECCKeyStore.init(t):RSAKeyStore.init(t)}async function clear$2(){return IDB.clear()}const index={...keys,...operations,...ECCKeyStore},ecc=Object.freeze(Object.defineProperty({__proto__:null,ECCKeyStore,decrypt,default:index,encrypt,getPublicKey,getSharedKey,importPublicKey,makeKeypair,sign:sign$1,verify},Symbol.toStringTag,{value:"Module"})),keystore$1={init:init$2,clear:clear$2,...types,...constants$1,...config$2,...utils$2,ecc,rsa:rsa$2,idb},KEYSTORE_CFG={type:CryptoSystem.RSA};let ks=null;const clear$1=async()=>{ks=await get$4(),await ks.destroy(),ks=null},get$4=async()=>ks||(ks=await keystore$1.init(KEYSTORE_CFG),ks),rsaVerify=(r,e,t)=>{assertBrowser("rsa.verify");const n=utils$1.arrBufToBase64(t.buffer);return rsa$1.verify(r,e,n)},ed25519Verify=async(r,e,t)=>tweetnacl.sign.detached.verify(r,e,t),ksPublicExchangeKey=async()=>(assertBrowser("keystore.publicExchangeKey"),(await get$4()).publicExchangeKey()),ksPublicWriteKey=async()=>(assertBrowser("keystore.publicWriteKey"),(await get$4()).publicWriteKey()),ksDecrypt=async r=>(assertBrowser("keystore.decrypt"),(await get$4()).decrypt(r)),ksSign=async(r,e)=>(assertBrowser("keystore.sign"),(await get$4()).sign(r,{charSize:e})),ksImportSymmKey=async(r,e)=>(assertBrowser("keystore.importSymmKey"),(await get$4()).importSymmKey(r,e)),ksExportSymmKey=async r=>(assertBrowser("keystore.exportSymmKey"),(await get$4()).exportSymmKey(r)),ksKeyExists=async r=>(assertBrowser("keystore.keyExists"),(await get$4()).keyExists(r)),ksGetAlg=async()=>(assertBrowser("keystore.getAlg"),(await get$4()).cfg.type),ksClear=async()=>(assertBrowser("keystore.clear"),clear$1()),IMPLEMENTATION={rsa:{verify:rsaVerify},ed25519:{verify:ed25519Verify},keystore:{publicExchangeKey:ksPublicExchangeKey,publicWriteKey:ksPublicWriteKey,decrypt:ksDecrypt,sign:ksSign,importSymmKey:ksImportSymmKey,exportSymmKey:ksExportSymmKey,keyExists:ksKeyExists,getAlg:ksGetAlg,clear:ksClear}};let impl$2=IMPLEMENTATION;const sha256Str=async r=>{const e=await webcrypto.subtle.digest("sha-256",fromString$8(r));return toString$a(new Uint8Array(e),"hex")},hash$1={sha256:async r=>new Uint8Array(await webcrypto.subtle.digest("sha-256",r)),sha256Str},aes={encrypt:async(r,e,t)=>{const n=await importKey(e,{length:SymmKeyLength.B256,alg:t}),i=await encryptBytes(r,n,{alg:t});return new Uint8Array(i)},decrypt:async(r,e,t)=>{const n=await importKey(e,{length:SymmKeyLength.B256,alg:t}),i=await decryptBytes(r,n,{alg:t});return new Uint8Array(i)},genKeyStr:async r=>{const e=await makeKey({length:SymmKeyLength.B256,alg:r});return exportKey(e)},decryptGCM:async(r,e,t)=>{const n=fromString$8(t,"base64pad"),i=await webcrypto.subtle.importKey("raw",fromString$8(e,"base64pad"),"AES-GCM",!1,["encrypt","decrypt"]),s=await webcrypto.subtle.decrypt({name:"AES-GCM",iv:n},i,fromString$8(r,"base64pad"));return toString$a(new Uint8Array(s))}},rsa={decrypt:(r,e)=>webcrypto.subtle.decrypt({name:"RSA-OAEP"},e,r),encrypt:async(r,e)=>webcrypto.subtle.encrypt({name:"RSA-OAEP"},await webcrypto.subtle.importKey("spki",fromString$8(e,"base64pad").buffer,{name:"RSA-OAEP",hash:"SHA-256"},!1,["encrypt"]),r),genKey:()=>webcrypto.subtle.generateKey({name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["encrypt","decrypt"]),verify:(r,e,t)=>impl$2.rsa.verify(r,e,t)},ed25519={verify:(r,e,t)=>impl$2.ed25519.verify(r,e,t)},keystore={publicExchangeKey:()=>impl$2.keystore.publicExchangeKey(),publicWriteKey:()=>impl$2.keystore.publicWriteKey(),decrypt:r=>impl$2.keystore.decrypt(r),sign:(r,e)=>impl$2.keystore.sign(r,e),importSymmKey:(r,e)=>impl$2.keystore.importSymmKey(r,e),exportSymmKey:r=>impl$2.keystore.exportSymmKey(r),keyExists:r=>impl$2.keystore.keyExists(r),getAlg:()=>impl$2.keystore.getAlg(),clear:()=>impl$2.keystore.clear()};var KeyType;(function(r){r.RSA="rsa",r.Edwards="ed25519",r.BLS="bls12-381"})(KeyType||(KeyType={}));const EDWARDS_DID_PREFIX=new Uint8Array([237,1]),BLS_DID_PREFIX=new Uint8Array([234,1]),RSA_DID_PREFIX=new Uint8Array([0,245,2]),BASE58_DID_PREFIX="did:key:z";function magicBytes(r){switch(r){case KeyType.Edwards:return EDWARDS_DID_PREFIX;case KeyType.RSA:return RSA_DID_PREFIX;case KeyType.BLS:return BLS_DID_PREFIX;default:return null}}const parseMagicBytes=r=>{if(hasPrefix(r,RSA_DID_PREFIX))return{keyBuffer:r.slice(RSA_DID_PREFIX.byteLength),type:KeyType.RSA};if(hasPrefix(r,EDWARDS_DID_PREFIX))return{keyBuffer:r.slice(EDWARDS_DID_PREFIX.byteLength),type:KeyType.Edwards};if(hasPrefix(r,BLS_DID_PREFIX))return{keyBuffer:r.slice(BLS_DID_PREFIX.byteLength),type:KeyType.BLS};throw new Error("Unsupported key algorithm. Try using RSA.")},hasPrefix=(r,e)=>equal(e,r.slice(0,e.byteLength)),toKeyType=r=>{switch(r){case"rsa":return KeyType.RSA;case"ed25519":return KeyType.Edwards;case"bls12-381":return KeyType.BLS}throw new Error(`Key Type ${r} not supported`)};function publicKeyToDid(r,e){const t=base64ToArrBuf(r),n=magicBytes(e);if(n===null)throw new Error(`Key type '${e}' not supported`);const i=joinBufs(n,t);return BASE58_DID_PREFIX+toString$a(new Uint8Array(i),"base58btc")}function didToPublicKey(r){if(!r.startsWith(BASE58_DID_PREFIX))throw new Error("Please use a base58-encoded DID formatted `did:key:z...`");const e=r.substr(BASE58_DID_PREFIX.length),t=fromString$8(e,"base58btc"),{keyBuffer:n,type:i}=parseMagicBytes(t);return{publicKey:arrBufToBase64(n),type:i}}async function exchange(){const r=await keystore.publicExchangeKey(),e=await keystore.getAlg();return publicKeyToDid(r,toKeyType(e))}async function write(){const r=await keystore.publicWriteKey(),e=await keystore.getAlg();return publicKeyToDid(r,toKeyType(e))}async function verifySignedData({charSize:r=16,data:e,did:t,signature:n}){try{const{type:i,publicKey:s}=didToPublicKey(t),u=new Uint8Array(base64ToArrBuf(n)),c=new Uint8Array(normalizeUnicodeToBuf(e,r)),d=new Uint8Array(base64ToArrBuf(s));switch(i){case KeyType.Edwards:return await ed25519.verify(c,u,d);case KeyType.RSA:return await rsa.verify(c,u,d);default:return!1}}catch{return!1}}async function build({addSignature:r=!0,audience:e,facts:t=[],issuer:n,lifetimeInSeconds:i=30,expiration:s,potency:u="APPEND",proof:c,resource:d}){const g=Math.floor(Date.now()/1e3),_=c&&decode$e(c),f=await keystore.getAlg(),l={alg:jwtAlgorithm(f)||"UnknownAlgorithm",typ:"JWT",uav:"1.0.0"};let h=s||g+i,p=g-60;if(_){const v=_.payload;h=Math.min(v.exp,h),p=Math.max(v.nbf,p)}const y={aud:e,exp:h,fct:t,iss:n||await write(),nbf:p,prf:c||null,ptc:u,rsc:d||(_?_.payload.rsc:"*")},w=r?await sign(l,y):null;return{header:l,payload:y,signature:w}}function decode$e(r){const e=r.split("."),t=JSON.parse(urlDecode(e[0])),n=JSON.parse(urlDecode(e[1]));return{header:t,payload:n,signature:e[2]||null}}function encode$b(r){const e=encodeHeader(r.header),t=encodePayload(r.payload);return e+"."+t+"."+r.signature}function encodeHeader(r){return urlEncode(JSON.stringify(r))}function encodePayload(r){return urlEncode(JSON.stringify({...r}))}function isExpired(r){return r.payload.exp<=Math.floor(Date.now()/1e3)}async function isValid(r){const e=encodeHeader(r.header),t=encodePayload(r.payload),n=await verifySignedData({charSize:8,data:`${e}.${t}`,did:r.payload.iss,signature:makeUrlUnsafe(r.signature||"")});if(!n)return n;if(!r.payload.prf)return!0;const i=decode$e(r.payload.prf),s=i.payload.aud===r.payload.iss;return s&&await isValid(i)}function rootIssuer(r,e=0){const t=extractPayload(r,e);return t.prf?rootIssuer(t.prf,e+1):t.iss}async function sign(r,e){const t=encodeHeader(r),n=encodePayload(e);return makeUrlSafe(await keystore.sign(`${t}.${n}`,8))}function jwtAlgorithm(r){switch(r){case"ed25519":return"EdDSA";case"rsa":return"RS256";default:return null}}function extractPayload(r,e){try{return JSON.parse(urlDecode(r.split(".")[1]))}catch{throw new Error(`Invalid UCAN (${e} level${e===1?"":"s"} deep): \`${r}\``)}}async function root$3(r){const e=setup.endpoints.user;try{const t=await lookupTxtRecord(`_did.${r}.${e}`);if(t!==null)return t}catch{}throw new Error("Could not locate user DID in DNS.")}async function ownRoot(){const r=getDictionary(),e=Object.values(r)[0];if(e!==void 0)return rootIssuer(e);const t=await authenticatedUsername();if(!isString(t))throw new Error("No logged in user");return root$3(t)}var Branch;(function(r){r.Public="public",r.Pretty="p",r.Private="private",r.PrivateLog="privateLog",r.Shared="shared",r.SharedCounter="sharedCounter",r.Version="version"})(Branch||(Branch={}));var Kind;(function(r){r.Directory="directory",r.File="file"})(Kind||(Kind={}));function directory(...r){if(r.some(e=>e.includes("/")))throw new Error("Forward slashes `/` are not allowed");return{directory:r}}function file(...r){if(r.some(e=>e.includes("/")))throw new Error("Forward slashes `/` are not allowed");return{file:r}}function root$2(){return{directory:[]}}function fromPosix(r){const e=r.replace(/^\/+/,"").split("/");return r.endsWith("/")?{directory:e.slice(0,-1)}:r===""?root$2():{file:e}}function toPosix(r,{absolute:e}={absolute:!1}){const t=e?"/":"",n=unwrap$2(r).join("/");return isDirectory(r)?t+n+(n.length?"/":""):t+n}function combine(r,e){return map$2(t=>unwrap$2(r).concat(t),e)}function isBranch(r,e){return unwrap$2(e)[0]===r}function isDirectory(r){return!!r.directory}function isFile$1(r){return!!r.file}function isRootDirectory(r){return r.directory.length===0}function isSameBranch(r,e){return unwrap$2(r)[0]===unwrap$2(e)[0]}function isSameKind(r,e){return isDirectory(r)&&isDirectory(e)?!0:!!(isFile$1(r)&&isFile$1(e))}function kind(r){return isDirectory(r)?Kind.Directory:Kind.File}function map$2(r,e){return isDirectory(e)?{directory:r(e.directory)}:isFile$1(e)?{file:r(e.file)}:e}function parent(r){return isDirectory(r)&&isRootDirectory(r)?null:directory(...unwrap$2(r).slice(0,-1))}function removeBranch(r){return map$2(e=>isDirectory(r)||e.length>1?e.slice(1):e,r)}function terminus(r){const e=unwrap$2(r);return e.length<1?null:e[e.length-1]}function unwrap$2(r){return isDirectory(r)?r.directory:isFile$1(r)?r.file:[]}function log$8(r){return`[ ${r.join(", ")} ]`}const WNFS_PREFIX="wnfs";function compile(r){return r.reduce((e,t)=>{const n=decode$e(t);if(isExpired(n))return e;const i=resourceLabel(n.payload.rsc);return{...e,[i]:t}},{})}function resourceLabel(r){if(typeof r!="object")return r;const e=Array.from(Object.entries(r))[0];return e[0]+":"+(e[0]===WNFS_PREFIX?e[1].replace(/^\/+/,""):e[1])}function filesystemPrefix(r){return WNFS_PREFIX+":"}function lookup$1(r){return getDictionary()[r]}async function lookupFilesystemUcan(r){const e=lookup$1("*");if(e)return e;const t=r==="*",n=t?!1:isDirectory(r),i=t?["*"]:unwrap$2(r),u=await authenticatedUsername()?filesystemPrefix():"";return i.reduce((c,d,g)=>{if(c)return c;const _=g===0,f=i.slice(0,i.length-g),l=toPosix(_&&!n?file(...f):directory(...f));return lookup$1(`${u}${l}`)||null},null)}const EMPTY_CID="Qmc5m94Gu7z62RC8waSKkZUrCCBJPyHbkpmGzEePxy2oXJ";async function lookup(r){const e=await lookupOnFisson(r);if(!e||e.toString()===EMPTY_CID)return null;if(e!==null)return e;try{const t=await lookupDnsLink(r+".files."+setup.endpoints.user);return!t||t===EMPTY_CID?null:decodeCID(t)}catch(t){throw console.error(t),new Error("Could not locate user root in dns")}}async function lookupOnFisson(r){const e=setup.getApiEndpoint();try{const n=await(await fetch(`${e}/user/data/${r}`,{cache:"reload"})).json();return decodeCID(n)}catch(t){return log$9("Could not locate user root on Fission server: ",hasProp(t,"toString")?t.toString():t),null}}async function update(r,e){const t=setup.getApiEndpoint(),n=r.toString();return await fetchWithRetry(`${t}/user/data/${n}`,{headers:async()=>({authorization:`Bearer ${encode$b(await build({audience:await did(),issuer:await write(),potency:"APPEND",proof:e,resource:decode$e(e).payload.rsc}))}`}),retries:100,retryDelay:5e3,retryOn:[502,503,504]},{method:"PUT"}).then(i=>(i.status<300,{success:i.status<300})).catch(i=>(console.error(i),{success:!1}))}async function fetchWithRetry(r,e,t,n=0){const i=await e.headers(),s=await fetch(r,{...t,headers:{...t.headers,...i}});if(e.retryOn.includes(s.status)){if(n<e.retries)return await new Promise((u,c)=>setTimeout(()=>fetchWithRetry(r,e,t,n+1).then(u,c),e.retryDelay));throw new Error("Too many retries for fetch")}return s}function appDataPath(r){return directory(Branch.Private,"Apps",r.creator,r.name)}function paths(r){var t,n,i,s;let e=[];return r.app&&e.push(appDataPath(r.app)),(t=r.fs)!=null&&t.private&&(e=e.concat((n=r.fs)==null?void 0:n.private.map(u=>combine(directory(Branch.Private),u)))),(i=r.fs)!=null&&i.public&&(e=e.concat((s=r.fs)==null?void 0:s.public.map(u=>combine(directory(Branch.Public),u)))),e}async function store(r){const t=(await getItem(UCANS_STORAGE_KEY)||[]).concat(r);setDictionary(compile(t));const n=listFromDictionary();await setItem(UCANS_STORAGE_KEY,n)}function validatePermissions({app:r,fs:e,raw:t},n){const i=filesystemPrefix(),s=lookup$1("*");if(s&&!isExpired(decode$e(s)))return!0;if(r){const u=i+toPosix(appDataPath(r)),c=lookup$1(u);if(!c||isExpired(decode$e(c)))return!1}return!(e!=null&&e.private&&!e.private.every(c=>{const d=`${i}private/`+toPosix(c),g=lookup$1(d);return g&&!isExpired(decode$e(g))})||e!=null&&e.public&&!e.public.every(c=>{const d=`${i}public/`+toPosix(c),g=lookup$1(d);return g&&!isExpired(decode$e(g))})||t&&!t.every(c=>{const d=resourceLabel(c.rsc),g=lookup$1(d);return g&&!isExpired(decode$e(g))}))}function listFromDictionary(){return Object.values(getDictionary())}var InitialisationError;(function(r){r.InsecureContext="INSECURE_CONTEXT",r.UnsupportedBrowser="UNSUPPORTED_BROWSER"})(InitialisationError||(InitialisationError={}));async function bareNameFilter({path:r}){return`wnfs__bareNameFilter__${await hash$1.sha256Str(pathToString(r))}`}async function readKey({path:r}){return`wnfs__readKey__${await hash$1.sha256Str(pathToString(r))}`}function pathToString(r){return"/"+unwrap$2(r).join("/")}async function validateSecrets(r){return paths(r).reduce((e,t)=>e.then(async n=>{if(n===!1||isBranch(Branch.Public,t))return n;const i=await readKey({path:t});return await keystore.keyExists(i)}),Promise.resolve(!0))}const typeofs=["string","number","bigint","symbol"],objectTypeNames=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function is(r){if(r===null)return"null";if(r===void 0)return"undefined";if(r===!0||r===!1)return"boolean";const e=typeof r;if(typeofs.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(r))return"Array";if(isBuffer$1(r))return"Buffer";const t=getObjectType(r);return t||"Object"}function isBuffer$1(r){return r&&r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer.call(null,r)}function getObjectType(r){const e=Object.prototype.toString.call(r).slice(8,-1);if(objectTypeNames.includes(e))return e}class Type{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}Type.uint=new Type(0,"uint",!0);Type.negint=new Type(1,"negint",!0);Type.bytes=new Type(2,"bytes",!0);Type.string=new Type(3,"string",!0);Type.array=new Type(4,"array",!1);Type.map=new Type(5,"map",!1);Type.tag=new Type(6,"tag",!1);Type.float=new Type(7,"float",!0);Type.false=new Type(7,"false",!0);Type.true=new Type(7,"true",!0);Type.null=new Type(7,"null",!0);Type.undefined=new Type(7,"undefined",!0);Type.break=new Type(7,"break",!0);class Token{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const useBuffer=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",textDecoder$1=new TextDecoder,textEncoder$2=new TextEncoder;function isBuffer(r){return useBuffer&&globalThis.Buffer.isBuffer(r)}function asU8A(r){return r instanceof Uint8Array?isBuffer(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r)}const toString$9=useBuffer?(r,e,t)=>t-e>64?globalThis.Buffer.from(r.subarray(e,t)).toString("utf8"):utf8Slice(r,e,t):(r,e,t)=>t-e>64?textDecoder$1.decode(r.subarray(e,t)):utf8Slice(r,e,t),fromString$7=useBuffer?r=>r.length>64?globalThis.Buffer.from(r):utf8ToBytes(r):r=>r.length>64?textEncoder$2.encode(r):utf8ToBytes(r),fromArray=r=>Uint8Array.from(r),slice=useBuffer?(r,e,t)=>isBuffer(r)?new Uint8Array(r.subarray(e,t)):r.slice(e,t):(r,e,t)=>r.slice(e,t),concat$1=useBuffer?(r,e)=>(r=r.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),asU8A(globalThis.Buffer.concat(r,e))):(r,e)=>{const t=new Uint8Array(e);let n=0;for(let i of r)n+i.length>t.length&&(i=i.subarray(0,t.length-n)),t.set(i,n),n+=i.length;return t},alloc=useBuffer?r=>globalThis.Buffer.allocUnsafe(r):r=>new Uint8Array(r);function compare(r,e){if(isBuffer(r)&&isBuffer(e))return r.compare(e);for(let t=0;t<r.length;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}function utf8ToBytes(r,e=1/0){let t;const n=r.length;let i=null;const s=[];for(let u=0;u<n;++u){if(t=r.charCodeAt(u),t>55295&&t<57344){if(!i){if(t>56319){(e-=3)>-1&&s.push(239,191,189);continue}else if(u+1===n){(e-=3)>-1&&s.push(239,191,189);continue}i=t;continue}if(t<56320){(e-=3)>-1&&s.push(239,191,189),i=t;continue}t=(i-55296<<10|t-56320)+65536}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,t<128){if((e-=1)<0)break;s.push(t)}else if(t<2048){if((e-=2)<0)break;s.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;s.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;s.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return s}function utf8Slice(r,e,t){const n=[];for(;e<t;){const i=r[e];let s=null,u=i>239?4:i>223?3:i>191?2:1;if(e+u<=t){let c,d,g,_;switch(u){case 1:i<128&&(s=i);break;case 2:c=r[e+1],(c&192)===128&&(_=(i&31)<<6|c&63,_>127&&(s=_));break;case 3:c=r[e+1],d=r[e+2],(c&192)===128&&(d&192)===128&&(_=(i&15)<<12|(c&63)<<6|d&63,_>2047&&(_<55296||_>57343)&&(s=_));break;case 4:c=r[e+1],d=r[e+2],g=r[e+3],(c&192)===128&&(d&192)===128&&(g&192)===128&&(_=(i&15)<<18|(c&63)<<12|(d&63)<<6|g&63,_>65535&&_<1114112&&(s=_))}}s===null?(s=65533,u=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|s&1023),n.push(s),e+=u}return decodeCodePointsArray(n)}const MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(r){const e=r.length;if(e<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=MAX_ARGUMENTS_LENGTH));return t}const defaultChunkSize=256;class Bl{constructor(e=defaultChunkSize){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const i=t.length-(this.maxCursor-this.cursor)-1;t.set(e,i)}else{if(t){const i=t.length-(this.maxCursor-this.cursor)-1;i<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,i),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=alloc(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){const n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=slice(n,0,this.cursor)}else t=concat$1(this.chunks,this.cursor);return e&&this.reset(),t}}const decodeErrPrefix="CBOR decode error:",encodeErrPrefix="CBOR encode error:";function assertEnoughData(r,e,t){if(r.length-e<t)throw new Error(`${decodeErrPrefix} not enough data for type`)}const uintBoundaries=[24,256,65536,4294967296,BigInt("18446744073709551616")];function readUint8(r,e,t){assertEnoughData(r,e,1);const n=r[e];if(t.strict===!0&&n<uintBoundaries[0])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return n}function readUint16(r,e,t){assertEnoughData(r,e,2);const n=r[e]<<8|r[e+1];if(t.strict===!0&&n<uintBoundaries[1])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return n}function readUint32(r,e,t){assertEnoughData(r,e,4);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3];if(t.strict===!0&&n<uintBoundaries[2])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return n}function readUint64(r,e,t){assertEnoughData(r,e,8);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3],i=r[e+4]*16777216+(r[e+5]<<16)+(r[e+6]<<8)+r[e+7],s=(BigInt(n)<<BigInt(32))+BigInt(i);if(t.strict===!0&&s<uintBoundaries[3])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);if(s<=Number.MAX_SAFE_INTEGER)return Number(s);if(t.allowBigInt===!0)return s;throw new Error(`${decodeErrPrefix} integers outside of the safe integer range are not supported`)}function decodeUint8(r,e,t,n){return new Token(Type.uint,readUint8(r,e+1,n),2)}function decodeUint16(r,e,t,n){return new Token(Type.uint,readUint16(r,e+1,n),3)}function decodeUint32(r,e,t,n){return new Token(Type.uint,readUint32(r,e+1,n),5)}function decodeUint64(r,e,t,n){return new Token(Type.uint,readUint64(r,e+1,n),9)}function encodeUint(r,e){return encodeUintValue(r,0,e.value)}function encodeUintValue(r,e,t){if(t<uintBoundaries[0]){const n=Number(t);r.push([e|n])}else if(t<uintBoundaries[1]){const n=Number(t);r.push([e|24,n])}else if(t<uintBoundaries[2]){const n=Number(t);r.push([e|25,n>>>8,n&255])}else if(t<uintBoundaries[3]){const n=Number(t);r.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{const n=BigInt(t);if(n<uintBoundaries[4]){const i=[e|27,0,0,0,0,0,0,0];let s=Number(n&BigInt(4294967295)),u=Number(n>>BigInt(32)&BigInt(4294967295));i[8]=s&255,s=s>>8,i[7]=s&255,s=s>>8,i[6]=s&255,s=s>>8,i[5]=s&255,i[4]=u&255,u=u>>8,i[3]=u&255,u=u>>8,i[2]=u&255,u=u>>8,i[1]=u&255,r.push(i)}else throw new Error(`${decodeErrPrefix} encountered BigInt larger than allowable range`)}}encodeUint.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)};encodeUintValue.encodedSize=function(e){return e<uintBoundaries[0]?1:e<uintBoundaries[1]?2:e<uintBoundaries[2]?3:e<uintBoundaries[3]?5:9};encodeUint.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function decodeNegint8(r,e,t,n){return new Token(Type.negint,-1-readUint8(r,e+1,n),2)}function decodeNegint16(r,e,t,n){return new Token(Type.negint,-1-readUint16(r,e+1,n),3)}function decodeNegint32(r,e,t,n){return new Token(Type.negint,-1-readUint32(r,e+1,n),5)}const neg1b=BigInt(-1),pos1b=BigInt(1);function decodeNegint64(r,e,t,n){const i=readUint64(r,e+1,n);if(typeof i!="bigint"){const s=-1-i;if(s>=Number.MIN_SAFE_INTEGER)return new Token(Type.negint,s,9)}if(n.allowBigInt!==!0)throw new Error(`${decodeErrPrefix} integers outside of the safe integer range are not supported`);return new Token(Type.negint,neg1b-BigInt(i),9)}function encodeNegint(r,e){const t=e.value,n=typeof t=="bigint"?t*neg1b-pos1b:t*-1-1;encodeUintValue(r,e.type.majorEncoded,n)}encodeNegint.encodedSize=function(e){const t=e.value,n=typeof t=="bigint"?t*neg1b-pos1b:t*-1-1;return n<uintBoundaries[0]?1:n<uintBoundaries[1]?2:n<uintBoundaries[2]?3:n<uintBoundaries[3]?5:9};encodeNegint.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function toToken$3(r,e,t,n){assertEnoughData(r,e,t+n);const i=slice(r,e+t,e+t+n);return new Token(Type.bytes,i,t+n)}function decodeBytesCompact(r,e,t,n){return toToken$3(r,e,1,t)}function decodeBytes8(r,e,t,n){return toToken$3(r,e,2,readUint8(r,e+1,n))}function decodeBytes16(r,e,t,n){return toToken$3(r,e,3,readUint16(r,e+1,n))}function decodeBytes32(r,e,t,n){return toToken$3(r,e,5,readUint32(r,e+1,n))}function decodeBytes64(r,e,t,n){const i=readUint64(r,e+1,n);if(typeof i=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer bytes lengths not supported`);return toToken$3(r,e,9,i)}function tokenBytes(r){return r.encodedBytes===void 0&&(r.encodedBytes=r.type===Type.string?fromString$7(r.value):r.value),r.encodedBytes}function encodeBytes(r,e){const t=tokenBytes(e);encodeUintValue(r,e.type.majorEncoded,t.length),r.push(t)}encodeBytes.encodedSize=function(e){const t=tokenBytes(e);return encodeUintValue.encodedSize(t.length)+t.length};encodeBytes.compareTokens=function(e,t){return compareBytes(tokenBytes(e),tokenBytes(t))};function compareBytes(r,e){return r.length<e.length?-1:r.length>e.length?1:compare(r,e)}function toToken$2(r,e,t,n,i){const s=t+n;assertEnoughData(r,e,s);const u=new Token(Type.string,toString$9(r,e+t,e+s),s);return i.retainStringBytes===!0&&(u.byteValue=slice(r,e+t,e+s)),u}function decodeStringCompact(r,e,t,n){return toToken$2(r,e,1,t,n)}function decodeString8(r,e,t,n){return toToken$2(r,e,2,readUint8(r,e+1,n),n)}function decodeString16(r,e,t,n){return toToken$2(r,e,3,readUint16(r,e+1,n),n)}function decodeString32(r,e,t,n){return toToken$2(r,e,5,readUint32(r,e+1,n),n)}function decodeString64(r,e,t,n){const i=readUint64(r,e+1,n);if(typeof i=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer string lengths not supported`);return toToken$2(r,e,9,i,n)}const encodeString$1=encodeBytes;function toToken$1(r,e,t,n){return new Token(Type.array,n,t)}function decodeArrayCompact(r,e,t,n){return toToken$1(r,e,1,t)}function decodeArray8(r,e,t,n){return toToken$1(r,e,2,readUint8(r,e+1,n))}function decodeArray16(r,e,t,n){return toToken$1(r,e,3,readUint16(r,e+1,n))}function decodeArray32(r,e,t,n){return toToken$1(r,e,5,readUint32(r,e+1,n))}function decodeArray64(r,e,t,n){const i=readUint64(r,e+1,n);if(typeof i=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer array lengths not supported`);return toToken$1(r,e,9,i)}function decodeArrayIndefinite(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${decodeErrPrefix} indefinite length items not allowed`);return toToken$1(r,e,1,1/0)}function encodeArray(r,e){encodeUintValue(r,Type.array.majorEncoded,e.value)}encodeArray.compareTokens=encodeUint.compareTokens;encodeArray.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)};function toToken(r,e,t,n){return new Token(Type.map,n,t)}function decodeMapCompact(r,e,t,n){return toToken(r,e,1,t)}function decodeMap8(r,e,t,n){return toToken(r,e,2,readUint8(r,e+1,n))}function decodeMap16(r,e,t,n){return toToken(r,e,3,readUint16(r,e+1,n))}function decodeMap32(r,e,t,n){return toToken(r,e,5,readUint32(r,e+1,n))}function decodeMap64(r,e,t,n){const i=readUint64(r,e+1,n);if(typeof i=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer map lengths not supported`);return toToken(r,e,9,i)}function decodeMapIndefinite(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${decodeErrPrefix} indefinite length items not allowed`);return toToken(r,e,1,1/0)}function encodeMap(r,e){encodeUintValue(r,Type.map.majorEncoded,e.value)}encodeMap.compareTokens=encodeUint.compareTokens;encodeMap.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)};function decodeTagCompact(r,e,t,n){return new Token(Type.tag,t,1)}function decodeTag8(r,e,t,n){return new Token(Type.tag,readUint8(r,e+1,n),2)}function decodeTag16(r,e,t,n){return new Token(Type.tag,readUint16(r,e+1,n),3)}function decodeTag32(r,e,t,n){return new Token(Type.tag,readUint32(r,e+1,n),5)}function decodeTag64(r,e,t,n){return new Token(Type.tag,readUint64(r,e+1,n),9)}function encodeTag(r,e){encodeUintValue(r,Type.tag.majorEncoded,e.value)}encodeTag.compareTokens=encodeUint.compareTokens;encodeTag.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)};const MINOR_FALSE=20,MINOR_TRUE=21,MINOR_NULL=22,MINOR_UNDEFINED=23;function decodeUndefined(r,e,t,n){if(n.allowUndefined===!1)throw new Error(`${decodeErrPrefix} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new Token(Type.null,null,1):new Token(Type.undefined,void 0,1)}function decodeBreak(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${decodeErrPrefix} indefinite length items not allowed`);return new Token(Type.break,void 0,1)}function createToken(r,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(r))throw new Error(`${decodeErrPrefix} NaN values are not supported`);if(t.allowInfinity===!1&&(r===1/0||r===-1/0))throw new Error(`${decodeErrPrefix} Infinity values are not supported`)}return new Token(Type.float,r,e)}function decodeFloat16(r,e,t,n){return createToken(readFloat16(r,e+1),3,n)}function decodeFloat32(r,e,t,n){return createToken(readFloat32(r,e+1),5,n)}function decodeFloat64(r,e,t,n){return createToken(readFloat64(r,e+1),9,n)}function encodeFloat(r,e,t){const n=e.value;if(n===!1)r.push([Type.float.majorEncoded|MINOR_FALSE]);else if(n===!0)r.push([Type.float.majorEncoded|MINOR_TRUE]);else if(n===null)r.push([Type.float.majorEncoded|MINOR_NULL]);else if(n===void 0)r.push([Type.float.majorEncoded|MINOR_UNDEFINED]);else{let i,s=!1;(!t||t.float64!==!0)&&(encodeFloat16(n),i=readFloat16(ui8a,1),n===i||Number.isNaN(n)?(ui8a[0]=249,r.push(ui8a.slice(0,3)),s=!0):(encodeFloat32(n),i=readFloat32(ui8a,1),n===i&&(ui8a[0]=250,r.push(ui8a.slice(0,5)),s=!0))),s||(encodeFloat64(n),i=readFloat64(ui8a,1),ui8a[0]=251,r.push(ui8a.slice(0,9)))}}encodeFloat.encodedSize=function(e,t){const n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!t||t.float64!==!0){encodeFloat16(n);let i=readFloat16(ui8a,1);if(n===i||Number.isNaN(n))return 3;if(encodeFloat32(n),i=readFloat32(ui8a,1),n===i)return 5}return 9};const buffer$1=new ArrayBuffer(9),dataView=new DataView(buffer$1,1),ui8a=new Uint8Array(buffer$1,0);function encodeFloat16(r){if(r===1/0)dataView.setUint16(0,31744,!1);else if(r===-1/0)dataView.setUint16(0,64512,!1);else if(Number.isNaN(r))dataView.setUint16(0,32256,!1);else{dataView.setFloat32(0,r);const e=dataView.getUint32(0),t=(e&2139095040)>>23,n=e&8388607;if(t===255)dataView.setUint16(0,31744,!1);else if(t===0)dataView.setUint16(0,(r&2147483648)>>16|n>>13,!1);else{const i=t-127;i<-24?dataView.setUint16(0,0):i<-14?dataView.setUint16(0,(e&2147483648)>>16|1<<24+i,!1):dataView.setUint16(0,(e&2147483648)>>16|i+15<<10|n>>13,!1)}}}function readFloat16(r,e){if(r.length-e<2)throw new Error(`${decodeErrPrefix} not enough data for float16`);const t=(r[e]<<8)+r[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;const n=t>>10&31,i=t&1023;let s;return n===0?s=i*2**-24:n!==31?s=(i+1024)*2**(n-25):s=i===0?1/0:NaN,t&32768?-s:s}function encodeFloat32(r){dataView.setFloat32(0,r,!1)}function readFloat32(r,e){if(r.length-e<4)throw new Error(`${decodeErrPrefix} not enough data for float32`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,4).getFloat32(0,!1)}function encodeFloat64(r){dataView.setFloat64(0,r,!1)}function readFloat64(r,e){if(r.length-e<8)throw new Error(`${decodeErrPrefix} not enough data for float64`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,8).getFloat64(0,!1)}encodeFloat.compareTokens=encodeUint.compareTokens;function invalidMinor(r,e,t){throw new Error(`${decodeErrPrefix} encountered invalid minor (${t}) for major ${r[e]>>>5}`)}function errorer(r){return()=>{throw new Error(`${decodeErrPrefix} ${r}`)}}const jump=[];for(let r=0;r<=23;r++)jump[r]=invalidMinor;jump[24]=decodeUint8;jump[25]=decodeUint16;jump[26]=decodeUint32;jump[27]=decodeUint64;jump[28]=invalidMinor;jump[29]=invalidMinor;jump[30]=invalidMinor;jump[31]=invalidMinor;for(let r=32;r<=55;r++)jump[r]=invalidMinor;jump[56]=decodeNegint8;jump[57]=decodeNegint16;jump[58]=decodeNegint32;jump[59]=decodeNegint64;jump[60]=invalidMinor;jump[61]=invalidMinor;jump[62]=invalidMinor;jump[63]=invalidMinor;for(let r=64;r<=87;r++)jump[r]=decodeBytesCompact;jump[88]=decodeBytes8;jump[89]=decodeBytes16;jump[90]=decodeBytes32;jump[91]=decodeBytes64;jump[92]=invalidMinor;jump[93]=invalidMinor;jump[94]=invalidMinor;jump[95]=errorer("indefinite length bytes/strings are not supported");for(let r=96;r<=119;r++)jump[r]=decodeStringCompact;jump[120]=decodeString8;jump[121]=decodeString16;jump[122]=decodeString32;jump[123]=decodeString64;jump[124]=invalidMinor;jump[125]=invalidMinor;jump[126]=invalidMinor;jump[127]=errorer("indefinite length bytes/strings are not supported");for(let r=128;r<=151;r++)jump[r]=decodeArrayCompact;jump[152]=decodeArray8;jump[153]=decodeArray16;jump[154]=decodeArray32;jump[155]=decodeArray64;jump[156]=invalidMinor;jump[157]=invalidMinor;jump[158]=invalidMinor;jump[159]=decodeArrayIndefinite;for(let r=160;r<=183;r++)jump[r]=decodeMapCompact;jump[184]=decodeMap8;jump[185]=decodeMap16;jump[186]=decodeMap32;jump[187]=decodeMap64;jump[188]=invalidMinor;jump[189]=invalidMinor;jump[190]=invalidMinor;jump[191]=decodeMapIndefinite;for(let r=192;r<=215;r++)jump[r]=decodeTagCompact;jump[216]=decodeTag8;jump[217]=decodeTag16;jump[218]=decodeTag32;jump[219]=decodeTag64;jump[220]=invalidMinor;jump[221]=invalidMinor;jump[222]=invalidMinor;jump[223]=invalidMinor;for(let r=224;r<=243;r++)jump[r]=errorer("simple values are not supported");jump[244]=invalidMinor;jump[245]=invalidMinor;jump[246]=invalidMinor;jump[247]=decodeUndefined;jump[248]=errorer("simple values are not supported");jump[249]=decodeFloat16;jump[250]=decodeFloat32;jump[251]=decodeFloat64;jump[252]=invalidMinor;jump[253]=invalidMinor;jump[254]=invalidMinor;jump[255]=decodeBreak;const quick=[];for(let r=0;r<24;r++)quick[r]=new Token(Type.uint,r,1);for(let r=-1;r>=-24;r--)quick[31-r]=new Token(Type.negint,r,1);quick[64]=new Token(Type.bytes,new Uint8Array(0),1);quick[96]=new Token(Type.string,"",1);quick[128]=new Token(Type.array,0,1);quick[160]=new Token(Type.map,0,1);quick[244]=new Token(Type.false,!1,1);quick[245]=new Token(Type.true,!0,1);quick[246]=new Token(Type.null,null,1);function quickEncodeToken(r){switch(r.type){case Type.false:return fromArray([244]);case Type.true:return fromArray([245]);case Type.null:return fromArray([246]);case Type.bytes:return r.value.length?void 0:fromArray([64]);case Type.string:return r.value===""?fromArray([96]):void 0;case Type.array:return r.value===0?fromArray([128]):void 0;case Type.map:return r.value===0?fromArray([160]):void 0;case Type.uint:return r.value<24?fromArray([Number(r.value)]):void 0;case Type.negint:if(r.value>=-24)return fromArray([31-Number(r.value)])}}const defaultEncodeOptions={float64:!1,mapSorter,quickEncodeToken};function makeCborEncoders(){const r=[];return r[Type.uint.major]=encodeUint,r[Type.negint.major]=encodeNegint,r[Type.bytes.major]=encodeBytes,r[Type.string.major]=encodeString$1,r[Type.array.major]=encodeArray,r[Type.map.major]=encodeMap,r[Type.tag.major]=encodeTag,r[Type.float.major]=encodeFloat,r}const cborEncoders=makeCborEncoders(),buf=new Bl;class Ref{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${encodeErrPrefix} object contains circular references`);return new Ref(t,e)}}const simpleTokens={null:new Token(Type.null,null),undefined:new Token(Type.undefined,void 0),true:new Token(Type.true,!0),false:new Token(Type.false,!1),emptyArray:new Token(Type.array,0),emptyMap:new Token(Type.map,0)},typeEncoders={number(r,e,t,n){return!Number.isInteger(r)||!Number.isSafeInteger(r)?new Token(Type.float,r):r>=0?new Token(Type.uint,r):new Token(Type.negint,r)},bigint(r,e,t,n){return r>=BigInt(0)?new Token(Type.uint,r):new Token(Type.negint,r)},Uint8Array(r,e,t,n){return new Token(Type.bytes,r)},string(r,e,t,n){return new Token(Type.string,r)},boolean(r,e,t,n){return r?simpleTokens.true:simpleTokens.false},null(r,e,t,n){return simpleTokens.null},undefined(r,e,t,n){return simpleTokens.undefined},ArrayBuffer(r,e,t,n){return new Token(Type.bytes,new Uint8Array(r))},DataView(r,e,t,n){return new Token(Type.bytes,new Uint8Array(r.buffer,r.byteOffset,r.byteLength))},Array(r,e,t,n){if(!r.length)return t.addBreakTokens===!0?[simpleTokens.emptyArray,new Token(Type.break)]:simpleTokens.emptyArray;n=Ref.createCheck(n,r);const i=[];let s=0;for(const u of r)i[s++]=objectToTokens(u,t,n);return t.addBreakTokens?[new Token(Type.array,r.length),i,new Token(Type.break)]:[new Token(Type.array,r.length),i]},Object(r,e,t,n){const i=e!=="Object",s=i?r.keys():Object.keys(r),u=i?r.size:s.length;if(!u)return t.addBreakTokens===!0?[simpleTokens.emptyMap,new Token(Type.break)]:simpleTokens.emptyMap;n=Ref.createCheck(n,r);const c=[];let d=0;for(const g of s)c[d++]=[objectToTokens(g,t,n),objectToTokens(i?r.get(g):r[g],t,n)];return sortMapEntries(c,t),t.addBreakTokens?[new Token(Type.map,u),c,new Token(Type.break)]:[new Token(Type.map,u),c]}};typeEncoders.Map=typeEncoders.Object;typeEncoders.Buffer=typeEncoders.Uint8Array;for(const r of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))typeEncoders[`${r}Array`]=typeEncoders.DataView;function objectToTokens(r,e={},t){const n=is(r),i=e&&e.typeEncoders&&e.typeEncoders[n]||typeEncoders[n];if(typeof i=="function"){const u=i(r,n,e,t);if(u!=null)return u}const s=typeEncoders[n];if(!s)throw new Error(`${encodeErrPrefix} unsupported type: ${n}`);return s(r,n,e,t)}function sortMapEntries(r,e){e.mapSorter&&r.sort(e.mapSorter)}function mapSorter(r,e){const t=Array.isArray(r[0])?r[0][0]:r[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(t.type!==n.type)return t.type.compare(n.type);const i=t.type.major,s=cborEncoders[i].compareTokens(t,n);return s===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),s}function tokensToEncoded(r,e,t,n){if(Array.isArray(e))for(const i of e)tokensToEncoded(r,i,t,n);else t[e.type.major](r,e,n)}function encodeCustom(r,e,t){const n=objectToTokens(r,t);if(!Array.isArray(n)&&t.quickEncodeToken){const i=t.quickEncodeToken(n);if(i)return i;const s=e[n.type.major];if(s.encodedSize){const u=s.encodedSize(n,t),c=new Bl(u);if(s(c,n,t),c.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return asU8A(c.chunks[0])}}return buf.reset(),tokensToEncoded(buf,n,e,t),buf.toBytes(!0)}function encode$a(r,e){return e=Object.assign({},defaultEncodeOptions,e),encodeCustom(r,cborEncoders,e)}const defaultDecodeOptions={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class Tokeniser{constructor(e,t={}){this.pos=0,this.data=e,this.options=t}done(){return this.pos>=this.data.length}next(){const e=this.data[this.pos];let t=quick[e];if(t===void 0){const n=jump[e];if(!n)throw new Error(`${decodeErrPrefix} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const i=e&31;t=n(this.data,this.pos,i,this.options)}return this.pos+=t.encodedLength,t}}const DONE=Symbol.for("DONE"),BREAK=Symbol.for("BREAK");function tokenToArray(r,e,t){const n=[];for(let i=0;i<r.value;i++){const s=tokensToObject(e,t);if(s===BREAK){if(r.value===1/0)break;throw new Error(`${decodeErrPrefix} got unexpected break to lengthed array`)}if(s===DONE)throw new Error(`${decodeErrPrefix} found array but not enough entries (got ${i}, expected ${r.value})`);n[i]=s}return n}function tokenToMap(r,e,t){const n=t.useMaps===!0,i=n?void 0:{},s=n?new Map:void 0;for(let u=0;u<r.value;u++){const c=tokensToObject(e,t);if(c===BREAK){if(r.value===1/0)break;throw new Error(`${decodeErrPrefix} got unexpected break to lengthed map`)}if(c===DONE)throw new Error(`${decodeErrPrefix} found map but not enough entries (got ${u} [no key], expected ${r.value})`);if(n!==!0&&typeof c!="string")throw new Error(`${decodeErrPrefix} non-string keys not supported (got ${typeof c})`);const d=tokensToObject(e,t);if(d===DONE)throw new Error(`${decodeErrPrefix} found map but not enough entries (got ${u} [no value], expected ${r.value})`);n?s.set(c,d):i[c]=d}return n?s:i}function tokensToObject(r,e){if(r.done())return DONE;const t=r.next();if(t.type===Type.break)return BREAK;if(t.type.terminal)return t.value;if(t.type===Type.array)return tokenToArray(t,r,e);if(t.type===Type.map)return tokenToMap(t,r,e);if(t.type===Type.tag){if(e.tags&&typeof e.tags[t.value]=="function"){const n=tokensToObject(r,e);return e.tags[t.value](n)}throw new Error(`${decodeErrPrefix} tag not supported (${t.value})`)}throw new Error("unsupported")}function decode$d(r,e){if(!(r instanceof Uint8Array))throw new Error(`${decodeErrPrefix} data to decode must be a Uint8Array`);e=Object.assign({},defaultDecodeOptions,e);const t=e.tokenizer||new Tokeniser(r,e),n=tokensToObject(t,e);if(n===DONE)throw new Error(`${decodeErrPrefix} did not find any content to decode`);if(n===BREAK)throw new Error(`${decodeErrPrefix} got unexpected break`);if(!t.done())throw new Error(`${decodeErrPrefix} too many terminals, data makes no sense`);return n}const CID_CBOR_TAG=42;function cidEncoder(r){if(r.asCID!==r)return null;const e=CID$1.asCID(r);if(!e)return null;const t=new Uint8Array(e.bytes.byteLength+1);return t.set(e.bytes,1),[new Token(Type.tag,CID_CBOR_TAG),new Token(Type.bytes,t)]}function undefinedEncoder(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function numberEncoder(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const encodeOptions={float64:!0,typeEncoders:{Object:cidEncoder,undefined:undefinedEncoder,number:numberEncoder}};function cidDecoder(r){if(r[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return CID$1.decode(r.subarray(1))}const decodeOptions={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,tags:[]};decodeOptions.tags[CID_CBOR_TAG]=cidDecoder;const name$1="dag-cbor",code$1=113,encode$9=r=>encode$a(r,encodeOptions),decode$c=r=>decode$d(r,decodeOptions),dagCBOR=Object.freeze(Object.defineProperty({__proto__:null,code:code$1,decode:decode$c,encode:encode$9,name:name$1},Symbol.toStringTag,{value:"Module"}));function throttle(r,e,t,n){var i,s=!1;function u(){i&&clearTimeout(i)}function c(){u(),s=!0}function d(){for(var g=arguments.length,_=new Array(g),f=0;f<g;f++)_[f]=arguments[f];var l=this;if(s)return;function h(){t.apply(l,_)}u(),i=setTimeout(h,r)}return d.cancel=c,d}const isFile=r=>isObject(r)&&r.content!==void 0,isTree=r=>isObject(r)&&r.ls!==void 0,isBaseLink=r=>isObject(r)&&isString(r.name)&&isNum(r.size)&&isBool(r.isFile),isSoftLink=r=>isObject(r)&&isString(r.name)&&isString(r.ipns),isSoftLinkDictionary=r=>{if(isObject(r)){const e=Object.values(r);return e.length>0&&e.every(isSoftLink)}return!1},isSoftLinkList=r=>Array.isArray(r)&&r.every(isSoftLink),isHardLink=r=>isBaseLink(r)&&isCID(r.cid),isLinks=r=>isObject(r)&&Object.values(r).every(e=>isHardLink(e)||isSoftLink(e)),isUnixMeta=r=>isObject(r)&&isNum(r.mtime)&&isNum(r.ctime)&&isNum(r.mode)&&isString(r._type),isMetadata=r=>isObject(r)&&isUnixMeta(r.unixMeta)&&isBool(r.isFile)&&isSemVer(r.version),isSkeleton=r=>isObject(r)&&Object.values(r).every(isSkeletonInfo),isSkeletonInfo=r=>isObject(r)&&isCID(r.cid)&&isCID(r.userland)&&isCID(r.metadata)&&isSkeleton(r.subSkeleton)||isSoftLink(r),isTreeHeader=r=>isObject(r)&&isSkeleton(r.skeleton)&&isMetadata(r.metadata)&&r.metadata.isFile===!1,isTreeInfo=r=>isTreeHeader(r)&&isCID(r.userland),isFileHeader=r=>isObject(r)&&isMetadata(r.metadata)&&r.metadata.isFile===!0,isFileInfo=r=>isFileHeader(r)&&isCID(r.userland),isCID=r=>!!CID$1.asCID(r)||isString(r)||r&&"code"in r&&"version"in r&&"multihash"in r,isSemVer=r=>{if(!isObject(r))return!1;const{major:e,minor:t,patch:n}=r;return isNum(e)&&isNum(t)&&isNum(n)},textDecoder=new TextDecoder;function decodeVarint(r,e){let t=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(e>=r.length)throw new Error("protobuf: unexpected end of data");const i=r[e++];if(t+=n<28?(i&127)<<n:(i&127)*2**n,i<128)break}return[t,e]}function decodeBytes(r,e){let t;[t,e]=decodeVarint(r,e);const n=e+t;if(t<0||n<0)throw new Error("protobuf: invalid length");if(n>r.length)throw new Error("protobuf: unexpected end of data");return[r.subarray(e,n),n]}function decodeKey(r,e){let t;return[t,e]=decodeVarint(r,e),[t&7,t>>3,e]}function decodeLink(r){const e={},t=r.length;let n=0;for(;n<t;){let i,s;if([i,s,n]=decodeKey(r,n),s===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,n]=decodeBytes(r,n)}else if(s===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let u;[u,n]=decodeBytes(r,n),e.Name=textDecoder.decode(u)}else if(s===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(i!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Tsize`);[e.Tsize,n]=decodeVarint(r,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${s}`)}if(n>t)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function decodeNode(r){const e=r.length;let t=0,n,i=!1,s;for(;t<e;){let c,d;if([c,d,t]=decodeKey(r,t),c!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${c}`);if(d===1){if(s)throw new Error("protobuf: (PBNode) duplicate Data section");[s,t]=decodeBytes(r,t),n&&(i=!0)}else if(d===2){if(i)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let g;[g,t]=decodeBytes(r,t),n.push(decodeLink(g))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${d}`)}if(t>e)throw new Error("protobuf: (PBNode) unexpected end of data");const u={};return s&&(u.Data=s),u.Links=n||[],u}const textEncoder$1=new TextEncoder,maxInt32=2**32,maxUInt32=2**31;function encodeLink(r,e){let t=e.length;if(typeof r.Tsize=="number"){if(r.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(r.Tsize))throw new Error("Tsize too large for encoding");t=encodeVarint(e,t,r.Tsize)-1,e[t]=24}if(typeof r.Name=="string"){const n=textEncoder$1.encode(r.Name);t-=n.length,e.set(n,t),t=encodeVarint(e,t,n.length)-1,e[t]=18}return r.Hash&&(t-=r.Hash.length,e.set(r.Hash,t),t=encodeVarint(e,t,r.Hash.length)-1,e[t]=10),e.length-t}function encodeNode(r){const e=sizeNode(r),t=new Uint8Array(e);let n=e;if(r.Data&&(n-=r.Data.length,t.set(r.Data,n),n=encodeVarint(t,n,r.Data.length)-1,t[n]=10),r.Links)for(let i=r.Links.length-1;i>=0;i--){const s=encodeLink(r.Links[i],t.subarray(0,n));n-=s,n=encodeVarint(t,n,s)-1,t[n]=18}return t}function sizeLink(r){let e=0;if(r.Hash){const t=r.Hash.length;e+=1+t+sov(t)}if(typeof r.Name=="string"){const t=textEncoder$1.encode(r.Name).length;e+=1+t+sov(t)}return typeof r.Tsize=="number"&&(e+=1+sov(r.Tsize)),e}function sizeNode(r){let e=0;if(r.Data){const t=r.Data.length;e+=1+t+sov(t)}if(r.Links)for(const t of r.Links){const n=sizeLink(t);e+=1+n+sov(n)}return e}function encodeVarint(r,e,t){e-=sov(t);const n=e;for(;t>=maxUInt32;)r[e++]=t&127|128,t/=128;for(;t>=128;)r[e++]=t&127|128,t>>>=7;return r[e]=t,n}function sov(r){return r%2===0&&r++,Math.floor((len64(r)+6)/7)}function len64(r){let e=0;return r>=maxInt32&&(r=Math.floor(r/maxInt32),e=32),r>=65536&&(r>>>=16,e+=16),r>=256&&(r>>>=8,e+=8),e+len8tab[r]}const len8tab=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],pbNodeProperties=["Data","Links"],pbLinkProperties=["Hash","Name","Tsize"],textEncoder=new TextEncoder;function linkComparator(r,e){if(r===e)return 0;const t=r.Name?textEncoder.encode(r.Name):[],n=e.Name?textEncoder.encode(e.Name):[];let i=t.length,s=n.length;for(let u=0,c=Math.min(i,s);u<c;++u)if(t[u]!==n[u]){i=t[u],s=n[u];break}return i<s?-1:s<i?1:0}function hasOnlyProperties(r,e){return!Object.keys(r).some(t=>!e.includes(t))}function asLink(r){if(typeof r.asCID=="object"){const t=CID$1.asCID(r);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if(typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");const e={};if(r.Hash){let t=CID$1.asCID(r.Hash);try{t||(typeof r.Hash=="string"?t=CID$1.parse(r.Hash):r.Hash instanceof Uint8Array&&(t=CID$1.decode(r.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}t&&(e.Hash=t)}if(!e.Hash)throw new TypeError("Invalid DAG-PB form");return typeof r.Name=="string"&&(e.Name=r.Name),typeof r.Tsize=="number"&&(e.Tsize=r.Tsize),e}function prepare(r){if((r instanceof Uint8Array||typeof r=="string")&&(r={Data:r}),typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");const e={};if(r.Data!==void 0)if(typeof r.Data=="string")e.Data=textEncoder.encode(r.Data);else if(r.Data instanceof Uint8Array)e.Data=r.Data;else throw new TypeError("Invalid DAG-PB form");if(r.Links!==void 0)if(Array.isArray(r.Links))e.Links=r.Links.map(asLink),e.Links.sort(linkComparator);else throw new TypeError("Invalid DAG-PB form");else e.Links=[];return e}function validate(r){if(!r||typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");if(!hasOnlyProperties(r,pbNodeProperties))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(r.Data!==void 0&&!(r.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be a Uint8Array)");if(!Array.isArray(r.Links))throw new TypeError("Invalid DAG-PB form (Links must be an array)");for(let e=0;e<r.Links.length;e++){const t=r.Links[e];if(!t||typeof t!="object"||Array.isArray(t))throw new TypeError("Invalid DAG-PB form (bad link object)");if(!hasOnlyProperties(t,pbLinkProperties))throw new TypeError("Invalid DAG-PB form (extraneous properties on link object)");if(!t.Hash)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(t.Hash.asCID!==t.Hash)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(t.Name!==void 0&&typeof t.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(t.Tsize!==void 0&&(typeof t.Tsize!="number"||t.Tsize%1!==0))throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(e>0&&linkComparator(t,r.Links[e-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function createNode(r,e=[]){return prepare({Data:r,Links:e})}function createLink(r,e,t){return asLink({Hash:t,Name:r,Tsize:e})}const name="dag-pb",code=112;function encode$8(r){validate(r);const e={};return r.Links&&(e.Links=r.Links.map(t=>{const n={};return t.Hash&&(n.Hash=t.Hash.bytes),t.Name!==void 0&&(n.Name=t.Name),t.Tsize!==void 0&&(n.Tsize=t.Tsize),n})),r.Data&&(e.Data=r.Data),encodeNode(e)}function decode$b(r){const e=decodeNode(r),t={};return e.Data&&(t.Data=e.Data),e.Links&&(t.Links=e.Links.map(n=>{const i={};try{i.Hash=CID$1.decode(n.Hash)}catch{}if(!i.Hash)throw new Error("Invalid Hash field found in link, expected CID");return n.Name!==void 0&&(i.Name=n.Name),n.Tsize!==void 0&&(i.Tsize=n.Tsize),i})),t}const dagPB=Object.freeze(Object.defineProperty({__proto__:null,code,createLink,createNode,decode:decode$b,encode:encode$8,name,prepare,validate},Symbol.toStringTag,{value:"Module"})),RSA="RSA",word="[a-fA-F\\d:]",boundry=r=>r&&r.includeBoundaries?`(?:(?<=\\s|^)(?=${word})|(?<=${word})(?=\\s|$))`:"",v4="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",v6segment="[a-fA-F\\d]{1,4}",v6=`
(?:
(?:${v6segment}:){7}(?:${v6segment}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${v6segment}:){6}(?:${v4}|:${v6segment}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${v6segment}:){5}(?::${v4}|(?::${v6segment}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${v6segment}:){4}(?:(?::${v6segment}){0,1}:${v4}|(?::${v6segment}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${v6segment}:){3}(?:(?::${v6segment}){0,2}:${v4}|(?::${v6segment}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${v6segment}:){2}(?:(?::${v6segment}){0,3}:${v4}|(?::${v6segment}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${v6segment}:){1}(?:(?::${v6segment}){0,4}:${v4}|(?::${v6segment}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${v6segment}){0,5}:${v4}|(?::${v6segment}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),v46Exact=new RegExp(`(?:^${v4}$)|(?:^${v6}$)`),v4exact=new RegExp(`^${v4}$`),v6exact=new RegExp(`^${v6}$`),ipRegex=r=>r&&r.exact?v46Exact:new RegExp(`(?:${boundry(r)}${v4}${boundry(r)})|(?:${boundry(r)}${v6}${boundry(r)})`,"g");ipRegex.v4=r=>r&&r.exact?v4exact:new RegExp(`${boundry(r)}${v4}${boundry(r)}`,"g");ipRegex.v6=r=>r&&r.exact?v6exact:new RegExp(`${boundry(r)}${v6}${boundry(r)}`,"g");function functionTimeout(r){const e=(...t)=>r(...t);return Object.defineProperty(e,"name",{value:`functionTimeout(${r.name||"<anonymous>"})`,configurable:!0}),e}const{toString:toString$8}=Object.prototype;function isRegexp(r){return toString$8.call(r)==="[object RegExp]"}const flagMap={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function clonedRegexp(r,e={}){if(!isRegexp(r))throw new TypeError("Expected a RegExp instance");const t=Object.keys(flagMap).map(i=>(typeof e[i]=="boolean"?e[i]:r[i])?flagMap[i]:"").join(""),n=new RegExp(e.source||r.source,t);return n.lastIndex=typeof e.lastIndex=="number"?e.lastIndex:r.lastIndex,n}function isMatch(r,e,{timeout:t}={}){try{return functionTimeout(()=>clonedRegexp(r).test(e),{timeout:t})()}catch(n){throw n}}const maxIPv4Length=15,maxIPv6Length=45,options={timeout:400};function isIP$1(r){return isMatch(ipRegex({exact:!0}),r.slice(0,maxIPv6Length),options)}function isIPv6$1(r){return isMatch(ipRegex.v6({exact:!0}),r.slice(0,maxIPv6Length),options)}function isIPv4$1(r){return isMatch(ipRegex.v4({exact:!0}),r.slice(0,maxIPv4Length),options)}const isV4$1=isIPv4$1,isV6$1=isIPv6$1,toBytes$2=function(r){let e=0,t;if(r=r.trim(),isV4$1(r))t=new Uint8Array(e+4),r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255});else if(isV6$1(r)){const n=r.split(":",8);let i;for(i=0;i<n.length;i++){const s=isV4$1(n[i]);let u;s&&(u=toBytes$2(n[i]),n[i]=toString$a(u.slice(0,2),"base16")),u!=null&&++i<8&&n.splice(i,0,toString$a(u.slice(2,4),"base16"))}if(n[0]==="")for(;n.length<8;)n.unshift("0");else if(n[n.length-1]==="")for(;n.length<8;)n.push("0");else if(n.length<8){for(i=0;i<n.length&&n[i]!=="";i++);const s=[i,1];for(i=9-n.length;i>0;i--)s.push("0");n.splice.apply(n,s)}for(t=new Uint8Array(e+16),i=0;i<n.length;i++){const s=parseInt(n[i],16);t[e++]=s>>8&255,t[e++]=s&255}}if(t==null)throw new Error(`invalid ip address "${r}"`);return t},toString$7=function(r,e=0,t){e=~~e,t=t??r.length-e;const n=[];let i="";const s=new DataView(r.buffer);if(t===4){for(let u=0;u<t;u++)n.push(r[e+u]);i=n.join(".")}else if(t===16){for(let u=0;u<t;u+=2)n.push(s.getUint16(e+u).toString(16));i=n.join(":"),i=i.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),i=i.replace(/:{3,4}/,"::")}return i},V$1=-1,names$1={},codes$1={},table$1=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,V$1,"ip6zone"],[53,V$1,"dns",!0],[54,V$1,"dns4",!0],[55,V$1,"dns6",!0],[56,V$1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,V$1,"unix",!1,!0],[421,V$1,"ipfs"],[421,V$1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,V$1,"garlic64"],[460,0,"quic"],[465,0,"webtransport"],[466,V$1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,V$1,"memory"]];table$1.forEach(r=>{const e=createProtocol$1(...r);codes$1[e.code]=e,names$1[e.name]=e});function createProtocol$1(r,e,t,n,i){return{code:r,size:e,name:t,resolvable:!!n,path:!!i}}function getProtocol$1(r){if(typeof r=="number"){if(codes$1[r]!=null)return codes$1[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(names$1[r]!=null)return names$1[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}var encode_1$1,hasRequiredEncode;function requireEncode(){if(hasRequiredEncode)return encode_1$1;hasRequiredEncode=1,encode_1$1=n;var r=128,e=-128,t=Math.pow(2,31);function n(i,s,u){if(Number.MAX_SAFE_INTEGER&&i>Number.MAX_SAFE_INTEGER)throw n.bytes=0,new RangeError("Could not encode varint");s=s||[],u=u||0;for(var c=u;i>=t;)s[u++]=i&255|r,i/=128;for(;i&e;)s[u++]=i&255|r,i>>>=7;return s[u]=i|0,n.bytes=u-c+1,s}return encode_1$1}var decode$a,hasRequiredDecode;function requireDecode(){if(hasRequiredDecode)return decode$a;hasRequiredDecode=1,decode$a=t;var r=128,e=127;function t(n,u){var s=0,u=u||0,c=0,d=u,g,_=n.length;do{if(d>=_||c>49)throw t.bytes=0,new RangeError("Could not decode varint");g=n[d++],s+=c<28?(g&e)<<c:(g&e)*Math.pow(2,c),c+=7}while(g>=r);return t.bytes=d-u,s}return decode$a}var length$2,hasRequiredLength;function requireLength(){if(hasRequiredLength)return length$2;hasRequiredLength=1;var r=Math.pow(2,7),e=Math.pow(2,14),t=Math.pow(2,21),n=Math.pow(2,28),i=Math.pow(2,35),s=Math.pow(2,42),u=Math.pow(2,49),c=Math.pow(2,56),d=Math.pow(2,63);return length$2=function(g){return g<r?1:g<e?2:g<t?3:g<n?4:g<i?5:g<s?6:g<u?7:g<c?8:g<d?9:10},length$2}var varint$2,hasRequiredVarint;function requireVarint(){return hasRequiredVarint||(hasRequiredVarint=1,varint$2={encode:requireEncode(),decode:requireDecode(),encodingLength:requireLength()}),varint$2}var varintExports=requireVarint();const varint$1=getDefaultExportFromCjs(varintExports);function convertToString$1(r,e){switch(getProtocol$1(r).code){case 4:case 41:return bytes2ip$1(e);case 6:case 273:case 33:case 132:return bytes2port$1(e).toString();case 53:case 54:case 55:case 56:case 400:case 777:return bytes2str$1(e);case 421:return bytes2mh$1(e);case 444:return bytes2onion$1(e);case 445:return bytes2onion$1(e);case 466:return bytes2mb$1(e);default:return toString$a(e,"base16")}}function convertToBytes$1(r,e){switch(getProtocol$1(r).code){case 4:return ip2bytes$1(e);case 41:return ip2bytes$1(e);case 6:case 273:case 33:case 132:return port2bytes$1(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 777:return str2bytes$1(e);case 421:return mh2bytes$1(e);case 444:return onion2bytes$1(e);case 445:return onion32bytes$1(e);case 466:return mb2bytes$1(e);default:return fromString$8(e,"base16")}}const decoders$1=Object.values(bases$3).map(r=>r.decoder),anybaseDecoder$1=function(){let r=decoders$1[0].or(decoders$1[1]);return decoders$1.slice(2).forEach(e=>r=r.or(e)),r}();function ip2bytes$1(r){if(!isIP$1(r))throw new Error(`invalid ip address "${r}"`);return toBytes$2(r)}function bytes2ip$1(r){const e=toString$7(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!isIP$1(e))throw new Error(`invalid ip address "${e}"`);return e}function port2bytes$1(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function bytes2port$1(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function str2bytes$1(r){const e=fromString$8(r),t=Uint8Array.from(varint$1.encode(e.length));return concat$2([t,e],t.length+e.length)}function bytes2str$1(r){const e=varint$1.decode(r);if(r=r.slice(varint$1.decode.bytes),r.length!==e)throw new Error("inconsistent lengths");return toString$a(r)}function mh2bytes$1(r){let e;r[0]==="Q"||r[0]==="1"?e=decode$h(base58btc$4.decode(`z${r}`)).bytes:e=CID$1.parse(r).multihash.bytes;const t=Uint8Array.from(varint$1.encode(e.length));return concat$2([t,e],t.length+e.length)}function mb2bytes$1(r){const e=anybaseDecoder$1.decode(r),t=Uint8Array.from(varint$1.encode(e.length));return concat$2([t,e],t.length+e.length)}function bytes2mb$1(r){const e=varint$1.decode(r),t=r.slice(varint$1.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return"u"+toString$a(t,"base64url")}function bytes2mh$1(r){const e=varint$1.decode(r),t=r.slice(varint$1.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return toString$a(t,"base58btc")}function onion2bytes$1(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=base32$7.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=port2bytes$1(n);return concat$2([t,i],t.length+i.length)}function onion32bytes$1(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=base32$7.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=port2bytes$1(n);return concat$2([t,i],t.length+i.length)}function bytes2onion$1(r){const e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=toString$a(e,"base32"),i=bytes2port$1(t);return`${n}:${i}`}function stringToStringTuples$1(r){const e=[],t=r.split("/").slice(1);if(t.length===1&&t[0]==="")return[];for(let n=0;n<t.length;n++){const i=t[n],s=getProtocol$1(i);if(s.size===0){e.push([i]);continue}if(n++,n>=t.length)throw ParseError$1("invalid address: "+r);if(s.path===!0){e.push([i,cleanPath$1(t.slice(n).join("/"))]);break}e.push([i,t[n]])}return e}function stringTuplesToString$1(r){const e=[];return r.map(t=>{const n=protoFromTuple$1(t);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),cleanPath$1(e.join("/"))}function stringTuplesToTuples$1(r){return r.map(e=>{Array.isArray(e)||(e=[e]);const t=protoFromTuple$1(e);return e.length>1?[t.code,convertToBytes$1(t.code,e[1])]:[t.code]})}function tuplesToStringTuples$1(r){return r.map(e=>{const t=protoFromTuple$1(e);return e[1]!=null?[t.code,convertToString$1(t.code,e[1])]:[t.code]})}function tuplesToBytes$1(r){return fromBytes$2(concat$2(r.map(e=>{const t=protoFromTuple$1(e);let n=Uint8Array.from(varint$1.encode(t.code));return e.length>1&&e[1]!=null&&(n=concat$2([n,e[1]])),n})))}function sizeForAddr$1(r,e){return r.size>0?r.size/8:r.size===0?0:varint$1.decode(e)+varint$1.decode.bytes}function bytesToTuples$1(r){const e=[];let t=0;for(;t<r.length;){const n=varint$1.decode(r,t),i=varint$1.decode.bytes,s=getProtocol$1(n),u=sizeForAddr$1(s,r.slice(t+i));if(u===0){e.push([n]),t+=i;continue}const c=r.slice(t+i,t+i+u);if(t+=u+i,t>r.length)throw ParseError$1("Invalid address Uint8Array: "+toString$a(r,"base16"));e.push([n,c])}return e}function bytesToString$1(r){const e=bytesToTuples$1(r),t=tuplesToStringTuples$1(e);return stringTuplesToString$1(t)}function stringToBytes$1(r){r=cleanPath$1(r);const e=stringToStringTuples$1(r),t=stringTuplesToTuples$1(e);return tuplesToBytes$1(t)}function fromString$6(r){return stringToBytes$1(r)}function fromBytes$2(r){const e=validateBytes$1(r);if(e!=null)throw e;return Uint8Array.from(r)}function validateBytes$1(r){try{bytesToTuples$1(r)}catch(e){return e}}function cleanPath$1(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function ParseError$1(r){return new Error("Error parsing address: "+r)}function protoFromTuple$1(r){return getProtocol$1(r[0])}var errCode,hasRequiredErrCode;function requireErrCode(){if(hasRequiredErrCode)return errCode;hasRequiredErrCode=1;function r(t,n){for(const i in n)Object.defineProperty(t,i,{value:n[i],enumerable:!0,configurable:!0});return t}function e(t,n,i){if(!t||typeof t=="string")throw new TypeError("Please pass an Error to err-code");i||(i={}),typeof n=="object"&&(i=n,n=""),n&&(i.code=n);try{return r(t,i)}catch{i.message=t.message,i.stack=t.stack;const u=function(){};return u.prototype=Object.create(Object.getPrototypeOf(t)),r(new u,i)}}return errCode=e,errCode}var errCodeExports=requireErrCode();const errcode=getDefaultExportFromCjs(errCodeExports),inspect$1=Symbol.for("nodejs.util.inspect.custom"),DNS_CODES$1=[getProtocol$1("dns").code,getProtocol$1("dns4").code,getProtocol$1("dns6").code,getProtocol$1("dnsaddr").code],P2P_CODES$1=[getProtocol$1("p2p").code,getProtocol$1("ipfs").code],resolvers$1=new Map,symbol$1=Symbol.for("@multiformats/js-multiaddr/multiaddr");class Multiaddr{constructor(e){if(e==null&&(e=""),Object.defineProperty(this,symbol$1,{value:!0}),e instanceof Uint8Array)this.bytes=fromBytes$2(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=fromString$6(e)}else if(Multiaddr.isMultiaddr(e))this.bytes=fromBytes$2(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return bytesToString$1(this.bytes)}toJSON(){return this.toString()}toOptions(){const e=this.protoCodes(),t=this.toString().split("/").slice(1);let n,i;if(t.length>2)DNS_CODES$1.includes(e[0])&&P2P_CODES$1.includes(e[1])?(n=getProtocol$1("tcp").name,i=443):(n=getProtocol$1(t[2]).name,i=parseInt(t[3]));else if(DNS_CODES$1.includes(e[0]))n=getProtocol$1("tcp").name,i=443;else throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e[0]===41||e[0]===55?6:4,host:t[1],transport:n,port:i}}protos(){return this.protoCodes().map(e=>Object.assign({},getProtocol$1(e)))}protoCodes(){const e=[],t=this.bytes;let n=0;for(;n<t.length;){const i=varint$1.decode(t,n),s=varint$1.decode.bytes,u=getProtocol$1(i),c=sizeForAddr$1(u,t.slice(n+s));n+=c+s,e.push(i)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return bytesToTuples$1(this.bytes)}stringTuples(){const e=bytesToTuples$1(this.bytes);return tuplesToStringTuples$1(e)}encapsulate(e){return e=new Multiaddr(e),new Multiaddr(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),i=n.lastIndexOf(t);if(i<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new Multiaddr(n.slice(0,i))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new Multiaddr(tuplesToBytes$1(t.slice(0,n)));return this}getPeerId(){try{const t=this.stringTuples().filter(n=>n[0]===names$1.ipfs.code).pop();if((t==null?void 0:t[1])!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?toString$a(base58btc$4.decode(`z${n}`),"base58btc"):toString$a(CID$1.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){let e=null;try{e=this.stringTuples().filter(t=>getProtocol$1(t[0]).path===!0)[0][1],e==null&&(e=null)}catch{e=null}return e}equals(e){return equals$5(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(s=>s.resolvable);if(t==null)return[this];const n=resolvers$1.get(t.name);if(n==null)throw errcode(new Error(`no available resolver for ${t.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(s=>new Multiaddr(s))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}static fromNodeAddress(e,t){if(e==null)throw new Error("requires node address object");if(t==null)throw new Error("requires transport protocol");let n;switch(e.family){case 4:n="ip4";break;case 6:n="ip6";break;default:throw Error("Invalid addr family, should be 4 or 6.")}return new Multiaddr("/"+[n,e.address,t,e.port].join("/"))}static isName(e){return Multiaddr.isMultiaddr(e)?e.protos().some(t=>t.resolvable):!1}static isMultiaddr(e){return!!(e!=null&&e[symbol$1])}[inspect$1](){return"<Multiaddr "+toString$a(this.bytes,"base16")+" - "+bytesToString$1(this.bytes)+">"}inspect(){return"<Multiaddr "+toString$a(this.bytes,"base16")+" - "+bytesToString$1(this.bytes)+">"}}Multiaddr.resolvers=resolvers$1;function multiaddr$1(r){return new Multiaddr(r)}const coerce$3=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},fromString$5=r=>new TextEncoder().encode(r),toString$6=r=>new TextDecoder().decode(r);function base$3(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),u=s.charCodeAt(0);if(t[u]!==255)throw new TypeError(s+" is ambiguous");t[u]=i}var c=r.length,d=r.charAt(0),g=Math.log(c)/Math.log(256),_=Math.log(256)/Math.log(c);function f(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var y=0,w=0,v=0,C=p.length;v!==C&&p[v]===0;)v++,y++;for(var P=(C-v)*_+1>>>0,R=new Uint8Array(P);v!==C;){for(var F=p[v],k=0,B=P-1;(F!==0||k<w)&&B!==-1;B--,k++)F+=256*R[B]>>>0,R[B]=F%c>>>0,F=F/c>>>0;if(F!==0)throw new Error("Non-zero carry");w=k,v++}for(var H=P-w;H!==P&&R[H]===0;)H++;for(var re=d.repeat(y);H<P;++H)re+=r.charAt(R[H]);return re}function l(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var y=0;if(p[y]!==" "){for(var w=0,v=0;p[y]===d;)w++,y++;for(var C=(p.length-y)*g+1>>>0,P=new Uint8Array(C);p[y];){var R=t[p.charCodeAt(y)];if(R===255)return;for(var F=0,k=C-1;(R!==0||F<v)&&k!==-1;k--,F++)R+=c*P[k]>>>0,P[k]=R%256>>>0,R=R/256>>>0;if(R!==0)throw new Error("Non-zero carry");v=F,y++}if(p[y]!==" "){for(var B=C-v;B!==C&&P[B]===0;)B++;for(var H=new Uint8Array(w+(C-B)),re=w;B!==C;)H[re++]=P[B++];return H}}}function h(p){var y=l(p);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:l,decode:h}}var src$3=base$3,_brrp__multiformats_scope_baseX$3=src$3;let Encoder$3=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Decoder$3=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or$3(this,e)}},ComposedDecoder$3=class{constructor(e){this.decoders=e}or(e){return or$3(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const or$3=(r,e)=>new ComposedDecoder$3({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let Codec$3=class{constructor(e,t,n,i){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Encoder$3(e,t,n),this.decoder=new Decoder$3(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const from$3=({name:r,prefix:e,encode:t,decode:n})=>new Codec$3(r,e,t,n),baseX$3=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:i}=_brrp__multiformats_scope_baseX$3(t,e);return from$3({prefix:r,name:e,encode:n,decode:s=>coerce$3(i(s))})},decode$9=(r,e,t,n)=>{const i={};for(let _=0;_<e.length;++_)i[e[_]]=_;let s=r.length;for(;r[s-1]==="=";)--s;const u=new Uint8Array(s*t/8|0);let c=0,d=0,g=0;for(let _=0;_<s;++_){const f=i[r[_]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);d=d<<t|f,c+=t,c>=8&&(c-=8,u[g++]=255&d>>c)}if(c>=t||255&d<<8-c)throw new SyntaxError("Unexpected end of data");return u},encode$7=(r,e,t)=>{const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",u=0,c=0;for(let d=0;d<r.length;++d)for(c=c<<8|r[d],u+=8;u>t;)u-=t,s+=e[i&c>>u];if(u&&(s+=e[i&c<<t-u]),n)for(;s.length*t&7;)s+="=";return s},rfc4648$3=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>from$3({prefix:e,name:r,encode(i){return encode$7(i,n,t)},decode(i){return decode$9(i,n,t,r)}}),base58btc$3=baseX$3({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr$2=baseX$3({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58$2=Object.freeze(Object.defineProperty({__proto__:null,base58btc:base58btc$3,base58flickr:base58flickr$2},Symbol.toStringTag,{value:"Module"})),base32$5=rfc4648$3({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper$2=rfc4648$3({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad$2=rfc4648$3({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper$2=rfc4648$3({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex$2=rfc4648$3({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper$2=rfc4648$3({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad$2=rfc4648$3({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper$2=rfc4648$3({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z$2=rfc4648$3({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$6=Object.freeze(Object.defineProperty({__proto__:null,base32:base32$5,base32hex:base32hex$2,base32hexpad:base32hexpad$2,base32hexpadupper:base32hexpadupper$2,base32hexupper:base32hexupper$2,base32pad:base32pad$2,base32padupper:base32padupper$2,base32upper:base32upper$2,base32z:base32z$2},Symbol.toStringTag,{value:"Module"})),identity$2=from$3({prefix:"\0",name:"identity",encode:r=>toString$6(r),decode:r=>fromString$5(r)}),identityBase$2=Object.freeze(Object.defineProperty({__proto__:null,identity:identity$2},Symbol.toStringTag,{value:"Module"})),base2$4=rfc4648$3({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$5=Object.freeze(Object.defineProperty({__proto__:null,base2:base2$4},Symbol.toStringTag,{value:"Module"})),base8$4=rfc4648$3({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$5=Object.freeze(Object.defineProperty({__proto__:null,base8:base8$4},Symbol.toStringTag,{value:"Module"})),base10$4=baseX$3({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$5=Object.freeze(Object.defineProperty({__proto__:null,base10:base10$4},Symbol.toStringTag,{value:"Module"})),base16$4=rfc4648$3({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper$2=rfc4648$3({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$5=Object.freeze(Object.defineProperty({__proto__:null,base16:base16$4,base16upper:base16upper$2},Symbol.toStringTag,{value:"Module"})),base36$4=baseX$3({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper$2=baseX$3({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$5=Object.freeze(Object.defineProperty({__proto__:null,base36:base36$4,base36upper:base36upper$2},Symbol.toStringTag,{value:"Module"})),base64$6=rfc4648$3({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad$2=rfc4648$3({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url$2=rfc4648$3({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad$2=rfc4648$3({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$7=Object.freeze(Object.defineProperty({__proto__:null,base64:base64$6,base64pad:base64pad$2,base64url:base64url$2,base64urlpad:base64urlpad$2},Symbol.toStringTag,{value:"Module"})),alphabet$2=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),alphabetBytesToChars$2=alphabet$2.reduce((r,e,t)=>(r[t]=e,r),[]),alphabetCharsToBytes$2=alphabet$2.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function encode$6(r){return r.reduce((e,t)=>(e+=alphabetBytesToChars$2[t],e),"")}function decode$8(r){const e=[];for(const t of r){const n=alphabetCharsToBytes$2[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const base256emoji$4=from$3({prefix:"🚀",name:"base256emoji",encode:encode$6,decode:decode$8}),base256emoji$5=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:base256emoji$4},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const bases$2={...identityBase$2,...base2$5,...base8$5,...base10$5,...base16$5,...base32$6,...base36$5,...base58$2,...base64$7,...base256emoji$5};Object.values(bases$2).map(r=>r.decoder).reduce((r,e)=>r.or(e),bases$2.identity.decoder);var objectSafeGet=get$3;function get$3(r,e,t){if(!r)return t;var n,i;if(Array.isArray(e)&&(n=e.slice(0)),typeof e=="string"&&(n=e.split(".")),typeof e=="symbol"&&(n=[e]),!Array.isArray(n))throw new Error("props arg must be an array, a string or a symbol");for(;n.length;)if(i=n.shift(),!r||(r=r[i],r===void 0))return t;return r}var browser$3={exports:{}},ms$2,hasRequiredMs$2;function requireMs$2(){if(hasRequiredMs$2)return ms$2;hasRequiredMs$2=1;var r=1e3,e=r*60,t=e*60,n=t*24,i=n*7,s=n*365.25;ms$2=function(_,f){f=f||{};var l=typeof _;if(l==="string"&&_.length>0)return u(_);if(l==="number"&&isFinite(_))return f.long?d(_):c(_);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(_))};function u(_){if(_=String(_),!(_.length>100)){var f=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(_);if(f){var l=parseFloat(f[1]),h=(f[2]||"ms").toLowerCase();switch(h){case"years":case"year":case"yrs":case"yr":case"y":return l*s;case"weeks":case"week":case"w":return l*i;case"days":case"day":case"d":return l*n;case"hours":case"hour":case"hrs":case"hr":case"h":return l*t;case"minutes":case"minute":case"mins":case"min":case"m":return l*e;case"seconds":case"second":case"secs":case"sec":case"s":return l*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return}}}}function c(_){var f=Math.abs(_);return f>=n?Math.round(_/n)+"d":f>=t?Math.round(_/t)+"h":f>=e?Math.round(_/e)+"m":f>=r?Math.round(_/r)+"s":_+"ms"}function d(_){var f=Math.abs(_);return f>=n?g(_,f,n,"day"):f>=t?g(_,f,t,"hour"):f>=e?g(_,f,e,"minute"):f>=r?g(_,f,r,"second"):_+" ms"}function g(_,f,l,h){var p=f>=l*1.5;return Math.round(_/l)+" "+h+(p?"s":"")}return ms$2}var common$3,hasRequiredCommon$3;function requireCommon$3(){if(hasRequiredCommon$3)return common$3;hasRequiredCommon$3=1;function r(e){n.debug=n,n.default=n,n.coerce=g,n.disable=u,n.enable=s,n.enabled=c,n.humanize=requireMs$2(),n.destroy=_,Object.keys(e).forEach(f=>{n[f]=e[f]}),n.names=[],n.skips=[],n.formatters={};function t(f){let l=0;for(let h=0;h<f.length;h++)l=(l<<5)-l+f.charCodeAt(h),l|=0;return n.colors[Math.abs(l)%n.colors.length]}n.selectColor=t;function n(f){let l,h=null,p,y;function w(...v){if(!w.enabled)return;const C=w,P=Number(new Date),R=P-(l||P);C.diff=R,C.prev=l,C.curr=P,l=P,v[0]=n.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let F=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(B,H)=>{if(B==="%%")return"%";F++;const re=n.formatters[H];if(typeof re=="function"){const le=v[F];B=re.call(C,le),v.splice(F,1),F--}return B}),n.formatArgs.call(C,v),(C.log||n.log).apply(C,v)}return w.namespace=f,w.useColors=n.useColors(),w.color=n.selectColor(f),w.extend=i,w.destroy=n.destroy,Object.defineProperty(w,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(p!==n.namespaces&&(p=n.namespaces,y=n.enabled(f)),y),set:v=>{h=v}}),typeof n.init=="function"&&n.init(w),w}function i(f,l){const h=n(this.namespace+(typeof l>"u"?":":l)+f);return h.log=this.log,h}function s(f){n.save(f),n.namespaces=f,n.names=[],n.skips=[];let l;const h=(typeof f=="string"?f:"").split(/[\s,]+/),p=h.length;for(l=0;l<p;l++)h[l]&&(f=h[l].replace(/\*/g,".*?"),f[0]==="-"?n.skips.push(new RegExp("^"+f.slice(1)+"$")):n.names.push(new RegExp("^"+f+"$")))}function u(){const f=[...n.names.map(d),...n.skips.map(d).map(l=>"-"+l)].join(",");return n.enable(""),f}function c(f){if(f[f.length-1]==="*")return!0;let l,h;for(l=0,h=n.skips.length;l<h;l++)if(n.skips[l].test(f))return!1;for(l=0,h=n.names.length;l<h;l++)if(n.names[l].test(f))return!0;return!1}function d(f){return f.toString().substring(2,f.toString().length-2).replace(/\.\*\?$/,"*")}function g(f){return f instanceof Error?f.stack||f.message:f}function _(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}return common$3=r,common$3}var hasRequiredBrowser$3;function requireBrowser$3(){return hasRequiredBrowser$3||(hasRequiredBrowser$3=1,function(r,e){var t={};e.formatArgs=i,e.save=s,e.load=u,e.useColors=n,e.storage=c(),e.destroy=(()=>{let g=!1;return()=>{g||(g=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(g){if(g[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+g[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const _="color: "+this.color;g.splice(1,0,_,"color: inherit");let f=0,l=0;g[0].replace(/%[a-zA-Z%]/g,h=>{h!=="%%"&&(f++,h==="%c"&&(l=f))}),g.splice(l,0,_)}e.log=console.debug||console.log||(()=>{});function s(g){try{g?e.storage.setItem("debug",g):e.storage.removeItem("debug")}catch{}}function u(){let g;try{g=e.storage.getItem("debug")}catch{}return!g&&typeof process<"u"&&"env"in process&&(g=t.DEBUG),g}function c(){try{return localStorage}catch{}}r.exports=requireCommon$3()(e);const{formatters:d}=r.exports;d.j=function(g){try{return JSON.stringify(g)}catch(_){return"[UnexpectedJSONParseError]: "+_.message}}}(browser$3,browser$3.exports)),browser$3.exports}var browserExports$3=requireBrowser$3();const debug$2=getDefaultExportFromCjs(browserExports$3);let nanoid=(r=21)=>crypto.getRandomValues(new Uint8Array(r)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");function base$2(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),u=s.charCodeAt(0);if(t[u]!==255)throw new TypeError(s+" is ambiguous");t[u]=i}var c=r.length,d=r.charAt(0),g=Math.log(c)/Math.log(256),_=Math.log(256)/Math.log(c);function f(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var y=0,w=0,v=0,C=p.length;v!==C&&p[v]===0;)v++,y++;for(var P=(C-v)*_+1>>>0,R=new Uint8Array(P);v!==C;){for(var F=p[v],k=0,B=P-1;(F!==0||k<w)&&B!==-1;B--,k++)F+=256*R[B]>>>0,R[B]=F%c>>>0,F=F/c>>>0;if(F!==0)throw new Error("Non-zero carry");w=k,v++}for(var H=P-w;H!==P&&R[H]===0;)H++;for(var re=d.repeat(y);H<P;++H)re+=r.charAt(R[H]);return re}function l(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var y=0;if(p[y]!==" "){for(var w=0,v=0;p[y]===d;)w++,y++;for(var C=(p.length-y)*g+1>>>0,P=new Uint8Array(C);p[y];){var R=t[p.charCodeAt(y)];if(R===255)return;for(var F=0,k=C-1;(R!==0||F<v)&&k!==-1;k--,F++)R+=c*P[k]>>>0,P[k]=R%256>>>0,R=R/256>>>0;if(R!==0)throw new Error("Non-zero carry");v=F,y++}if(p[y]!==" "){for(var B=C-v;B!==C&&P[B]===0;)B++;for(var H=new Uint8Array(w+(C-B)),re=w;B!==C;)H[re++]=P[B++];return H}}}function h(p){var y=l(p);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:l,decode:h}}var src$2=base$2,_brrp__multiformats_scope_baseX$2=src$2;const coerce$2=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},fromString$4=r=>new TextEncoder().encode(r),toString$5=r=>new TextDecoder().decode(r);let Encoder$2=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Decoder$2=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or$2(this,e)}},ComposedDecoder$2=class{constructor(e){this.decoders=e}or(e){return or$2(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const or$2=(r,e)=>new ComposedDecoder$2({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let Codec$2=class{constructor(e,t,n,i){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Encoder$2(e,t,n),this.decoder=new Decoder$2(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const from$2=({name:r,prefix:e,encode:t,decode:n})=>new Codec$2(r,e,t,n),baseX$2=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:i}=_brrp__multiformats_scope_baseX$2(t,e);return from$2({prefix:r,name:e,encode:n,decode:s=>coerce$2(i(s))})},decode$7=(r,e,t,n)=>{const i={};for(let _=0;_<e.length;++_)i[e[_]]=_;let s=r.length;for(;r[s-1]==="=";)--s;const u=new Uint8Array(s*t/8|0);let c=0,d=0,g=0;for(let _=0;_<s;++_){const f=i[r[_]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);d=d<<t|f,c+=t,c>=8&&(c-=8,u[g++]=255&d>>c)}if(c>=t||255&d<<8-c)throw new SyntaxError("Unexpected end of data");return u},encode$5=(r,e,t)=>{const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",u=0,c=0;for(let d=0;d<r.length;++d)for(c=c<<8|r[d],u+=8;u>t;)u-=t,s+=e[i&c>>u];if(u&&(s+=e[i&c<<t-u]),n)for(;s.length*t&7;)s+="=";return s},rfc4648$2=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>from$2({prefix:e,name:r,encode(i){return encode$5(i,n,t)},decode(i){return decode$7(i,n,t,r)}}),identity$1=from$2({prefix:"\0",name:"identity",encode:r=>toString$5(r),decode:r=>fromString$4(r)}),identityBase$1=Object.freeze(Object.defineProperty({__proto__:null,identity:identity$1},Symbol.toStringTag,{value:"Module"})),base2$2=rfc4648$2({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$3=Object.freeze(Object.defineProperty({__proto__:null,base2:base2$2},Symbol.toStringTag,{value:"Module"})),base8$2=rfc4648$2({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$3=Object.freeze(Object.defineProperty({__proto__:null,base8:base8$2},Symbol.toStringTag,{value:"Module"})),base10$2=baseX$2({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$3=Object.freeze(Object.defineProperty({__proto__:null,base10:base10$2},Symbol.toStringTag,{value:"Module"})),base16$2=rfc4648$2({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper$1=rfc4648$2({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$3=Object.freeze(Object.defineProperty({__proto__:null,base16:base16$2,base16upper:base16upper$1},Symbol.toStringTag,{value:"Module"})),base32$3=rfc4648$2({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper$1=rfc4648$2({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad$1=rfc4648$2({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper$1=rfc4648$2({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex$1=rfc4648$2({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper$1=rfc4648$2({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad$1=rfc4648$2({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper$1=rfc4648$2({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z$1=rfc4648$2({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$4=Object.freeze(Object.defineProperty({__proto__:null,base32:base32$3,base32hex:base32hex$1,base32hexpad:base32hexpad$1,base32hexpadupper:base32hexpadupper$1,base32hexupper:base32hexupper$1,base32pad:base32pad$1,base32padupper:base32padupper$1,base32upper:base32upper$1,base32z:base32z$1},Symbol.toStringTag,{value:"Module"})),base36$2=baseX$2({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper$1=baseX$2({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$3=Object.freeze(Object.defineProperty({__proto__:null,base36:base36$2,base36upper:base36upper$1},Symbol.toStringTag,{value:"Module"})),base58btc$2=baseX$2({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr$1=baseX$2({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58$1=Object.freeze(Object.defineProperty({__proto__:null,base58btc:base58btc$2,base58flickr:base58flickr$1},Symbol.toStringTag,{value:"Module"})),base64$4=rfc4648$2({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad$1=rfc4648$2({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url$1=rfc4648$2({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad$1=rfc4648$2({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$5=Object.freeze(Object.defineProperty({__proto__:null,base64:base64$4,base64pad:base64pad$1,base64url:base64url$1,base64urlpad:base64urlpad$1},Symbol.toStringTag,{value:"Module"})),alphabet$1=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),alphabetBytesToChars$1=alphabet$1.reduce((r,e,t)=>(r[t]=e,r),[]),alphabetCharsToBytes$1=alphabet$1.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function encode$4(r){return r.reduce((e,t)=>(e+=alphabetBytesToChars$1[t],e),"")}function decode$6(r){const e=[];for(const t of r){const n=alphabetCharsToBytes$1[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const base256emoji$2=from$2({prefix:"🚀",name:"base256emoji",encode:encode$4,decode:decode$6}),base256emoji$3=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:base256emoji$2},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const bases$1={...identityBase$1,...base2$3,...base8$3,...base10$3,...base16$3,...base32$4,...base36$3,...base58$1,...base64$5,...base256emoji$3};function asUint8Array$1(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function allocUnsafe$1(r=0){var e;return((e=globalThis.Buffer)==null?void 0:e.allocUnsafe)!=null?asUint8Array$1(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function createCodec$1(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}const string$1=createCodec$1("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),ascii$1=createCodec$1("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=allocUnsafe$1(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),BASES$1={utf8:string$1,"utf-8":string$1,hex:bases$1.base16,latin1:ascii$1,ascii:ascii$1,binary:ascii$1,...bases$1};function toString$4(r,e="utf8"){const t=BASES$1[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}function fromString$3(r,e="utf8"){const t=BASES$1[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?asUint8Array$1(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}const pathSepS="/",pathSepB=new TextEncoder().encode(pathSepS),pathSep=pathSepB[0];class Key{constructor(e,t){if(typeof e=="string")this._buf=fromString$3(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==pathSep)throw new Error("Invalid key")}toString(e="utf8"){return toString$4(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new Key(e.join(pathSepS))}static random(){return new Key(nanoid().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new Key(e):typeof e.uint8Array=="function"?new Key(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=pathSepB),this._buf[0]!==pathSep){const e=new Uint8Array(this._buf.byteLength+1);e.fill(pathSep,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===pathSep;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),n=e.list();for(let i=0;i<t.length;i++){if(n.length<i+1)return!1;const s=t[i],u=n[i];if(s<u)return!0;if(s>u)return!1}return t.length<n.length}reverse(){return Key.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(pathSepS).slice(1)}type(){return namespaceType(this.baseNamespace())}name(){return namespaceValue(this.baseNamespace())}instance(e){return new Key(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(pathSepS)||(e+=pathSepS),e+=this.type(),new Key(e)}parent(){const e=this.list();return e.length===1?new Key(pathSepS):new Key(e.slice(0,-1).join(pathSepS))}child(e){return this.toString()===pathSepS?e:e.toString()===pathSepS?this:new Key(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return Key.withNamespaces([...this.namespaces(),...flatten(e.map(t=>t.namespaces()))])}}function namespaceType(r){const e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function namespaceValue(r){const e=r.split(":");return e[e.length-1]}function flatten(r){return[].concat(...r)}var browser$2={exports:{}},ms$1,hasRequiredMs$1;function requireMs$1(){if(hasRequiredMs$1)return ms$1;hasRequiredMs$1=1;var r=1e3,e=r*60,t=e*60,n=t*24,i=n*7,s=n*365.25;ms$1=function(_,f){f=f||{};var l=typeof _;if(l==="string"&&_.length>0)return u(_);if(l==="number"&&isFinite(_))return f.long?d(_):c(_);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(_))};function u(_){if(_=String(_),!(_.length>100)){var f=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(_);if(f){var l=parseFloat(f[1]),h=(f[2]||"ms").toLowerCase();switch(h){case"years":case"year":case"yrs":case"yr":case"y":return l*s;case"weeks":case"week":case"w":return l*i;case"days":case"day":case"d":return l*n;case"hours":case"hour":case"hrs":case"hr":case"h":return l*t;case"minutes":case"minute":case"mins":case"min":case"m":return l*e;case"seconds":case"second":case"secs":case"sec":case"s":return l*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return}}}}function c(_){var f=Math.abs(_);return f>=n?Math.round(_/n)+"d":f>=t?Math.round(_/t)+"h":f>=e?Math.round(_/e)+"m":f>=r?Math.round(_/r)+"s":_+"ms"}function d(_){var f=Math.abs(_);return f>=n?g(_,f,n,"day"):f>=t?g(_,f,t,"hour"):f>=e?g(_,f,e,"minute"):f>=r?g(_,f,r,"second"):_+" ms"}function g(_,f,l,h){var p=f>=l*1.5;return Math.round(_/l)+" "+h+(p?"s":"")}return ms$1}var common$2,hasRequiredCommon$2;function requireCommon$2(){if(hasRequiredCommon$2)return common$2;hasRequiredCommon$2=1;function r(e){n.debug=n,n.default=n,n.coerce=g,n.disable=u,n.enable=s,n.enabled=c,n.humanize=requireMs$1(),n.destroy=_,Object.keys(e).forEach(f=>{n[f]=e[f]}),n.names=[],n.skips=[],n.formatters={};function t(f){let l=0;for(let h=0;h<f.length;h++)l=(l<<5)-l+f.charCodeAt(h),l|=0;return n.colors[Math.abs(l)%n.colors.length]}n.selectColor=t;function n(f){let l,h=null,p,y;function w(...v){if(!w.enabled)return;const C=w,P=Number(new Date),R=P-(l||P);C.diff=R,C.prev=l,C.curr=P,l=P,v[0]=n.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let F=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(B,H)=>{if(B==="%%")return"%";F++;const re=n.formatters[H];if(typeof re=="function"){const le=v[F];B=re.call(C,le),v.splice(F,1),F--}return B}),n.formatArgs.call(C,v),(C.log||n.log).apply(C,v)}return w.namespace=f,w.useColors=n.useColors(),w.color=n.selectColor(f),w.extend=i,w.destroy=n.destroy,Object.defineProperty(w,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(p!==n.namespaces&&(p=n.namespaces,y=n.enabled(f)),y),set:v=>{h=v}}),typeof n.init=="function"&&n.init(w),w}function i(f,l){const h=n(this.namespace+(typeof l>"u"?":":l)+f);return h.log=this.log,h}function s(f){n.save(f),n.namespaces=f,n.names=[],n.skips=[];let l;const h=(typeof f=="string"?f:"").split(/[\s,]+/),p=h.length;for(l=0;l<p;l++)h[l]&&(f=h[l].replace(/\*/g,".*?"),f[0]==="-"?n.skips.push(new RegExp("^"+f.slice(1)+"$")):n.names.push(new RegExp("^"+f+"$")))}function u(){const f=[...n.names.map(d),...n.skips.map(d).map(l=>"-"+l)].join(",");return n.enable(""),f}function c(f){if(f[f.length-1]==="*")return!0;let l,h;for(l=0,h=n.skips.length;l<h;l++)if(n.skips[l].test(f))return!1;for(l=0,h=n.names.length;l<h;l++)if(n.names[l].test(f))return!0;return!1}function d(f){return f.toString().substring(2,f.toString().length-2).replace(/\.\*\?$/,"*")}function g(f){return f instanceof Error?f.stack||f.message:f}function _(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}return common$2=r,common$2}var hasRequiredBrowser$2;function requireBrowser$2(){return hasRequiredBrowser$2||(hasRequiredBrowser$2=1,function(r,e){var t={};e.formatArgs=i,e.save=s,e.load=u,e.useColors=n,e.storage=c(),e.destroy=(()=>{let g=!1;return()=>{g||(g=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(g){if(g[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+g[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const _="color: "+this.color;g.splice(1,0,_,"color: inherit");let f=0,l=0;g[0].replace(/%[a-zA-Z%]/g,h=>{h!=="%%"&&(f++,h==="%c"&&(l=f))}),g.splice(l,0,_)}e.log=console.debug||console.log||(()=>{});function s(g){try{g?e.storage.setItem("debug",g):e.storage.removeItem("debug")}catch{}}function u(){let g;try{g=e.storage.getItem("debug")}catch{}return!g&&typeof process<"u"&&"env"in process&&(g=t.DEBUG),g}function c(){try{return localStorage}catch{}}r.exports=requireCommon$2()(e);const{formatters:d}=r.exports;d.j=function(g){try{return JSON.stringify(g)}catch(_){return"[UnexpectedJSONParseError]: "+_.message}}}(browser$2,browser$2.exports)),browser$2.exports}var browserExports$2=requireBrowser$2();const debug$1=getDefaultExportFromCjs(browserExports$2);var itLength,hasRequiredItLength;function requireItLength(){return hasRequiredItLength||(hasRequiredItLength=1,itLength=async e=>{let t=0;for await(const n of e)t++;return t}),itLength}var itLengthExports=requireItLength();const length$1=getDefaultExportFromCjs(itLengthExports),log$7=debug$1("ipfs:repo:migrator:migration-8");function unwrap$1(r){return r.child?unwrap$1(r.child):r}function keyToMultihash$1(r){try{const e=base32$7.decode(`b${r.toString().toLowerCase().slice(1)}`),t=CID$1.decode(e).multihash.bytes,n=base32$7.encode(t).slice(1).toUpperCase();return new Key(`/${n}`,!1)}catch{return r}}function keyToCid$1(r){try{const e=base32$7.decode(`b${r.toString().toLowerCase().slice(1)}`),t=decode$h(e),n=base32$7.encode(CID$1.createV1(code$2,t).bytes).slice(1);return new Key(`/${n.toUpperCase()}`,!1)}catch{return r}}async function process$3(r,e,t){const n=r.blocks;await n.open();const i=unwrap$1(n),s=await length$1(i.queryKeys({filters:[u=>t(u).toString()!==u.toString()]}));try{let u=0;for await(const c of i.query({})){const d=t(c.key);d.toString()!==c.key.toString()&&(u+=1,log$7(`Migrating Block from ${c.key} to ${d}`,await i.has(c.key)),await i.delete(c.key),await i.put(d,c.value),e(u/s*100,`Migrated Block from ${c.key} to ${d}`))}}finally{await n.close()}}const migration$4={version:8,description:"Transforms key names into base32 encoding and converts Block store to use bare multihashes encoded as base32",migrate:(r,e=()=>{})=>process$3(r,e,keyToMultihash$1),revert:(r,e=()=>{})=>process$3(r,e,keyToCid$1)};var indexMinimal={},minimal$1={},aspromise,hasRequiredAspromise;function requireAspromise(){if(hasRequiredAspromise)return aspromise;hasRequiredAspromise=1,aspromise=r;function r(e,t){for(var n=new Array(arguments.length-1),i=0,s=2,u=!0;s<arguments.length;)n[i++]=arguments[s++];return new Promise(function(d,g){n[i]=function(f){if(u)if(u=!1,f)g(f);else{for(var l=new Array(arguments.length-1),h=0;h<l.length;)l[h++]=arguments[h];d.apply(null,l)}};try{e.apply(t||null,n)}catch(_){u&&(u=!1,g(_))}})}return aspromise}var base64$3={},hasRequiredBase64;function requireBase64(){return hasRequiredBase64||(hasRequiredBase64=1,function(r){var e=r;e.length=function(c){var d=c.length;if(!d)return 0;for(var g=0;--d%4>1&&c.charAt(d)==="=";)++g;return Math.ceil(c.length*3)/4-g};for(var t=new Array(64),n=new Array(123),i=0;i<64;)n[t[i]=i<26?i+65:i<52?i+71:i<62?i-4:i-59|43]=i++;e.encode=function(c,d,g){for(var _=null,f=[],l=0,h=0,p;d<g;){var y=c[d++];switch(h){case 0:f[l++]=t[y>>2],p=(y&3)<<4,h=1;break;case 1:f[l++]=t[p|y>>4],p=(y&15)<<2,h=2;break;case 2:f[l++]=t[p|y>>6],f[l++]=t[y&63],h=0;break}l>8191&&((_||(_=[])).push(String.fromCharCode.apply(String,f)),l=0)}return h&&(f[l++]=t[p],f[l++]=61,h===1&&(f[l++]=61)),_?(l&&_.push(String.fromCharCode.apply(String,f.slice(0,l))),_.join("")):String.fromCharCode.apply(String,f.slice(0,l))};var s="invalid encoding";e.decode=function(c,d,g){for(var _=g,f=0,l,h=0;h<c.length;){var p=c.charCodeAt(h++);if(p===61&&f>1)break;if((p=n[p])===void 0)throw Error(s);switch(f){case 0:l=p,f=1;break;case 1:d[g++]=l<<2|(p&48)>>4,l=p,f=2;break;case 2:d[g++]=(l&15)<<4|(p&60)>>2,l=p,f=3;break;case 3:d[g++]=(l&3)<<6|p,f=0;break}}if(f===1)throw Error(s);return g-_},e.test=function(c){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(c)}}(base64$3)),base64$3}var eventemitter,hasRequiredEventemitter;function requireEventemitter(){if(hasRequiredEventemitter)return eventemitter;hasRequiredEventemitter=1,eventemitter=r;function r(){this._listeners={}}return r.prototype.on=function(t,n,i){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:n,ctx:i||this}),this},r.prototype.off=function(t,n){if(t===void 0)this._listeners={};else if(n===void 0)this._listeners[t]=[];else for(var i=this._listeners[t],s=0;s<i.length;)i[s].fn===n?i.splice(s,1):++s;return this},r.prototype.emit=function(t){var n=this._listeners[t];if(n){for(var i=[],s=1;s<arguments.length;)i.push(arguments[s++]);for(s=0;s<n.length;)n[s].fn.apply(n[s++].ctx,i)}return this},eventemitter}var float,hasRequiredFloat;function requireFloat(){if(hasRequiredFloat)return float;hasRequiredFloat=1,float=r(r);function r(s){return typeof Float32Array<"u"?function(){var u=new Float32Array([-0]),c=new Uint8Array(u.buffer),d=c[3]===128;function g(h,p,y){u[0]=h,p[y]=c[0],p[y+1]=c[1],p[y+2]=c[2],p[y+3]=c[3]}function _(h,p,y){u[0]=h,p[y]=c[3],p[y+1]=c[2],p[y+2]=c[1],p[y+3]=c[0]}s.writeFloatLE=d?g:_,s.writeFloatBE=d?_:g;function f(h,p){return c[0]=h[p],c[1]=h[p+1],c[2]=h[p+2],c[3]=h[p+3],u[0]}function l(h,p){return c[3]=h[p],c[2]=h[p+1],c[1]=h[p+2],c[0]=h[p+3],u[0]}s.readFloatLE=d?f:l,s.readFloatBE=d?l:f}():function(){function u(d,g,_,f){var l=g<0?1:0;if(l&&(g=-g),g===0)d(1/g>0?0:2147483648,_,f);else if(isNaN(g))d(2143289344,_,f);else if(g>34028234663852886e22)d((l<<31|2139095040)>>>0,_,f);else if(g<11754943508222875e-54)d((l<<31|Math.round(g/1401298464324817e-60))>>>0,_,f);else{var h=Math.floor(Math.log(g)/Math.LN2),p=Math.round(g*Math.pow(2,-h)*8388608)&8388607;d((l<<31|h+127<<23|p)>>>0,_,f)}}s.writeFloatLE=u.bind(null,e),s.writeFloatBE=u.bind(null,t);function c(d,g,_){var f=d(g,_),l=(f>>31)*2+1,h=f>>>23&255,p=f&8388607;return h===255?p?NaN:l*(1/0):h===0?l*1401298464324817e-60*p:l*Math.pow(2,h-150)*(p+8388608)}s.readFloatLE=c.bind(null,n),s.readFloatBE=c.bind(null,i)}(),typeof Float64Array<"u"?function(){var u=new Float64Array([-0]),c=new Uint8Array(u.buffer),d=c[7]===128;function g(h,p,y){u[0]=h,p[y]=c[0],p[y+1]=c[1],p[y+2]=c[2],p[y+3]=c[3],p[y+4]=c[4],p[y+5]=c[5],p[y+6]=c[6],p[y+7]=c[7]}function _(h,p,y){u[0]=h,p[y]=c[7],p[y+1]=c[6],p[y+2]=c[5],p[y+3]=c[4],p[y+4]=c[3],p[y+5]=c[2],p[y+6]=c[1],p[y+7]=c[0]}s.writeDoubleLE=d?g:_,s.writeDoubleBE=d?_:g;function f(h,p){return c[0]=h[p],c[1]=h[p+1],c[2]=h[p+2],c[3]=h[p+3],c[4]=h[p+4],c[5]=h[p+5],c[6]=h[p+6],c[7]=h[p+7],u[0]}function l(h,p){return c[7]=h[p],c[6]=h[p+1],c[5]=h[p+2],c[4]=h[p+3],c[3]=h[p+4],c[2]=h[p+5],c[1]=h[p+6],c[0]=h[p+7],u[0]}s.readDoubleLE=d?f:l,s.readDoubleBE=d?l:f}():function(){function u(d,g,_,f,l,h){var p=f<0?1:0;if(p&&(f=-f),f===0)d(0,l,h+g),d(1/f>0?0:2147483648,l,h+_);else if(isNaN(f))d(0,l,h+g),d(2146959360,l,h+_);else if(f>17976931348623157e292)d(0,l,h+g),d((p<<31|2146435072)>>>0,l,h+_);else{var y;if(f<22250738585072014e-324)y=f/5e-324,d(y>>>0,l,h+g),d((p<<31|y/4294967296)>>>0,l,h+_);else{var w=Math.floor(Math.log(f)/Math.LN2);w===1024&&(w=1023),y=f*Math.pow(2,-w),d(y*4503599627370496>>>0,l,h+g),d((p<<31|w+1023<<20|y*1048576&1048575)>>>0,l,h+_)}}}s.writeDoubleLE=u.bind(null,e,0,4),s.writeDoubleBE=u.bind(null,t,4,0);function c(d,g,_,f,l){var h=d(f,l+g),p=d(f,l+_),y=(p>>31)*2+1,w=p>>>20&2047,v=4294967296*(p&1048575)+h;return w===2047?v?NaN:y*(1/0):w===0?y*5e-324*v:y*Math.pow(2,w-1075)*(v+4503599627370496)}s.readDoubleLE=c.bind(null,n,0,4),s.readDoubleBE=c.bind(null,i,4,0)}(),s}function e(s,u,c){u[c]=s&255,u[c+1]=s>>>8&255,u[c+2]=s>>>16&255,u[c+3]=s>>>24}function t(s,u,c){u[c]=s>>>24,u[c+1]=s>>>16&255,u[c+2]=s>>>8&255,u[c+3]=s&255}function n(s,u){return(s[u]|s[u+1]<<8|s[u+2]<<16|s[u+3]<<24)>>>0}function i(s,u){return(s[u]<<24|s[u+1]<<16|s[u+2]<<8|s[u+3])>>>0}return float}var inquire_1,hasRequiredInquire;function requireInquire(){if(hasRequiredInquire)return inquire_1;hasRequiredInquire=1,inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(r){}return null}return inquire_1}var utf8={},hasRequiredUtf8;function requireUtf8(){return hasRequiredUtf8||(hasRequiredUtf8=1,function(r){var e=r;e.length=function(n){for(var i=0,s=0,u=0;u<n.length;++u)s=n.charCodeAt(u),s<128?i+=1:s<2048?i+=2:(s&64512)===55296&&(n.charCodeAt(u+1)&64512)===56320?(++u,i+=4):i+=3;return i},e.read=function(n,i,s){var u=s-i;if(u<1)return"";for(var c=null,d=[],g=0,_;i<s;)_=n[i++],_<128?d[g++]=_:_>191&&_<224?d[g++]=(_&31)<<6|n[i++]&63:_>239&&_<365?(_=((_&7)<<18|(n[i++]&63)<<12|(n[i++]&63)<<6|n[i++]&63)-65536,d[g++]=55296+(_>>10),d[g++]=56320+(_&1023)):d[g++]=(_&15)<<12|(n[i++]&63)<<6|n[i++]&63,g>8191&&((c||(c=[])).push(String.fromCharCode.apply(String,d)),g=0);return c?(g&&c.push(String.fromCharCode.apply(String,d.slice(0,g))),c.join("")):String.fromCharCode.apply(String,d.slice(0,g))},e.write=function(n,i,s){for(var u=s,c,d,g=0;g<n.length;++g)c=n.charCodeAt(g),c<128?i[s++]=c:c<2048?(i[s++]=c>>6|192,i[s++]=c&63|128):(c&64512)===55296&&((d=n.charCodeAt(g+1))&64512)===56320?(c=65536+((c&1023)<<10)+(d&1023),++g,i[s++]=c>>18|240,i[s++]=c>>12&63|128,i[s++]=c>>6&63|128,i[s++]=c&63|128):(i[s++]=c>>12|224,i[s++]=c>>6&63|128,i[s++]=c&63|128);return s-u}}(utf8)),utf8}var pool_1,hasRequiredPool;function requirePool(){if(hasRequiredPool)return pool_1;hasRequiredPool=1,pool_1=r;function r(e,t,n){var i=n||8192,s=i>>>1,u=null,c=i;return function(g){if(g<1||g>s)return e(g);c+g>i&&(u=e(i),c=0);var _=t.call(u,c,c+=g);return c&7&&(c=(c|7)+1),_}}return pool_1}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=e;var r=requireMinimal$1();function e(s,u){this.lo=s>>>0,this.hi=u>>>0}var t=e.zero=new e(0,0);t.toNumber=function(){return 0},t.zzEncode=t.zzDecode=function(){return this},t.length=function(){return 1};var n=e.zeroHash="\0\0\0\0\0\0\0\0";e.fromNumber=function(u){if(u===0)return t;var c=u<0;c&&(u=-u);var d=u>>>0,g=(u-d)/4294967296>>>0;return c&&(g=~g>>>0,d=~d>>>0,++d>4294967295&&(d=0,++g>4294967295&&(g=0))),new e(d,g)},e.from=function(u){if(typeof u=="number")return e.fromNumber(u);if(r.isString(u))if(r.Long)u=r.Long.fromString(u);else return e.fromNumber(parseInt(u,10));return u.low||u.high?new e(u.low>>>0,u.high>>>0):t},e.prototype.toNumber=function(u){if(!u&&this.hi>>>31){var c=~this.lo+1>>>0,d=~this.hi>>>0;return c||(d=d+1>>>0),-(c+d*4294967296)}return this.lo+this.hi*4294967296},e.prototype.toLong=function(u){return r.Long?new r.Long(this.lo|0,this.hi|0,!!u):{low:this.lo|0,high:this.hi|0,unsigned:!!u}};var i=String.prototype.charCodeAt;return e.fromHash=function(u){return u===n?t:new e((i.call(u,0)|i.call(u,1)<<8|i.call(u,2)<<16|i.call(u,3)<<24)>>>0,(i.call(u,4)|i.call(u,5)<<8|i.call(u,6)<<16|i.call(u,7)<<24)>>>0)},e.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},e.prototype.zzEncode=function(){var u=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^u)>>>0,this.lo=(this.lo<<1^u)>>>0,this},e.prototype.zzDecode=function(){var u=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^u)>>>0,this.hi=(this.hi>>>1^u)>>>0,this},e.prototype.length=function(){var u=this.lo,c=(this.lo>>>28|this.hi<<4)>>>0,d=this.hi>>>24;return d===0?c===0?u<16384?u<128?1:2:u<2097152?3:4:c<16384?c<128?5:6:c<2097152?7:8:d<128?9:10},longbits}var hasRequiredMinimal$1;function requireMinimal$1(){return hasRequiredMinimal$1||(hasRequiredMinimal$1=1,function(r){var e=r;e.asPromise=requireAspromise(),e.base64=requireBase64(),e.EventEmitter=requireEventemitter(),e.float=requireFloat(),e.inquire=requireInquire(),e.utf8=requireUtf8(),e.pool=requirePool(),e.LongBits=requireLongbits(),e.isNode=!!(typeof commonjsGlobal<"u"&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),e.global=e.isNode&&commonjsGlobal||typeof window<"u"&&window||typeof self<"u"&&self||minimal$1,e.emptyArray=Object.freeze?Object.freeze([]):[],e.emptyObject=Object.freeze?Object.freeze({}):{},e.isInteger=Number.isInteger||function(s){return typeof s=="number"&&isFinite(s)&&Math.floor(s)===s},e.isString=function(s){return typeof s=="string"||s instanceof String},e.isObject=function(s){return s&&typeof s=="object"},e.isset=e.isSet=function(s,u){var c=s[u];return c!=null&&s.hasOwnProperty(u)?typeof c!="object"||(Array.isArray(c)?c.length:Object.keys(c).length)>0:!1},e.Buffer=function(){try{var i=e.inquire("buffer").Buffer;return i.prototype.utf8Write?i:null}catch{return null}}(),e._Buffer_from=null,e._Buffer_allocUnsafe=null,e.newBuffer=function(s){return typeof s=="number"?e.Buffer?e._Buffer_allocUnsafe(s):new e.Array(s):e.Buffer?e._Buffer_from(s):typeof Uint8Array>"u"?s:new Uint8Array(s)},e.Array=typeof Uint8Array<"u"?Uint8Array:Array,e.Long=e.global.dcodeIO&&e.global.dcodeIO.Long||e.global.Long||e.inquire("long"),e.key2Re=/^true|false|0|1$/,e.key32Re=/^-?(?:0|[1-9][0-9]*)$/,e.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,e.longToHash=function(s){return s?e.LongBits.from(s).toHash():e.LongBits.zeroHash},e.longFromHash=function(s,u){var c=e.LongBits.fromHash(s);return e.Long?e.Long.fromBits(c.lo,c.hi,u):c.toNumber(!!u)};function t(i,s,u){for(var c=Object.keys(s),d=0;d<c.length;++d)(i[c[d]]===void 0||!u)&&(i[c[d]]=s[c[d]]);return i}e.merge=t,e.lcFirst=function(s){return s.charAt(0).toLowerCase()+s.substring(1)};function n(i){function s(u,c){if(!(this instanceof s))return new s(u,c);Object.defineProperty(this,"message",{get:function(){return u}}),Error.captureStackTrace?Error.captureStackTrace(this,s):Object.defineProperty(this,"stack",{value:new Error().stack||""}),c&&t(this,c)}return s.prototype=Object.create(Error.prototype,{constructor:{value:s,writable:!0,enumerable:!1,configurable:!0},name:{get(){return i},set:void 0,enumerable:!1,configurable:!0},toString:{value(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),s}e.newError=n,e.ProtocolError=n("ProtocolError"),e.oneOfGetter=function(s){for(var u={},c=0;c<s.length;++c)u[s[c]]=1;return function(){for(var d=Object.keys(this),g=d.length-1;g>-1;--g)if(u[d[g]]===1&&this[d[g]]!==void 0&&this[d[g]]!==null)return d[g]}},e.oneOfSetter=function(s){return function(u){for(var c=0;c<s.length;++c)s[c]!==u&&delete this[s[c]]}},e.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},e._configure=function(){var i=e.Buffer;if(!i){e._Buffer_from=e._Buffer_allocUnsafe=null;return}e._Buffer_from=i.from!==Uint8Array.from&&i.from||function(u,c){return new i(u,c)},e._Buffer_allocUnsafe=i.allocUnsafe||function(u){return new i(u)}}}(minimal$1)),minimal$1}var writer,hasRequiredWriter;function requireWriter(){if(hasRequiredWriter)return writer;hasRequiredWriter=1,writer=d;var r=requireMinimal$1(),e,t=r.LongBits,n=r.base64,i=r.utf8;function s(w,v,C){this.fn=w,this.len=v,this.next=void 0,this.val=C}function u(){}function c(w){this.head=w.head,this.tail=w.tail,this.len=w.len,this.next=w.states}function d(){this.len=0,this.head=new s(u,0,0),this.tail=this.head,this.states=null}var g=function(){return r.Buffer?function(){return(d.create=function(){return new e})()}:function(){return new d}};d.create=g(),d.alloc=function(v){return new r.Array(v)},r.Array!==Array&&(d.alloc=r.pool(d.alloc,r.Array.prototype.subarray)),d.prototype._push=function(v,C,P){return this.tail=this.tail.next=new s(v,C,P),this.len+=C,this};function _(w,v,C){v[C]=w&255}function f(w,v,C){for(;w>127;)v[C++]=w&127|128,w>>>=7;v[C]=w}function l(w,v){this.len=w,this.next=void 0,this.val=v}l.prototype=Object.create(s.prototype),l.prototype.fn=f,d.prototype.uint32=function(v){return this.len+=(this.tail=this.tail.next=new l((v=v>>>0)<128?1:v<16384?2:v<2097152?3:v<268435456?4:5,v)).len,this},d.prototype.int32=function(v){return v<0?this._push(h,10,t.fromNumber(v)):this.uint32(v)},d.prototype.sint32=function(v){return this.uint32((v<<1^v>>31)>>>0)};function h(w,v,C){for(;w.hi;)v[C++]=w.lo&127|128,w.lo=(w.lo>>>7|w.hi<<25)>>>0,w.hi>>>=7;for(;w.lo>127;)v[C++]=w.lo&127|128,w.lo=w.lo>>>7;v[C++]=w.lo}d.prototype.uint64=function(v){var C=t.from(v);return this._push(h,C.length(),C)},d.prototype.int64=d.prototype.uint64,d.prototype.sint64=function(v){var C=t.from(v).zzEncode();return this._push(h,C.length(),C)},d.prototype.bool=function(v){return this._push(_,1,v?1:0)};function p(w,v,C){v[C]=w&255,v[C+1]=w>>>8&255,v[C+2]=w>>>16&255,v[C+3]=w>>>24}d.prototype.fixed32=function(v){return this._push(p,4,v>>>0)},d.prototype.sfixed32=d.prototype.fixed32,d.prototype.fixed64=function(v){var C=t.from(v);return this._push(p,4,C.lo)._push(p,4,C.hi)},d.prototype.sfixed64=d.prototype.fixed64,d.prototype.float=function(v){return this._push(r.float.writeFloatLE,4,v)},d.prototype.double=function(v){return this._push(r.float.writeDoubleLE,8,v)};var y=r.Array.prototype.set?function(v,C,P){C.set(v,P)}:function(v,C,P){for(var R=0;R<v.length;++R)C[P+R]=v[R]};return d.prototype.bytes=function(v){var C=v.length>>>0;if(!C)return this._push(_,1,0);if(r.isString(v)){var P=d.alloc(C=n.length(v));n.decode(v,P,0),v=P}return this.uint32(C)._push(y,C,v)},d.prototype.string=function(v){var C=i.length(v);return C?this.uint32(C)._push(i.write,C,v):this._push(_,1,0)},d.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new s(u,0,0),this.len=0,this},d.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new s(u,0,0),this.len=0),this},d.prototype.ldelim=function(){var v=this.head,C=this.tail,P=this.len;return this.reset().uint32(P),P&&(this.tail.next=v.next,this.tail=C,this.len+=P),this},d.prototype.finish=function(){for(var v=this.head.next,C=this.constructor.alloc(this.len),P=0;v;)v.fn(v.val,C,P),P+=v.len,v=v.next;return C},d._configure=function(w){e=w,d.create=g(),e._configure()},writer}var writer_buffer,hasRequiredWriter_buffer;function requireWriter_buffer(){if(hasRequiredWriter_buffer)return writer_buffer;hasRequiredWriter_buffer=1,writer_buffer=t;var r=requireWriter();(t.prototype=Object.create(r.prototype)).constructor=t;var e=requireMinimal$1();function t(){r.call(this)}t._configure=function(){t.alloc=e._Buffer_allocUnsafe,t.writeBytesBuffer=e.Buffer&&e.Buffer.prototype instanceof Uint8Array&&e.Buffer.prototype.set.name==="set"?function(s,u,c){u.set(s,c)}:function(s,u,c){if(s.copy)s.copy(u,c,0,s.length);else for(var d=0;d<s.length;)u[c++]=s[d++]}},t.prototype.bytes=function(s){e.isString(s)&&(s=e._Buffer_from(s,"base64"));var u=s.length>>>0;return this.uint32(u),u&&this._push(t.writeBytesBuffer,u,s),this};function n(i,s,u){i.length<40?e.utf8.write(i,s,u):s.utf8Write?s.utf8Write(i,u):s.write(i,u)}return t.prototype.string=function(s){var u=e.Buffer.byteLength(s);return this.uint32(u),u&&this._push(n,u,s),this},t._configure(),writer_buffer}var reader,hasRequiredReader;function requireReader(){if(hasRequiredReader)return reader;hasRequiredReader=1,reader=s;var r=requireMinimal$1(),e,t=r.LongBits,n=r.utf8;function i(f,l){return RangeError("index out of range: "+f.pos+" + "+(l||1)+" > "+f.len)}function s(f){this.buf=f,this.pos=0,this.len=f.length}var u=typeof Uint8Array<"u"?function(l){if(l instanceof Uint8Array||Array.isArray(l))return new s(l);throw Error("illegal buffer")}:function(l){if(Array.isArray(l))return new s(l);throw Error("illegal buffer")},c=function(){return r.Buffer?function(h){return(s.create=function(y){return r.Buffer.isBuffer(y)?new e(y):u(y)})(h)}:u};s.create=c(),s.prototype._slice=r.Array.prototype.subarray||r.Array.prototype.slice,s.prototype.uint32=function(){var l=4294967295;return function(){if(l=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(l=(l|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(l=(l|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(l=(l|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(l=(l|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return l;if((this.pos+=5)>this.len)throw this.pos=this.len,i(this,10);return l}}(),s.prototype.int32=function(){return this.uint32()|0},s.prototype.sint32=function(){var l=this.uint32();return l>>>1^-(l&1)|0};function d(){var f=new t(0,0),l=0;if(this.len-this.pos>4){for(;l<4;++l)if(f.lo=(f.lo|(this.buf[this.pos]&127)<<l*7)>>>0,this.buf[this.pos++]<128)return f;if(f.lo=(f.lo|(this.buf[this.pos]&127)<<28)>>>0,f.hi=(f.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return f;l=0}else{for(;l<3;++l){if(this.pos>=this.len)throw i(this);if(f.lo=(f.lo|(this.buf[this.pos]&127)<<l*7)>>>0,this.buf[this.pos++]<128)return f}return f.lo=(f.lo|(this.buf[this.pos++]&127)<<l*7)>>>0,f}if(this.len-this.pos>4){for(;l<5;++l)if(f.hi=(f.hi|(this.buf[this.pos]&127)<<l*7+3)>>>0,this.buf[this.pos++]<128)return f}else for(;l<5;++l){if(this.pos>=this.len)throw i(this);if(f.hi=(f.hi|(this.buf[this.pos]&127)<<l*7+3)>>>0,this.buf[this.pos++]<128)return f}throw Error("invalid varint encoding")}s.prototype.bool=function(){return this.uint32()!==0};function g(f,l){return(f[l-4]|f[l-3]<<8|f[l-2]<<16|f[l-1]<<24)>>>0}s.prototype.fixed32=function(){if(this.pos+4>this.len)throw i(this,4);return g(this.buf,this.pos+=4)},s.prototype.sfixed32=function(){if(this.pos+4>this.len)throw i(this,4);return g(this.buf,this.pos+=4)|0};function _(){if(this.pos+8>this.len)throw i(this,8);return new t(g(this.buf,this.pos+=4),g(this.buf,this.pos+=4))}return s.prototype.float=function(){if(this.pos+4>this.len)throw i(this,4);var l=r.float.readFloatLE(this.buf,this.pos);return this.pos+=4,l},s.prototype.double=function(){if(this.pos+8>this.len)throw i(this,4);var l=r.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,l},s.prototype.bytes=function(){var l=this.uint32(),h=this.pos,p=this.pos+l;if(p>this.len)throw i(this,l);return this.pos+=l,Array.isArray(this.buf)?this.buf.slice(h,p):h===p?new this.buf.constructor(0):this._slice.call(this.buf,h,p)},s.prototype.string=function(){var l=this.bytes();return n.read(l,0,l.length)},s.prototype.skip=function(l){if(typeof l=="number"){if(this.pos+l>this.len)throw i(this,l);this.pos+=l}else do if(this.pos>=this.len)throw i(this);while(this.buf[this.pos++]&128);return this},s.prototype.skipType=function(f){switch(f){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(f=this.uint32()&7)!==4;)this.skipType(f);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+f+" at offset "+this.pos)}return this},s._configure=function(f){e=f,s.create=c(),e._configure();var l=r.Long?"toLong":"toNumber";r.merge(s.prototype,{int64:function(){return d.call(this)[l](!1)},uint64:function(){return d.call(this)[l](!0)},sint64:function(){return d.call(this).zzDecode()[l](!1)},fixed64:function(){return _.call(this)[l](!0)},sfixed64:function(){return _.call(this)[l](!1)}})},reader}var reader_buffer,hasRequiredReader_buffer;function requireReader_buffer(){if(hasRequiredReader_buffer)return reader_buffer;hasRequiredReader_buffer=1,reader_buffer=t;var r=requireReader();(t.prototype=Object.create(r.prototype)).constructor=t;var e=requireMinimal$1();function t(n){r.call(this,n)}return t._configure=function(){e.Buffer&&(t.prototype._slice=e.Buffer.prototype.slice)},t.prototype.string=function(){var i=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+i,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+i,this.len))},t._configure(),reader_buffer}var rpc={},service,hasRequiredService;function requireService(){if(hasRequiredService)return service;hasRequiredService=1,service=e;var r=requireMinimal$1();(e.prototype=Object.create(r.EventEmitter.prototype)).constructor=e;function e(t,n,i){if(typeof t!="function")throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=!!n,this.responseDelimited=!!i}return e.prototype.rpcCall=function t(n,i,s,u,c){if(!u)throw TypeError("request must be specified");var d=this;if(!c)return r.asPromise(t,d,n,i,s,u);if(!d.rpcImpl){setTimeout(function(){c(Error("already ended"))},0);return}try{return d.rpcImpl(n,i[d.requestDelimited?"encodeDelimited":"encode"](u).finish(),function(_,f){if(_)return d.emit("error",_,n),c(_);if(f===null){d.end(!0);return}if(!(f instanceof s))try{f=s[d.responseDelimited?"decodeDelimited":"decode"](f)}catch(l){return d.emit("error",l,n),c(l)}return d.emit("data",f,n),c(null,f)})}catch(g){d.emit("error",g,n),setTimeout(function(){c(g)},0);return}},e.prototype.end=function(n){return this.rpcImpl&&(n||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},service}var hasRequiredRpc;function requireRpc(){return hasRequiredRpc||(hasRequiredRpc=1,function(r){var e=r;e.Service=requireService()}(rpc)),rpc}var roots,hasRequiredRoots;function requireRoots(){return hasRequiredRoots||(hasRequiredRoots=1,roots={}),roots}var hasRequiredIndexMinimal;function requireIndexMinimal(){return hasRequiredIndexMinimal||(hasRequiredIndexMinimal=1,function(r){var e=r;e.build="minimal",e.Writer=requireWriter(),e.BufferWriter=requireWriter_buffer(),e.Reader=requireReader(),e.BufferReader=requireReader_buffer(),e.util=requireMinimal$1(),e.rpc=requireRpc(),e.roots=requireRoots(),e.configure=t;function t(){e.util._configure(),e.Writer._configure(e.BufferWriter),e.Reader._configure(e.BufferReader)}t()}(indexMinimal)),indexMinimal}var minimal,hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,minimal=requireIndexMinimal()),minimal}var minimalExports=requireMinimal();const $protobuf=getDefaultExportFromCjs(minimalExports),$Reader$5=$protobuf.Reader,$Writer$5=$protobuf.Writer;$protobuf.util;const $root$5=$protobuf.roots.default||($protobuf.roots.default={}),ipfs$1=$root$5.ipfs=(()=>{const r={};return r.pin=function(){const e={};return e.Set=function(){function t(n){if(n)for(var i=Object.keys(n),s=0;s<i.length;++s)n[i[s]]!=null&&(this[i[s]]=n[i[s]])}return t.prototype.version=0,t.prototype.fanout=0,t.prototype.seed=0,t.encode=function(i,s){return s||(s=$Writer$5.create()),i.version!=null&&Object.hasOwnProperty.call(i,"version")&&s.uint32(8).uint32(i.version),i.fanout!=null&&Object.hasOwnProperty.call(i,"fanout")&&s.uint32(16).uint32(i.fanout),i.seed!=null&&Object.hasOwnProperty.call(i,"seed")&&s.uint32(29).fixed32(i.seed),s},t.decode=function(i,s){i instanceof $Reader$5||(i=$Reader$5.create(i));for(var u=s===void 0?i.len:i.pos+s,c=new $root$5.ipfs.pin.Set;i.pos<u;){var d=i.uint32();switch(d>>>3){case 1:c.version=i.uint32();break;case 2:c.fanout=i.uint32();break;case 3:c.seed=i.fixed32();break;default:i.skipType(d&7);break}}return c},t.fromObject=function(i){if(i instanceof $root$5.ipfs.pin.Set)return i;var s=new $root$5.ipfs.pin.Set;return i.version!=null&&(s.version=i.version>>>0),i.fanout!=null&&(s.fanout=i.fanout>>>0),i.seed!=null&&(s.seed=i.seed>>>0),s},t.toObject=function(i,s){s||(s={});var u={};return s.defaults&&(u.version=0,u.fanout=0,u.seed=0),i.version!=null&&i.hasOwnProperty("version")&&(u.version=i.version),i.fanout!=null&&i.hasOwnProperty("fanout")&&(u.fanout=i.fanout),i.seed!=null&&i.hasOwnProperty("seed")&&(u.seed=i.seed),u},t.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},t}(),e}(),r})();var fnv1a$1={exports:{}},hasRequiredFnv1a;function requireFnv1a(){return hasRequiredFnv1a||(hasRequiredFnv1a=1,function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),t.BASE=2166136261;function t(n,i=t.BASE){const s=n.length;for(let u=0;u<s;u++)i^=n.charCodeAt(u),i+=(i<<1)+(i<<4)+(i<<7)+(i<<8)+(i<<24);return i>>>0}e.default=t,r.exports=t}(fnv1a$1,fnv1a$1.exports)),fnv1a$1.exports}var fnv1aExports=requireFnv1a();const fnv1a=getDefaultExportFromCjs(fnv1aExports),PIN_DS_KEY=new Key("/local/pins"),DEFAULT_FANOUT=256,MAX_ITEMS=8192,EMPTY_KEY=CID$1.parse("QmdfTbBqBPQ7VNxZEYEj14VmRuZBkqFbiwReogJgS1zR1n"),PinTypes$1={direct:"direct",recursive:"recursive"};function cidToKey$2(r){return new Key(`/${base32$7.encode(r.multihash.bytes).toUpperCase().substring(1)}`)}const PinSet=ipfs$1.pin.Set;function readHeader(r){const e=r.Data;if(!e)throw new Error("No data present");const t=varint$1.decode(e),n=varint$1.decode.bytes;if(n<=0)throw new Error("Invalid Set header length");if(n+t>e.length)throw new Error("Impossibly large set header length");const i=e.slice(n,t+n),s=PinSet.toObject(PinSet.decode(i),{defaults:!1,arrays:!0,longs:Number,objects:!1});if(s.version!==1)throw new Error(`Unsupported Set version: ${s.version}`);if(s.fanout>r.Links.length)throw new Error("Impossibly large fanout");return{header:s,data:e.slice(t+n)}}function hash(r,e){const t=new Uint8Array(4);new DataView(t.buffer).setUint32(0,r,!0);const i=fromString$8(e.toString()),s=concat$2([t,i],t.byteLength+i.byteLength);return fnv1a(toString$a(s))}async function*walkItems(r,e){const t=readHeader(e);let n=0;for(const i of e.Links){if(n<t.header.fanout){const s=i.Hash;if(!EMPTY_KEY.equals(s)){const u=await r.get(s),c=decode$b(u);yield*walkItems(r,c)}}else yield i.Hash;n++}}async function*loadSet(r,e,t){const n=e.Links.find(u=>u.Name===t);if(!n)throw new Error("No link found with name "+t);const i=await r.get(n.Hash),s=decode$b(i);yield*walkItems(r,s)}function storeItems(r,e){return t(e,0);async function t(n,i){const s=PinSet.encode({version:1,fanout:DEFAULT_FANOUT,seed:i}).finish(),u=varint$1.encode(s.length),c=concat$2([u,s]),d=[];for(let _=0;_<DEFAULT_FANOUT;_++)d.push({Name:"",Tsize:1,Hash:EMPTY_KEY});if(n.length<=MAX_ITEMS){const _=n.map(h=>({link:{Name:"",Tsize:1,Hash:h.key},data:h.data||new Uint8Array})).sort((h,p)=>compare$1(h.link.Hash.bytes,p.link.Hash.bytes)),f=d.concat(_.map(h=>h.link));return{Data:concat$2([c,..._.map(h=>h.data)]),Links:f}}else{const _=n.reduce((l,h)=>{const p=hash(i,h.key)%DEFAULT_FANOUT;return l[p]=p in l?l[p].concat([h]):[h],l},[]);let f=0;for(const l of _){const h=await t(l,i+1);await g(h,f),f++}return{Data:c,Links:d}}async function g(_,f){const l=encode$8(_),h=await sha256.digest(l),p=CID$1.createV0(h);await r.put(p,l);const y=_.Links.reduce((w,v)=>w+(v.Tsize||0),0)+l.length;d[f]={Name:"",Tsize:y,Hash:p}}}}async function storeSet(r,e,t){const n=await storeItems(r,t.map(d=>({key:d}))),i=encode$8(n),s=await sha256.digest(i),u=CID$1.createV0(s);await r.put(u,i);const c=n.Links.reduce((d,g)=>d+g.Tsize,0)+i.length;return{Name:e,Tsize:c,Hash:u}}async function pinsToDatastore(r,e,t,n){if(!await e.has(PIN_DS_KEY))return;const i=await e.get(PIN_DS_KEY),s=CID$1.decode(i),u=await r.get(s),c=decode$b(u);let d=0;const g=await length$1(loadSet(r,c,PinTypes$1.recursive))+await length$1(loadSet(r,c,PinTypes$1.direct));for await(const _ of loadSet(r,c,PinTypes$1.recursive)){d++;const f={depth:1/0};_.version!==0&&(f.version=_.version),_.code!==code&&(f.codec=_.code),await t.put(cidToKey$2(_),encode$a(f)),n(d/g*100,`Migrated recursive pin ${_}`)}for await(const _ of loadSet(r,c,PinTypes$1.direct)){d++;const f={depth:0};_.version!==0&&(f.version=_.version),_.code!==code&&(f.codec=_.code),await t.put(cidToKey$2(_),encode$a(f)),n(d/g*100,`Migrated direct pin ${_}`)}await r.delete(s),await e.delete(PIN_DS_KEY)}async function pinsToDAG(r,e,t,n){const i=[],s=[];let u=0;const c=await length$1(t.queryKeys({}));for await(const{key:l,value:h}of t.query({})){u++;const p=decode$d(h),y=CID$1.create(p.version||0,p.codec||code,decode$h(base32$7.decode("b"+l.toString().toLowerCase().split("/").pop())));p.depth===0?(n(u/c*100,`Reverted direct pin ${y}`),s.push(y)):(n(u/c*100,`Reverted recursive pin ${y}`),i.push(y))}n(100,"Updating pin root");const d={Links:[await storeSet(r,PinTypes$1.direct,s),await storeSet(r,PinTypes$1.recursive,i)]},g=encode$8(d),_=await sha256.digest(g),f=CID$1.createV0(_);await r.put(f,g),await e.put(PIN_DS_KEY,f.bytes)}async function process$2(r,e,t){const n=r.blocks,i=r.datastore,s=r.pins;await n.open(),await i.open(),await s.open();try{await t(n,i,s,e)}finally{await s.close(),await i.close(),await n.close()}}const migration$3={version:9,description:"Migrates pins to datastore",migrate:(r,e=()=>{})=>process$2(r,e,pinsToDatastore),revert:(r,e=()=>{})=>process$2(r,e,pinsToDAG)};function dbOpenFailedError(r){return r=r||new Error("Cannot open database"),errcode(r,"ERR_DB_OPEN_FAILED")}function dbDeleteFailedError(r){return r=r||new Error("Delete failed"),errcode(r,"ERR_DB_DELETE_FAILED")}function dbWriteFailedError(r){return r=r||new Error("Write failed"),errcode(r,"ERR_DB_WRITE_FAILED")}function notFoundError(r){return r=r||new Error("Not Found"),errcode(r,"ERR_NOT_FOUND")}const CONFIG_KEY=new Key("/config"),VERSION_KEY=new Key("/version");function findLevelJs$1(r){let e=r;for(;e.db||e.child;)if(e=e.db||e.child,e.type==="level-js"||e.constructor.name==="Level")return e}async function hasWithFallback$1(r,e,t){const n=await e(r);if(n)return n;const i=findLevelJs$1(t);return i?new Promise((s,u)=>{const c=i.store("readonly").get(r.toString());c.transaction.onabort=()=>{u(c.transaction.error)},c.transaction.oncomplete=()=>{s(!!c.result)}}):!1}async function getWithFallback$1(r,e,t,n){if(await t(r))return e(r);const i=findLevelJs$1(n);if(!i)throw notFoundError();return new Promise((s,u)=>{const c=i.store("readonly").get(r.toString());c.transaction.onabort=()=>{u(c.transaction.error)},c.transaction.oncomplete=()=>{if(c.result)return s(c.result);u(notFoundError())}})}function wrapStore(r){const e=r.get.bind(r),t=r.has.bind(r);return r.get=n=>getWithFallback$1(n,e,t,r),r.has=n=>hasWithFallback$1(n,t,r),r}function wrapBackends(r){return{...r,root:wrapStore(r.root),datastore:wrapStore(r.datastore),pins:wrapStore(r.pins),keys:wrapStore(r.keys)}}async function keysToBinary(r,e,t=()=>{}){const n=findLevelJs$1(e);if(!n){t(`${r} did not need an upgrade`);return}t(`Upgrading ${r}`),await withEach(n,(s,u)=>[{type:"del",key:s},{type:"put",key:fromString$8(s),value:u}])}async function keysToStrings(r,e,t=()=>{}){const n=findLevelJs$1(e);if(!n){t(`${r} did not need a downgrade`);return}t(`Downgrading ${r}`),await withEach(n,(s,u)=>[{type:"del",key:s},{type:"put",key:toString$a(s),value:u}])}function unwrap(r){return r.child?unwrap(r.child):r}async function process$1(r,e,t){const n=Object.entries(r).map(([u,c])=>({key:u,backend:unwrap(c)})).filter(({key:u,backend:c})=>c.constructor.name==="LevelDatastore").map(({key:u,backend:c})=>({name:u,store:c}));e(0,`Migrating ${n.length} dbs`);let i=0;const s=u=>{e(Math.round(i/n.length*100),u)};for(const{name:u,store:c}of n){await c.open();try{await t(u,c,s)}finally{i++,await c.close()}}e(100,`Migrated ${n.length} dbs`)}const migration$2={version:10,description:"Migrates datastore-level keys to binary",migrate:(r,e=()=>{})=>process$1(r,e,keysToBinary),revert:(r,e=()=>{})=>process$1(r,e,keysToStrings)};function withEach(r,e){function t(n,i){const s=r.store("readwrite"),u=s.transaction;let c=0,d;u.onabort=()=>i(d||u.error||new Error("aborted by user")),u.oncomplete=()=>i();function g(){const _=n[c++],f=_.key;let l;try{l=_.type==="del"?s.delete(f):s.put(_.value,f)}catch(h){d=h,u.abort();return}c<n.length&&(l.onsuccess=g)}g()}return new Promise((n,i)=>{const s=r.iterator(),u=d=>d;s._deserializeKey=s._deserializeValue=u,c();function c(){const d=(g,_,f)=>{if(g||_===void 0){const l=h=>{if(h){i(h);return}n()};s.end(l);return}t(e(_,f),c)};s.next(d)}})}const MFS_ROOT_KEY$1=new Key("/local/filesroot");async function storeMfsRootInDatastore(r,e=()=>{}){if(e(100,"Migrating MFS root to repo datastore"),await r.root.open(),await r.datastore.open(),await r.root.has(MFS_ROOT_KEY$1)){const t=await r.root.get(MFS_ROOT_KEY$1);await r.datastore.put(MFS_ROOT_KEY$1,t),await r.root.delete(MFS_ROOT_KEY$1)}await r.datastore.close(),await r.root.close(),e(100,"Stored MFS root in repo datastore")}async function storeMfsRootInRoot(r,e=()=>{}){if(e(100,"Migrating MFS root to repo root datastore"),await r.root.open(),await r.datastore.open(),await r.datastore.has(MFS_ROOT_KEY$1)){const t=await r.datastore.get(MFS_ROOT_KEY$1);await r.root.put(MFS_ROOT_KEY$1,t),await r.datastore.delete(MFS_ROOT_KEY$1)}await r.datastore.close(),await r.root.close(),e(100,"Stored MFS root in repo root datastore")}const migration$1={version:11,description:"Store mfs root in the datastore",migrate:storeMfsRootInDatastore,revert:storeMfsRootInRoot},$Reader$4=$protobuf.Reader,$Writer$4=$protobuf.Writer,$util$4=$protobuf.util,$root$4=$protobuf.roots.default||($protobuf.roots.default={}),Protocols=$root$4.Protocols=(()=>{function r(e){if(this.protocols=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.protocols=$util$4.emptyArray,r.encode=function(t,n){if(n||(n=$Writer$4.create()),t.protocols!=null&&t.protocols.length)for(var i=0;i<t.protocols.length;++i)n.uint32(10).string(t.protocols[i]);return n},r.decode=function(t,n){t instanceof $Reader$4||(t=$Reader$4.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new $root$4.Protocols;t.pos<i;){var u=t.uint32();switch(u>>>3){case 1:s.protocols&&s.protocols.length||(s.protocols=[]),s.protocols.push(t.string());break;default:t.skipType(u&7);break}}return s},r.fromObject=function(t){if(t instanceof $root$4.Protocols)return t;var n=new $root$4.Protocols;if(t.protocols){if(!Array.isArray(t.protocols))throw TypeError(".Protocols.protocols: array expected");n.protocols=[];for(var i=0;i<t.protocols.length;++i)n.protocols[i]=String(t.protocols[i])}return n},r.toObject=function(t,n){n||(n={});var i={};if((n.arrays||n.defaults)&&(i.protocols=[]),t.protocols&&t.protocols.length){i.protocols=[];for(var s=0;s<t.protocols.length;++s)i.protocols[s]=t.protocols[s]}return i},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r})(),$Reader$3=$protobuf.Reader,$Writer$3=$protobuf.Writer,$util$3=$protobuf.util,$root$3=$protobuf.roots.default||($protobuf.roots.default={}),Addresses=$root$3.Addresses=(()=>{function r(e){if(this.addrs=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.addrs=$util$3.emptyArray,r.prototype.certifiedRecord=null,r.encode=function(t,n){if(n||(n=$Writer$3.create()),t.addrs!=null&&t.addrs.length)for(var i=0;i<t.addrs.length;++i)$root$3.Addresses.Address.encode(t.addrs[i],n.uint32(10).fork()).ldelim();return t.certifiedRecord!=null&&Object.hasOwnProperty.call(t,"certifiedRecord")&&$root$3.Addresses.CertifiedRecord.encode(t.certifiedRecord,n.uint32(18).fork()).ldelim(),n},r.decode=function(t,n){t instanceof $Reader$3||(t=$Reader$3.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new $root$3.Addresses;t.pos<i;){var u=t.uint32();switch(u>>>3){case 1:s.addrs&&s.addrs.length||(s.addrs=[]),s.addrs.push($root$3.Addresses.Address.decode(t,t.uint32()));break;case 2:s.certifiedRecord=$root$3.Addresses.CertifiedRecord.decode(t,t.uint32());break;default:t.skipType(u&7);break}}return s},r.fromObject=function(t){if(t instanceof $root$3.Addresses)return t;var n=new $root$3.Addresses;if(t.addrs){if(!Array.isArray(t.addrs))throw TypeError(".Addresses.addrs: array expected");n.addrs=[];for(var i=0;i<t.addrs.length;++i){if(typeof t.addrs[i]!="object")throw TypeError(".Addresses.addrs: object expected");n.addrs[i]=$root$3.Addresses.Address.fromObject(t.addrs[i])}}if(t.certifiedRecord!=null){if(typeof t.certifiedRecord!="object")throw TypeError(".Addresses.certifiedRecord: object expected");n.certifiedRecord=$root$3.Addresses.CertifiedRecord.fromObject(t.certifiedRecord)}return n},r.toObject=function(t,n){n||(n={});var i={};if((n.arrays||n.defaults)&&(i.addrs=[]),n.defaults&&(i.certifiedRecord=null),t.addrs&&t.addrs.length){i.addrs=[];for(var s=0;s<t.addrs.length;++s)i.addrs[s]=$root$3.Addresses.Address.toObject(t.addrs[s],n)}return t.certifiedRecord!=null&&t.hasOwnProperty("certifiedRecord")&&(i.certifiedRecord=$root$3.Addresses.CertifiedRecord.toObject(t.certifiedRecord,n)),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r.Address=function(){function e(n){if(n)for(var i=Object.keys(n),s=0;s<i.length;++s)n[i[s]]!=null&&(this[i[s]]=n[i[s]])}e.prototype.multiaddr=$util$3.newBuffer([]),e.prototype.isCertified=null;let t;return Object.defineProperty(e.prototype,"_isCertified",{get:$util$3.oneOfGetter(t=["isCertified"]),set:$util$3.oneOfSetter(t)}),e.encode=function(i,s){return s||(s=$Writer$3.create()),i.multiaddr!=null&&Object.hasOwnProperty.call(i,"multiaddr")&&s.uint32(10).bytes(i.multiaddr),i.isCertified!=null&&Object.hasOwnProperty.call(i,"isCertified")&&s.uint32(16).bool(i.isCertified),s},e.decode=function(i,s){i instanceof $Reader$3||(i=$Reader$3.create(i));for(var u=s===void 0?i.len:i.pos+s,c=new $root$3.Addresses.Address;i.pos<u;){var d=i.uint32();switch(d>>>3){case 1:c.multiaddr=i.bytes();break;case 2:c.isCertified=i.bool();break;default:i.skipType(d&7);break}}return c},e.fromObject=function(i){if(i instanceof $root$3.Addresses.Address)return i;var s=new $root$3.Addresses.Address;return i.multiaddr!=null&&(typeof i.multiaddr=="string"?$util$3.base64.decode(i.multiaddr,s.multiaddr=$util$3.newBuffer($util$3.base64.length(i.multiaddr)),0):i.multiaddr.length&&(s.multiaddr=i.multiaddr)),i.isCertified!=null&&(s.isCertified=!!i.isCertified),s},e.toObject=function(i,s){s||(s={});var u={};return s.defaults&&(s.bytes===String?u.multiaddr="":(u.multiaddr=[],s.bytes!==Array&&(u.multiaddr=$util$3.newBuffer(u.multiaddr)))),i.multiaddr!=null&&i.hasOwnProperty("multiaddr")&&(u.multiaddr=s.bytes===String?$util$3.base64.encode(i.multiaddr,0,i.multiaddr.length):s.bytes===Array?Array.prototype.slice.call(i.multiaddr):i.multiaddr),i.isCertified!=null&&i.hasOwnProperty("isCertified")&&(u.isCertified=i.isCertified,s.oneofs&&(u._isCertified="isCertified")),u},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),r.CertifiedRecord=function(){function e(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.seq=$util$3.Long?$util$3.Long.fromBits(0,0,!0):0,e.prototype.raw=$util$3.newBuffer([]),e.encode=function(n,i){return i||(i=$Writer$3.create()),n.seq!=null&&Object.hasOwnProperty.call(n,"seq")&&i.uint32(8).uint64(n.seq),n.raw!=null&&Object.hasOwnProperty.call(n,"raw")&&i.uint32(18).bytes(n.raw),i},e.decode=function(n,i){n instanceof $Reader$3||(n=$Reader$3.create(n));for(var s=i===void 0?n.len:n.pos+i,u=new $root$3.Addresses.CertifiedRecord;n.pos<s;){var c=n.uint32();switch(c>>>3){case 1:u.seq=n.uint64();break;case 2:u.raw=n.bytes();break;default:n.skipType(c&7);break}}return u},e.fromObject=function(n){if(n instanceof $root$3.Addresses.CertifiedRecord)return n;var i=new $root$3.Addresses.CertifiedRecord;return n.seq!=null&&($util$3.Long?(i.seq=$util$3.Long.fromValue(n.seq)).unsigned=!0:typeof n.seq=="string"?i.seq=parseInt(n.seq,10):typeof n.seq=="number"?i.seq=n.seq:typeof n.seq=="object"&&(i.seq=new $util$3.LongBits(n.seq.low>>>0,n.seq.high>>>0).toNumber(!0))),n.raw!=null&&(typeof n.raw=="string"?$util$3.base64.decode(n.raw,i.raw=$util$3.newBuffer($util$3.base64.length(n.raw)),0):n.raw.length&&(i.raw=n.raw)),i},e.toObject=function(n,i){i||(i={});var s={};if(i.defaults){if($util$3.Long){var u=new $util$3.Long(0,0,!0);s.seq=i.longs===String?u.toString():i.longs===Number?u.toNumber():u}else s.seq=i.longs===String?"0":0;i.bytes===String?s.raw="":(s.raw=[],i.bytes!==Array&&(s.raw=$util$3.newBuffer(s.raw)))}return n.seq!=null&&n.hasOwnProperty("seq")&&(typeof n.seq=="number"?s.seq=i.longs===String?String(n.seq):n.seq:s.seq=i.longs===String?$util$3.Long.prototype.toString.call(n.seq):i.longs===Number?new $util$3.LongBits(n.seq.low>>>0,n.seq.high>>>0).toNumber(!0):n.seq),n.raw!=null&&n.hasOwnProperty("raw")&&(s.raw=i.bytes===String?$util$3.base64.encode(n.raw,0,n.raw.length):i.bytes===Array?Array.prototype.slice.call(n.raw):n.raw),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),r})(),$Reader$2=$protobuf.Reader,$Writer$2=$protobuf.Writer,$util$2=$protobuf.util,$root$2=$protobuf.roots.default||($protobuf.roots.default={}),Peer=$root$2.Peer=(()=>{function r(t){if(this.addresses=[],this.protocols=[],this.metadata=[],t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}r.prototype.addresses=$util$2.emptyArray,r.prototype.protocols=$util$2.emptyArray,r.prototype.metadata=$util$2.emptyArray,r.prototype.pubKey=null,r.prototype.peerRecordEnvelope=null;let e;return Object.defineProperty(r.prototype,"_pubKey",{get:$util$2.oneOfGetter(e=["pubKey"]),set:$util$2.oneOfSetter(e)}),Object.defineProperty(r.prototype,"_peerRecordEnvelope",{get:$util$2.oneOfGetter(e=["peerRecordEnvelope"]),set:$util$2.oneOfSetter(e)}),r.encode=function(n,i){if(i||(i=$Writer$2.create()),n.addresses!=null&&n.addresses.length)for(var s=0;s<n.addresses.length;++s)$root$2.Address.encode(n.addresses[s],i.uint32(10).fork()).ldelim();if(n.protocols!=null&&n.protocols.length)for(var s=0;s<n.protocols.length;++s)i.uint32(18).string(n.protocols[s]);if(n.metadata!=null&&n.metadata.length)for(var s=0;s<n.metadata.length;++s)$root$2.Metadata.encode(n.metadata[s],i.uint32(26).fork()).ldelim();return n.pubKey!=null&&Object.hasOwnProperty.call(n,"pubKey")&&i.uint32(34).bytes(n.pubKey),n.peerRecordEnvelope!=null&&Object.hasOwnProperty.call(n,"peerRecordEnvelope")&&i.uint32(42).bytes(n.peerRecordEnvelope),i},r.decode=function(n,i){n instanceof $Reader$2||(n=$Reader$2.create(n));for(var s=i===void 0?n.len:n.pos+i,u=new $root$2.Peer;n.pos<s;){var c=n.uint32();switch(c>>>3){case 1:u.addresses&&u.addresses.length||(u.addresses=[]),u.addresses.push($root$2.Address.decode(n,n.uint32()));break;case 2:u.protocols&&u.protocols.length||(u.protocols=[]),u.protocols.push(n.string());break;case 3:u.metadata&&u.metadata.length||(u.metadata=[]),u.metadata.push($root$2.Metadata.decode(n,n.uint32()));break;case 4:u.pubKey=n.bytes();break;case 5:u.peerRecordEnvelope=n.bytes();break;default:n.skipType(c&7);break}}return u},r.fromObject=function(n){if(n instanceof $root$2.Peer)return n;var i=new $root$2.Peer;if(n.addresses){if(!Array.isArray(n.addresses))throw TypeError(".Peer.addresses: array expected");i.addresses=[];for(var s=0;s<n.addresses.length;++s){if(typeof n.addresses[s]!="object")throw TypeError(".Peer.addresses: object expected");i.addresses[s]=$root$2.Address.fromObject(n.addresses[s])}}if(n.protocols){if(!Array.isArray(n.protocols))throw TypeError(".Peer.protocols: array expected");i.protocols=[];for(var s=0;s<n.protocols.length;++s)i.protocols[s]=String(n.protocols[s])}if(n.metadata){if(!Array.isArray(n.metadata))throw TypeError(".Peer.metadata: array expected");i.metadata=[];for(var s=0;s<n.metadata.length;++s){if(typeof n.metadata[s]!="object")throw TypeError(".Peer.metadata: object expected");i.metadata[s]=$root$2.Metadata.fromObject(n.metadata[s])}}return n.pubKey!=null&&(typeof n.pubKey=="string"?$util$2.base64.decode(n.pubKey,i.pubKey=$util$2.newBuffer($util$2.base64.length(n.pubKey)),0):n.pubKey.length&&(i.pubKey=n.pubKey)),n.peerRecordEnvelope!=null&&(typeof n.peerRecordEnvelope=="string"?$util$2.base64.decode(n.peerRecordEnvelope,i.peerRecordEnvelope=$util$2.newBuffer($util$2.base64.length(n.peerRecordEnvelope)),0):n.peerRecordEnvelope.length&&(i.peerRecordEnvelope=n.peerRecordEnvelope)),i},r.toObject=function(n,i){i||(i={});var s={};if((i.arrays||i.defaults)&&(s.addresses=[],s.protocols=[],s.metadata=[]),n.addresses&&n.addresses.length){s.addresses=[];for(var u=0;u<n.addresses.length;++u)s.addresses[u]=$root$2.Address.toObject(n.addresses[u],i)}if(n.protocols&&n.protocols.length){s.protocols=[];for(var u=0;u<n.protocols.length;++u)s.protocols[u]=n.protocols[u]}if(n.metadata&&n.metadata.length){s.metadata=[];for(var u=0;u<n.metadata.length;++u)s.metadata[u]=$root$2.Metadata.toObject(n.metadata[u],i)}return n.pubKey!=null&&n.hasOwnProperty("pubKey")&&(s.pubKey=i.bytes===String?$util$2.base64.encode(n.pubKey,0,n.pubKey.length):i.bytes===Array?Array.prototype.slice.call(n.pubKey):n.pubKey,i.oneofs&&(s._pubKey="pubKey")),n.peerRecordEnvelope!=null&&n.hasOwnProperty("peerRecordEnvelope")&&(s.peerRecordEnvelope=i.bytes===String?$util$2.base64.encode(n.peerRecordEnvelope,0,n.peerRecordEnvelope.length):i.bytes===Array?Array.prototype.slice.call(n.peerRecordEnvelope):n.peerRecordEnvelope,i.oneofs&&(s._peerRecordEnvelope="peerRecordEnvelope")),s},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r})();$root$2.Address=(()=>{function r(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}r.prototype.multiaddr=$util$2.newBuffer([]),r.prototype.isCertified=null;let e;return Object.defineProperty(r.prototype,"_isCertified",{get:$util$2.oneOfGetter(e=["isCertified"]),set:$util$2.oneOfSetter(e)}),r.encode=function(n,i){return i||(i=$Writer$2.create()),n.multiaddr!=null&&Object.hasOwnProperty.call(n,"multiaddr")&&i.uint32(10).bytes(n.multiaddr),n.isCertified!=null&&Object.hasOwnProperty.call(n,"isCertified")&&i.uint32(16).bool(n.isCertified),i},r.decode=function(n,i){n instanceof $Reader$2||(n=$Reader$2.create(n));for(var s=i===void 0?n.len:n.pos+i,u=new $root$2.Address;n.pos<s;){var c=n.uint32();switch(c>>>3){case 1:u.multiaddr=n.bytes();break;case 2:u.isCertified=n.bool();break;default:n.skipType(c&7);break}}return u},r.fromObject=function(n){if(n instanceof $root$2.Address)return n;var i=new $root$2.Address;return n.multiaddr!=null&&(typeof n.multiaddr=="string"?$util$2.base64.decode(n.multiaddr,i.multiaddr=$util$2.newBuffer($util$2.base64.length(n.multiaddr)),0):n.multiaddr.length&&(i.multiaddr=n.multiaddr)),n.isCertified!=null&&(i.isCertified=!!n.isCertified),i},r.toObject=function(n,i){i||(i={});var s={};return i.defaults&&(i.bytes===String?s.multiaddr="":(s.multiaddr=[],i.bytes!==Array&&(s.multiaddr=$util$2.newBuffer(s.multiaddr)))),n.multiaddr!=null&&n.hasOwnProperty("multiaddr")&&(s.multiaddr=i.bytes===String?$util$2.base64.encode(n.multiaddr,0,n.multiaddr.length):i.bytes===Array?Array.prototype.slice.call(n.multiaddr):n.multiaddr),n.isCertified!=null&&n.hasOwnProperty("isCertified")&&(s.isCertified=n.isCertified,i.oneofs&&(s._isCertified="isCertified")),s},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r})();$root$2.Metadata=(()=>{function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.key="",r.prototype.value=$util$2.newBuffer([]),r.encode=function(t,n){return n||(n=$Writer$2.create()),t.key!=null&&Object.hasOwnProperty.call(t,"key")&&n.uint32(10).string(t.key),t.value!=null&&Object.hasOwnProperty.call(t,"value")&&n.uint32(18).bytes(t.value),n},r.decode=function(t,n){t instanceof $Reader$2||(t=$Reader$2.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new $root$2.Metadata;t.pos<i;){var u=t.uint32();switch(u>>>3){case 1:s.key=t.string();break;case 2:s.value=t.bytes();break;default:t.skipType(u&7);break}}return s},r.fromObject=function(t){if(t instanceof $root$2.Metadata)return t;var n=new $root$2.Metadata;return t.key!=null&&(n.key=String(t.key)),t.value!=null&&(typeof t.value=="string"?$util$2.base64.decode(t.value,n.value=$util$2.newBuffer($util$2.base64.length(t.value)),0):t.value.length&&(n.value=t.value)),n},r.toObject=function(t,n){n||(n={});var i={};return n.defaults&&(i.key="",n.bytes===String?i.value="":(i.value=[],n.bytes!==Array&&(i.value=$util$2.newBuffer(i.value)))),t.key!=null&&t.hasOwnProperty("key")&&(i.key=t.key),t.value!=null&&t.hasOwnProperty("value")&&(i.value=n.bytes===String?$util$2.base64.encode(t.value,0,t.value.length):n.bytes===Array?Array.prototype.slice.call(t.value):t.value),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r})();const $Reader$1=$protobuf.Reader,$Writer$1=$protobuf.Writer,$util$1=$protobuf.util,$root$1=$protobuf.roots.default||($protobuf.roots.default={}),Envelope=$root$1.Envelope=(()=>{function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.publicKey=$util$1.newBuffer([]),r.prototype.payloadType=$util$1.newBuffer([]),r.prototype.payload=$util$1.newBuffer([]),r.prototype.signature=$util$1.newBuffer([]),r.encode=function(t,n){return n||(n=$Writer$1.create()),t.publicKey!=null&&Object.hasOwnProperty.call(t,"publicKey")&&n.uint32(10).bytes(t.publicKey),t.payloadType!=null&&Object.hasOwnProperty.call(t,"payloadType")&&n.uint32(18).bytes(t.payloadType),t.payload!=null&&Object.hasOwnProperty.call(t,"payload")&&n.uint32(26).bytes(t.payload),t.signature!=null&&Object.hasOwnProperty.call(t,"signature")&&n.uint32(42).bytes(t.signature),n},r.decode=function(t,n){t instanceof $Reader$1||(t=$Reader$1.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new $root$1.Envelope;t.pos<i;){var u=t.uint32();switch(u>>>3){case 1:s.publicKey=t.bytes();break;case 2:s.payloadType=t.bytes();break;case 3:s.payload=t.bytes();break;case 5:s.signature=t.bytes();break;default:t.skipType(u&7);break}}return s},r.fromObject=function(t){if(t instanceof $root$1.Envelope)return t;var n=new $root$1.Envelope;return t.publicKey!=null&&(typeof t.publicKey=="string"?$util$1.base64.decode(t.publicKey,n.publicKey=$util$1.newBuffer($util$1.base64.length(t.publicKey)),0):t.publicKey.length&&(n.publicKey=t.publicKey)),t.payloadType!=null&&(typeof t.payloadType=="string"?$util$1.base64.decode(t.payloadType,n.payloadType=$util$1.newBuffer($util$1.base64.length(t.payloadType)),0):t.payloadType.length&&(n.payloadType=t.payloadType)),t.payload!=null&&(typeof t.payload=="string"?$util$1.base64.decode(t.payload,n.payload=$util$1.newBuffer($util$1.base64.length(t.payload)),0):t.payload.length&&(n.payload=t.payload)),t.signature!=null&&(typeof t.signature=="string"?$util$1.base64.decode(t.signature,n.signature=$util$1.newBuffer($util$1.base64.length(t.signature)),0):t.signature.length&&(n.signature=t.signature)),n},r.toObject=function(t,n){n||(n={});var i={};return n.defaults&&(n.bytes===String?i.publicKey="":(i.publicKey=[],n.bytes!==Array&&(i.publicKey=$util$1.newBuffer(i.publicKey))),n.bytes===String?i.payloadType="":(i.payloadType=[],n.bytes!==Array&&(i.payloadType=$util$1.newBuffer(i.payloadType))),n.bytes===String?i.payload="":(i.payload=[],n.bytes!==Array&&(i.payload=$util$1.newBuffer(i.payload))),n.bytes===String?i.signature="":(i.signature=[],n.bytes!==Array&&(i.signature=$util$1.newBuffer(i.signature)))),t.publicKey!=null&&t.hasOwnProperty("publicKey")&&(i.publicKey=n.bytes===String?$util$1.base64.encode(t.publicKey,0,t.publicKey.length):n.bytes===Array?Array.prototype.slice.call(t.publicKey):t.publicKey),t.payloadType!=null&&t.hasOwnProperty("payloadType")&&(i.payloadType=n.bytes===String?$util$1.base64.encode(t.payloadType,0,t.payloadType.length):n.bytes===Array?Array.prototype.slice.call(t.payloadType):t.payloadType),t.payload!=null&&t.hasOwnProperty("payload")&&(i.payload=n.bytes===String?$util$1.base64.encode(t.payload,0,t.payload.length):n.bytes===Array?Array.prototype.slice.call(t.payload):t.payload),t.signature!=null&&t.hasOwnProperty("signature")&&(i.signature=n.bytes===String?$util$1.base64.encode(t.signature,0,t.signature.length):n.bytes===Array?Array.prototype.slice.call(t.signature):t.signature),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r})(),$Reader=$protobuf.Reader,$Writer=$protobuf.Writer,$util=$protobuf.util,$root=$protobuf.roots.default||($protobuf.roots.default={}),PeerRecord=$root.PeerRecord=(()=>{function r(e){if(this.addresses=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.peerId=$util.newBuffer([]),r.prototype.seq=$util.Long?$util.Long.fromBits(0,0,!0):0,r.prototype.addresses=$util.emptyArray,r.encode=function(t,n){if(n||(n=$Writer.create()),t.peerId!=null&&Object.hasOwnProperty.call(t,"peerId")&&n.uint32(10).bytes(t.peerId),t.seq!=null&&Object.hasOwnProperty.call(t,"seq")&&n.uint32(16).uint64(t.seq),t.addresses!=null&&t.addresses.length)for(var i=0;i<t.addresses.length;++i)$root.PeerRecord.AddressInfo.encode(t.addresses[i],n.uint32(26).fork()).ldelim();return n},r.decode=function(t,n){t instanceof $Reader||(t=$Reader.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new $root.PeerRecord;t.pos<i;){var u=t.uint32();switch(u>>>3){case 1:s.peerId=t.bytes();break;case 2:s.seq=t.uint64();break;case 3:s.addresses&&s.addresses.length||(s.addresses=[]),s.addresses.push($root.PeerRecord.AddressInfo.decode(t,t.uint32()));break;default:t.skipType(u&7);break}}return s},r.fromObject=function(t){if(t instanceof $root.PeerRecord)return t;var n=new $root.PeerRecord;if(t.peerId!=null&&(typeof t.peerId=="string"?$util.base64.decode(t.peerId,n.peerId=$util.newBuffer($util.base64.length(t.peerId)),0):t.peerId.length&&(n.peerId=t.peerId)),t.seq!=null&&($util.Long?(n.seq=$util.Long.fromValue(t.seq)).unsigned=!0:typeof t.seq=="string"?n.seq=parseInt(t.seq,10):typeof t.seq=="number"?n.seq=t.seq:typeof t.seq=="object"&&(n.seq=new $util.LongBits(t.seq.low>>>0,t.seq.high>>>0).toNumber(!0))),t.addresses){if(!Array.isArray(t.addresses))throw TypeError(".PeerRecord.addresses: array expected");n.addresses=[];for(var i=0;i<t.addresses.length;++i){if(typeof t.addresses[i]!="object")throw TypeError(".PeerRecord.addresses: object expected");n.addresses[i]=$root.PeerRecord.AddressInfo.fromObject(t.addresses[i])}}return n},r.toObject=function(t,n){n||(n={});var i={};if((n.arrays||n.defaults)&&(i.addresses=[]),n.defaults)if(n.bytes===String?i.peerId="":(i.peerId=[],n.bytes!==Array&&(i.peerId=$util.newBuffer(i.peerId))),$util.Long){var s=new $util.Long(0,0,!0);i.seq=n.longs===String?s.toString():n.longs===Number?s.toNumber():s}else i.seq=n.longs===String?"0":0;if(t.peerId!=null&&t.hasOwnProperty("peerId")&&(i.peerId=n.bytes===String?$util.base64.encode(t.peerId,0,t.peerId.length):n.bytes===Array?Array.prototype.slice.call(t.peerId):t.peerId),t.seq!=null&&t.hasOwnProperty("seq")&&(typeof t.seq=="number"?i.seq=n.longs===String?String(t.seq):t.seq:i.seq=n.longs===String?$util.Long.prototype.toString.call(t.seq):n.longs===Number?new $util.LongBits(t.seq.low>>>0,t.seq.high>>>0).toNumber(!0):t.seq),t.addresses&&t.addresses.length){i.addresses=[];for(var u=0;u<t.addresses.length;++u)i.addresses[u]=$root.PeerRecord.AddressInfo.toObject(t.addresses[u],n)}return i},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r.AddressInfo=function(){function e(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.multiaddr=$util.newBuffer([]),e.encode=function(n,i){return i||(i=$Writer.create()),n.multiaddr!=null&&Object.hasOwnProperty.call(n,"multiaddr")&&i.uint32(10).bytes(n.multiaddr),i},e.decode=function(n,i){n instanceof $Reader||(n=$Reader.create(n));for(var s=i===void 0?n.len:n.pos+i,u=new $root.PeerRecord.AddressInfo;n.pos<s;){var c=n.uint32();switch(c>>>3){case 1:u.multiaddr=n.bytes();break;default:n.skipType(c&7);break}}return u},e.fromObject=function(n){if(n instanceof $root.PeerRecord.AddressInfo)return n;var i=new $root.PeerRecord.AddressInfo;return n.multiaddr!=null&&(typeof n.multiaddr=="string"?$util.base64.decode(n.multiaddr,i.multiaddr=$util.newBuffer($util.base64.length(n.multiaddr)),0):n.multiaddr.length&&(i.multiaddr=n.multiaddr)),i},e.toObject=function(n,i){i||(i={});var s={};return i.defaults&&(i.bytes===String?s.multiaddr="":(s.multiaddr=[],i.bytes!==Array&&(s.multiaddr=$util.newBuffer(s.multiaddr)))),n.multiaddr!=null&&n.hasOwnProperty("multiaddr")&&(s.multiaddr=i.bytes===String?$util.base64.encode(n.multiaddr,0,n.multiaddr.length):i.bytes===Array?Array.prototype.slice.call(n.multiaddr):n.multiaddr),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),r})();class Parser{constructor(){ns(this,"index",0);ns(this,"input","")}new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,n=e();return n===void 0&&(this.index=t),n}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{const t=this.readChar();if(t===e)return t})}readSeparator(e,t,n){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,t,n,i){return this.readAtomically(()=>{let s=0,u=0;const c=this.peekChar();if(c===void 0)return;const d=c==="0",g=2**(8*i)-1;for(;;){const _=this.readAtomically(()=>{const f=this.readChar();if(f===void 0)return;const l=Number.parseInt(f,e);if(!Number.isNaN(l))return l});if(_===void 0)break;if(s*=e,s+=_,s>g||(u+=1,t!==void 0&&u>t))return}if(u!==0)return!n&&d&&u>1?void 0:s})}readIPv4Addr(){return this.readAtomically(()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const n=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[t]=n}return e})}readIPv6Addr(){const e=t=>{for(let n=0;n<t.length/2;n++){const i=n*2;if(n<t.length-3){const u=this.readSeparator(":",n,()=>this.readIPv4Addr());if(u!==void 0)return t[i]=u[0],t[i+1]=u[1],t[i+2]=u[2],t[i+3]=u[3],[i+4,!0]}const s=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(s===void 0)return[i,!1];t[i]=s>>8,t[i+1]=s&255}return[t.length,!1]};return this.readAtomically(()=>{const t=new Uint8Array(16),[n,i]=e(t);if(n===16)return t;if(i||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;const s=new Uint8Array(14),u=16-(n+2),[c]=e(s.subarray(0,u));return t.set(s.subarray(0,c),16-c),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}const MAX_IPV6_LENGTH=45,MAX_IPV4_LENGTH=15,parser=new Parser;function parseIPv4(r){if(!(r.length>MAX_IPV4_LENGTH))return parser.new(r).parseWith(()=>parser.readIPv4Addr())}function parseIPv6(r){if(!(r.length>MAX_IPV6_LENGTH))return parser.new(r).parseWith(()=>parser.readIPv6Addr())}function parseIP(r){if(!(r.length>MAX_IPV6_LENGTH))return parser.new(r).parseWith(()=>parser.readIPAddr())}function isIPv4(r){return!!parseIPv4(r)}function isIPv6(r){return!!parseIPv6(r)}function isIP(r){return!!parseIP(r)}function base$1(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),u=s.charCodeAt(0);if(t[u]!==255)throw new TypeError(s+" is ambiguous");t[u]=i}var c=r.length,d=r.charAt(0),g=Math.log(c)/Math.log(256),_=Math.log(256)/Math.log(c);function f(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var y=0,w=0,v=0,C=p.length;v!==C&&p[v]===0;)v++,y++;for(var P=(C-v)*_+1>>>0,R=new Uint8Array(P);v!==C;){for(var F=p[v],k=0,B=P-1;(F!==0||k<w)&&B!==-1;B--,k++)F+=256*R[B]>>>0,R[B]=F%c>>>0,F=F/c>>>0;if(F!==0)throw new Error("Non-zero carry");w=k,v++}for(var H=P-w;H!==P&&R[H]===0;)H++;for(var re=d.repeat(y);H<P;++H)re+=r.charAt(R[H]);return re}function l(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var y=0;if(p[y]!==" "){for(var w=0,v=0;p[y]===d;)w++,y++;for(var C=(p.length-y)*g+1>>>0,P=new Uint8Array(C);p[y];){var R=t[p.charCodeAt(y)];if(R===255)return;for(var F=0,k=C-1;(R!==0||F<v)&&k!==-1;k--,F++)R+=c*P[k]>>>0,P[k]=R%256>>>0,R=R/256>>>0;if(R!==0)throw new Error("Non-zero carry");v=F,y++}if(p[y]!==" "){for(var B=C-v;B!==C&&P[B]===0;)B++;for(var H=new Uint8Array(w+(C-B)),re=w;B!==C;)H[re++]=P[B++];return H}}}function h(p){var y=l(p);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:l,decode:h}}var src$1=base$1,_brrp__multiformats_scope_baseX$1=src$1;const equals$2=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},coerce$1=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},fromString$2=r=>new TextEncoder().encode(r),toString$3=r=>new TextDecoder().decode(r);let Encoder$1=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Decoder$1=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or$1(this,e)}},ComposedDecoder$1=class{constructor(e){this.decoders=e}or(e){return or$1(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const or$1=(r,e)=>new ComposedDecoder$1({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let Codec$1=class{constructor(e,t,n,i){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Encoder$1(e,t,n),this.decoder=new Decoder$1(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const from$1=({name:r,prefix:e,encode:t,decode:n})=>new Codec$1(r,e,t,n),baseX$1=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:i}=_brrp__multiformats_scope_baseX$1(t,e);return from$1({prefix:r,name:e,encode:n,decode:s=>coerce$1(i(s))})},decode$5=(r,e,t,n)=>{const i={};for(let _=0;_<e.length;++_)i[e[_]]=_;let s=r.length;for(;r[s-1]==="=";)--s;const u=new Uint8Array(s*t/8|0);let c=0,d=0,g=0;for(let _=0;_<s;++_){const f=i[r[_]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);d=d<<t|f,c+=t,c>=8&&(c-=8,u[g++]=255&d>>c)}if(c>=t||255&d<<8-c)throw new SyntaxError("Unexpected end of data");return u},encode$3=(r,e,t)=>{const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",u=0,c=0;for(let d=0;d<r.length;++d)for(c=c<<8|r[d],u+=8;u>t;)u-=t,s+=e[i&c>>u];if(u&&(s+=e[i&c<<t-u]),n)for(;s.length*t&7;)s+="=";return s},rfc4648$1=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>from$1({prefix:e,name:r,encode(i){return encode$3(i,n,t)},decode(i){return decode$5(i,n,t,r)}}),identity=from$1({prefix:"\0",name:"identity",encode:r=>toString$3(r),decode:r=>fromString$2(r)}),identityBase=Object.freeze(Object.defineProperty({__proto__:null,identity},Symbol.toStringTag,{value:"Module"})),base2=rfc4648$1({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$1=Object.freeze(Object.defineProperty({__proto__:null,base2},Symbol.toStringTag,{value:"Module"})),base8=rfc4648$1({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$1=Object.freeze(Object.defineProperty({__proto__:null,base8},Symbol.toStringTag,{value:"Module"})),base10=baseX$1({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$1=Object.freeze(Object.defineProperty({__proto__:null,base10},Symbol.toStringTag,{value:"Module"})),base16=rfc4648$1({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper=rfc4648$1({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$1=Object.freeze(Object.defineProperty({__proto__:null,base16,base16upper},Symbol.toStringTag,{value:"Module"})),base32$1=rfc4648$1({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper=rfc4648$1({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad=rfc4648$1({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper=rfc4648$1({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex=rfc4648$1({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper=rfc4648$1({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad=rfc4648$1({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper=rfc4648$1({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z=rfc4648$1({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$2=Object.freeze(Object.defineProperty({__proto__:null,base32:base32$1,base32hex,base32hexpad,base32hexpadupper,base32hexupper,base32pad,base32padupper,base32upper,base32z},Symbol.toStringTag,{value:"Module"})),base36=baseX$1({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper=baseX$1({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$1=Object.freeze(Object.defineProperty({__proto__:null,base36,base36upper},Symbol.toStringTag,{value:"Module"})),base58btc$1=baseX$1({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr=baseX$1({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58=Object.freeze(Object.defineProperty({__proto__:null,base58btc:base58btc$1,base58flickr},Symbol.toStringTag,{value:"Module"})),base64$1=rfc4648$1({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad=rfc4648$1({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url=rfc4648$1({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad=rfc4648$1({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$2=Object.freeze(Object.defineProperty({__proto__:null,base64:base64$1,base64pad,base64url,base64urlpad},Symbol.toStringTag,{value:"Module"})),alphabet=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),alphabetBytesToChars=alphabet.reduce((r,e,t)=>(r[t]=e,r),[]),alphabetCharsToBytes=alphabet.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function encode$2(r){return r.reduce((e,t)=>(e+=alphabetBytesToChars[t],e),"")}function decode$4(r){const e=[];for(const t of r){const n=alphabetCharsToBytes[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const base256emoji=from$1({prefix:"🚀",name:"base256emoji",encode:encode$2,decode:decode$4}),base256emoji$1=Object.freeze(Object.defineProperty({__proto__:null,base256emoji},Symbol.toStringTag,{value:"Module"}));var encode_1=encode$1,MSB=128,MSBALL=-128,INT=Math.pow(2,31);function encode$1(r,e,t){e=e||[],t=t||0;for(var n=t;r>=INT;)e[t++]=r&255|MSB,r/=128;for(;r&MSBALL;)e[t++]=r&255|MSB,r>>>=7;return e[t]=r|0,encode$1.bytes=t-n+1,e}var decode$3=read,MSB$1=128,REST$1=127;function read(r,n){var t=0,n=n||0,i=0,s=n,u,c=r.length;do{if(s>=c)throw read.bytes=0,new RangeError("Could not decode varint");u=r[s++],t+=i<28?(u&REST$1)<<i:(u&REST$1)*Math.pow(2,i),i+=7}while(u>=MSB$1);return read.bytes=s-n,t}var N1=Math.pow(2,7),N2=Math.pow(2,14),N3=Math.pow(2,21),N4=Math.pow(2,28),N5=Math.pow(2,35),N6=Math.pow(2,42),N7=Math.pow(2,49),N8=Math.pow(2,56),N9=Math.pow(2,63),length=function(r){return r<N1?1:r<N2?2:r<N3?3:r<N4?4:r<N5?5:r<N6?6:r<N7?7:r<N8?8:r<N9?9:10},varint={encode:encode_1,decode:decode$3,encodingLength:length},_brrp_varint=varint;const decode$2=(r,e=0)=>[_brrp_varint.decode(r,e),_brrp_varint.decode.bytes],encodeTo=(r,e,t=0)=>(_brrp_varint.encode(r,e,t),e),encodingLength=r=>_brrp_varint.encodingLength(r),create$2=(r,e)=>{const t=e.byteLength,n=encodingLength(r),i=n+encodingLength(t),s=new Uint8Array(i+t);return encodeTo(r,s,0),encodeTo(t,s,n),s.set(e,i),new Digest(r,t,e,s)},decode$1=r=>{const e=coerce$1(r),[t,n]=decode$2(e),[i,s]=decode$2(e.subarray(n)),u=e.subarray(n+s);if(u.byteLength!==i)throw new Error("Incorrect length");return new Digest(t,i,u,e)},equals$1=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&equals$2(r.bytes,t.bytes)}};class Digest{constructor(e,t,n,i){this.code=e,this.size=t,this.digest=n,this.bytes=i}}new TextEncoder;new TextDecoder;const format=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return toStringV0(t,baseCache(r),e||base58btc$1.encoder);default:return toStringV1(t,baseCache(r),e||base32$1.encoder)}},cache=new WeakMap,baseCache=r=>{const e=cache.get(r);if(e==null){const t=new Map;return cache.set(r,t),t}return e};class CID{constructor(e,t,n,i){this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return CID.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=create$2(e,t);return CID.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return CID.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&equals$1(e.multihash,n.multihash)}toString(e){return format(this,e)}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof CID)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:u}=t;return new CID(n,i,s,u||encodeCID(n,i,s.bytes))}else if(t[cidSymbol]===!0){const{version:n,multihash:i,code:s}=t,u=decode$1(i);return CID.create(n,s,u)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${DAG_PB_CODE}) block encoding`);return new CID(e,t,n,n.bytes)}case 1:{const i=encodeCID(e,t,n.bytes);return new CID(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return CID.create(0,DAG_PB_CODE,e)}static createV1(e,t){return CID.create(1,e,t)}static decode(e){const[t,n]=CID.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=CID.inspectBytes(e),n=t.size-t.multihashSize,i=coerce$1(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),u=new Digest(t.multihashCode,t.digestSize,s,i);return[t.version===0?CID.createV0(u):CID.createV1(t.codec,u),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[f,l]=decode$2(e.subarray(t));return t+=l,f};let i=n(),s=DAG_PB_CODE;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const u=t,c=n(),d=n(),g=t+d,_=g-u;return{version:i,codec:s,multihashCode:c,digestSize:d,multihashSize:_,size:g}}static parse(e,t){const[n,i]=parseCIDtoBytes(e,t),s=CID.decode(i);return baseCache(s).set(n,e),s}}const parseCIDtoBytes=(r,e)=>{switch(r[0]){case"Q":{const t=e||base58btc$1;return[base58btc$1.prefix,t.decode(`${base58btc$1.prefix}${r}`)]}case base58btc$1.prefix:{const t=e||base58btc$1;return[base58btc$1.prefix,t.decode(r)]}case base32$1.prefix:{const t=e||base32$1;return[base32$1.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},toStringV0=(r,e,t)=>{const{prefix:n}=t;if(n!==base58btc$1.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i},toStringV1=(r,e,t)=>{const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i},DAG_PB_CODE=112,SHA_256_CODE=18,encodeCID=(r,e,t)=>{const n=encodingLength(r),i=n+encodingLength(e),s=new Uint8Array(i+t.byteLength);return encodeTo(r,s,0),encodeTo(e,s,n),s.set(t,i),s},cidSymbol=Symbol.for("@ipld/js-cid/CID"),bases={...identityBase,...base2$1,...base8$1,...base10$1,...base16$1,...base32$2,...base36$1,...base58,...base64$2,...base256emoji$1};function asUint8Array(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function allocUnsafe(r=0){var e;return((e=globalThis.Buffer)==null?void 0:e.allocUnsafe)!=null?asUint8Array(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function createCodec(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}const string=createCodec("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),ascii=createCodec("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=allocUnsafe(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),BASES={utf8:string,"utf-8":string,hex:bases.base16,latin1:ascii,ascii,binary:ascii,...bases};function toString$2(r,e="utf8"){const t=BASES[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}const isV4=isIPv4,isV6=isIPv6,toBytes$1=function(r){let e=0;if(r=r.toString().trim(),isV4(r)){const t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(isV6(r)){const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const s=isV4(t[n]);let u;s&&(u=toBytes$1(t[n]),t[n]=toString$2(u.slice(0,2),"base16")),u!=null&&++n<8&&t.splice(n,0,toString$2(u.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const s=[n,1];for(n=9-t.length;n>0;n--)s.push("0");t.splice.apply(t,s)}const i=new Uint8Array(e+16);for(n=0;n<t.length;n++){const s=parseInt(t[n],16);i[e++]=s>>8&255,i[e++]=s&255}return i}throw new Error("invalid ip address")},toString$1=function(r,e=0,t){e=~~e,t=t??r.length-e;const n=new DataView(r.buffer);if(t===4){const i=[];for(let s=0;s<t;s++)i.push(r[e+s]);return i.join(".")}if(t===16){const i=[];for(let s=0;s<t;s+=2)i.push(n.getUint16(e+s).toString(16));return i.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},V=-1,names={},codes={},table=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,V,"ip6zone"],[53,V,"dns",!0],[54,V,"dns4",!0],[55,V,"dns6",!0],[56,V,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,V,"unix",!1,!0],[421,V,"ipfs"],[421,V,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,V,"garlic64"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,V,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,V,"memory"]];table.forEach(r=>{const e=createProtocol(...r);codes[e.code]=e,names[e.name]=e});function createProtocol(r,e,t,n,i){return{code:r,size:e,name:t,resolvable:!!n,path:!!i}}function getProtocol(r){if(typeof r=="number"){if(codes[r]!=null)return codes[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(names[r]!=null)return names[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}function fromString$1(r,e="utf8"){const t=BASES[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?asUint8Array(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}function concat(r,e){e==null&&(e=r.reduce((i,s)=>i+s.length,0));const t=allocUnsafe(e);let n=0;for(const i of r)t.set(i,n),n+=i.length;return asUint8Array(t)}function convertToString(r,e){switch(getProtocol(r).code){case 4:case 41:return bytes2ip(e);case 6:case 273:case 33:case 132:return bytes2port(e).toString();case 53:case 54:case 55:case 56:case 400:case 777:return bytes2str(e);case 421:return bytes2mh(e);case 444:return bytes2onion(e);case 445:return bytes2onion(e);case 466:return bytes2mb(e);default:return toString$2(e,"base16")}}function convertToBytes(r,e){switch(getProtocol(r).code){case 4:return ip2bytes(e);case 41:return ip2bytes(e);case 6:case 273:case 33:case 132:return port2bytes(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 777:return str2bytes(e);case 421:return mh2bytes(e);case 444:return onion2bytes(e);case 445:return onion32bytes(e);case 466:return mb2bytes(e);default:return fromString$1(e,"base16")}}const decoders=Object.values(bases).map(r=>r.decoder),anybaseDecoder=function(){let r=decoders[0].or(decoders[1]);return decoders.slice(2).forEach(e=>r=r.or(e)),r}();function ip2bytes(r){if(!isIP(r))throw new Error("invalid ip address");return toBytes$1(r)}function bytes2ip(r){const e=toString$1(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!isIP(e))throw new Error("invalid ip address");return e}function port2bytes(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function bytes2port(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function str2bytes(r){const e=fromString$1(r),t=Uint8Array.from(varint$1.encode(e.length));return concat([t,e],t.length+e.length)}function bytes2str(r){const e=varint$1.decode(r);if(r=r.slice(varint$1.decode.bytes),r.length!==e)throw new Error("inconsistent lengths");return toString$2(r)}function mh2bytes(r){let e;r[0]==="Q"||r[0]==="1"?e=decode$1(base58btc$1.decode(`z${r}`)).bytes:e=CID.parse(r).multihash.bytes;const t=Uint8Array.from(varint$1.encode(e.length));return concat([t,e],t.length+e.length)}function mb2bytes(r){const e=anybaseDecoder.decode(r),t=Uint8Array.from(varint$1.encode(e.length));return concat([t,e],t.length+e.length)}function bytes2mb(r){const e=varint$1.decode(r),t=r.slice(varint$1.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return"u"+toString$2(t,"base64url")}function bytes2mh(r){const e=varint$1.decode(r),t=r.slice(varint$1.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return toString$2(t,"base58btc")}function onion2bytes(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=base32$1.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=port2bytes(n);return concat([t,i],t.length+i.length)}function onion32bytes(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=base32$1.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=port2bytes(n);return concat([t,i],t.length+i.length)}function bytes2onion(r){const e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=toString$2(e,"base32"),i=bytes2port(t);return`${n}:${i}`}function stringToStringTuples(r){const e=[],t=r.split("/").slice(1);if(t.length===1&&t[0]==="")return[];for(let n=0;n<t.length;n++){const i=t[n],s=getProtocol(i);if(s.size===0){e.push([i]);continue}if(n++,n>=t.length)throw ParseError("invalid address: "+r);if(s.path===!0){e.push([i,cleanPath(t.slice(n).join("/"))]);break}e.push([i,t[n]])}return e}function stringTuplesToString(r){const e=[];return r.map(t=>{const n=protoFromTuple(t);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),cleanPath(e.join("/"))}function stringTuplesToTuples(r){return r.map(e=>{Array.isArray(e)||(e=[e]);const t=protoFromTuple(e);return e.length>1?[t.code,convertToBytes(t.code,e[1])]:[t.code]})}function tuplesToStringTuples(r){return r.map(e=>{const t=protoFromTuple(e);return e[1]!=null?[t.code,convertToString(t.code,e[1])]:[t.code]})}function tuplesToBytes(r){return fromBytes$1(concat(r.map(e=>{const t=protoFromTuple(e);let n=Uint8Array.from(varint$1.encode(t.code));return e.length>1&&e[1]!=null&&(n=concat([n,e[1]])),n})))}function sizeForAddr(r,e){return r.size>0?r.size/8:r.size===0?0:varint$1.decode(e)+(varint$1.decode.bytes??0)}function bytesToTuples(r){const e=[];let t=0;for(;t<r.length;){const n=varint$1.decode(r,t),i=varint$1.decode.bytes??0,s=getProtocol(n),u=sizeForAddr(s,r.slice(t+i));if(u===0){e.push([n]),t+=i;continue}const c=r.slice(t+i,t+i+u);if(t+=u+i,t>r.length)throw ParseError("Invalid address Uint8Array: "+toString$2(r,"base16"));e.push([n,c])}return e}function bytesToString(r){const e=bytesToTuples(r),t=tuplesToStringTuples(e);return stringTuplesToString(t)}function stringToBytes(r){r=cleanPath(r);const e=stringToStringTuples(r),t=stringTuplesToTuples(e);return tuplesToBytes(t)}function fromString(r){return stringToBytes(r)}function fromBytes$1(r){const e=validateBytes(r);if(e!=null)throw e;return Uint8Array.from(r)}function validateBytes(r){try{bytesToTuples(r)}catch(e){return e}}function cleanPath(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function ParseError(r){return new Error("Error parsing address: "+r)}function protoFromTuple(r){return getProtocol(r[0])}function equals(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}var __classPrivateFieldGet$2=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},__classPrivateFieldSet$1=function(r,e,t,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(r,t):i?i.value=t:e.set(r,t),t},_DefaultMultiaddr_string,_DefaultMultiaddr_tuples,_DefaultMultiaddr_stringTuples,_a;const inspect=Symbol.for("nodejs.util.inspect.custom"),DNS_CODES=[getProtocol("dns").code,getProtocol("dns4").code,getProtocol("dns6").code,getProtocol("dnsaddr").code],P2P_CODES=[getProtocol("p2p").code,getProtocol("ipfs").code],resolvers=new Map,symbol=Symbol.for("@multiformats/js-multiaddr/multiaddr");function isMultiaddr(r){return!!(r!=null&&r[symbol])}class DefaultMultiaddr{constructor(e){if(_DefaultMultiaddr_string.set(this,void 0),_DefaultMultiaddr_tuples.set(this,void 0),_DefaultMultiaddr_stringTuples.set(this,void 0),this[_a]=!0,e==null&&(e=""),e instanceof Uint8Array)this.bytes=fromBytes$1(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=fromString(e)}else if(isMultiaddr(e))this.bytes=fromBytes$1(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return __classPrivateFieldGet$2(this,_DefaultMultiaddr_string,"f")==null&&__classPrivateFieldSet$1(this,_DefaultMultiaddr_string,bytesToString(this.bytes),"f"),__classPrivateFieldGet$2(this,_DefaultMultiaddr_string,"f")}toJSON(){return this.toString()}toOptions(){const e=this.protoCodes(),t=this.toString().split("/").slice(1);let n,i;if(t.length>2)DNS_CODES.includes(e[0])&&P2P_CODES.includes(e[1])?(n=getProtocol("tcp").name,i=443):(n=getProtocol(t[2]).name,i=parseInt(t[3]));else if(DNS_CODES.includes(e[0]))n=getProtocol("tcp").name,i=443;else throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e[0]===41||e[0]===55?6:4,host:t[1],transport:n,port:i}}protos(){return this.protoCodes().map(e=>Object.assign({},getProtocol(e)))}protoCodes(){const e=[],t=this.bytes;let n=0;for(;n<t.length;){const i=varint$1.decode(t,n),s=varint$1.decode.bytes??0,u=getProtocol(i),c=sizeForAddr(u,t.slice(n+s));n+=c+s,e.push(i)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return __classPrivateFieldGet$2(this,_DefaultMultiaddr_tuples,"f")==null&&__classPrivateFieldSet$1(this,_DefaultMultiaddr_tuples,bytesToTuples(this.bytes),"f"),__classPrivateFieldGet$2(this,_DefaultMultiaddr_tuples,"f")}stringTuples(){return __classPrivateFieldGet$2(this,_DefaultMultiaddr_stringTuples,"f")==null&&__classPrivateFieldSet$1(this,_DefaultMultiaddr_stringTuples,tuplesToStringTuples(this.tuples()),"f"),__classPrivateFieldGet$2(this,_DefaultMultiaddr_stringTuples,"f")}encapsulate(e){return e=new DefaultMultiaddr(e),new DefaultMultiaddr(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),i=n.lastIndexOf(t);if(i<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new DefaultMultiaddr(n.slice(0,i))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new DefaultMultiaddr(tuplesToBytes(t.slice(0,n)));return this}getPeerId(){try{const t=this.stringTuples().filter(n=>n[0]===names.ipfs.code).pop();if((t==null?void 0:t[1])!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?toString$2(base58btc$1.decode(`z${n}`),"base58btc"):toString$2(CID.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){let e=null;try{e=this.stringTuples().filter(t=>getProtocol(t[0]).path===!0)[0][1],e==null&&(e=null)}catch{e=null}return e}equals(e){return equals(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(s=>s.resolvable);if(t==null)return[this];const n=resolvers.get(t.name);if(n==null)throw errcode(new Error(`no available resolver for ${t.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(s=>new DefaultMultiaddr(s))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(_DefaultMultiaddr_string=new WeakMap,_DefaultMultiaddr_tuples=new WeakMap,_DefaultMultiaddr_stringTuples=new WeakMap,_a=symbol,inspect)](){return`Multiaddr(${bytesToString(this.bytes)})`}}function multiaddr(r){return new DefaultMultiaddr(r)}$protobuf.util.Long=void 0;$protobuf.configure();async function storePeerUnderSingleDatastoreKey(r,e=()=>{}){e(0,"Storing each peerstore key under a single datastore key"),await r.datastore.open();const t={},n=[];for await(const{key:i,value:s}of r.datastore.query({prefix:"/peers"})){n.push(i);const u=i.toString(),[c,d,g,_,f]=u.split("/");if(d==="peers"&&["protos","addrs","metadata","keys"].includes(g)&&_)if(t[_]=t[_]||{addresses:[],protocols:[],metadata:[]},g==="protos"){const l=Protocols.decode(s);t[_].protocols=l.protocols.sort()}else if(g==="addrs"){const l=Addresses.decode(s);t[_].addresses=l.addrs.sort((h,p)=>multiaddr(h.multiaddr).toString().localeCompare(multiaddr(p.multiaddr).toString())),l.certifiedRecord&&l.certifiedRecord.raw&&(t[_].peerRecordEnvelope=l.certifiedRecord.raw)}else g==="metadata"?t[_].metadata.push({key:f,value:s}):g==="keys"&&(t[_].pubKey=s)}e(33,"Read peer data from store");for(const i of n)await r.datastore.delete(i);e(66,"Removed existing peer data from store");for(const i of Object.keys(t)){const s=t[i];s.metadata=s.metadata.sort((c,d)=>c.key.localeCompare(d.key));const u=Peer.encode(s).finish();await r.datastore.put(new Key(`/peers/${i}`),u)}await r.datastore.close(),e(100,"Stored each peerstore key under a single datastore key")}async function storePeerUnderMultipleDatastoreKeys(r,e=()=>{}){e(0,"Storing each peerstore key under a multiple datastore keys"),await r.datastore.open();const t={},n=[];for await(const{key:i,value:s}of r.datastore.query({prefix:"/peers"})){n.push(i);const u=i.toString(),[c,d,g]=u.split("/");t[g]=Peer.decode(s)}e(33,"Read peer data from store");for(const i of n)await r.datastore.delete(i);e(66,"Removed existing peer data from store");for(const[i,s]of Object.entries(t)){if(s.protocols&&s.protocols.length>0&&await r.datastore.put(new Key(`/peers/protos/${i}`),Protocols.encode({protocols:s.protocols}).finish()),s.addresses&&s.addresses.length>0){const u=s.peerRecordEnvelope;let c;if(u){const d=Envelope.decode(u),g=PeerRecord.decode(d.payload);c={raw:u,seq:g.seq}}await r.datastore.put(new Key(`/peers/addrs/${i}`),Addresses.encode({addrs:s.addresses,certifiedRecord:c}).finish())}if(s.metadata&&s.metadata.length>0)for(const{key:u,value:c}of s.metadata)await r.datastore.put(new Key(`/peers/metadata/${i}/${u}`),c);s.pubKey&&await r.datastore.put(new Key(`/peers/keys/${i}`),s.pubKey)}await r.datastore.close(),e(100,"Stored each peerstore key under multiple datastore keys")}const migration={version:12,description:"Store each peerstore peer under a single datastore key",migrate:storePeerUnderSingleDatastoreKey,revert:storePeerUnderMultipleDatastoreKeys},emptyMigration={description:"Empty migration.",migrate:()=>{},revert:()=>{},empty:!0},defaultMigrations=[Object.assign({version:1},emptyMigration),Object.assign({version:2},emptyMigration),Object.assign({version:3},emptyMigration),Object.assign({version:4},emptyMigration),Object.assign({version:5},emptyMigration),Object.assign({version:6},emptyMigration),Object.assign({version:7},emptyMigration),migration$4,migration$3,migration$2,migration$1,migration];class NonReversibleMigrationError extends Error{constructor(e){super(e),this.name="NonReversibleMigrationError",this.code=NonReversibleMigrationError.code,this.message=e}}NonReversibleMigrationError.code="ERR_NON_REVERSIBLE_MIGRATION";class NotInitializedRepoError extends Error{constructor(e){super(e),this.name="NotInitializedRepoError",this.code=NotInitializedRepoError.code,this.message=e}}NotInitializedRepoError.code="ERR_NOT_INITIALIZED_REPO";class RequiredParameterError extends Error{constructor(e){super(e),this.name="RequiredParameterError",this.code=RequiredParameterError.code,this.message=e}}RequiredParameterError.code="ERR_REQUIRED_PARAMETER";class InvalidValueError extends Error{constructor(e){super(e),this.name="InvalidValueError",this.code=InvalidValueError.code,this.message=e}}InvalidValueError.code="ERR_INVALID_VALUE";class MissingRepoOptionsError extends Error{constructor(e){super(e),this.name="MissingRepoOptionsError",this.code=MissingRepoOptionsError.code,this.message=e}}MissingRepoOptionsError.code="ERR_MISSING_REPO_OPTIONS";const Errors=Object.freeze(Object.defineProperty({__proto__:null,InvalidValueError,MissingRepoOptionsError,NonReversibleMigrationError,NotInitializedRepoError,RequiredParameterError},Symbol.toStringTag,{value:"Module"})),log$6=debug$1("ipfs:repo:migrator:repo:init");async function isRepoInitialized(r){if(!r)throw new MissingRepoOptionsError("Please pass repo options when trying to open a repo");const e=r.root;try{await e.open();const t=await e.has(VERSION_KEY),n=await e.has(CONFIG_KEY);return!t||!n?(log$6(`Version entry present: ${t}`),log$6(`Config entry present: ${n}`),!1):!0}catch(t){return log$6("While checking if repo is initialized error was thrown: "+t.message),!1}finally{if(e!==void 0)try{await e.close()}catch{}}}async function getVersion(r){if(!await isRepoInitialized(r))throw new NotInitializedRepoError("Repo is not initialized!");const e=r.root;await e.open();try{return parseInt(toString$a(await e.get(VERSION_KEY)))}finally{await e.close()}}async function setVersion(r,e){if(!e)throw new MissingRepoOptionsError("Please pass repo options when trying to open a repo");const t=e.root;await t.open(),await t.put(VERSION_KEY,fromString$8(String(r))),await t.close()}const log$5=debug$1("ipfs:repo:migrator");function getLatestMigrationVersion(r){return r=r||defaultMigrations,!Array.isArray(r)||r.length===0?0:r[r.length-1].version}async function migrate(r,e,t,n,i={}){const s=i.ignoreLock??!1,u=i.onProgress,c=i.isDryRun??!1,d=i.migrations??defaultMigrations;if(!r)throw new errors.RequiredParameterError("Path argument is required!");if(!t)throw new errors.RequiredParameterError("repoOptions argument is required!");if(!n)throw new errors.RequiredParameterError("toVersion argument is required!");if(!Number.isInteger(n)||n<=0)throw new errors.InvalidValueError("Version has to be positive integer!");e=wrapBackends(e);const g=await getVersion(e);if(g===n){log$5("Nothing to migrate.");return}if(g>n)throw new errors.InvalidValueError(`Current repo's version (${g}) is higher then toVersion (${n}), you probably wanted to revert it?`);verifyAvailableMigrations(d,g,n);let _;!c&&!s&&(_=await t.repoLock.lock(r));try{for(const f of d){if(n!==void 0&&f.version>n)break;if(!(f.version<=g)){log$5(`Migrating version ${f.version}`);try{if(!c){let l=()=>{};u&&(l=(h,p)=>u(f.version,h.toFixed(2),p)),await f.migrate(e,l)}}catch(l){const h=f.version-1;throw log$5(`An exception was raised during execution of migration. Setting the repo's version to last successfully migrated version: ${h}`),await setVersion(h,e),new Error(`During migration to version ${f.version} exception was raised: ${l.stack||l.message||l}`)}log$5(`Migrating to version ${f.version} finished`)}}c||await setVersion(n||getLatestMigrationVersion(d),e),log$5("Repo successfully migrated",n!==void 0?`to version ${n}!`:"to latest version!")}finally{!c&&!s&&_&&await _.close()}}async function revert(r,e,t,n,i={}){const s=i.ignoreLock??!1,u=i.onProgress,c=i.isDryRun??!1,d=i.migrations??defaultMigrations;if(!r)throw new errors.RequiredParameterError("Path argument is required!");if(!t)throw new errors.RequiredParameterError("repoOptions argument is required!");if(!n)throw new errors.RequiredParameterError("When reverting migrations, you have to specify to which version to revert!");if(!Number.isInteger(n)||n<=0)throw new errors.InvalidValueError("Version has to be positive integer!");e=wrapBackends(e);const g=await getVersion(e);if(g===n){log$5("Nothing to revert.");return}if(g<n)throw new errors.InvalidValueError(`Current repo's version (${g}) is lower then toVersion (${n}), you probably wanted to migrate it?`);verifyAvailableMigrations(d,n,g,!0);let _;!c&&!s&&(_=await t.repoLock.lock(r)),log$5(`Reverting from version ${g} to ${n}`);try{const f=d.slice().reverse();for(const l of f){if(l.version<=n)break;if(!(l.version>g)){log$5(`Reverting migration version ${l.version}`);try{if(!c){let h=()=>{};u&&(h=(p,y)=>u(l.version,p.toFixed(2),y)),await l.revert(e,h)}}catch(h){const p=l.version;throw log$5(`An exception was raised during execution of migration. Setting the repo's version to last successfully reverted version: ${p}`),await setVersion(p,e),h.message=`During reversion to version ${l.version} exception was raised: ${h.message}`,h}log$5(`Reverting to version ${l.version} finished`)}}c||await setVersion(n,e),log$5(`All migrations successfully reverted to version ${n}!`)}finally{!c&&!s&&_&&await _.close()}}function verifyAvailableMigrations(r,e,t,n=!1){let i=0;for(const s of r){if(s.version>t)break;if(s.version>e){if(n&&!s.revert)throw new errors.NonReversibleMigrationError(`It is not possible to revert to version ${e} because migration version ${s.version} is not reversible. Cancelling reversion.`);i++}}if(i!==t-e)throw new errors.InvalidValueError(`The ipfs-repo-migrations package does not have all migration to migrate from version ${e} to ${t}`)}const errors=Errors;var bytes$1={exports:{}};/*!
 * bytes
 * Copyright(c) 2012-2014 TJ Holowaychuk
 * Copyright(c) 2015 Jed Watson
 * MIT Licensed
 */var hasRequiredBytes;function requireBytes(){if(hasRequiredBytes)return bytes$1.exports;hasRequiredBytes=1,bytes$1.exports=i,bytes$1.exports.format=s,bytes$1.exports.parse=u;var r=/\B(?=(\d{3})+(?!\d))/g,e=/(?:\.0*|(\.[^0]+)0+)$/,t={b:1,kb:1024,mb:1<<20,gb:1<<30,tb:Math.pow(1024,4),pb:Math.pow(1024,5)},n=/^((-|\+)?(\d+(?:\.\d+)?)) *(kb|mb|gb|tb|pb)$/i;function i(c,d){return typeof c=="string"?u(c):typeof c=="number"?s(c,d):null}function s(c,d){if(!Number.isFinite(c))return null;var g=Math.abs(c),_=d&&d.thousandsSeparator||"",f=d&&d.unitSeparator||"",l=d&&d.decimalPlaces!==void 0?d.decimalPlaces:2,h=!!(d&&d.fixedDecimals),p=d&&d.unit||"";(!p||!t[p.toLowerCase()])&&(g>=t.pb?p="PB":g>=t.tb?p="TB":g>=t.gb?p="GB":g>=t.mb?p="MB":g>=t.kb?p="KB":p="B");var y=c/t[p.toLowerCase()],w=y.toFixed(l);return h||(w=w.replace(e,"$1")),_&&(w=w.split(".").map(function(v,C){return C===0?v.replace(r,_):v}).join(".")),w+f+p}function u(c){if(typeof c=="number"&&!isNaN(c))return c;if(typeof c!="string")return null;var d=n.exec(c),g,_="b";return d?(g=parseFloat(d[1]),_=d[4].toLowerCase()):(g=parseInt(c,10),_="b"),isNaN(g)?null:Math.floor(t[_]*g)}return bytes$1.exports}var bytesExports=requireBytes();const bytes=getDefaultExportFromCjs(bytesExports);var isPlainObj,hasRequiredIsPlainObj;function requireIsPlainObj(){return hasRequiredIsPlainObj||(hasRequiredIsPlainObj=1,isPlainObj=r=>{if(Object.prototype.toString.call(r)!=="[object Object]")return!1;const e=Object.getPrototypeOf(r);return e===null||e===Object.prototype}),isPlainObj}var mergeOptions$1,hasRequiredMergeOptions;function requireMergeOptions(){if(hasRequiredMergeOptions)return mergeOptions$1;hasRequiredMergeOptions=1;const r=requireIsPlainObj(),{hasOwnProperty:e}=Object.prototype,{propertyIsEnumerable:t}=Object,n=(h,p,y)=>Object.defineProperty(h,p,{value:y,writable:!0,enumerable:!0,configurable:!0}),i=mergeOptions$1,s={concatArrays:!1,ignoreUndefined:!1},u=h=>{const p=[];for(const y in h)e.call(h,y)&&p.push(y);if(Object.getOwnPropertySymbols){const y=Object.getOwnPropertySymbols(h);for(const w of y)t.call(h,w)&&p.push(w)}return p};function c(h){return Array.isArray(h)?d(h):r(h)?g(h):h}function d(h){const p=h.slice(0,0);return u(h).forEach(y=>{n(p,y,c(h[y]))}),p}function g(h){const p=Object.getPrototypeOf(h)===null?Object.create(null):{};return u(h).forEach(y=>{n(p,y,c(h[y]))}),p}const _=(h,p,y,w)=>(y.forEach(v=>{typeof p[v]>"u"&&w.ignoreUndefined||(v in h&&h[v]!==Object.getPrototypeOf(h)?n(h,v,l(h[v],p[v],w)):n(h,v,c(p[v])))}),h),f=(h,p,y)=>{let w=h.slice(0,0),v=0;return[h,p].forEach(C=>{const P=[];for(let R=0;R<C.length;R++)e.call(C,R)&&(P.push(String(R)),C===h?n(w,v++,C[R]):n(w,v++,c(C[R])));w=_(w,C,u(C).filter(R=>!P.includes(R)),y)}),w};function l(h,p,y){return y.concatArrays&&Array.isArray(h)&&Array.isArray(p)?f(h,p,y):!r(p)||!r(h)?c(p):_(h,p,u(p),y)}return mergeOptions$1=function(...h){const p=l(c(s),this!==i&&this||{},s);let y={_:{}};for(const w of h)if(w!==void 0){if(!r(w))throw new TypeError("`"+w+"` is not an Option Object");y=l(y,{_:w},p)}return y._},mergeOptions$1}var mergeOptionsExports=requireMergeOptions();const mergeOptions=getDefaultExportFromCjs(mergeOptionsExports),repoVersion=12;class LockExistsError extends Error{constructor(e){super(e),this.name="LockExistsError",this.code=LockExistsError.code}}LockExistsError.code="ERR_LOCK_EXISTS";class NotFoundError extends Error{constructor(e){super(e),this.name="NotFoundError",this.code=NotFoundError.code}}NotFoundError.code="ERR_NOT_FOUND";class InvalidRepoVersionError extends Error{constructor(e){super(e),this.name="InvalidRepoVersionError",this.code=InvalidRepoVersionError.code}}InvalidRepoVersionError.code="ERR_INVALID_REPO_VERSION";const ERR_REPO_NOT_INITIALIZED="ERR_REPO_NOT_INITIALIZED",ERR_REPO_ALREADY_OPEN="ERR_REPO_ALREADY_OPEN",ERR_REPO_ALREADY_CLOSED="ERR_REPO_ALREADY_CLOSED";async function hasWithFallback(r,e,t){const n=await e(r);if(n)return n;const i=findLevelJs(t);return i?new Promise((s,u)=>{const c=i.store("readonly").get(r.toString());c.transaction.onabort=()=>{u(c.transaction.error)},c.transaction.oncomplete=()=>{s(!!c.result)}}):!1}async function getWithFallback(r,e,t,n){if(await t(r))return e(r);const i=findLevelJs(n);if(!i)throw new NotFoundError;return new Promise((s,u)=>{const c=i.store("readonly").get(r.toString());c.transaction.onabort=()=>{u(c.transaction.error)},c.transaction.oncomplete=()=>{if(c.result)return s(c.result);u(new NotFoundError)}})}function findLevelJs(r){let e=r;for(;e.db||e.child;)if(e=e.db||e.child,e.type==="level-js"||e.constructor.name==="Level")return e}const log$4=debug$2("ipfs:repo:version"),versionKey=new Key("version");function version(r){return{async exists(){return hasWithFallback(versionKey,r.has.bind(r),r)},async get(){const e=await getWithFallback(versionKey,r.get.bind(r),r.has.bind(r),r);return parseInt(toString$a(e),10)},set(e){return r.put(versionKey,fromString$8(String(e)))},async check(e){const t=await this.get();return log$4("comparing version: %s and %s",t,e),t===e||(t===6&&e===7||e===6&&t===7)}}}var eventemitter3={exports:{}},hasRequiredEventemitter3;function requireEventemitter3(){return hasRequiredEventemitter3||(hasRequiredEventemitter3=1,function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(d,g,_){this.fn=d,this.context=g,this.once=_||!1}function s(d,g,_,f,l){if(typeof _!="function")throw new TypeError("The listener must be a function");var h=new i(_,f||d,l),p=t?t+g:g;return d._events[p]?d._events[p].fn?d._events[p]=[d._events[p],h]:d._events[p].push(h):(d._events[p]=h,d._eventsCount++),d}function u(d,g){--d._eventsCount===0?d._events=new n:delete d._events[g]}function c(){this._events=new n,this._eventsCount=0}c.prototype.eventNames=function(){var g=[],_,f;if(this._eventsCount===0)return g;for(f in _=this._events)e.call(_,f)&&g.push(t?f.slice(1):f);return Object.getOwnPropertySymbols?g.concat(Object.getOwnPropertySymbols(_)):g},c.prototype.listeners=function(g){var _=t?t+g:g,f=this._events[_];if(!f)return[];if(f.fn)return[f.fn];for(var l=0,h=f.length,p=new Array(h);l<h;l++)p[l]=f[l].fn;return p},c.prototype.listenerCount=function(g){var _=t?t+g:g,f=this._events[_];return f?f.fn?1:f.length:0},c.prototype.emit=function(g,_,f,l,h,p){var y=t?t+g:g;if(!this._events[y])return!1;var w=this._events[y],v=arguments.length,C,P;if(w.fn){switch(w.once&&this.removeListener(g,w.fn,void 0,!0),v){case 1:return w.fn.call(w.context),!0;case 2:return w.fn.call(w.context,_),!0;case 3:return w.fn.call(w.context,_,f),!0;case 4:return w.fn.call(w.context,_,f,l),!0;case 5:return w.fn.call(w.context,_,f,l,h),!0;case 6:return w.fn.call(w.context,_,f,l,h,p),!0}for(P=1,C=new Array(v-1);P<v;P++)C[P-1]=arguments[P];w.fn.apply(w.context,C)}else{var R=w.length,F;for(P=0;P<R;P++)switch(w[P].once&&this.removeListener(g,w[P].fn,void 0,!0),v){case 1:w[P].fn.call(w[P].context);break;case 2:w[P].fn.call(w[P].context,_);break;case 3:w[P].fn.call(w[P].context,_,f);break;case 4:w[P].fn.call(w[P].context,_,f,l);break;default:if(!C)for(F=1,C=new Array(v-1);F<v;F++)C[F-1]=arguments[F];w[P].fn.apply(w[P].context,C)}}return!0},c.prototype.on=function(g,_,f){return s(this,g,_,f,!1)},c.prototype.once=function(g,_,f){return s(this,g,_,f,!0)},c.prototype.removeListener=function(g,_,f,l){var h=t?t+g:g;if(!this._events[h])return this;if(!_)return u(this,h),this;var p=this._events[h];if(p.fn)p.fn===_&&(!l||p.once)&&(!f||p.context===f)&&u(this,h);else{for(var y=0,w=[],v=p.length;y<v;y++)(p[y].fn!==_||l&&!p[y].once||f&&p[y].context!==f)&&w.push(p[y]);w.length?this._events[h]=w.length===1?w[0]:w:u(this,h)}return this},c.prototype.removeAllListeners=function(g){var _;return g?(_=t?t+g:g,this._events[_]&&u(this,_)):(this._events=new n,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,r.exports=c}(eventemitter3)),eventemitter3.exports}var eventemitter3Exports=requireEventemitter3();const EventEmitter$1=getDefaultExportFromCjs(eventemitter3Exports);let TimeoutError$1=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},AbortError$2=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}};const getDOMException$1=r=>globalThis.DOMException===void 0?new AbortError$2(r):new DOMException(r),getAbortedReason$1=r=>{const e=r.reason===void 0?getDOMException$1("This operation was aborted."):r.reason;return e instanceof Error?e:getDOMException$1(e)};function pTimeout$1(r,e,t,n){let i;const s=new Promise((u,c)=>{if(typeof e!="number"||Math.sign(e)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${e}\``);if(e===Number.POSITIVE_INFINITY){u(r);return}if(n={customTimers:{setTimeout,clearTimeout},...n},n.signal){const{signal:d}=n;d.aborted&&c(getAbortedReason$1(d)),d.addEventListener("abort",()=>{c(getAbortedReason$1(d))})}i=n.customTimers.setTimeout.call(void 0,()=>{if(typeof t=="function"){try{u(t())}catch(_){c(_)}return}const d=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,g=t instanceof Error?t:new TimeoutError$1(d);typeof r.cancel=="function"&&r.cancel(),c(g)},e),(async()=>{try{u(await r)}catch(d){c(d)}finally{n.customTimers.clearTimeout.call(void 0,i)}})()});return s.clear=()=>{clearTimeout(i),i=void 0},s}function lowerBound(r,e,t){let n=0,i=r.length;for(;i>0;){const s=Math.trunc(i/2);let u=n+s;t(r[u],e)<=0?(n=++u,i-=s+1):i=s}return n}var __classPrivateFieldGet$1=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},_PriorityQueue_queue;class PriorityQueue{constructor(){_PriorityQueue_queue.set(this,[])}enqueue(e,t){t={priority:0,...t};const n={priority:t.priority,run:e};if(this.size&&__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f")[this.size-1].priority>=t.priority){__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").push(n);return}const i=lowerBound(__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f"),n,(s,u)=>u.priority-s.priority);__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").splice(i,0,n)}dequeue(){const e=__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").shift();return e==null?void 0:e.run}filter(e){return __classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return __classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").length}}_PriorityQueue_queue=new WeakMap;var __classPrivateFieldSet=function(r,e,t,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(r,t):i?i.value=t:e.set(r,t),t},__classPrivateFieldGet=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},_PQueue_instances,_PQueue_carryoverConcurrencyCount,_PQueue_isIntervalIgnored,_PQueue_intervalCount,_PQueue_intervalCap,_PQueue_interval,_PQueue_intervalEnd,_PQueue_intervalId,_PQueue_timeoutId,_PQueue_queue,_PQueue_queueClass,_PQueue_pendingCount,_PQueue_concurrency,_PQueue_isPaused,_PQueue_throwOnTimeout,_PQueue_doesIntervalAllowAnother_get,_PQueue_doesConcurrentAllowAnother_get,_PQueue_next,_PQueue_emitEvents,_PQueue_onResumeInterval,_PQueue_isIntervalPaused_get,_PQueue_tryToStartAnother,_PQueue_initializeIntervalIfNeeded,_PQueue_onInterval,_PQueue_processQueue,_PQueue_onEvent;const timeoutError=new TimeoutError$1;let AbortError$1=class extends Error{};class PQueue extends EventEmitter$1{constructor(e){var t,n,i,s;if(super(),_PQueue_instances.add(this),_PQueue_carryoverConcurrencyCount.set(this,void 0),_PQueue_isIntervalIgnored.set(this,void 0),_PQueue_intervalCount.set(this,0),_PQueue_intervalCap.set(this,void 0),_PQueue_interval.set(this,void 0),_PQueue_intervalEnd.set(this,0),_PQueue_intervalId.set(this,void 0),_PQueue_timeoutId.set(this,void 0),_PQueue_queue.set(this,void 0),_PQueue_queueClass.set(this,void 0),_PQueue_pendingCount.set(this,0),_PQueue_concurrency.set(this,void 0),_PQueue_isPaused.set(this,void 0),_PQueue_throwOnTimeout.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:PriorityQueue,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(s=(i=e.interval)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""}\` (${typeof e.interval})`);__classPrivateFieldSet(this,_PQueue_carryoverConcurrencyCount,e.carryoverConcurrencyCount,"f"),__classPrivateFieldSet(this,_PQueue_isIntervalIgnored,e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,"f"),__classPrivateFieldSet(this,_PQueue_intervalCap,e.intervalCap,"f"),__classPrivateFieldSet(this,_PQueue_interval,e.interval,"f"),__classPrivateFieldSet(this,_PQueue_queue,new e.queueClass,"f"),__classPrivateFieldSet(this,_PQueue_queueClass,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,__classPrivateFieldSet(this,_PQueue_throwOnTimeout,e.throwOnTimeout===!0,"f"),__classPrivateFieldSet(this,_PQueue_isPaused,e.autoStart===!1,"f")}get concurrency(){return __classPrivateFieldGet(this,_PQueue_concurrency,"f")}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);__classPrivateFieldSet(this,_PQueue_concurrency,e,"f"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_processQueue).call(this)}async add(e,t={}){return new Promise((n,i)=>{const s=async()=>{var u,c,d;__classPrivateFieldSet(this,_PQueue_pendingCount,(c=__classPrivateFieldGet(this,_PQueue_pendingCount,"f"),c++,c),"f"),__classPrivateFieldSet(this,_PQueue_intervalCount,(d=__classPrivateFieldGet(this,_PQueue_intervalCount,"f"),d++,d),"f");try{if(!((u=t.signal)===null||u===void 0)&&u.aborted){i(new AbortError$1("The task was aborted."));return}const _=await(this.timeout===void 0&&t.timeout===void 0?e({signal:t.signal}):pTimeout$1(Promise.resolve(e({signal:t.signal})),t.timeout===void 0?this.timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?__classPrivateFieldGet(this,_PQueue_throwOnTimeout,"f"):t.throwOnTimeout)&&i(timeoutError)}));n(_),this.emit("completed",_)}catch(g){i(g),this.emit("error",g)}__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_next).call(this)};__classPrivateFieldGet(this,_PQueue_queue,"f").enqueue(s,t),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_tryToStartAnother).call(this),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async n=>this.add(n,t)))}start(){return __classPrivateFieldGet(this,_PQueue_isPaused,"f")?(__classPrivateFieldSet(this,_PQueue_isPaused,!1,"f"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_processQueue).call(this),this):this}pause(){__classPrivateFieldSet(this,_PQueue_isPaused,!0,"f")}clear(){__classPrivateFieldSet(this,_PQueue_queue,new(__classPrivateFieldGet(this,_PQueue_queueClass,"f")),"f")}async onEmpty(){__classPrivateFieldGet(this,_PQueue_queue,"f").size!==0&&await __classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onEvent).call(this,"empty")}async onSizeLessThan(e){__classPrivateFieldGet(this,_PQueue_queue,"f").size<e||await __classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onEvent).call(this,"next",()=>__classPrivateFieldGet(this,_PQueue_queue,"f").size<e)}async onIdle(){__classPrivateFieldGet(this,_PQueue_pendingCount,"f")===0&&__classPrivateFieldGet(this,_PQueue_queue,"f").size===0||await __classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onEvent).call(this,"idle")}get size(){return __classPrivateFieldGet(this,_PQueue_queue,"f").size}sizeBy(e){return __classPrivateFieldGet(this,_PQueue_queue,"f").filter(e).length}get pending(){return __classPrivateFieldGet(this,_PQueue_pendingCount,"f")}get isPaused(){return __classPrivateFieldGet(this,_PQueue_isPaused,"f")}}_PQueue_carryoverConcurrencyCount=new WeakMap,_PQueue_isIntervalIgnored=new WeakMap,_PQueue_intervalCount=new WeakMap,_PQueue_intervalCap=new WeakMap,_PQueue_interval=new WeakMap,_PQueue_intervalEnd=new WeakMap,_PQueue_intervalId=new WeakMap,_PQueue_timeoutId=new WeakMap,_PQueue_queue=new WeakMap,_PQueue_queueClass=new WeakMap,_PQueue_pendingCount=new WeakMap,_PQueue_concurrency=new WeakMap,_PQueue_isPaused=new WeakMap,_PQueue_throwOnTimeout=new WeakMap,_PQueue_instances=new WeakSet,_PQueue_doesIntervalAllowAnother_get=function r(){return __classPrivateFieldGet(this,_PQueue_isIntervalIgnored,"f")||__classPrivateFieldGet(this,_PQueue_intervalCount,"f")<__classPrivateFieldGet(this,_PQueue_intervalCap,"f")},_PQueue_doesConcurrentAllowAnother_get=function r(){return __classPrivateFieldGet(this,_PQueue_pendingCount,"f")<__classPrivateFieldGet(this,_PQueue_concurrency,"f")},_PQueue_next=function r(){var e;__classPrivateFieldSet(this,_PQueue_pendingCount,(e=__classPrivateFieldGet(this,_PQueue_pendingCount,"f"),e--,e),"f"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_tryToStartAnother).call(this),this.emit("next")},_PQueue_emitEvents=function r(){this.emit("empty"),__classPrivateFieldGet(this,_PQueue_pendingCount,"f")===0&&this.emit("idle")},_PQueue_onResumeInterval=function r(){__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onInterval).call(this),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_initializeIntervalIfNeeded).call(this),__classPrivateFieldSet(this,_PQueue_timeoutId,void 0,"f")},_PQueue_isIntervalPaused_get=function r(){const e=Date.now();if(__classPrivateFieldGet(this,_PQueue_intervalId,"f")===void 0){const t=__classPrivateFieldGet(this,_PQueue_intervalEnd,"f")-e;if(t<0)__classPrivateFieldSet(this,_PQueue_intervalCount,__classPrivateFieldGet(this,_PQueue_carryoverConcurrencyCount,"f")?__classPrivateFieldGet(this,_PQueue_pendingCount,"f"):0,"f");else return __classPrivateFieldGet(this,_PQueue_timeoutId,"f")===void 0&&__classPrivateFieldSet(this,_PQueue_timeoutId,setTimeout(()=>{__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onResumeInterval).call(this)},t),"f"),!0}return!1},_PQueue_tryToStartAnother=function r(){if(__classPrivateFieldGet(this,_PQueue_queue,"f").size===0)return __classPrivateFieldGet(this,_PQueue_intervalId,"f")&&clearInterval(__classPrivateFieldGet(this,_PQueue_intervalId,"f")),__classPrivateFieldSet(this,_PQueue_intervalId,void 0,"f"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_emitEvents).call(this),!1;if(!__classPrivateFieldGet(this,_PQueue_isPaused,"f")){const e=!__classPrivateFieldGet(this,_PQueue_instances,"a",_PQueue_isIntervalPaused_get);if(__classPrivateFieldGet(this,_PQueue_instances,"a",_PQueue_doesIntervalAllowAnother_get)&&__classPrivateFieldGet(this,_PQueue_instances,"a",_PQueue_doesConcurrentAllowAnother_get)){const t=__classPrivateFieldGet(this,_PQueue_queue,"f").dequeue();return t?(this.emit("active"),t(),e&&__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_initializeIntervalIfNeeded).call(this),!0):!1}}return!1},_PQueue_initializeIntervalIfNeeded=function r(){__classPrivateFieldGet(this,_PQueue_isIntervalIgnored,"f")||__classPrivateFieldGet(this,_PQueue_intervalId,"f")!==void 0||(__classPrivateFieldSet(this,_PQueue_intervalId,setInterval(()=>{__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onInterval).call(this)},__classPrivateFieldGet(this,_PQueue_interval,"f")),"f"),__classPrivateFieldSet(this,_PQueue_intervalEnd,Date.now()+__classPrivateFieldGet(this,_PQueue_interval,"f"),"f"))},_PQueue_onInterval=function r(){__classPrivateFieldGet(this,_PQueue_intervalCount,"f")===0&&__classPrivateFieldGet(this,_PQueue_pendingCount,"f")===0&&__classPrivateFieldGet(this,_PQueue_intervalId,"f")&&(clearInterval(__classPrivateFieldGet(this,_PQueue_intervalId,"f")),__classPrivateFieldSet(this,_PQueue_intervalId,void 0,"f")),__classPrivateFieldSet(this,_PQueue_intervalCount,__classPrivateFieldGet(this,_PQueue_carryoverConcurrencyCount,"f")?__classPrivateFieldGet(this,_PQueue_pendingCount,"f"):0,"f"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_processQueue).call(this)},_PQueue_processQueue=function r(){for(;__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_tryToStartAnother).call(this););},_PQueue_onEvent=async function r(e,t){return new Promise(n=>{const i=()=>{t&&!t()||(this.off(e,i),n())};this.on(e,i)})};var objectSafeSet=set;function set(r,e,t){var n,i;if(Array.isArray(e)&&(n=e.slice(0)),typeof e=="string"&&(n=e.split(".")),typeof e=="symbol"&&(n=[e]),!Array.isArray(n))throw new Error("props arg must be an array, a string or a symbol");if(i=n.pop(),!i)return!1;prototypeCheck(i);for(var s;s=n.shift();)if(prototypeCheck(s),typeof r[s]>"u"&&(r[s]={}),r=r[s],!r||typeof r!="object")return!1;return r[i]=t,!0}function prototypeCheck(r){if(r=="__proto__"||r=="constructor"||r=="prototype")throw new Error("setting of prototype values not supported")}const Queue=PQueue.default?PQueue.default:PQueue,configKey=new Key("config");function config(r){const e=new Queue({concurrency:1}),t={async getAll(s={}){const u=await getWithFallback(configKey,r.get.bind(r),r.has.bind(r),r);return JSON.parse(toString$a(u))},async get(s,u={}){if(s==null)throw new NotFoundError(`Key ${s} does not exist in config`);const c=await this.getAll(u),d=objectSafeGet(c,s);if(d===void 0)throw new NotFoundError(`Key ${s} does not exist in config`);return d},set(s,u,c={}){if(typeof s!="string"&&!(s instanceof String))throw errcode(new Error("Invalid key type: "+typeof s),"ERR_INVALID_KEY");if(u===void 0||u instanceof Uint8Array)throw errcode(new Error("Invalid value type: "+typeof u),"ERR_INVALID_VALUE");return e.add(()=>n({key:s,value:u},c.signal))},replace(s,u={}){if(!s||s instanceof Uint8Array)throw errcode(new Error("Invalid value type: "+typeof s),"ERR_INVALID_VALUE");return e.add(()=>n({key:void 0,value:s},u.signal))},async exists(){return hasWithFallback(configKey,r.has.bind(r),r)}};return t;async function n(s,u){if(u&&u.aborted)return;const c=s.key,d=s.value;if(c){const g=await t.getAll();return typeof g=="object"&&g!==null&&objectSafeSet(g,c,d),i(g)}return i(d)}function i(s){const u=fromString$8(JSON.stringify(s,null,2));return r.put(configKey,u)}}function isPlainObject(r){if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)}function sortKeys(r,e={}){if(!isPlainObject(r)&&!Array.isArray(r))throw new TypeError("Expected a plain object or array");const{deep:t,compare:n}=e,i=[],s=[],u=d=>{const g=i.indexOf(d);if(g!==-1)return s[g];const _=[];return i.push(d),s.push(_),_.push(...d.map(f=>Array.isArray(f)?u(f):isPlainObject(f)?c(f):f)),_},c=d=>{const g=i.indexOf(d);if(g!==-1)return s[g];const _={},f=Object.keys(d).sort(n);i.push(d),s.push(_);for(const l of f){const h=d[l];let p;t&&Array.isArray(h)?p=u(h):p=t&&isPlainObject(h)?c(h):h,Object.defineProperty(_,l,{...Object.getOwnPropertyDescriptor(d,l),value:p})}return _};return Array.isArray(r)?t?u(r):r.slice():c(r)}const specKey=new Key("datastore_spec");function spec(r){return{exists(){return r.has(specKey)},async get(){const e=await r.get(specKey);return JSON.parse(toString$a(e))},async set(e){return r.put(specKey,fromString$8(JSON.stringify(sortKeys(e,{deep:!0}))))}}}const apiFile=new Key("api");function apiAddr(r){return{async get(){const e=await r.get(apiFile);return e&&e.toString()},set(e){return r.put(apiFile,fromString$8(e.toString()))},delete(){return r.delete(apiFile)}}}var itFilter,hasRequiredItFilter;function requireItFilter(){return hasRequiredItFilter||(hasRequiredItFilter=1,itFilter=async function*(e,t){for await(const n of e)await t(n)&&(yield n)}),itFilter}var itFilterExports=requireItFilter();const filter$2=getDefaultExportFromCjs(itFilterExports);class FixedFIFO{constructor(e){if(!(e>0)||(e-1&e)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}}class FIFO{constructor(e={}){this.hwm=e.splitLimit??16,this.head=new FixedFIFO(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return(e==null?void 0:e.byteLength)!=null?e.byteLength:1}push(e){if((e==null?void 0:e.value)!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new FixedFIFO(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return(e==null?void 0:e.value)!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}function pushable(r={}){return _pushable(t=>{const n=t.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function _pushable(r,e){e=e??{};let t=e.onEnd,n=new FIFO,i,s,u;const c=async()=>n.isEmpty()?u?{done:!0}:await new Promise((y,w)=>{s=v=>{s=null,n.push(v);try{y(r(n))}catch(C){w(C)}return i}}):r(n),d=y=>s!=null?s(y):(n.push(y),i),g=y=>(n=new FIFO,s!=null?s({error:y}):(n.push({error:y}),i)),_=y=>{if(u)return i;if((e==null?void 0:e.objectMode)!==!0&&(y==null?void 0:y.byteLength)==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return d({done:!1,value:y})},f=y=>u?i:(u=!0,y!=null?g(y):d({done:!0})),l=()=>(n=new FIFO,f(),{done:!0}),h=y=>(f(y),{done:!0});if(i={[Symbol.asyncIterator](){return this},next:c,return:l,throw:h,push:_,end:f,get readableLength(){return n.size}},t==null)return i;const p=i;return i={[Symbol.asyncIterator](){return this},next(){return p.next()},throw(y){return p.throw(y),t!=null&&(t(y),t=void 0),{done:!0}},return(){return p.return(),t!=null&&(t(),t=void 0),{done:!0}},push:_,end(y){return p.end(y),t!=null&&(t(y),t=void 0),i},get readableLength(){return p.readableLength}},i}var itDrain,hasRequiredItDrain;function requireItDrain(){return hasRequiredItDrain||(hasRequiredItDrain=1,itDrain=async e=>{for await(const t of e);}),itDrain}var itDrainExports=requireItDrain();const drain$1=getDefaultExportFromCjs(itDrainExports);function createIdStore(r){return{open(){return r.open()},close(){return r.close()},query(e,t){return r.query(e,t)},queryKeys(e,t){return r.queryKeys(e,t)},async get(e,t){const n=extractContents(e);return n.isIdentity?Promise.resolve(n.digest):r.get(e,t)},async*getMany(e,t){for await(const n of e)yield this.get(n,t)},async put(e,t,n){const{isIdentity:i}=extractContents(e);i||await r.put(e,t,n)},async*putMany(e,t){const n=pushable({objectMode:!0});(globalThis.process&&globalThis.process.nextTick?globalThis.process.nextTick:globalThis.setImmediate||globalThis.setTimeout)(async()=>{try{await drain$1(r.putMany(async function*(){for await(const{key:s,value:u}of e)extractContents(s).isIdentity||(yield{key:s,value:u}),n.push({key:s,value:u})}())),n.end()}catch(s){n.end(s)}}),yield*n},has(e,t){const{isIdentity:n}=extractContents(e);return n?Promise.resolve(!0):r.has(e,t)},delete(e,t){const{isIdentity:n}=extractContents(e);return n?Promise.resolve():r.delete(e,t)},deleteMany(e,t){return r.deleteMany(filter$2(e,n=>!extractContents(n).isIdentity),t)},batch(){const e=r.batch();return{put(t,n){const{isIdentity:i}=extractContents(t);i||e.put(t,n)},delete(t){const{isIdentity:n}=extractContents(t);n||e.delete(t)},commit:t=>e.commit(t)}}}}function extractContents(r){const e=CID$1.asCID(r);if(e==null)throw errcode(new Error("Not a valid cid"),"ERR_INVALID_CID");return e.multihash.code!==identity$3.code?{isIdentity:!1}:{isIdentity:!0,digest:e.multihash.digest}}const log$3=debug$2("ipfs:repo:lock:memory"),lockFile="repo.lock",LOCKS={};async function lock(r){const e=r+"/"+lockFile;if(log$3("locking %s",e),LOCKS[e]===!0)throw new LockExistsError(`Lock already being held for file: ${e}`);return LOCKS[e]=!0,{async close(){LOCKS[e]&&delete LOCKS[e]}}}async function locked(r){const e=r+"/"+lockFile;return log$3(`checking lock: ${e}`),!!LOCKS[e]}const MemoryLock={lock,locked},defaultOptions$2={autoMigrate:!0,onMigrationProgress:()=>{},repoOwner:!0,repoLock:MemoryLock},defaultDatastore={Spec:{type:"mount",mounts:[{mountpoint:"/blocks",type:"measure",prefix:"flatfs.datastore",child:{type:"flatfs",path:"blocks",sync:!0,shardFunc:"/repo/flatfs/shard/v1/next-to-last/2"}},{mountpoint:"/",type:"measure",prefix:"leveldb.datastore",child:{type:"levelds",path:"datastore",compression:"none"}}]}};var itFirst,hasRequiredItFirst;function requireItFirst(){return hasRequiredItFirst||(hasRequiredItFirst=1,itFirst=async e=>{for await(const t of e)return t}),itFirst}var itFirstExports=requireItFirst();const first=getDefaultExportFromCjs(itFirstExports),readonly=({enumerable:r=!0,configurable:e=!1}={})=>({enumerable:r,configurable:e,writable:!1}),links=function*(r,e){if(r!=null&&!(r instanceof Uint8Array))for(const[t,n]of Object.entries(r)){const i=[...e,t];if(n!=null&&typeof n=="object")if(Array.isArray(n))for(const[s,u]of n.entries()){const c=[...i,s],d=CID$1.asCID(u);d?yield[c.join("/"),d]:typeof u=="object"&&(yield*links(u,c))}else{const s=CID$1.asCID(n);s?yield[i.join("/"),s]:yield*links(n,i)}}},tree=function*(r,e){if(r!=null)for(const[t,n]of Object.entries(r)){const i=[...e,t];if(yield i.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&!CID$1.asCID(n))if(Array.isArray(n))for(const[s,u]of n.entries()){const c=[...i,s];yield c.join("/"),typeof u=="object"&&!CID$1.asCID(u)&&(yield*tree(u,c))}else yield*tree(n,i)}},get$2=(r,e)=>{let t=r;for(const[n,i]of e.entries()){if(t=t[i],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(u=>`[${JSON.stringify(u)}]`).join("")}`);const s=CID$1.asCID(t);if(s)return{value:s,remaining:e.slice(n+1).join("/")}}return{value:t}};class Block{constructor({cid:e,bytes:t,value:n}){if(!e||!t||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:readonly(),bytes:readonly(),value:readonly(),asBlock:readonly()})}links(){return links(this.value,[])}tree(){return tree(this.value,[])}get(e="/"){return get$2(this.value,e.split("/").filter(Boolean))}}const createUnsafe=({bytes:r,cid:e,value:t,codec:n})=>{const i=t!==void 0?t:n&&n.decode(r);if(i===void 0)throw new Error('Missing required argument, must either provide "value" or "codec"');return new Block({cid:e,bytes:r,value:i})};function cidToKey$1(r){const e=CID$1.asCID(r);if(e==null)throw errcode(new Error("Not a valid cid"),"ERR_INVALID_CID");const t=base32$7.encode(e.multihash.bytes);return new Key("/"+t.slice(1).toUpperCase(),!1)}function keyToMultihash(r){return decode$h(base32$7.decode(`b${r.toString().toLowerCase().substring(1)}`))}const log$2=debug$2("ipfs:repo:utils:walk-dag");async function*walkDag(r,e,t,n){try{const i=await e.get(r,n),s=await t(r.code),u=createUnsafe({bytes:i,cid:r,codec:s});for(const[,c]of u.links())yield c,yield*walkDag(c,e,t,n)}catch(i){throw log$2("Could not walk DAG for CID",r.toString(),i),i}}const PinTypes={direct:"direct",recursive:"recursive",indirect:"indirect",all:"all"};class QuickLRU extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[t,n]of e)this.onEviction(t,n.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const n=t.get(e);return this._getItemValue(e,n)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield e)}for(const e of this.cache){const[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:n=this.maxAge}={}){const i=typeof n=="number"&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;this.cache.has(e)?this.cache.set(e,{value:t,expiry:i}):this._set(e,{value:t,expiry:i})}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],n=t.length-e;n<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(n>0&&this._emitEvictions(t.slice(0,n)),this.oldCache=new Map(t.slice(n)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}for(const e of this.oldCache){const[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const n=e[t],[i,s]=n;this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const n=e[t],[i,s]=n;this.cache.has(i)||this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[n,i]of this.entriesAscending())e.call(t,i,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}const CID_CACHE_MAX_SIZE=2048;function invalidPinTypeErr(r){const e=`Invalid type '${r}', must be one of {direct, indirect, recursive, all}`;return errcode(new Error(e),"ERR_INVALID_PIN_TYPE")}class PinManager{constructor({pinstore:e,blockstore:t,loadCodec:n}){this.pinstore=e,this.blockstore=t,this.loadCodec=n,this.log=debug$2("ipfs:repo:pin"),this.directPins=new Set,this.recursivePins=new Set}async pinDirectly(e,t={}){await this.blockstore.get(e,t);const n={depth:0};return e.version!==0&&(n.version=e.version),e.code!==code&&(n.codec=e.code),t.metadata&&(n.metadata=t.metadata),this.pinstore.put(cidToKey$1(e),encode$a(n))}unpin(e,t){return this.pinstore.delete(cidToKey$1(e),t)}async pinRecursively(e,t={}){await this.fetchCompleteDag(e,t);const n={depth:1/0};e.version!==0&&(n.version=e.version),e.code!==code&&(n.codec=e.code),t.metadata&&(n.metadata=t.metadata),await this.pinstore.put(cidToKey$1(e),encode$a(n))}async*directKeys(e){for await(const t of this.pinstore.query({filters:[n=>decode$d(n.value).depth===0]})){const n=decode$d(t.value),i=n.version||0,s=n.codec!=null?n.codec:code,u=keyToMultihash(t.key);yield{cid:CID$1.create(i,s,u),metadata:n.metadata}}}async*recursiveKeys(e){for await(const t of this.pinstore.query({filters:[n=>decode$d(n.value).depth===1/0]})){const n=decode$d(t.value),i=n.version||0,s=n.codec!=null?n.codec:code,u=keyToMultihash(t.key);yield{cid:CID$1.create(i,s,u),metadata:n.metadata}}}async*indirectKeys(e){for await(const{cid:t}of this.recursiveKeys())for await(const n of walkDag(t,this.blockstore,this.loadCodec,e)){const i=[PinTypes.recursive];(await this.isPinnedWithType(n,i)).pinned||(yield n)}}async isPinnedWithType(e,t,n){Array.isArray(t)||(t=[t]);const i=t.includes(PinTypes.all),s=t.includes(PinTypes.direct),u=t.includes(PinTypes.recursive),c=t.includes(PinTypes.indirect);if(u||s||i){const _=await first(this.pinstore.query({prefix:cidToKey$1(e).toString(),filters:[f=>{if(i)return!0;const l=decode$d(f.value);return t.includes(l.depth===0?PinTypes.direct:PinTypes.recursive)}],limit:1}));if(_){const f=decode$d(_.value);return{cid:e,pinned:!0,reason:f.depth===0?PinTypes.direct:PinTypes.recursive,metadata:f.metadata}}}const d=this;async function*g(_,f){for await(const{cid:l}of f)for await(const h of walkDag(l,d.blockstore,d.loadCodec))if(h.equals(_)){yield l;return}}if(i||c){const _=await first(g(e,this.recursiveKeys()));if(_)return{cid:e,pinned:!0,reason:PinTypes.indirect,parent:_}}return{cid:e,pinned:!1}}async fetchCompleteDag(e,t={}){const n=new QuickLRU({maxSize:t.cidCacheMaxSize??CID_CACHE_MAX_SIZE}),i=async(s,u)=>{if(n.has(s.toString()))return;n.set(s.toString(),!0);const c=await this.blockstore.get(s,u),d=await this.loadCodec(s.code),g=createUnsafe({bytes:c,cid:s,codec:d});await Promise.all([...g.links()].map(([,_])=>i(_,u)))};await i(e,t)}static checkPinType(e){if(typeof e!="string"||!Object.keys(PinTypes).includes(e))throw invalidPinTypeErr(e);return!0}}var itMap,hasRequiredItMap;function requireItMap(){return hasRequiredItMap||(hasRequiredItMap=1,itMap=async function*(e,t){for await(const n of e)yield t(n)}),itMap}var itMapExports=requireItMap();const map$1=getDefaultExportFromCjs(itMapExports);function createPinnedBlockstore(r,e){return{open(){return e.open()},close(){return e.close()},query(t,n){return e.query(t,n)},queryKeys(t,n){return e.queryKeys(t,n)},async get(t,n){return e.get(t,n)},async*getMany(t,n){yield*e.getMany(t,n)},async put(t,n,i){await e.put(t,n,i)},async*putMany(t,n){yield*e.putMany(t,n)},has(t,n){return e.has(t,n)},async delete(t,n){return await ensureNotPinned(t,r),e.delete(t,n)},deleteMany(t,n){return e.deleteMany(map$1(t,async i=>(await ensureNotPinned(i,r),i)),n)},batch(){return e.batch()}}}async function ensureNotPinned(r,e){const{pinned:t,reason:n}=await e.isPinnedWithType(r,PinTypes.all);if(t)throw errcode(new Error(`pinned: ${n}`),"ERR_BLOCK_PINNED")}class TimeoutError extends Error{constructor(e){super(e),this.name="TimeoutError"}}class AbortError extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}const getDOMException=r=>globalThis.DOMException===void 0?new AbortError(r):new DOMException(r),getAbortedReason=r=>{const e=r.reason===void 0?getDOMException("This operation was aborted."):r.reason;return e instanceof Error?e:getDOMException(e)};function pTimeout(r,e){const{milliseconds:t,fallback:n,message:i,customTimers:s={setTimeout,clearTimeout}}=e;let u;const c=new Promise((d,g)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(t===Number.POSITIVE_INFINITY){d(r);return}if(e.signal){const{signal:_}=e;_.aborted&&g(getAbortedReason(_)),_.addEventListener("abort",()=>{g(getAbortedReason(_))})}u=s.setTimeout.call(void 0,()=>{if(n){try{d(n())}catch(l){g(l)}return}const _=typeof i=="string"?i:`Promise timed out after ${t} milliseconds`,f=i instanceof Error?i:new TimeoutError(_);typeof r.cancel=="function"&&r.cancel(),g(f)},t),(async()=>{try{d(await r)}catch(_){g(_)}finally{s.clearTimeout.call(void 0,u)}})()});return c.clear=()=>{s.clearTimeout.call(void 0,u),u=void 0},c}const WORKER_REQUEST_READ_LOCK="lock:worker:request-read",WORKER_RELEASE_READ_LOCK="lock:worker:release-read",MASTER_GRANT_READ_LOCK="lock:master:grant-read",WORKER_REQUEST_WRITE_LOCK="lock:worker:request-write",WORKER_RELEASE_WRITE_LOCK="lock:worker:release-write",MASTER_GRANT_WRITE_LOCK="lock:master:grant-write",events={},observable=r=>{r.addEventListener("message",e=>{observable.dispatchEvent("message",r,e)}),r.port!=null&&r.port.addEventListener("message",e=>{observable.dispatchEvent("message",r,e)})};observable.addEventListener=(r,e)=>{events[r]==null&&(events[r]=[]),events[r].push(e)};observable.removeEventListener=(r,e)=>{events[r]!=null&&(events[r]=events[r].filter(t=>t===e))};observable.dispatchEvent=function(r,e,t){events[r]!=null&&events[r].forEach(n=>n(e,t))};const handleWorkerLockRequest=(r,e,t,n,i)=>(s,u)=>{if(u.data.type!==t)return;const c={type:u.data.type,name:u.data.name,identifier:u.data.identifier};r.dispatchEvent(new MessageEvent(e,{data:{name:c.name,handler:async()=>(s.postMessage({type:i,name:c.name,identifier:c.identifier}),await new Promise(d=>{const g=_=>{if(_==null||_.data==null)return;const f={type:_.data.type,name:_.data.name,identifier:_.data.identifier};f.type===n&&f.identifier===c.identifier&&(s.removeEventListener("message",g),d())};s.addEventListener("message",g)}))}}))},makeWorkerLockRequest=(r,e,t,n)=>async()=>{const i=nanoid();return globalThis.postMessage({type:e,identifier:i,name:r}),await new Promise(s=>{const u=c=>{if(c==null||c.data==null)return;const d={type:c.data.type,identifier:c.data.identifier};d.type===t&&d.identifier===i&&(globalThis.removeEventListener("message",u),s(()=>{globalThis.postMessage({type:n,identifier:i,name:r})}))};globalThis.addEventListener("message",u)})},defaultOptions$1={singleProcess:!1},impl$1=r=>{if(r=Object.assign({},defaultOptions$1,r),!!globalThis.document||r.singleProcess){const t=new EventTarget;return observable.addEventListener("message",handleWorkerLockRequest(t,"requestReadLock",WORKER_REQUEST_READ_LOCK,WORKER_RELEASE_READ_LOCK,MASTER_GRANT_READ_LOCK)),observable.addEventListener("message",handleWorkerLockRequest(t,"requestWriteLock",WORKER_REQUEST_WRITE_LOCK,WORKER_RELEASE_WRITE_LOCK,MASTER_GRANT_WRITE_LOCK)),t}return{isWorker:!0,readLock:t=>makeWorkerLockRequest(t,WORKER_REQUEST_READ_LOCK,MASTER_GRANT_READ_LOCK,WORKER_RELEASE_READ_LOCK),writeLock:t=>makeWorkerLockRequest(t,WORKER_REQUEST_WRITE_LOCK,MASTER_GRANT_WRITE_LOCK,WORKER_RELEASE_WRITE_LOCK)}},mutexes={};let implementation;async function createReleaseable(r,e){let t;const n=new Promise(i=>{t=i});return r.add(async()=>await pTimeout((async()=>await new Promise(i=>{t(()=>{i()})}))(),{milliseconds:e.timeout})),await n}const createMutex=(r,e)=>{if(implementation.isWorker===!0)return{readLock:implementation.readLock(r,e),writeLock:implementation.writeLock(r,e)};const t=new PQueue({concurrency:1});let n;return{async readLock(){if(n!=null)return await createReleaseable(n,e);n=new PQueue({concurrency:e.concurrency,autoStart:!1});const i=n,s=createReleaseable(n,e);return t.add(async()=>(i.start(),await i.onIdle().then(()=>{n===i&&(n=null)}))),await s},async writeLock(){return n=null,await createReleaseable(t,e)}}},defaultOptions={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function createMortice(r){const e=Object.assign({},defaultOptions,r);return implementation==null&&(implementation=impl$1(e),implementation.isWorker!==!0&&(implementation.addEventListener("requestReadLock",t=>{mutexes[t.data.name]!=null&&mutexes[t.data.name].readLock().then(async n=>await t.data.handler().finally(()=>n()))}),implementation.addEventListener("requestWriteLock",async t=>{mutexes[t.data.name]!=null&&mutexes[t.data.name].writeLock().then(async n=>await t.data.handler().finally(()=>n()))}))),mutexes[e.name]==null&&(mutexes[e.name]=createMutex(e.name,e)),mutexes[e.name]}var itBatch,hasRequiredItBatch;function requireItBatch(){if(hasRequiredItBatch)return itBatch;hasRequiredItBatch=1;async function*r(e,t=1){let n=[];t<1&&(t=1);for await(const i of e)for(n.push(i);n.length>=t;)yield n.slice(0,t),n=n.slice(t);for(;n.length;)yield n.slice(0,t),n=n.slice(t)}return itBatch=r,itBatch}var itParallelBatch,hasRequiredItParallelBatch;function requireItParallelBatch(){if(hasRequiredItParallelBatch)return itParallelBatch;hasRequiredItParallelBatch=1;const r=requireItBatch();async function*e(t,n=1){for await(const i of r(t,n)){const s=i.map(u=>u().then(c=>({ok:!0,value:c}),c=>({ok:!1,err:c})));for(let u=0;u<s.length;u++){const c=await s[u];if(c.ok)yield c.value;else throw c.err}}}return itParallelBatch=e,itParallelBatch}var itParallelBatchExports=requireItParallelBatch();const parallelBatch=getDefaultExportFromCjs(itParallelBatchExports);async function*merge$1(...r){const e=pushable({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all(r.map(async t=>{for await(const n of t)e.push(n)})),e.end()}catch(t){e.end(t)}}),yield*e}const rawPipe=(...r)=>{let e;for(;r.length>0;)e=r.shift()(e);return e},isIterable=r=>r!=null&&(typeof r[Symbol.asyncIterator]=="function"||typeof r[Symbol.iterator]=="function"||typeof r.next=="function"),isDuplex=r=>r!=null&&typeof r.sink=="function"&&isIterable(r.source),duplexPipelineFn=r=>e=>{const t=r.sink(e);if(t.then!=null){const n=pushable({objectMode:!0});return t.then(()=>{n.end()},s=>{n.end(s)}),merge$1(n,async function*(){yield*r.source,n.end()}())}return r.source};function pipe(r,...e){if(isDuplex(r)){const n=r;r=()=>n.source}else if(isIterable(r)){const n=r;r=()=>n}const t=[r,...e];if(t.length>1&&isDuplex(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let n=1;n<t.length-1;n++)isDuplex(t[n])&&(t[n]=duplexPipelineFn(t[n]));return rawPipe(...t)}var fixedSize,hasRequiredFixedSize;function requireFixedSize(){return hasRequiredFixedSize||(hasRequiredFixedSize=1,fixedSize=class{constructor(e){if(!(e>0)||(e-1&e)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return this.buffer[this.btm]===void 0}}),fixedSize}var fastFifo,hasRequiredFastFifo;function requireFastFifo(){if(hasRequiredFastFifo)return fastFifo;hasRequiredFastFifo=1;const r=requireFixedSize();return fastFifo=class{constructor(t){this.hwm=t||16,this.head=new r(this.hwm),this.tail=this.head}push(t){if(!this.head.push(t)){const n=this.head;this.head=n.next=new r(2*this.head.buffer.length),this.head.push(t)}}shift(){const t=this.tail.shift();if(t===void 0&&this.tail.next){const n=this.tail.next;return this.tail.next=null,this.tail=n,this.tail.shift()}return t}peek(){return this.tail.peek()}isEmpty(){return this.head.isEmpty()}},fastFifo}var itPushable,hasRequiredItPushable;function requireItPushable(){if(hasRequiredItPushable)return itPushable;hasRequiredItPushable=1;const r=requireFastFifo();return itPushable=e=>{e=e||{};let t;typeof e=="function"?(t=e,e={}):t=e.onEnd;let n=new r,i,s,u;const c=()=>{if(!n.isEmpty()){if(e.writev){let w;const v=[];for(;!n.isEmpty();){if(w=n.shift(),w.error)throw w.error;v.push(w.value)}return{done:w.done,value:v}}const y=n.shift();if(y.error)throw y.error;return y}return u?{done:!0}:new Promise((y,w)=>{s=v=>(s=null,v.error?w(v.error):e.writev&&!v.done?y({done:v.done,value:[v.value]}):y(v),i)})},d=y=>s?s(y):(n.push(y),i),g=y=>(n=new r,s?s({error:y}):(n.push({error:y}),i)),_=y=>u?i:d({done:!1,value:y}),f=y=>u?i:(u=!0,y?g(y):d({done:!0})),l=()=>(n=new r,f(),{done:!0}),h=y=>(f(y),{done:!0});if(i={[Symbol.asyncIterator](){return this},next:c,return:l,throw:h,push:_,end:f},!t)return i;const p=i;return i={[Symbol.asyncIterator](){return this},next(){return p.next()},throw(y){return p.throw(y),t&&(t(y),t=null),{done:!0}},return(){return p.return(),t&&(t(),t=null),{done:!0}},push:_,end(y){return p.end(y),t&&(t(y),t=null),i}},i},itPushable}var itMerge,hasRequiredItMerge;function requireItMerge(){if(hasRequiredItMerge)return itMerge;hasRequiredItMerge=1;const r=requireItPushable();return itMerge=async function*(...t){const n=r();setTimeout(async()=>{try{await Promise.all(t.map(async i=>{for await(const s of i)n.push(s)})),n.end()}catch(i){n.end(i)}},0),yield*n},itMerge}var itMergeExports=requireItMerge();const merge=getDefaultExportFromCjs(itMergeExports),log$1=debug$2("ipfs:repo:gc"),ERR_NOT_FOUND=notFoundError().code,BLOCK_RM_CONCURRENCY=256,MFS_ROOT_KEY=new Key("/local/filesroot");function gc({gcLock:r,pins:e,blockstore:t,root:n,loadCodec:i}){async function*s(){const u=Date.now();log$1("Creating set of marked blocks");const c=await r.writeLock();try{const d=await createMarkedSet({pins:e,blockstore:t,root:n,loadCodec:i}),g=t.queryKeys({});yield*deleteUnmarkedBlocks({blockstore:t},d,g),log$1(`Complete (${Date.now()-u}ms)`)}finally{c()}}return s}async function createMarkedSet({pins:r,blockstore:e,loadCodec:t,root:n}){const i=async function*(){let c;try{c=await n.get(MFS_ROOT_KEY)}catch(g){if(g.code===ERR_NOT_FOUND){log$1("No blocks in MFS");return}throw g}const d=CID$1.decode(c);yield d,yield*walkDag(d,e,t)}(),s=merge(map$1(r.recursiveKeys(),({cid:c})=>c),r.indirectKeys(),map$1(r.directKeys(),({cid:c})=>c),i),u=new Set;for await(const c of merge(s,i))u.add(base32$7.encode(c.multihash.bytes));return u}async function*deleteUnmarkedBlocks({blockstore:r},e,t){let n=0,i=0;yield*pipe(parallelBatch(map$1(t,async u=>async function(){n++;try{const d=base32$7.encode(u.multihash.bytes);if(e.has(d))return null;try{await r.delete(u),i++}catch(g){return{err:new Error(`Could not delete block with CID ${u}: ${g.message}`)}}return{cid:u}}catch(d){const g=`Could delete block with CID ${u}`;return log$1(g,d),{err:new Error(g+`: ${d.message}`)}}}),BLOCK_RM_CONCURRENCY),u=>filter$2(u,Boolean)),log$1(`Marked set has ${e.size} unique blocks. Blockstore has ${n} blocks. Deleted ${i} blocks.`)}const log=debug$2("ipfs:repo"),noLimit=Number.MAX_SAFE_INTEGER,AUTO_MIGRATE_CONFIG_KEY="repoAutoMigrate";class Repo{constructor(e,t,n,i){if(typeof e!="string")throw new Error("missing repo path");if(typeof t!="function")throw new Error("missing codec loader");this.options=mergeOptions(defaultOptions$2,i),this.closed=!0,this.path=e,this.root=n.root,this.datastore=n.datastore,this.keys=n.keys;const s=n.blocks,u=n.pins;this.pins=new PinManager({pinstore:u,blockstore:s,loadCodec:t});const c=createPinnedBlockstore(this.pins,s);this.blocks=createIdStore(c),this.version=version(this.root),this.config=config(this.root),this.spec=spec(this.root),this.apiAddr=apiAddr(this.root),this.gcLock=createMortice({name:e,singleProcess:this.options.repoOwner!==!1}),this.gc=gc({gcLock:this.gcLock,pins:this.pins,blockstore:this.blocks,root:this.root,loadCodec:t})}async init(e){log("initializing at: %s",this.path),await this._openRoot(),await this.config.replace(buildConfig(e)),await this.spec.set(buildDatastoreSpec(e)),await this.version.set(repoVersion)}async isInitialized(){if(!this.closed)return!0;try{return await this._openRoot(),await this._checkInitialized(),await this.root.close(),!0}catch{return!1}}async open(){if(!this.closed)throw errcode(new Error("repo is already open"),ERR_REPO_ALREADY_OPEN);log("opening at: %s",this.path);try{if(await this._openRoot(),await this._checkInitialized(),this._lockfile=await this._openLock(),log("acquired repo.lock"),!await this.version.check(repoVersion))if(await this._isAutoMigrationEnabled())await this._migrate(repoVersion,{root:this.root,datastore:this.datastore,pins:this.pins.pinstore,blocks:this.pins.blockstore,keys:this.keys});else throw new InvalidRepoVersionError("Incompatible repo versions. Automatic migrations disabled. Please migrate the repo manually.");log("creating datastore"),await this.datastore.open(),log("creating blocks"),await this.blocks.open(),log("creating keystore"),await this.keys.open(),log("creating pins"),await this.pins.pinstore.open(),this.closed=!1,log("all opened")}catch(e){if(this._lockfile)try{await this._closeLock(),this._lockfile=null}catch(t){log("error removing lock",t)}throw e}}async _openRoot(){try{await this.root.open()}catch(e){if(e.message!=="Already open")throw e}}async _openLock(){const e=await this.options.repoLock.lock(this.path);if(typeof e.close!="function")throw errcode(new Error("Locks must have a close method"),"ERR_NO_CLOSE_FUNCTION");return e}_closeLock(){return this._lockfile&&this._lockfile.close()}async _checkInitialized(){log("init check");let e;try{[e]=await Promise.all([this.config.exists(),this.spec.exists(),this.version.exists()])}catch(t){throw t.code==="ERR_NOT_FOUND"?errcode(new Error("repo is not initialized yet"),ERR_REPO_NOT_INITIALIZED,{path:this.path}):t}if(!e)throw errcode(new Error("repo is not initialized yet"),ERR_REPO_NOT_INITIALIZED,{path:this.path})}async close(){if(this.closed)throw errcode(new Error("repo is already closed"),ERR_REPO_ALREADY_CLOSED);log("closing at: %s",this.path);try{await this.apiAddr.delete()}catch(e){if(e.code!==ERR_REPO_NOT_INITIALIZED&&!e.message.startsWith("ENOENT"))throw e}await Promise.all([this.root,this.blocks,this.keys,this.datastore,this.pins.pinstore].map(e=>e&&e.close())),log("unlocking"),this.closed=!0,await this._closeLock()}exists(){return this.version.exists()}async stat(){if(this.datastore&&this.keys){const[e,t,n,i,s]=await Promise.all([this._storageMaxStat(),this._blockStat(),this.version.get(),getSize(this.datastore),getSize(this.keys)]),u=t.size+i+s;return{repoPath:this.path,storageMax:e,version:n,numObjects:t.count,repoSize:u}}throw errcode(new Error("repo is not initialized yet"),ERR_REPO_NOT_INITIALIZED,{path:this.path})}async _isAutoMigrationEnabled(){if(this.options.autoMigrate!==void 0)return this.options.autoMigrate;let e;try{e=await this.config.get(AUTO_MIGRATE_CONFIG_KEY)}catch(t){if(t.code===NotFoundError.code)e=!0;else throw t}return e}async _migrate(e,t){return await this.version.get()>e?(log(`reverting to version ${e}`),revert(this.path,t,this.options,e,{ignoreLock:!0,onProgress:this.options.onMigrationProgress})):(log(`migrating to version ${e}`),migrate(this.path,t,this.options,e,{ignoreLock:!0,onProgress:this.options.onMigrationProgress}))}async _storageMaxStat(){try{const e=await this.config.get("Datastore.StorageMax");return BigInt(bytes(e))}catch{return BigInt(noLimit)}}async _blockStat(){let e=BigInt(0),t=BigInt(0);if(this.blocks)for await(const{key:n,value:i}of this.blocks.query({}))e+=BigInt(1),t+=BigInt(i.byteLength),t+=BigInt(n.bytes.byteLength);return{count:e,size:t}}}async function getSize(r){let e=BigInt(0);for await(const t of r.query({}))e+=BigInt(t.value.byteLength),e+=BigInt(t.key.uint8Array().byteLength);return e}function createRepo(r,e,t,n){return new Repo(r,e,t,n)}function buildConfig(r){return r.Datastore=Object.assign({},defaultDatastore,objectSafeGet(r,"datastore")),r}function buildDatastoreSpec(r){const e={...defaultDatastore.Spec,...objectSafeGet(r,"Datastore.Spec")};return{type:e.type,mounts:e.mounts.map(t=>({mountpoint:t.mountpoint,type:t.child.type,path:t.child.path,shardFunc:t.child.shardFunc}))}}var itTake,hasRequiredItTake;function requireItTake(){return hasRequiredItTake||(hasRequiredItTake=1,itTake=async function*(e,t){let n=0;if(!(t<1)){for await(const i of e)if(yield i,n++,n===t)return}}),itTake}var itTakeExports=requireItTake();const take$2=getDefaultExportFromCjs(itTakeExports);var itAll,hasRequiredItAll;function requireItAll(){return hasRequiredItAll||(hasRequiredItAll=1,itAll=async e=>{const t=[];for await(const n of e)t.push(n);return t}),itAll}var itAllExports=requireItAll();const all$2=getDefaultExportFromCjs(itAllExports),sortAll$1=(r,e)=>async function*(){yield*(await all$2(r)).sort(e)}();class BaseBlockstore{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:n,value:i}of e)await this.put(n,i,t),yield{key:n,value:i}}async*getMany(e,t={}){for await(const n of e)yield this.get(n,t)}async*deleteMany(e,t={}){for await(const n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,i){e.push({key:n,value:i})},delete(n){t.push(n)},commit:async n=>{await drain$1(this.putMany(e,n)),e=[],await drain$1(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null&&(n=filter$2(n,i=>i.key.toString().startsWith(e.prefix||""))),Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>filter$2(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>sortAll$1(i,s),n)),e.offset!=null){let i=0;n=filter$2(n,()=>i++>=(e.offset||0))}return e.limit!=null&&(n=take$2(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null&&(n=filter$2(n,i=>i.toString().startsWith(e.prefix||""))),Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>filter$2(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>sortAll$1(i,s),n)),e.offset!=null){let i=0;n=filter$2(n,()=>i++>=e.offset)}return e.limit!=null&&(n=take$2(n,e.limit)),n}}function cidToKey(r){const e=CID$1.asCID(r);if(!e)throw errcode(new Error("Not a valid cid"),"ERR_INVALID_CID");return new Key("/"+base32$7.encode(e.multihash.bytes).slice(1).toUpperCase(),!1)}function keyToCid(r){return CID$1.createV1(code$2,decode$h(base32$7.decode("b"+r.toString().slice(1).toLowerCase())))}function convertPrefix(r){const e=r.substring(0,1);if(e==="/")return convertPrefix(r.substring(1));let t;e.toLowerCase()==="b"?t=s=>base32$7.decode(s.toLowerCase()).subarray(2):e.toLowerCase()==="c"?t=s=>base32pad$3.decode(s.toLowerCase()).subarray(2):e==="z"?t=s=>base58btc$4.decode(s).subarray(2):e==="Q"?t=s=>base58btc$4.decode("z"+s):t=s=>base32$7.decode("b"+s.toLowerCase()).subarray(2);let n;for(let s=1;s<r.length;s++)try{n=t(r.substring(0,s))}catch(u){if(u.message!=="Unexpected end of data")throw u}let i="/C";return n&&(i=`/${base32$7.encode(n).slice(1,-1).toUpperCase()||"C"}`),i}function convertQuery(r){return{...r,prefix:r.prefix?convertPrefix(r.prefix):void 0,filters:r.filters?r.filters.map(e=>t=>e({key:keyToCid(t.key),value:t.value})):void 0,orders:r.orders?r.orders.map(e=>(t,n)=>e({key:keyToCid(t.key),value:t.value},{key:keyToCid(n.key),value:n.value})):void 0}}function convertKeyQuery(r){return{...r,prefix:r.prefix?convertPrefix(r.prefix):void 0,filters:r.filters?r.filters.map(e=>t=>e(keyToCid(t))):void 0,orders:r.orders?r.orders.map(e=>(t,n)=>e(keyToCid(t),keyToCid(n))):void 0}}class BlockstoreDatastoreAdapter extends BaseBlockstore{constructor(e){super(),this.child=e}open(){return this.child.open()}close(){return this.child.close()}async*query(e,t){for await(const{key:n,value:i}of this.child.query(convertQuery(e),t))yield{key:keyToCid(n),value:i}}async*queryKeys(e,t){for await(const n of this.child.queryKeys(convertKeyQuery(e),t))yield keyToCid(n)}async get(e,t){return this.child.get(cidToKey(e),t)}async*getMany(e,t){for await(const n of e)yield this.get(n,t)}async put(e,t,n){await this.child.put(cidToKey(e),t,n)}async*putMany(e,t){const n=pushable({objectMode:!0});(globalThis.process&&globalThis.process.nextTick?globalThis.process.nextTick:globalThis.setImmediate||globalThis.setTimeout)(async()=>{try{const s=this.child;await drain$1(this.child.putMany(async function*(){for await(const u of e){const c=cidToKey(u.key);await s.has(c,t)||(yield{key:c,value:u.value}),n.push(u)}}())),n.end()}catch(s){n.end(s)}}),yield*n}has(e,t){return this.child.has(cidToKey(e),t)}delete(e,t){return this.child.delete(cidToKey(e),t)}deleteMany(e,t){const n=pushable({objectMode:!0});return drain$1(this.child.deleteMany(async function*(){for await(const i of e)yield cidToKey(i),n.push(i);n.end()}(),t)).catch(i=>{n.end(i)}),n}}async function all$1(r){const e=[];for await(const t of r)e.push(t);return e}const sortAll=(r,e)=>async function*(){yield*(await all$1(r)).sort(e)}();async function drain(r){for await(const e of r);}async function*filter$1(r,e){for await(const t of r)await e(t)&&(yield t)}async function*take$1(r,e){let t=0;if(!(e<1)){for await(const n of r)if(yield n,t++,t===e)return}}class BaseDatastore{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:n,value:i}of e)await this.put(n,i,t),yield{key:n,value:i}}async*getMany(e,t={}){for await(const n of e)yield this.get(n,t)}async*deleteMany(e,t={}){for await(const n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,i){e.push({key:n,value:i})},delete(n){t.push(n)},commit:async n=>{await drain(this.putMany(e,n)),e=[],await drain(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null&&(n=filter$1(n,i=>i.key.toString().startsWith(e.prefix))),Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>filter$1(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>sortAll(i,s),n)),e.offset!=null){let i=0;n=filter$1(n,()=>i++>=e.offset)}return e.limit!=null&&(n=take$1(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null&&(n=filter$1(n,i=>i.toString().startsWith(e.prefix))),Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>filter$1(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>sortAll(i,s),n)),e.offset!=null){let i=0;n=filter$1(n,()=>i++>=e.offset)}return e.limit!=null&&(n=take$1(n,e.limit)),n}}class MemoryDatastore extends BaseDatastore{constructor(){super(),this.data={}}open(){return Promise.resolve()}close(){return Promise.resolve()}async put(e,t){this.data[e.toString()]=t}async get(e){if(!await this.has(e))throw notFoundError();return this.data[e.toString()]}async has(e){return this.data[e.toString()]!==void 0}async delete(e){delete this.data[e.toString()]}async*_all(){yield*Object.entries(this.data).map(([e,t])=>({key:new Key(e),value:t}))}async*_allKeys(){yield*Object.entries(this.data).map(([e])=>new Key(e))}}const SHARDING_FN="SHARDING",README_FN="_README";async function*map(r,e){for await(const t of r)yield e(t)}new Key(SHARDING_FN);new Key(README_FN);var browser$1={exports:{}},ms,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms;hasRequiredMs=1;var r=1e3,e=r*60,t=e*60,n=t*24,i=n*7,s=n*365.25;ms=function(_,f){f=f||{};var l=typeof _;if(l==="string"&&_.length>0)return u(_);if(l==="number"&&isFinite(_))return f.long?d(_):c(_);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(_))};function u(_){if(_=String(_),!(_.length>100)){var f=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(_);if(f){var l=parseFloat(f[1]),h=(f[2]||"ms").toLowerCase();switch(h){case"years":case"year":case"yrs":case"yr":case"y":return l*s;case"weeks":case"week":case"w":return l*i;case"days":case"day":case"d":return l*n;case"hours":case"hour":case"hrs":case"hr":case"h":return l*t;case"minutes":case"minute":case"mins":case"min":case"m":return l*e;case"seconds":case"second":case"secs":case"sec":case"s":return l*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return}}}}function c(_){var f=Math.abs(_);return f>=n?Math.round(_/n)+"d":f>=t?Math.round(_/t)+"h":f>=e?Math.round(_/e)+"m":f>=r?Math.round(_/r)+"s":_+"ms"}function d(_){var f=Math.abs(_);return f>=n?g(_,f,n,"day"):f>=t?g(_,f,t,"hour"):f>=e?g(_,f,e,"minute"):f>=r?g(_,f,r,"second"):_+" ms"}function g(_,f,l,h){var p=f>=l*1.5;return Math.round(_/l)+" "+h+(p?"s":"")}return ms}var common$1,hasRequiredCommon$1;function requireCommon$1(){if(hasRequiredCommon$1)return common$1;hasRequiredCommon$1=1;function r(e){n.debug=n,n.default=n,n.coerce=g,n.disable=u,n.enable=s,n.enabled=c,n.humanize=requireMs(),n.destroy=_,Object.keys(e).forEach(f=>{n[f]=e[f]}),n.names=[],n.skips=[],n.formatters={};function t(f){let l=0;for(let h=0;h<f.length;h++)l=(l<<5)-l+f.charCodeAt(h),l|=0;return n.colors[Math.abs(l)%n.colors.length]}n.selectColor=t;function n(f){let l,h=null,p,y;function w(...v){if(!w.enabled)return;const C=w,P=Number(new Date),R=P-(l||P);C.diff=R,C.prev=l,C.curr=P,l=P,v[0]=n.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let F=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(B,H)=>{if(B==="%%")return"%";F++;const re=n.formatters[H];if(typeof re=="function"){const le=v[F];B=re.call(C,le),v.splice(F,1),F--}return B}),n.formatArgs.call(C,v),(C.log||n.log).apply(C,v)}return w.namespace=f,w.useColors=n.useColors(),w.color=n.selectColor(f),w.extend=i,w.destroy=n.destroy,Object.defineProperty(w,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(p!==n.namespaces&&(p=n.namespaces,y=n.enabled(f)),y),set:v=>{h=v}}),typeof n.init=="function"&&n.init(w),w}function i(f,l){const h=n(this.namespace+(typeof l>"u"?":":l)+f);return h.log=this.log,h}function s(f){n.save(f),n.namespaces=f,n.names=[],n.skips=[];let l;const h=(typeof f=="string"?f:"").split(/[\s,]+/),p=h.length;for(l=0;l<p;l++)h[l]&&(f=h[l].replace(/\*/g,".*?"),f[0]==="-"?n.skips.push(new RegExp("^"+f.slice(1)+"$")):n.names.push(new RegExp("^"+f+"$")))}function u(){const f=[...n.names.map(d),...n.skips.map(d).map(l=>"-"+l)].join(",");return n.enable(""),f}function c(f){if(f[f.length-1]==="*")return!0;let l,h;for(l=0,h=n.skips.length;l<h;l++)if(n.skips[l].test(f))return!1;for(l=0,h=n.names.length;l<h;l++)if(n.names[l].test(f))return!0;return!1}function d(f){return f.toString().substring(2,f.toString().length-2).replace(/\.\*\?$/,"*")}function g(f){return f instanceof Error?f.stack||f.message:f}function _(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}return common$1=r,common$1}var hasRequiredBrowser$1;function requireBrowser$1(){return hasRequiredBrowser$1||(hasRequiredBrowser$1=1,function(r,e){var t={};e.formatArgs=i,e.save=s,e.load=u,e.useColors=n,e.storage=c(),e.destroy=(()=>{let g=!1;return()=>{g||(g=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(g){if(g[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+g[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const _="color: "+this.color;g.splice(1,0,_,"color: inherit");let f=0,l=0;g[0].replace(/%[a-zA-Z%]/g,h=>{h!=="%%"&&(f++,h==="%c"&&(l=f))}),g.splice(l,0,_)}e.log=console.debug||console.log||(()=>{});function s(g){try{g?e.storage.setItem("debug",g):e.storage.removeItem("debug")}catch{}}function u(){let g;try{g=e.storage.getItem("debug")}catch{}return!g&&typeof process<"u"&&"env"in process&&(g=t.DEBUG),g}function c(){try{return localStorage}catch{}}r.exports=requireCommon$1()(e);const{formatters:d}=r.exports;d.j=function(g){try{return JSON.stringify(g)}catch(_){return"[UnexpectedJSONParseError]: "+_.message}}}(browser$1,browser$1.exports)),browser$1.exports}var browserExports$1=requireBrowser$1();const debug=getDefaultExportFromCjs(browserExports$1);function base(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),u=s.charCodeAt(0);if(t[u]!==255)throw new TypeError(s+" is ambiguous");t[u]=i}var c=r.length,d=r.charAt(0),g=Math.log(c)/Math.log(256),_=Math.log(256)/Math.log(c);function f(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var y=0,w=0,v=0,C=p.length;v!==C&&p[v]===0;)v++,y++;for(var P=(C-v)*_+1>>>0,R=new Uint8Array(P);v!==C;){for(var F=p[v],k=0,B=P-1;(F!==0||k<w)&&B!==-1;B--,k++)F+=256*R[B]>>>0,R[B]=F%c>>>0,F=F/c>>>0;if(F!==0)throw new Error("Non-zero carry");w=k,v++}for(var H=P-w;H!==P&&R[H]===0;)H++;for(var re=d.repeat(y);H<P;++H)re+=r.charAt(R[H]);return re}function l(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var y=0;if(p[y]!==" "){for(var w=0,v=0;p[y]===d;)w++,y++;for(var C=(p.length-y)*g+1>>>0,P=new Uint8Array(C);p[y];){var R=t[p.charCodeAt(y)];if(R===255)return;for(var F=0,k=C-1;(R!==0||F<v)&&k!==-1;k--,F++)R+=c*P[k]>>>0,P[k]=R%256>>>0,R=R/256>>>0;if(R!==0)throw new Error("Non-zero carry");v=F,y++}if(p[y]!==" "){for(var B=C-v;B!==C&&P[B]===0;)B++;for(var H=new Uint8Array(w+(C-B)),re=w;B!==C;)H[re++]=P[B++];return H}}}function h(p){var y=l(p);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:l,decode:h}}var src=base,_brrp__multiformats_scope_baseX=src;const coerce=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};class Encoder{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Decoder{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or(this,e)}}class ComposedDecoder{constructor(e){this.decoders=e}or(e){return or(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const or=(r,e)=>new ComposedDecoder({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class Codec{constructor(e,t,n,i){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Encoder(e,t,n),this.decoder=new Decoder(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const from=({name:r,prefix:e,encode:t,decode:n})=>new Codec(r,e,t,n),baseX=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:i}=_brrp__multiformats_scope_baseX(t,e);return from({prefix:r,name:e,encode:n,decode:s=>coerce(i(s))})},decode=(r,e,t,n)=>{const i={};for(let _=0;_<e.length;++_)i[e[_]]=_;let s=r.length;for(;r[s-1]==="=";)--s;const u=new Uint8Array(s*t/8|0);let c=0,d=0,g=0;for(let _=0;_<s;++_){const f=i[r[_]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);d=d<<t|f,c+=t,c>=8&&(c-=8,u[g++]=255&d>>c)}if(c>=t||255&d<<8-c)throw new SyntaxError("Unexpected end of data");return u},encode=(r,e,t)=>{const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",u=0,c=0;for(let d=0;d<r.length;++d)for(c=c<<8|r[d],u+=8;u>t;)u-=t,s+=e[i&c>>u];if(u&&(s+=e[i&c<<t-u]),n)for(;s.length*t&7;)s+="=";return s},rfc4648=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>from({prefix:e,name:r,encode(i){return encode(i,n,t)},decode(i){return decode(i,n,t,r)}}),base58btc=baseX({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});baseX({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const base32=rfc4648({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});rfc4648({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});rfc4648({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});rfc4648({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});rfc4648({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});rfc4648({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});rfc4648({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});rfc4648({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});rfc4648({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const base64=rfc4648({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});rfc4648({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});rfc4648({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});rfc4648({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});debug.formatters.b=r=>r==null?"undefined":base58btc.baseEncode(r);debug.formatters.t=r=>r==null?"undefined":base32.baseEncode(r);debug.formatters.m=r=>r==null?"undefined":base64.baseEncode(r);debug.formatters.p=r=>r==null?"undefined":r.toString();debug.formatters.c=r=>r==null?"undefined":r.toString();debug.formatters.k=r=>r==null?"undefined":r.toString();function logger(r){return Object.assign(debug(r),{error:debug(`${r}:error`),trace:debug(`${r}:trace`)})}logger("datastore:core:tiered");async function*filter(r,e){for await(const t of r)await e(t)&&(yield t)}async function*take(r,e){let t=0;if(!(e<1)){for await(const n of r)if(yield n,t++,t===e)return}}async function all(r){const e=[];for await(const t of r)e.push(t);return e}async function*sort(r,e){yield*(await all(r)).sort(e)}var browser={},browserLevel={},abstractLevel$1={},abstractLevel={},levelSupports={},hasRequiredLevelSupports;function requireLevelSupports(){return hasRequiredLevelSupports||(hasRequiredLevelSupports=1,levelSupports.supports=function(...e){const t=e.reduce((n,i)=>Object.assign(n,i),{});return Object.assign(t,{snapshots:t.snapshots||!1,permanence:t.permanence||!1,seek:t.seek||!1,clear:t.clear||!1,getMany:t.getMany||!1,keyIterator:t.keyIterator||!1,valueIterator:t.valueIterator||!1,iteratorNextv:t.iteratorNextv||!1,iteratorAll:t.iteratorAll||!1,status:t.status||!1,createIfMissing:t.createIfMissing||!1,errorIfExists:t.errorIfExists||!1,deferredOpen:t.deferredOpen||!1,promises:t.promises||!1,streams:t.streams||!1,encodings:Object.assign({},t.encodings),events:Object.assign({},t.events),additionalMethods:Object.assign({},t.additionalMethods)})}),levelSupports}var levelTranscoder={},moduleError,hasRequiredModuleError;function requireModuleError(){return hasRequiredModuleError||(hasRequiredModuleError=1,moduleError=class extends Error{constructor(e,t){super(e||""),typeof t=="object"&&t!==null&&(t.code&&(this.code=String(t.code)),t.expected&&(this.expected=!0),t.transient&&(this.transient=!0),t.cause&&(this.cause=t.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}),moduleError}var encodings={},buffer={},base64Js={},hasRequiredBase64Js;function requireBase64Js(){if(hasRequiredBase64Js)return base64Js;hasRequiredBase64Js=1,base64Js.byteLength=c,base64Js.toByteArray=g,base64Js.fromByteArray=l;for(var r=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,s=n.length;i<s;++i)r[i]=n[i],e[n.charCodeAt(i)]=i;e[45]=62,e[95]=63;function u(h){var p=h.length;if(p%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var y=h.indexOf("=");y===-1&&(y=p);var w=y===p?0:4-y%4;return[y,w]}function c(h){var p=u(h),y=p[0],w=p[1];return(y+w)*3/4-w}function d(h,p,y){return(p+y)*3/4-y}function g(h){var p,y=u(h),w=y[0],v=y[1],C=new t(d(h,w,v)),P=0,R=v>0?w-4:w,F;for(F=0;F<R;F+=4)p=e[h.charCodeAt(F)]<<18|e[h.charCodeAt(F+1)]<<12|e[h.charCodeAt(F+2)]<<6|e[h.charCodeAt(F+3)],C[P++]=p>>16&255,C[P++]=p>>8&255,C[P++]=p&255;return v===2&&(p=e[h.charCodeAt(F)]<<2|e[h.charCodeAt(F+1)]>>4,C[P++]=p&255),v===1&&(p=e[h.charCodeAt(F)]<<10|e[h.charCodeAt(F+1)]<<4|e[h.charCodeAt(F+2)]>>2,C[P++]=p>>8&255,C[P++]=p&255),C}function _(h){return r[h>>18&63]+r[h>>12&63]+r[h>>6&63]+r[h&63]}function f(h,p,y){for(var w,v=[],C=p;C<y;C+=3)w=(h[C]<<16&16711680)+(h[C+1]<<8&65280)+(h[C+2]&255),v.push(_(w));return v.join("")}function l(h){for(var p,y=h.length,w=y%3,v=[],C=16383,P=0,R=y-w;P<R;P+=C)v.push(f(h,P,P+C>R?R:P+C));return w===1?(p=h[y-1],v.push(r[p>>2]+r[p<<4&63]+"==")):w===2&&(p=(h[y-2]<<8)+h[y-1],v.push(r[p>>10]+r[p>>4&63]+r[p<<2&63]+"=")),v.join("")}return base64Js}var ieee754={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var hasRequiredIeee754;function requireIeee754(){return hasRequiredIeee754||(hasRequiredIeee754=1,ieee754.read=function(r,e,t,n,i){var s,u,c=i*8-n-1,d=(1<<c)-1,g=d>>1,_=-7,f=t?i-1:0,l=t?-1:1,h=r[e+f];for(f+=l,s=h&(1<<-_)-1,h>>=-_,_+=c;_>0;s=s*256+r[e+f],f+=l,_-=8);for(u=s&(1<<-_)-1,s>>=-_,_+=n;_>0;u=u*256+r[e+f],f+=l,_-=8);if(s===0)s=1-g;else{if(s===d)return u?NaN:(h?-1:1)*(1/0);u=u+Math.pow(2,n),s=s-g}return(h?-1:1)*u*Math.pow(2,s-n)},ieee754.write=function(r,e,t,n,i,s){var u,c,d,g=s*8-i-1,_=(1<<g)-1,f=_>>1,l=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:s-1,p=n?1:-1,y=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(c=isNaN(e)?1:0,u=_):(u=Math.floor(Math.log(e)/Math.LN2),e*(d=Math.pow(2,-u))<1&&(u--,d*=2),u+f>=1?e+=l/d:e+=l*Math.pow(2,1-f),e*d>=2&&(u++,d/=2),u+f>=_?(c=0,u=_):u+f>=1?(c=(e*d-1)*Math.pow(2,i),u=u+f):(c=e*Math.pow(2,f-1)*Math.pow(2,i),u=0));i>=8;r[t+h]=c&255,h+=p,c/=256,i-=8);for(u=u<<i|c,g+=i;g>0;r[t+h]=u&255,h+=p,u/=256,g-=8);r[t+h-p]|=y*128}),ieee754}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var hasRequiredBuffer;function requireBuffer(){return hasRequiredBuffer||(hasRequiredBuffer=1,function(r){const e=requireBase64Js(),t=requireIeee754(),n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;r.Buffer=c,r.SlowBuffer=C,r.INSPECT_MAX_BYTES=50;const i=2147483647;r.kMaxLength=i,c.TYPED_ARRAY_SUPPORT=s(),!c.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const S=new Uint8Array(1),b={foo:function(){return 42}};return Object.setPrototypeOf(b,Uint8Array.prototype),Object.setPrototypeOf(S,b),S.foo()===42}catch{return!1}}Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}});function u(S){if(S>i)throw new RangeError('The value "'+S+'" is invalid for option "size"');const b=new Uint8Array(S);return Object.setPrototypeOf(b,c.prototype),b}function c(S,b,E){if(typeof S=="number"){if(typeof b=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return f(S)}return d(S,b,E)}c.poolSize=8192;function d(S,b,E){if(typeof S=="string")return l(S,b);if(ArrayBuffer.isView(S))return p(S);if(S==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof S);if(Rt(S,ArrayBuffer)||S&&Rt(S.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Rt(S,SharedArrayBuffer)||S&&Rt(S.buffer,SharedArrayBuffer)))return y(S,b,E);if(typeof S=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const q=S.valueOf&&S.valueOf();if(q!=null&&q!==S)return c.from(q,b,E);const X=w(S);if(X)return X;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof S[Symbol.toPrimitive]=="function")return c.from(S[Symbol.toPrimitive]("string"),b,E);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof S)}c.from=function(S,b,E){return d(S,b,E)},Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array);function g(S){if(typeof S!="number")throw new TypeError('"size" argument must be of type number');if(S<0)throw new RangeError('The value "'+S+'" is invalid for option "size"')}function _(S,b,E){return g(S),S<=0?u(S):b!==void 0?typeof E=="string"?u(S).fill(b,E):u(S).fill(b):u(S)}c.alloc=function(S,b,E){return _(S,b,E)};function f(S){return g(S),u(S<0?0:v(S)|0)}c.allocUnsafe=function(S){return f(S)},c.allocUnsafeSlow=function(S){return f(S)};function l(S,b){if((typeof b!="string"||b==="")&&(b="utf8"),!c.isEncoding(b))throw new TypeError("Unknown encoding: "+b);const E=P(S,b)|0;let q=u(E);const X=q.write(S,b);return X!==E&&(q=q.slice(0,X)),q}function h(S){const b=S.length<0?0:v(S.length)|0,E=u(b);for(let q=0;q<b;q+=1)E[q]=S[q]&255;return E}function p(S){if(Rt(S,Uint8Array)){const b=new Uint8Array(S);return y(b.buffer,b.byteOffset,b.byteLength)}return h(S)}function y(S,b,E){if(b<0||S.byteLength<b)throw new RangeError('"offset" is outside of buffer bounds');if(S.byteLength<b+(E||0))throw new RangeError('"length" is outside of buffer bounds');let q;return b===void 0&&E===void 0?q=new Uint8Array(S):E===void 0?q=new Uint8Array(S,b):q=new Uint8Array(S,b,E),Object.setPrototypeOf(q,c.prototype),q}function w(S){if(c.isBuffer(S)){const b=v(S.length)|0,E=u(b);return E.length===0||S.copy(E,0,0,b),E}if(S.length!==void 0)return typeof S.length!="number"||ar(S.length)?u(0):h(S);if(S.type==="Buffer"&&Array.isArray(S.data))return h(S.data)}function v(S){if(S>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return S|0}function C(S){return+S!=S&&(S=0),c.alloc(+S)}c.isBuffer=function(b){return b!=null&&b._isBuffer===!0&&b!==c.prototype},c.compare=function(b,E){if(Rt(b,Uint8Array)&&(b=c.from(b,b.offset,b.byteLength)),Rt(E,Uint8Array)&&(E=c.from(E,E.offset,E.byteLength)),!c.isBuffer(b)||!c.isBuffer(E))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(b===E)return 0;let q=b.length,X=E.length;for(let Z=0,se=Math.min(q,X);Z<se;++Z)if(b[Z]!==E[Z]){q=b[Z],X=E[Z];break}return q<X?-1:X<q?1:0},c.isEncoding=function(b){switch(String(b).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(b,E){if(!Array.isArray(b))throw new TypeError('"list" argument must be an Array of Buffers');if(b.length===0)return c.alloc(0);let q;if(E===void 0)for(E=0,q=0;q<b.length;++q)E+=b[q].length;const X=c.allocUnsafe(E);let Z=0;for(q=0;q<b.length;++q){let se=b[q];if(Rt(se,Uint8Array))Z+se.length>X.length?(c.isBuffer(se)||(se=c.from(se)),se.copy(X,Z)):Uint8Array.prototype.set.call(X,se,Z);else if(c.isBuffer(se))se.copy(X,Z);else throw new TypeError('"list" argument must be an Array of Buffers');Z+=se.length}return X};function P(S,b){if(c.isBuffer(S))return S.length;if(ArrayBuffer.isView(S)||Rt(S,ArrayBuffer))return S.byteLength;if(typeof S!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof S);const E=S.length,q=arguments.length>2&&arguments[2]===!0;if(!q&&E===0)return 0;let X=!1;for(;;)switch(b){case"ascii":case"latin1":case"binary":return E;case"utf8":case"utf-8":return Wt(S).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E*2;case"hex":return E>>>1;case"base64":return er(S).length;default:if(X)return q?-1:Wt(S).length;b=(""+b).toLowerCase(),X=!0}}c.byteLength=P;function R(S,b,E){let q=!1;if((b===void 0||b<0)&&(b=0),b>this.length||((E===void 0||E>this.length)&&(E=this.length),E<=0)||(E>>>=0,b>>>=0,E<=b))return"";for(S||(S="utf8");;)switch(S){case"hex":return ne(this,b,E);case"utf8":case"utf-8":return lt(this,b,E);case"ascii":return Ee(this,b,E);case"latin1":case"binary":return z(this,b,E);case"base64":return ct(this,b,E);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ee(this,b,E);default:if(q)throw new TypeError("Unknown encoding: "+S);S=(S+"").toLowerCase(),q=!0}}c.prototype._isBuffer=!0;function F(S,b,E){const q=S[b];S[b]=S[E],S[E]=q}c.prototype.swap16=function(){const b=this.length;if(b%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let E=0;E<b;E+=2)F(this,E,E+1);return this},c.prototype.swap32=function(){const b=this.length;if(b%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let E=0;E<b;E+=4)F(this,E,E+3),F(this,E+1,E+2);return this},c.prototype.swap64=function(){const b=this.length;if(b%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let E=0;E<b;E+=8)F(this,E,E+7),F(this,E+1,E+6),F(this,E+2,E+5),F(this,E+3,E+4);return this},c.prototype.toString=function(){const b=this.length;return b===0?"":arguments.length===0?lt(this,0,b):R.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(b){if(!c.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b?!0:c.compare(this,b)===0},c.prototype.inspect=function(){let b="";const E=r.INSPECT_MAX_BYTES;return b=this.toString("hex",0,E).replace(/(.{2})/g,"$1 ").trim(),this.length>E&&(b+=" ... "),"<Buffer "+b+">"},n&&(c.prototype[n]=c.prototype.inspect),c.prototype.compare=function(b,E,q,X,Z){if(Rt(b,Uint8Array)&&(b=c.from(b,b.offset,b.byteLength)),!c.isBuffer(b))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof b);if(E===void 0&&(E=0),q===void 0&&(q=b?b.length:0),X===void 0&&(X=0),Z===void 0&&(Z=this.length),E<0||q>b.length||X<0||Z>this.length)throw new RangeError("out of range index");if(X>=Z&&E>=q)return 0;if(X>=Z)return-1;if(E>=q)return 1;if(E>>>=0,q>>>=0,X>>>=0,Z>>>=0,this===b)return 0;let se=Z-X,Se=q-E;const qe=Math.min(se,Se),Ue=this.slice(X,Z),ht=b.slice(E,q);for(let mt=0;mt<qe;++mt)if(Ue[mt]!==ht[mt]){se=Ue[mt],Se=ht[mt];break}return se<Se?-1:Se<se?1:0};function k(S,b,E,q,X){if(S.length===0)return-1;if(typeof E=="string"?(q=E,E=0):E>2147483647?E=2147483647:E<-2147483648&&(E=-2147483648),E=+E,ar(E)&&(E=X?0:S.length-1),E<0&&(E=S.length+E),E>=S.length){if(X)return-1;E=S.length-1}else if(E<0)if(X)E=0;else return-1;if(typeof b=="string"&&(b=c.from(b,q)),c.isBuffer(b))return b.length===0?-1:B(S,b,E,q,X);if(typeof b=="number")return b=b&255,typeof Uint8Array.prototype.indexOf=="function"?X?Uint8Array.prototype.indexOf.call(S,b,E):Uint8Array.prototype.lastIndexOf.call(S,b,E):B(S,[b],E,q,X);throw new TypeError("val must be string, number or Buffer")}function B(S,b,E,q,X){let Z=1,se=S.length,Se=b.length;if(q!==void 0&&(q=String(q).toLowerCase(),q==="ucs2"||q==="ucs-2"||q==="utf16le"||q==="utf-16le")){if(S.length<2||b.length<2)return-1;Z=2,se/=2,Se/=2,E/=2}function qe(ht,mt){return Z===1?ht[mt]:ht.readUInt16BE(mt*Z)}let Ue;if(X){let ht=-1;for(Ue=E;Ue<se;Ue++)if(qe(S,Ue)===qe(b,ht===-1?0:Ue-ht)){if(ht===-1&&(ht=Ue),Ue-ht+1===Se)return ht*Z}else ht!==-1&&(Ue-=Ue-ht),ht=-1}else for(E+Se>se&&(E=se-Se),Ue=E;Ue>=0;Ue--){let ht=!0;for(let mt=0;mt<Se;mt++)if(qe(S,Ue+mt)!==qe(b,mt)){ht=!1;break}if(ht)return Ue}return-1}c.prototype.includes=function(b,E,q){return this.indexOf(b,E,q)!==-1},c.prototype.indexOf=function(b,E,q){return k(this,b,E,q,!0)},c.prototype.lastIndexOf=function(b,E,q){return k(this,b,E,q,!1)};function H(S,b,E,q){E=Number(E)||0;const X=S.length-E;q?(q=Number(q),q>X&&(q=X)):q=X;const Z=b.length;q>Z/2&&(q=Z/2);let se;for(se=0;se<q;++se){const Se=parseInt(b.substr(se*2,2),16);if(ar(Se))return se;S[E+se]=Se}return se}function re(S,b,E,q){return kt(Wt(b,S.length-E),S,E,q)}function le(S,b,E,q){return kt(mr(b),S,E,q)}function me(S,b,E,q){return kt(er(b),S,E,q)}function He(S,b,E,q){return kt(sr(b,S.length-E),S,E,q)}c.prototype.write=function(b,E,q,X){if(E===void 0)X="utf8",q=this.length,E=0;else if(q===void 0&&typeof E=="string")X=E,q=this.length,E=0;else if(isFinite(E))E=E>>>0,isFinite(q)?(q=q>>>0,X===void 0&&(X="utf8")):(X=q,q=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Z=this.length-E;if((q===void 0||q>Z)&&(q=Z),b.length>0&&(q<0||E<0)||E>this.length)throw new RangeError("Attempt to write outside buffer bounds");X||(X="utf8");let se=!1;for(;;)switch(X){case"hex":return H(this,b,E,q);case"utf8":case"utf-8":return re(this,b,E,q);case"ascii":case"latin1":case"binary":return le(this,b,E,q);case"base64":return me(this,b,E,q);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return He(this,b,E,q);default:if(se)throw new TypeError("Unknown encoding: "+X);X=(""+X).toLowerCase(),se=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ct(S,b,E){return b===0&&E===S.length?e.fromByteArray(S):e.fromByteArray(S.slice(b,E))}function lt(S,b,E){E=Math.min(S.length,E);const q=[];let X=b;for(;X<E;){const Z=S[X];let se=null,Se=Z>239?4:Z>223?3:Z>191?2:1;if(X+Se<=E){let qe,Ue,ht,mt;switch(Se){case 1:Z<128&&(se=Z);break;case 2:qe=S[X+1],(qe&192)===128&&(mt=(Z&31)<<6|qe&63,mt>127&&(se=mt));break;case 3:qe=S[X+1],Ue=S[X+2],(qe&192)===128&&(Ue&192)===128&&(mt=(Z&15)<<12|(qe&63)<<6|Ue&63,mt>2047&&(mt<55296||mt>57343)&&(se=mt));break;case 4:qe=S[X+1],Ue=S[X+2],ht=S[X+3],(qe&192)===128&&(Ue&192)===128&&(ht&192)===128&&(mt=(Z&15)<<18|(qe&63)<<12|(Ue&63)<<6|ht&63,mt>65535&&mt<1114112&&(se=mt))}}se===null?(se=65533,Se=1):se>65535&&(se-=65536,q.push(se>>>10&1023|55296),se=56320|se&1023),q.push(se),X+=Se}return gt(q)}const dt=4096;function gt(S){const b=S.length;if(b<=dt)return String.fromCharCode.apply(String,S);let E="",q=0;for(;q<b;)E+=String.fromCharCode.apply(String,S.slice(q,q+=dt));return E}function Ee(S,b,E){let q="";E=Math.min(S.length,E);for(let X=b;X<E;++X)q+=String.fromCharCode(S[X]&127);return q}function z(S,b,E){let q="";E=Math.min(S.length,E);for(let X=b;X<E;++X)q+=String.fromCharCode(S[X]);return q}function ne(S,b,E){const q=S.length;(!b||b<0)&&(b=0),(!E||E<0||E>q)&&(E=q);let X="";for(let Z=b;Z<E;++Z)X+=Er[S[Z]];return X}function ee(S,b,E){const q=S.slice(b,E);let X="";for(let Z=0;Z<q.length-1;Z+=2)X+=String.fromCharCode(q[Z]+q[Z+1]*256);return X}c.prototype.slice=function(b,E){const q=this.length;b=~~b,E=E===void 0?q:~~E,b<0?(b+=q,b<0&&(b=0)):b>q&&(b=q),E<0?(E+=q,E<0&&(E=0)):E>q&&(E=q),E<b&&(E=b);const X=this.subarray(b,E);return Object.setPrototypeOf(X,c.prototype),X};function ve(S,b,E){if(S%1!==0||S<0)throw new RangeError("offset is not uint");if(S+b>E)throw new RangeError("Trying to access beyond buffer length")}c.prototype.readUintLE=c.prototype.readUIntLE=function(b,E,q){b=b>>>0,E=E>>>0,q||ve(b,E,this.length);let X=this[b],Z=1,se=0;for(;++se<E&&(Z*=256);)X+=this[b+se]*Z;return X},c.prototype.readUintBE=c.prototype.readUIntBE=function(b,E,q){b=b>>>0,E=E>>>0,q||ve(b,E,this.length);let X=this[b+--E],Z=1;for(;E>0&&(Z*=256);)X+=this[b+--E]*Z;return X},c.prototype.readUint8=c.prototype.readUInt8=function(b,E){return b=b>>>0,E||ve(b,1,this.length),this[b]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(b,E){return b=b>>>0,E||ve(b,2,this.length),this[b]|this[b+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(b,E){return b=b>>>0,E||ve(b,2,this.length),this[b]<<8|this[b+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(b,E){return b=b>>>0,E||ve(b,4,this.length),(this[b]|this[b+1]<<8|this[b+2]<<16)+this[b+3]*16777216},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(b,E){return b=b>>>0,E||ve(b,4,this.length),this[b]*16777216+(this[b+1]<<16|this[b+2]<<8|this[b+3])},c.prototype.readBigUInt64LE=Bt(function(b){b=b>>>0,Zt(b,"offset");const E=this[b],q=this[b+7];(E===void 0||q===void 0)&&qt(b,this.length-8);const X=E+this[++b]*2**8+this[++b]*2**16+this[++b]*2**24,Z=this[++b]+this[++b]*2**8+this[++b]*2**16+q*2**24;return BigInt(X)+(BigInt(Z)<<BigInt(32))}),c.prototype.readBigUInt64BE=Bt(function(b){b=b>>>0,Zt(b,"offset");const E=this[b],q=this[b+7];(E===void 0||q===void 0)&&qt(b,this.length-8);const X=E*2**24+this[++b]*2**16+this[++b]*2**8+this[++b],Z=this[++b]*2**24+this[++b]*2**16+this[++b]*2**8+q;return(BigInt(X)<<BigInt(32))+BigInt(Z)}),c.prototype.readIntLE=function(b,E,q){b=b>>>0,E=E>>>0,q||ve(b,E,this.length);let X=this[b],Z=1,se=0;for(;++se<E&&(Z*=256);)X+=this[b+se]*Z;return Z*=128,X>=Z&&(X-=Math.pow(2,8*E)),X},c.prototype.readIntBE=function(b,E,q){b=b>>>0,E=E>>>0,q||ve(b,E,this.length);let X=E,Z=1,se=this[b+--X];for(;X>0&&(Z*=256);)se+=this[b+--X]*Z;return Z*=128,se>=Z&&(se-=Math.pow(2,8*E)),se},c.prototype.readInt8=function(b,E){return b=b>>>0,E||ve(b,1,this.length),this[b]&128?(255-this[b]+1)*-1:this[b]},c.prototype.readInt16LE=function(b,E){b=b>>>0,E||ve(b,2,this.length);const q=this[b]|this[b+1]<<8;return q&32768?q|4294901760:q},c.prototype.readInt16BE=function(b,E){b=b>>>0,E||ve(b,2,this.length);const q=this[b+1]|this[b]<<8;return q&32768?q|4294901760:q},c.prototype.readInt32LE=function(b,E){return b=b>>>0,E||ve(b,4,this.length),this[b]|this[b+1]<<8|this[b+2]<<16|this[b+3]<<24},c.prototype.readInt32BE=function(b,E){return b=b>>>0,E||ve(b,4,this.length),this[b]<<24|this[b+1]<<16|this[b+2]<<8|this[b+3]},c.prototype.readBigInt64LE=Bt(function(b){b=b>>>0,Zt(b,"offset");const E=this[b],q=this[b+7];(E===void 0||q===void 0)&&qt(b,this.length-8);const X=this[b+4]+this[b+5]*2**8+this[b+6]*2**16+(q<<24);return(BigInt(X)<<BigInt(32))+BigInt(E+this[++b]*2**8+this[++b]*2**16+this[++b]*2**24)}),c.prototype.readBigInt64BE=Bt(function(b){b=b>>>0,Zt(b,"offset");const E=this[b],q=this[b+7];(E===void 0||q===void 0)&&qt(b,this.length-8);const X=(E<<24)+this[++b]*2**16+this[++b]*2**8+this[++b];return(BigInt(X)<<BigInt(32))+BigInt(this[++b]*2**24+this[++b]*2**16+this[++b]*2**8+q)}),c.prototype.readFloatLE=function(b,E){return b=b>>>0,E||ve(b,4,this.length),t.read(this,b,!0,23,4)},c.prototype.readFloatBE=function(b,E){return b=b>>>0,E||ve(b,4,this.length),t.read(this,b,!1,23,4)},c.prototype.readDoubleLE=function(b,E){return b=b>>>0,E||ve(b,8,this.length),t.read(this,b,!0,52,8)},c.prototype.readDoubleBE=function(b,E){return b=b>>>0,E||ve(b,8,this.length),t.read(this,b,!1,52,8)};function Qe(S,b,E,q,X,Z){if(!c.isBuffer(S))throw new TypeError('"buffer" argument must be a Buffer instance');if(b>X||b<Z)throw new RangeError('"value" argument is out of bounds');if(E+q>S.length)throw new RangeError("Index out of range")}c.prototype.writeUintLE=c.prototype.writeUIntLE=function(b,E,q,X){if(b=+b,E=E>>>0,q=q>>>0,!X){const Se=Math.pow(2,8*q)-1;Qe(this,b,E,q,Se,0)}let Z=1,se=0;for(this[E]=b&255;++se<q&&(Z*=256);)this[E+se]=b/Z&255;return E+q},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(b,E,q,X){if(b=+b,E=E>>>0,q=q>>>0,!X){const Se=Math.pow(2,8*q)-1;Qe(this,b,E,q,Se,0)}let Z=q-1,se=1;for(this[E+Z]=b&255;--Z>=0&&(se*=256);)this[E+Z]=b/se&255;return E+q},c.prototype.writeUint8=c.prototype.writeUInt8=function(b,E,q){return b=+b,E=E>>>0,q||Qe(this,b,E,1,255,0),this[E]=b&255,E+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(b,E,q){return b=+b,E=E>>>0,q||Qe(this,b,E,2,65535,0),this[E]=b&255,this[E+1]=b>>>8,E+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(b,E,q){return b=+b,E=E>>>0,q||Qe(this,b,E,2,65535,0),this[E]=b>>>8,this[E+1]=b&255,E+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(b,E,q){return b=+b,E=E>>>0,q||Qe(this,b,E,4,4294967295,0),this[E+3]=b>>>24,this[E+2]=b>>>16,this[E+1]=b>>>8,this[E]=b&255,E+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(b,E,q){return b=+b,E=E>>>0,q||Qe(this,b,E,4,4294967295,0),this[E]=b>>>24,this[E+1]=b>>>16,this[E+2]=b>>>8,this[E+3]=b&255,E+4};function Me(S,b,E,q,X){Yt(b,q,X,S,E,7);let Z=Number(b&BigInt(4294967295));S[E++]=Z,Z=Z>>8,S[E++]=Z,Z=Z>>8,S[E++]=Z,Z=Z>>8,S[E++]=Z;let se=Number(b>>BigInt(32)&BigInt(4294967295));return S[E++]=se,se=se>>8,S[E++]=se,se=se>>8,S[E++]=se,se=se>>8,S[E++]=se,E}function it(S,b,E,q,X){Yt(b,q,X,S,E,7);let Z=Number(b&BigInt(4294967295));S[E+7]=Z,Z=Z>>8,S[E+6]=Z,Z=Z>>8,S[E+5]=Z,Z=Z>>8,S[E+4]=Z;let se=Number(b>>BigInt(32)&BigInt(4294967295));return S[E+3]=se,se=se>>8,S[E+2]=se,se=se>>8,S[E+1]=se,se=se>>8,S[E]=se,E+8}c.prototype.writeBigUInt64LE=Bt(function(b,E=0){return Me(this,b,E,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeBigUInt64BE=Bt(function(b,E=0){return it(this,b,E,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeIntLE=function(b,E,q,X){if(b=+b,E=E>>>0,!X){const qe=Math.pow(2,8*q-1);Qe(this,b,E,q,qe-1,-qe)}let Z=0,se=1,Se=0;for(this[E]=b&255;++Z<q&&(se*=256);)b<0&&Se===0&&this[E+Z-1]!==0&&(Se=1),this[E+Z]=(b/se>>0)-Se&255;return E+q},c.prototype.writeIntBE=function(b,E,q,X){if(b=+b,E=E>>>0,!X){const qe=Math.pow(2,8*q-1);Qe(this,b,E,q,qe-1,-qe)}let Z=q-1,se=1,Se=0;for(this[E+Z]=b&255;--Z>=0&&(se*=256);)b<0&&Se===0&&this[E+Z+1]!==0&&(Se=1),this[E+Z]=(b/se>>0)-Se&255;return E+q},c.prototype.writeInt8=function(b,E,q){return b=+b,E=E>>>0,q||Qe(this,b,E,1,127,-128),b<0&&(b=255+b+1),this[E]=b&255,E+1},c.prototype.writeInt16LE=function(b,E,q){return b=+b,E=E>>>0,q||Qe(this,b,E,2,32767,-32768),this[E]=b&255,this[E+1]=b>>>8,E+2},c.prototype.writeInt16BE=function(b,E,q){return b=+b,E=E>>>0,q||Qe(this,b,E,2,32767,-32768),this[E]=b>>>8,this[E+1]=b&255,E+2},c.prototype.writeInt32LE=function(b,E,q){return b=+b,E=E>>>0,q||Qe(this,b,E,4,2147483647,-2147483648),this[E]=b&255,this[E+1]=b>>>8,this[E+2]=b>>>16,this[E+3]=b>>>24,E+4},c.prototype.writeInt32BE=function(b,E,q){return b=+b,E=E>>>0,q||Qe(this,b,E,4,2147483647,-2147483648),b<0&&(b=4294967295+b+1),this[E]=b>>>24,this[E+1]=b>>>16,this[E+2]=b>>>8,this[E+3]=b&255,E+4},c.prototype.writeBigInt64LE=Bt(function(b,E=0){return Me(this,b,E,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),c.prototype.writeBigInt64BE=Bt(function(b,E=0){return it(this,b,E,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ne(S,b,E,q,X,Z){if(E+q>S.length)throw new RangeError("Index out of range");if(E<0)throw new RangeError("Index out of range")}function De(S,b,E,q,X){return b=+b,E=E>>>0,X||Ne(S,b,E,4),t.write(S,b,E,q,23,4),E+4}c.prototype.writeFloatLE=function(b,E,q){return De(this,b,E,!0,q)},c.prototype.writeFloatBE=function(b,E,q){return De(this,b,E,!1,q)};function Dt(S,b,E,q,X){return b=+b,E=E>>>0,X||Ne(S,b,E,8),t.write(S,b,E,q,52,8),E+8}c.prototype.writeDoubleLE=function(b,E,q){return Dt(this,b,E,!0,q)},c.prototype.writeDoubleBE=function(b,E,q){return Dt(this,b,E,!1,q)},c.prototype.copy=function(b,E,q,X){if(!c.isBuffer(b))throw new TypeError("argument should be a Buffer");if(q||(q=0),!X&&X!==0&&(X=this.length),E>=b.length&&(E=b.length),E||(E=0),X>0&&X<q&&(X=q),X===q||b.length===0||this.length===0)return 0;if(E<0)throw new RangeError("targetStart out of bounds");if(q<0||q>=this.length)throw new RangeError("Index out of range");if(X<0)throw new RangeError("sourceEnd out of bounds");X>this.length&&(X=this.length),b.length-E<X-q&&(X=b.length-E+q);const Z=X-q;return this===b&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(E,q,X):Uint8Array.prototype.set.call(b,this.subarray(q,X),E),Z},c.prototype.fill=function(b,E,q,X){if(typeof b=="string"){if(typeof E=="string"?(X=E,E=0,q=this.length):typeof q=="string"&&(X=q,q=this.length),X!==void 0&&typeof X!="string")throw new TypeError("encoding must be a string");if(typeof X=="string"&&!c.isEncoding(X))throw new TypeError("Unknown encoding: "+X);if(b.length===1){const se=b.charCodeAt(0);(X==="utf8"&&se<128||X==="latin1")&&(b=se)}}else typeof b=="number"?b=b&255:typeof b=="boolean"&&(b=Number(b));if(E<0||this.length<E||this.length<q)throw new RangeError("Out of range index");if(q<=E)return this;E=E>>>0,q=q===void 0?this.length:q>>>0,b||(b=0);let Z;if(typeof b=="number")for(Z=E;Z<q;++Z)this[Z]=b;else{const se=c.isBuffer(b)?b:c.from(b,X),Se=se.length;if(Se===0)throw new TypeError('The value "'+b+'" is invalid for argument "value"');for(Z=0;Z<q-E;++Z)this[Z+E]=se[Z%Se]}return this};const bt={};function Nt(S,b,E){bt[S]=class extends E{constructor(){super(),Object.defineProperty(this,"message",{value:b.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${S}]`,this.stack,delete this.name}get code(){return S}set code(X){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:X,writable:!0})}toString(){return`${this.name} [${S}]: ${this.message}`}}}Nt("ERR_BUFFER_OUT_OF_BOUNDS",function(S){return S?`${S} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Nt("ERR_INVALID_ARG_TYPE",function(S,b){return`The "${S}" argument must be of type number. Received type ${typeof b}`},TypeError),Nt("ERR_OUT_OF_RANGE",function(S,b,E){let q=`The value of "${S}" is out of range.`,X=E;return Number.isInteger(E)&&Math.abs(E)>2**32?X=fr(String(E)):typeof E=="bigint"&&(X=String(E),(E>BigInt(2)**BigInt(32)||E<-(BigInt(2)**BigInt(32)))&&(X=fr(X)),X+="n"),q+=` It must be ${b}. Received ${X}`,q},RangeError);function fr(S){let b="",E=S.length;const q=S[0]==="-"?1:0;for(;E>=q+4;E-=3)b=`_${S.slice(E-3,E)}${b}`;return`${S.slice(0,E)}${b}`}function Ut(S,b,E){Zt(b,"offset"),(S[b]===void 0||S[b+E]===void 0)&&qt(b,S.length-(E+1))}function Yt(S,b,E,q,X,Z){if(S>E||S<b){const se=typeof b=="bigint"?"n":"";let Se;throw b===0||b===BigInt(0)?Se=`>= 0${se} and < 2${se} ** ${(Z+1)*8}${se}`:Se=`>= -(2${se} ** ${(Z+1)*8-1}${se}) and < 2 ** ${(Z+1)*8-1}${se}`,new bt.ERR_OUT_OF_RANGE("value",Se,S)}Ut(q,X,Z)}function Zt(S,b){if(typeof S!="number")throw new bt.ERR_INVALID_ARG_TYPE(b,"number",S)}function qt(S,b,E){throw Math.floor(S)!==S?(Zt(S,E),new bt.ERR_OUT_OF_RANGE("offset","an integer",S)):b<0?new bt.ERR_BUFFER_OUT_OF_BOUNDS:new bt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${b}`,S)}const Xt=/[^+/0-9A-Za-z-_]/g;function zr(S){if(S=S.split("=")[0],S=S.trim().replace(Xt,""),S.length<2)return"";for(;S.length%4!==0;)S=S+"=";return S}function Wt(S,b){b=b||1/0;let E;const q=S.length;let X=null;const Z=[];for(let se=0;se<q;++se){if(E=S.charCodeAt(se),E>55295&&E<57344){if(!X){if(E>56319){(b-=3)>-1&&Z.push(239,191,189);continue}else if(se+1===q){(b-=3)>-1&&Z.push(239,191,189);continue}X=E;continue}if(E<56320){(b-=3)>-1&&Z.push(239,191,189),X=E;continue}E=(X-55296<<10|E-56320)+65536}else X&&(b-=3)>-1&&Z.push(239,191,189);if(X=null,E<128){if((b-=1)<0)break;Z.push(E)}else if(E<2048){if((b-=2)<0)break;Z.push(E>>6|192,E&63|128)}else if(E<65536){if((b-=3)<0)break;Z.push(E>>12|224,E>>6&63|128,E&63|128)}else if(E<1114112){if((b-=4)<0)break;Z.push(E>>18|240,E>>12&63|128,E>>6&63|128,E&63|128)}else throw new Error("Invalid code point")}return Z}function mr(S){const b=[];for(let E=0;E<S.length;++E)b.push(S.charCodeAt(E)&255);return b}function sr(S,b){let E,q,X;const Z=[];for(let se=0;se<S.length&&!((b-=2)<0);++se)E=S.charCodeAt(se),q=E>>8,X=E%256,Z.push(X),Z.push(q);return Z}function er(S){return e.toByteArray(zr(S))}function kt(S,b,E,q){let X;for(X=0;X<q&&!(X+E>=b.length||X>=S.length);++X)b[X+E]=S[X];return X}function Rt(S,b){return S instanceof b||S!=null&&S.constructor!=null&&S.constructor.name!=null&&S.constructor.name===b.name}function ar(S){return S!==S}const Er=function(){const S="0123456789abcdef",b=new Array(256);for(let E=0;E<16;++E){const q=E*16;for(let X=0;X<16;++X)b[q+X]=S[E]+S[X]}return b}();function Bt(S){return typeof BigInt>"u"?ce:S}function ce(){throw new Error("BigInt not supported")}}(buffer)),buffer}var textEndec,hasRequiredTextEndec;function requireTextEndec(){if(hasRequiredTextEndec)return textEndec;hasRequiredTextEndec=1;let r=null;return textEndec=function(){return r===null&&(r={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),r},textEndec}var formats={},encoding={},hasRequiredEncoding;function requireEncoding(){if(hasRequiredEncoding)return encoding;hasRequiredEncoding=1;const r=requireModuleError(),e=new Set(["buffer","view","utf8"]);class t{constructor(i){if(this.encode=i.encode||this.encode,this.decode=i.decode||this.decode,this.name=i.name||this.name,this.format=i.format||this.format,typeof this.encode!="function")throw new TypeError("The 'encode' property must be a function");if(typeof this.decode!="function")throw new TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),typeof this.name!="string"||this.name==="")throw new TypeError("The 'name' property must be a string");if(typeof this.format!="string"||!e.has(this.format))throw new TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");i.createViewTranscoder&&(this.createViewTranscoder=i.createViewTranscoder),i.createBufferTranscoder&&(this.createBufferTranscoder=i.createBufferTranscoder),i.createUTF8Transcoder&&(this.createUTF8Transcoder=i.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new r(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new r(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new r(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}}return encoding.Encoding=t,encoding}var hasRequiredFormats;function requireFormats(){if(hasRequiredFormats)return formats;hasRequiredFormats=1;const{Buffer:r}=requireBuffer()||{},{Encoding:e}=requireEncoding(),t=requireTextEndec();class n extends e{constructor(c){super({...c,format:"buffer"})}createViewTranscoder(){return new i({encode:this.encode,decode:c=>this.decode(r.from(c.buffer,c.byteOffset,c.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}}class i extends e{constructor(c){super({...c,format:"view"})}createBufferTranscoder(){return new n({encode:c=>{const d=this.encode(c);return r.from(d.buffer,d.byteOffset,d.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}}class s extends e{constructor(c){super({...c,format:"utf8"})}createBufferTranscoder(){return new n({encode:c=>r.from(this.encode(c),"utf8"),decode:c=>this.decode(c.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){const{textEncoder:c,textDecoder:d}=t();return new i({encode:g=>c.encode(this.encode(g)),decode:g=>this.decode(d.decode(g)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}}return formats.BufferFormat=n,formats.ViewFormat=i,formats.UTF8Format=s,formats}var hasRequiredEncodings;function requireEncodings(){if(hasRequiredEncodings)return encodings;hasRequiredEncodings=1;const{Buffer:r}=requireBuffer()||{Buffer:{isBuffer:()=>!1}},{textEncoder:e,textDecoder:t}=requireTextEndec()(),{BufferFormat:n,ViewFormat:i,UTF8Format:s}=requireFormats(),u=c=>c;return encodings.utf8=new s({encode:function(c){return r.isBuffer(c)?c.toString("utf8"):ArrayBuffer.isView(c)?t.decode(c):String(c)},decode:u,name:"utf8",createViewTranscoder(){return new i({encode:function(c){return ArrayBuffer.isView(c)?c:e.encode(c)},decode:function(c){return t.decode(c)},name:`${this.name}+view`})},createBufferTranscoder(){return new n({encode:function(c){return r.isBuffer(c)?c:ArrayBuffer.isView(c)?r.from(c.buffer,c.byteOffset,c.byteLength):r.from(String(c),"utf8")},decode:function(c){return c.toString("utf8")},name:`${this.name}+buffer`})}}),encodings.json=new s({encode:JSON.stringify,decode:JSON.parse,name:"json"}),encodings.buffer=new n({encode:function(c){return r.isBuffer(c)?c:ArrayBuffer.isView(c)?r.from(c.buffer,c.byteOffset,c.byteLength):r.from(String(c),"utf8")},decode:u,name:"buffer",createViewTranscoder(){return new i({encode:function(c){return ArrayBuffer.isView(c)?c:r.from(String(c),"utf8")},decode:function(c){return r.from(c.buffer,c.byteOffset,c.byteLength)},name:`${this.name}+view`})}}),encodings.view=new i({encode:function(c){return ArrayBuffer.isView(c)?c:e.encode(c)},decode:u,name:"view",createBufferTranscoder(){return new n({encode:function(c){return r.isBuffer(c)?c:ArrayBuffer.isView(c)?r.from(c.buffer,c.byteOffset,c.byteLength):r.from(String(c),"utf8")},decode:u,name:`${this.name}+buffer`})}}),encodings.hex=new n({encode:function(c){return r.isBuffer(c)?c:r.from(String(c),"hex")},decode:function(c){return c.toString("hex")},name:"hex"}),encodings.base64=new n({encode:function(c){return r.isBuffer(c)?c:r.from(String(c),"base64")},decode:function(c){return c.toString("base64")},name:"base64"}),encodings}var hasRequiredLevelTranscoder;function requireLevelTranscoder(){if(hasRequiredLevelTranscoder)return levelTranscoder;hasRequiredLevelTranscoder=1;const r=requireModuleError(),e=requireEncodings(),{Encoding:t}=requireEncoding(),{BufferFormat:n,ViewFormat:i,UTF8Format:s}=requireFormats(),u=Symbol("formats"),c=Symbol("encodings"),d=new Set(["buffer","view","utf8"]);class g{constructor(w){if(Array.isArray(w)){if(!w.every(v=>d.has(v)))throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}else throw new TypeError("The first argument 'formats' must be an array");this[c]=new Map,this[u]=new Set(w);for(const v in e)try{this.encoding(v)}catch(C){if(C.code!=="LEVEL_ENCODING_NOT_SUPPORTED")throw C}}encodings(){return Array.from(new Set(this[c].values()))}encoding(w){let v=this[c].get(w);if(v===void 0){if(typeof w=="string"&&w!==""){if(v=h[w],!v)throw new r(`Encoding '${w}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if(typeof w!="object"||w===null)throw new TypeError("First argument 'encoding' must be a string or object");v=_(w)}const{name:C,format:P}=v;if(!this[u].has(P))if(this[u].has("view"))v=v.createViewTranscoder();else if(this[u].has("buffer"))v=v.createBufferTranscoder();else if(this[u].has("utf8"))v=v.createUTF8Transcoder();else throw new r(`Encoding '${C}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});for(const R of[w,C,v.name,v.commonName])this[c].set(R,v)}return v}}levelTranscoder.Transcoder=g;function _(y){if(y instanceof t)return y;const w="type"in y&&typeof y.type=="string"?y.type:void 0,v=y.name||w||`anonymous-${p++}`;switch(f(y)){case"view":return new i({...y,name:v});case"utf8":return new s({...y,name:v});case"buffer":return new n({...y,name:v});default:throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}function f(y){return"format"in y&&y.format!==void 0?y.format:"buffer"in y&&typeof y.buffer=="boolean"?y.buffer?"buffer":"utf8":"code"in y&&Number.isInteger(y.code)?"view":"buffer"}const l={binary:e.buffer,"utf-8":e.utf8},h={...e,...l};let p=0;return levelTranscoder}var catering={},nextTickBrowser$1,hasRequiredNextTickBrowser$1;function requireNextTickBrowser$1(){return hasRequiredNextTickBrowser$1||(hasRequiredNextTickBrowser$1=1,nextTickBrowser$1=typeof queueMicrotask=="function"?queueMicrotask:r=>Promise.resolve().then(r)),nextTickBrowser$1}var hasRequiredCatering;function requireCatering(){if(hasRequiredCatering)return catering;hasRequiredCatering=1;var r=requireNextTickBrowser$1();return catering.fromCallback=function(e,t){if(e===void 0){var n=new Promise(function(i,s){e=function(u,c){u?s(u):i(c)}});e[t!==void 0?t:"promise"]=n}else if(typeof e!="function")throw new TypeError("Callback must be a function");return e},catering.fromPromise=function(e,t){if(t===void 0)return e;e.then(function(n){r(()=>t(null,n))}).catch(function(n){r(()=>t(n))})},catering}var abstractIterator={},common={},hasRequiredCommon;function requireCommon(){return hasRequiredCommon||(hasRequiredCommon=1,common.getCallback=function(r,e){return typeof r=="function"?r:e},common.getOptions=function(r,e){return typeof r=="object"&&r!==null?r:e!==void 0?e:{}}),common}var hasRequiredAbstractIterator;function requireAbstractIterator(){if(hasRequiredAbstractIterator)return abstractIterator;hasRequiredAbstractIterator=1;const{fromCallback:r}=requireCatering(),e=requireModuleError(),{getOptions:t,getCallback:n}=requireCommon(),i=Symbol("promise"),s=Symbol("callback"),u=Symbol("working"),c=Symbol("handleOne"),d=Symbol("handleMany"),g=Symbol("autoClose"),_=Symbol("finishWork"),f=Symbol("returnMany"),l=Symbol("closing"),h=Symbol("handleClose"),p=Symbol("closed"),y=Symbol("closeCallbacks"),w=Symbol("keyEncoding"),v=Symbol("valueEncoding"),C=Symbol("abortOnClose"),P=Symbol("legacy"),R=Symbol("keys"),F=Symbol("values"),k=Symbol("limit"),B=Symbol("count"),H=Object.freeze({}),re=()=>{};let le=!1;class me{constructor(Ee,z,ne){if(typeof Ee!="object"||Ee===null){const ee=Ee===null?"null":typeof Ee;throw new TypeError(`The first argument must be an abstract-level database, received ${ee}`)}if(typeof z!="object"||z===null)throw new TypeError("The second argument must be an options object");this[p]=!1,this[y]=[],this[u]=!1,this[l]=!1,this[g]=!1,this[s]=null,this[c]=this[c].bind(this),this[d]=this[d].bind(this),this[h]=this[h].bind(this),this[w]=z[w],this[v]=z[v],this[P]=ne,this[k]=Number.isInteger(z.limit)&&z.limit>=0?z.limit:1/0,this[B]=0,this[C]=!!z.abortOnClose,this.db=Ee,this.db.attachResource(this),this.nextTick=Ee.nextTick}get count(){return this[B]}get limit(){return this[k]}next(Ee){let z;if(Ee===void 0)z=new Promise((ne,ee)=>{Ee=(ve,Qe,Me)=>{ve?ee(ve):this[P]?Qe===void 0&&Me===void 0?ne():ne([Qe,Me]):ne(Qe)}});else if(typeof Ee!="function")throw new TypeError("Callback must be a function");return this[l]?this.nextTick(Ee,new e("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[u]?this.nextTick(Ee,new e("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[u]=!0,this[s]=Ee,this[B]>=this[k]?this.nextTick(this[c],null):this._next(this[c])),z}_next(Ee){this.nextTick(Ee)}nextv(Ee,z,ne){return ne=n(z,ne),ne=r(ne,i),z=t(z,H),Number.isInteger(Ee)?(this[l]?this.nextTick(ne,new e("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[u]?this.nextTick(ne,new e("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(Ee<1&&(Ee=1),this[k]<1/0&&(Ee=Math.min(Ee,this[k]-this[B])),this[u]=!0,this[s]=ne,Ee<=0?this.nextTick(this[d],null,[]):this._nextv(Ee,z,this[d])),ne[i]):(this.nextTick(ne,new TypeError("The first argument 'size' must be an integer")),ne[i])}_nextv(Ee,z,ne){const ee=[],ve=(Qe,Me,it)=>{if(Qe)return ne(Qe);if(this[P]?Me===void 0&&it===void 0:Me===void 0)return ne(null,ee);ee.push(this[P]?[Me,it]:Me),ee.length===Ee?ne(null,ee):this._next(ve)};this._next(ve)}all(Ee,z){return z=n(Ee,z),z=r(z,i),Ee=t(Ee,H),this[l]?this.nextTick(z,new e("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[u]?this.nextTick(z,new e("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[u]=!0,this[s]=z,this[g]=!0,this[B]>=this[k]?this.nextTick(this[d],null,[]):this._all(Ee,this[d])),z[i]}_all(Ee,z){let ne=this[B];const ee=[],ve=()=>{const Me=this[k]<1/0?Math.min(1e3,this[k]-ne):1e3;Me<=0?this.nextTick(z,null,ee):this._nextv(Me,H,Qe)},Qe=(Me,it)=>{Me?z(Me):it.length===0?z(null,ee):(ee.push.apply(ee,it),ne+=it.length,ve())};ve()}[_](){const Ee=this[s];return this[C]&&Ee===null?re:(this[u]=!1,this[s]=null,this[l]&&this._close(this[h]),Ee)}[f](Ee,z,ne){this[g]?this.close(Ee.bind(null,z,ne)):Ee(z,ne)}seek(Ee,z){if(z=t(z,H),!this[l]){if(this[u])throw new e("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{const ne=this.db.keyEncoding(z.keyEncoding||this[w]),ee=ne.format;z.keyEncoding!==ee&&(z={...z,keyEncoding:ee});const ve=this.db.prefixKey(ne.encode(Ee),ee);this._seek(ve,z)}}}_seek(Ee,z){throw new e("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(Ee){return Ee=r(Ee,i),this[p]?this.nextTick(Ee):this[l]?this[y].push(Ee):(this[l]=!0,this[y].push(Ee),this[u]?this[C]&&this[_]()(new e("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this._close(this[h])),Ee[i]}_close(Ee){this.nextTick(Ee)}[h](){this[p]=!0,this.db.detachResource(this);const Ee=this[y];this[y]=[];for(const z of Ee)z()}async*[Symbol.asyncIterator](){try{let Ee;for(;(Ee=await this.next())!==void 0;)yield Ee}finally{this[p]||await this.close()}}}class He extends me{constructor(Ee,z){super(Ee,z,!0),this[R]=z.keys!==!1,this[F]=z.values!==!1}[c](Ee,z,ne){const ee=this[_]();if(Ee)return ee(Ee);try{z=this[R]&&z!==void 0?this[w].decode(z):void 0,ne=this[F]&&ne!==void 0?this[v].decode(ne):void 0}catch(ve){return ee(new dt("entry",ve))}z===void 0&&ne===void 0||this[B]++,ee(null,z,ne)}[d](Ee,z){const ne=this[_]();if(Ee)return this[f](ne,Ee);try{for(const ee of z){const ve=ee[0],Qe=ee[1];ee[0]=this[R]&&ve!==void 0?this[w].decode(ve):void 0,ee[1]=this[F]&&Qe!==void 0?this[v].decode(Qe):void 0}}catch(ee){return this[f](ne,new dt("entries",ee))}this[B]+=z.length,this[f](ne,null,z)}end(Ee){return!le&&typeof console<"u"&&(le=!0,console.warn(new e("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(Ee)}}class ct extends me{constructor(Ee,z){super(Ee,z,!1)}[c](Ee,z){const ne=this[_]();if(Ee)return ne(Ee);try{z=z!==void 0?this[w].decode(z):void 0}catch(ee){return ne(new dt("key",ee))}z!==void 0&&this[B]++,ne(null,z)}[d](Ee,z){const ne=this[_]();if(Ee)return this[f](ne,Ee);try{for(let ee=0;ee<z.length;ee++){const ve=z[ee];z[ee]=ve!==void 0?this[w].decode(ve):void 0}}catch(ee){return this[f](ne,new dt("keys",ee))}this[B]+=z.length,this[f](ne,null,z)}}class lt extends me{constructor(Ee,z){super(Ee,z,!1)}[c](Ee,z){const ne=this[_]();if(Ee)return ne(Ee);try{z=z!==void 0?this[v].decode(z):void 0}catch(ee){return ne(new dt("value",ee))}z!==void 0&&this[B]++,ne(null,z)}[d](Ee,z){const ne=this[_]();if(Ee)return this[f](ne,Ee);try{for(let ee=0;ee<z.length;ee++){const ve=z[ee];z[ee]=ve!==void 0?this[v].decode(ve):void 0}}catch(ee){return this[f](ne,new dt("values",ee))}this[B]+=z.length,this[f](ne,null,z)}}class dt extends e{constructor(Ee,z){super(`Iterator could not decode ${Ee}`,{code:"LEVEL_DECODE_ERROR",cause:z})}}for(const gt of["_ended property","_nexting property","_end method"])Object.defineProperty(He.prototype,gt.split(" ")[0],{get(){throw new e(`The ${gt} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new e(`The ${gt} has been removed`,{code:"LEVEL_LEGACY"})}});return He.keyEncoding=w,He.valueEncoding=v,abstractIterator.AbstractIterator=He,abstractIterator.AbstractKeyIterator=ct,abstractIterator.AbstractValueIterator=lt,abstractIterator}var defaultKvIterator={},hasRequiredDefaultKvIterator;function requireDefaultKvIterator(){if(hasRequiredDefaultKvIterator)return defaultKvIterator;hasRequiredDefaultKvIterator=1;const{AbstractKeyIterator:r,AbstractValueIterator:e}=requireAbstractIterator(),t=Symbol("iterator"),n=Symbol("callback"),i=Symbol("handleOne"),s=Symbol("handleMany");class u extends r{constructor(g,_){super(g,_),this[t]=g.iterator({..._,keys:!0,values:!1}),this[i]=this[i].bind(this),this[s]=this[s].bind(this)}}class c extends e{constructor(g,_){super(g,_),this[t]=g.iterator({..._,keys:!1,values:!0}),this[i]=this[i].bind(this),this[s]=this[s].bind(this)}}for(const d of[u,c]){const g=d===u,_=g?f=>f[0]:f=>f[1];d.prototype._next=function(f){this[n]=f,this[t].next(this[i])},d.prototype[i]=function(f,l,h){const p=this[n];f?p(f):p(null,g?l:h)},d.prototype._nextv=function(f,l,h){this[n]=h,this[t].nextv(f,l,this[s])},d.prototype._all=function(f,l){this[n]=l,this[t].all(f,this[s])},d.prototype[s]=function(f,l){const h=this[n];f?h(f):h(null,l.map(_))},d.prototype._seek=function(f,l){this[t].seek(f,l)},d.prototype._close=function(f){this[t].close(f)}}return defaultKvIterator.DefaultKeyIterator=u,defaultKvIterator.DefaultValueIterator=c,defaultKvIterator}var deferredIterator={},hasRequiredDeferredIterator;function requireDeferredIterator(){if(hasRequiredDeferredIterator)return deferredIterator;hasRequiredDeferredIterator=1;const{AbstractIterator:r,AbstractKeyIterator:e,AbstractValueIterator:t}=requireAbstractIterator(),n=requireModuleError(),i=Symbol("nut"),s=Symbol("undefer"),u=Symbol("factory");class c extends r{constructor(f,l){super(f,l),this[i]=null,this[u]=()=>f.iterator(l),this.db.defer(()=>this[s]())}}class d extends e{constructor(f,l){super(f,l),this[i]=null,this[u]=()=>f.keys(l),this.db.defer(()=>this[s]())}}class g extends t{constructor(f,l){super(f,l),this[i]=null,this[u]=()=>f.values(l),this.db.defer(()=>this[s]())}}for(const _ of[c,d,g])_.prototype[s]=function(){this.db.status==="open"&&(this[i]=this[u]())},_.prototype._next=function(f){this[i]!==null?this[i].next(f):this.db.status==="opening"?this.db.defer(()=>this._next(f)):this.nextTick(f,new n("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},_.prototype._nextv=function(f,l,h){this[i]!==null?this[i].nextv(f,l,h):this.db.status==="opening"?this.db.defer(()=>this._nextv(f,l,h)):this.nextTick(h,new n("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},_.prototype._all=function(f,l){this[i]!==null?this[i].all(l):this.db.status==="opening"?this.db.defer(()=>this._all(f,l)):this.nextTick(l,new n("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},_.prototype._seek=function(f,l){this[i]!==null?this[i]._seek(f,l):this.db.status==="opening"&&this.db.defer(()=>this._seek(f,l))},_.prototype._close=function(f){this[i]!==null?this[i].close(f):this.db.status==="opening"?this.db.defer(()=>this._close(f)):this.nextTick(f)};return deferredIterator.DeferredIterator=c,deferredIterator.DeferredKeyIterator=d,deferredIterator.DeferredValueIterator=g,deferredIterator}var defaultChainedBatch={},abstractChainedBatch={},hasRequiredAbstractChainedBatch;function requireAbstractChainedBatch(){if(hasRequiredAbstractChainedBatch)return abstractChainedBatch;hasRequiredAbstractChainedBatch=1;const{fromCallback:r}=requireCatering(),e=requireModuleError(),{getCallback:t,getOptions:n}=requireCommon(),i=Symbol("promise"),s=Symbol("status"),u=Symbol("operations"),c=Symbol("finishClose"),d=Symbol("closeCallbacks");class g{constructor(f){if(typeof f!="object"||f===null){const l=f===null?"null":typeof f;throw new TypeError(`The first argument must be an abstract-level database, received ${l}`)}this[u]=[],this[d]=[],this[s]="open",this[c]=this[c].bind(this),this.db=f,this.db.attachResource(this),this.nextTick=f.nextTick}get length(){return this[u].length}put(f,l,h){if(this[s]!=="open")throw new e("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const p=this.db._checkKey(f)||this.db._checkValue(l);if(p)throw p;const y=h&&h.sublevel!=null?h.sublevel:this.db,w=h,v=y.keyEncoding(h&&h.keyEncoding),C=y.valueEncoding(h&&h.valueEncoding),P=v.format;h={...h,keyEncoding:P,valueEncoding:C.format},y!==this.db&&(h.sublevel=null);const R=y.prefixKey(v.encode(f),P),F=C.encode(l);return this._put(R,F,h),this[u].push({...w,type:"put",key:f,value:l}),this}_put(f,l,h){}del(f,l){if(this[s]!=="open")throw new e("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const h=this.db._checkKey(f);if(h)throw h;const p=l&&l.sublevel!=null?l.sublevel:this.db,y=l,w=p.keyEncoding(l&&l.keyEncoding),v=w.format;return l={...l,keyEncoding:v},p!==this.db&&(l.sublevel=null),this._del(p.prefixKey(w.encode(f),v),l),this[u].push({...y,type:"del",key:f}),this}_del(f,l){}clear(){if(this[s]!=="open")throw new e("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[u]=[],this}_clear(){}write(f,l){return l=t(f,l),l=r(l,i),f=n(f),this[s]!=="open"?this.nextTick(l,new e("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):this.length===0?this.close(l):(this[s]="writing",this._write(f,h=>{this[s]="closing",this[d].push(()=>l(h)),h||this.db.emit("batch",this[u]),this._close(this[c])})),l[i]}_write(f,l){}close(f){return f=r(f,i),this[s]==="closing"?this[d].push(f):this[s]==="closed"?this.nextTick(f):(this[d].push(f),this[s]!=="writing"&&(this[s]="closing",this._close(this[c]))),f[i]}_close(f){this.nextTick(f)}[c](){this[s]="closed",this.db.detachResource(this);const f=this[d];this[d]=[];for(const l of f)l()}}return abstractChainedBatch.AbstractChainedBatch=g,abstractChainedBatch}var hasRequiredDefaultChainedBatch;function requireDefaultChainedBatch(){if(hasRequiredDefaultChainedBatch)return defaultChainedBatch;hasRequiredDefaultChainedBatch=1;const{AbstractChainedBatch:r}=requireAbstractChainedBatch(),e=requireModuleError(),t=Symbol("encoded");class n extends r{constructor(s){super(s),this[t]=[]}_put(s,u,c){this[t].push({...c,type:"put",key:s,value:u})}_del(s,u){this[t].push({...u,type:"del",key:s})}_clear(){this[t]=[]}_write(s,u){this.db.status==="opening"?this.db.defer(()=>this._write(s,u)):this.db.status==="open"?this[t].length===0?this.nextTick(u):this.db._batch(this[t],s,u):this.nextTick(u,new e("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}}return defaultChainedBatch.DefaultChainedBatch=n,defaultChainedBatch}var rangeOptions_1,hasRequiredRangeOptions;function requireRangeOptions(){if(hasRequiredRangeOptions)return rangeOptions_1;hasRequiredRangeOptions=1;const r=requireModuleError(),e=Object.prototype.hasOwnProperty,t=new Set(["lt","lte","gt","gte"]);return rangeOptions_1=function(n,i){const s={};for(const u in n)if(e.call(n,u)&&!(u==="keyEncoding"||u==="valueEncoding")){if(u==="start"||u==="end")throw new r(`The legacy range option '${u}' has been removed`,{code:"LEVEL_LEGACY"});if(u==="encoding")throw new r("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});t.has(u)?s[u]=i.encode(n[u]):s[u]=n[u]}return s.reverse=!!s.reverse,s.limit=Number.isInteger(s.limit)&&s.limit>=0?s.limit:-1,s},rangeOptions_1}/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var queueMicrotask_1,hasRequiredQueueMicrotask;function requireQueueMicrotask(){if(hasRequiredQueueMicrotask)return queueMicrotask_1;hasRequiredQueueMicrotask=1;let r;return queueMicrotask_1=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:commonjsGlobal):e=>(r||(r=Promise.resolve())).then(e).catch(t=>setTimeout(()=>{throw t},0)),queueMicrotask_1}var nextTickBrowser,hasRequiredNextTickBrowser;function requireNextTickBrowser(){if(hasRequiredNextTickBrowser)return nextTickBrowser;hasRequiredNextTickBrowser=1;const r=requireQueueMicrotask();return nextTickBrowser=function(e,...t){t.length===0?r(e):r(()=>e(...t))},nextTickBrowser}var abstractSublevelIterator={},hasRequiredAbstractSublevelIterator;function requireAbstractSublevelIterator(){if(hasRequiredAbstractSublevelIterator)return abstractSublevelIterator;hasRequiredAbstractSublevelIterator=1;const{AbstractIterator:r,AbstractKeyIterator:e,AbstractValueIterator:t}=requireAbstractIterator(),n=Symbol("unfix"),i=Symbol("iterator"),s=Symbol("handleOne"),u=Symbol("handleMany"),c=Symbol("callback");class d extends r{constructor(l,h,p,y){super(l,h),this[i]=p,this[n]=y,this[s]=this[s].bind(this),this[u]=this[u].bind(this),this[c]=null}[s](l,h,p){const y=this[c];if(l)return y(l);h!==void 0&&(h=this[n](h)),y(l,h,p)}[u](l,h){const p=this[c];if(l)return p(l);for(const y of h){const w=y[0];w!==void 0&&(y[0]=this[n](w))}p(l,h)}}class g extends e{constructor(l,h,p,y){super(l,h),this[i]=p,this[n]=y,this[s]=this[s].bind(this),this[u]=this[u].bind(this),this[c]=null}[s](l,h){const p=this[c];if(l)return p(l);h!==void 0&&(h=this[n](h)),p(l,h)}[u](l,h){const p=this[c];if(l)return p(l);for(let y=0;y<h.length;y++){const w=h[y];w!==void 0&&(h[y]=this[n](w))}p(l,h)}}class _ extends t{constructor(l,h,p){super(l,h),this[i]=p}}for(const f of[d,g])f.prototype._next=function(l){this[c]=l,this[i].next(this[s])},f.prototype._nextv=function(l,h,p){this[c]=p,this[i].nextv(l,h,this[u])},f.prototype._all=function(l,h){this[c]=h,this[i].all(l,this[u])};for(const f of[_])f.prototype._next=function(l){this[i].next(l)},f.prototype._nextv=function(l,h,p){this[i].nextv(l,h,p)},f.prototype._all=function(l,h){this[i].all(l,h)};for(const f of[d,g,_])f.prototype._seek=function(l,h){this[i].seek(l,h)},f.prototype._close=function(l){this[i].close(l)};return abstractSublevelIterator.AbstractSublevelIterator=d,abstractSublevelIterator.AbstractSublevelKeyIterator=g,abstractSublevelIterator.AbstractSublevelValueIterator=_,abstractSublevelIterator}var abstractSublevel,hasRequiredAbstractSublevel;function requireAbstractSublevel(){if(hasRequiredAbstractSublevel)return abstractSublevel;hasRequiredAbstractSublevel=1;const r=requireModuleError(),{Buffer:e}=requireBuffer()||{},{AbstractSublevelIterator:t,AbstractSublevelKeyIterator:n,AbstractSublevelValueIterator:i}=requireAbstractSublevelIterator(),s=Symbol("prefix"),u=Symbol("upperBound"),c=Symbol("prefixRange"),d=Symbol("parent"),g=Symbol("unfix"),_=new TextEncoder,f={separator:"!"};abstractSublevel=function({AbstractLevel:v}){class C extends v{static defaults(R){if(typeof R=="string")throw new r("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(R&&R.open)throw new r("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return R==null?f:R.separator?R:{...R,separator:"!"}}constructor(R,F,k){const{separator:B,manifest:H,...re}=C.defaults(k);F=w(F,B);const le=B.charCodeAt(0)+1,me=R[d]||R;if(!_.encode(F).every(lt=>lt>le&&lt<127))throw new r(`Prefix must use bytes > ${le} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(l(me,H),re);const He=(R.prefix||"")+B+F+B,ct=He.slice(0,-1)+String.fromCharCode(le);this[d]=me,this[s]=new p(He),this[u]=new p(ct),this[g]=new y,this.nextTick=me.nextTick}prefixKey(R,F){if(F==="utf8")return this[s].utf8+R;if(R.byteLength===0)return this[s][F];if(F==="view"){const k=this[s].view,B=new Uint8Array(k.byteLength+R.byteLength);return B.set(k,0),B.set(R,k.byteLength),B}else{const k=this[s].buffer;return e.concat([k,R],k.byteLength+R.byteLength)}}[c](R,F){R.gte!==void 0?R.gte=this.prefixKey(R.gte,F):R.gt!==void 0?R.gt=this.prefixKey(R.gt,F):R.gte=this[s][F],R.lte!==void 0?R.lte=this.prefixKey(R.lte,F):R.lt!==void 0?R.lt=this.prefixKey(R.lt,F):R.lte=this[u][F]}get prefix(){return this[s].utf8}get db(){return this[d]}_open(R,F){this[d].open({passive:!0},F)}_put(R,F,k,B){this[d].put(R,F,k,B)}_get(R,F,k){this[d].get(R,F,k)}_getMany(R,F,k){this[d].getMany(R,F,k)}_del(R,F,k){this[d].del(R,F,k)}_batch(R,F,k){this[d].batch(R,F,k)}_clear(R,F){this[c](R,R.keyEncoding),this[d].clear(R,F)}_iterator(R){this[c](R,R.keyEncoding);const F=this[d].iterator(R),k=this[g].get(this[s].utf8.length,R.keyEncoding);return new t(this,R,F,k)}_keys(R){this[c](R,R.keyEncoding);const F=this[d].keys(R),k=this[g].get(this[s].utf8.length,R.keyEncoding);return new n(this,R,F,k)}_values(R){this[c](R,R.keyEncoding);const F=this[d].values(R);return new i(this,R,F)}}return{AbstractSublevel:C}};const l=function(v,C){return{...v.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...C,encodings:{utf8:h(v,"utf8"),buffer:h(v,"buffer"),view:h(v,"view")}}},h=function(v,C){return v.supports.encodings[C]?v.keyEncoding(C).name===C:!1};class p{constructor(C){this.utf8=C,this.view=_.encode(C),this.buffer=e?e.from(this.view.buffer,0,this.view.byteLength):{}}}class y{constructor(){this.cache=new Map}get(C,P){let R=this.cache.get(P);return R===void 0&&(P==="view"?R=(function(F,k){return k.subarray(F)}).bind(null,C):R=(function(F,k){return k.slice(F)}).bind(null,C),this.cache.set(P,R)),R}}const w=function(v,C){let P=0,R=v.length;for(;P<R&&v[P]===C;)P++;for(;R>P&&v[R-1]===C;)R--;return v.slice(P,R)};return abstractSublevel}var hasRequiredAbstractLevel$1;function requireAbstractLevel$1(){if(hasRequiredAbstractLevel$1)return abstractLevel;hasRequiredAbstractLevel$1=1;const{supports:r}=requireLevelSupports(),{Transcoder:e}=requireLevelTranscoder(),{EventEmitter:t}=require$$0,{fromCallback:n}=requireCatering(),i=requireModuleError(),{AbstractIterator:s}=requireAbstractIterator(),{DefaultKeyIterator:u,DefaultValueIterator:c}=requireDefaultKvIterator(),{DeferredIterator:d,DeferredKeyIterator:g,DeferredValueIterator:_}=requireDeferredIterator(),{DefaultChainedBatch:f}=requireDefaultChainedBatch(),{getCallback:l,getOptions:h}=requireCommon(),p=requireRangeOptions(),y=Symbol("promise"),w=Symbol("landed"),v=Symbol("resources"),C=Symbol("closeResources"),P=Symbol("operations"),R=Symbol("undefer"),F=Symbol("deferOpen"),k=Symbol("options"),B=Symbol("status"),H=Symbol("defaultOptions"),re=Symbol("transcoder"),le=Symbol("keyEncoding"),me=Symbol("valueEncoding"),He=()=>{};class ct extends t{constructor(z,ne){if(super(),typeof z!="object"||z===null)throw new TypeError("The first argument 'manifest' must be an object");ne=h(ne);const{keyEncoding:ee,valueEncoding:ve,passive:Qe,...Me}=ne;this[v]=new Set,this[P]=[],this[F]=!0,this[k]=Me,this[B]="opening",this.supports=r(z,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:z.snapshots!==!1,permanence:z.permanence!==!1,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:z.encodings||{},events:Object.assign({},z.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[re]=new e(gt(this)),this[le]=this[re].encoding(ee||"utf8"),this[me]=this[re].encoding(ve||"utf8");for(const it of this[re].encodings())this.supports.encodings[it.commonName]||(this.supports.encodings[it.commonName]=!0);this[H]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[le].commonName,valueEncoding:this[me].commonName}),key:Object.freeze({keyEncoding:this[le].commonName})},this.nextTick(()=>{this[F]&&this.open({passive:!1},He)})}get status(){return this[B]}keyEncoding(z){return this[re].encoding(z??this[le])}valueEncoding(z){return this[re].encoding(z??this[me])}open(z,ne){ne=l(z,ne),ne=n(ne,y),z={...this[k],...h(z)},z.createIfMissing=z.createIfMissing!==!1,z.errorIfExists=!!z.errorIfExists;const ee=ve=>{this[B]==="closing"||this[B]==="opening"?this.once(w,ve?()=>ee(ve):ee):this[B]!=="open"?ne(new i("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:ve})):ne()};return z.passive?this[B]==="opening"?this.once(w,ee):this.nextTick(ee):this[B]==="closed"||this[F]?(this[F]=!1,this[B]="opening",this.emit("opening"),this._open(z,ve=>{if(ve){this[B]="closed",this[C](()=>{this.emit(w),ee(ve)}),this[R]();return}this[B]="open",this[R](),this.emit(w),this[B]==="open"&&this.emit("open"),this[B]==="open"&&this.emit("ready"),ee()})):this[B]==="open"?this.nextTick(ee):this.once(w,()=>this.open(z,ne)),ne[y]}_open(z,ne){this.nextTick(ne)}close(z){z=n(z,y);const ne=ee=>{this[B]==="opening"||this[B]==="closing"?this.once(w,ee?ne(ee):ne):this[B]!=="closed"?z(new i("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:ee})):z()};if(this[B]==="open"){this[B]="closing",this.emit("closing");const ee=ve=>{this[B]="open",this[R](),this.emit(w),ne(ve)};this[C](()=>{this._close(ve=>{if(ve)return ee(ve);this[B]="closed",this[R](),this.emit(w),this[B]==="closed"&&this.emit("closed"),ne()})})}else this[B]==="closed"?this.nextTick(ne):this.once(w,()=>this.close(z));return z[y]}[C](z){if(this[v].size===0)return this.nextTick(z);let ne=this[v].size,ee=!0;const ve=()=>{--ne===0&&(ee?this.nextTick(z):z())};for(const Qe of this[v])Qe.close(ve);ee=!1,this[v].clear()}_close(z){this.nextTick(z)}get(z,ne,ee){if(ee=l(ne,ee),ee=n(ee,y),ne=h(ne,this[H].entry),this[B]==="opening")return this.defer(()=>this.get(z,ne,ee)),ee[y];if(dt(this,ee))return ee[y];const ve=this._checkKey(z);if(ve)return this.nextTick(ee,ve),ee[y];const Qe=this.keyEncoding(ne.keyEncoding),Me=this.valueEncoding(ne.valueEncoding),it=Qe.format,Ne=Me.format;return(ne.keyEncoding!==it||ne.valueEncoding!==Ne)&&(ne=Object.assign({},ne,{keyEncoding:it,valueEncoding:Ne})),this._get(this.prefixKey(Qe.encode(z),it),ne,(De,Dt)=>{if(De)return(De.code==="LEVEL_NOT_FOUND"||De.notFound||/NotFound/i.test(De))&&(De.code||(De.code="LEVEL_NOT_FOUND"),De.notFound||(De.notFound=!0),De.status||(De.status=404)),ee(De);try{Dt=Me.decode(Dt)}catch(bt){return ee(new i("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:bt}))}ee(null,Dt)}),ee[y]}_get(z,ne,ee){this.nextTick(ee,new Error("NotFound"))}getMany(z,ne,ee){if(ee=l(ne,ee),ee=n(ee,y),ne=h(ne,this[H].entry),this[B]==="opening")return this.defer(()=>this.getMany(z,ne,ee)),ee[y];if(dt(this,ee))return ee[y];if(!Array.isArray(z))return this.nextTick(ee,new TypeError("The first argument 'keys' must be an array")),ee[y];if(z.length===0)return this.nextTick(ee,null,[]),ee[y];const ve=this.keyEncoding(ne.keyEncoding),Qe=this.valueEncoding(ne.valueEncoding),Me=ve.format,it=Qe.format;(ne.keyEncoding!==Me||ne.valueEncoding!==it)&&(ne=Object.assign({},ne,{keyEncoding:Me,valueEncoding:it}));const Ne=new Array(z.length);for(let De=0;De<z.length;De++){const Dt=z[De],bt=this._checkKey(Dt);if(bt)return this.nextTick(ee,bt),ee[y];Ne[De]=this.prefixKey(ve.encode(Dt),Me)}return this._getMany(Ne,ne,(De,Dt)=>{if(De)return ee(De);try{for(let bt=0;bt<Dt.length;bt++)Dt[bt]!==void 0&&(Dt[bt]=Qe.decode(Dt[bt]))}catch(bt){return ee(new i(`Could not decode one or more of ${Dt.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:bt}))}ee(null,Dt)}),ee[y]}_getMany(z,ne,ee){this.nextTick(ee,null,new Array(z.length).fill(void 0))}put(z,ne,ee,ve){if(ve=l(ee,ve),ve=n(ve,y),ee=h(ee,this[H].entry),this[B]==="opening")return this.defer(()=>this.put(z,ne,ee,ve)),ve[y];if(dt(this,ve))return ve[y];const Qe=this._checkKey(z)||this._checkValue(ne);if(Qe)return this.nextTick(ve,Qe),ve[y];const Me=this.keyEncoding(ee.keyEncoding),it=this.valueEncoding(ee.valueEncoding),Ne=Me.format,De=it.format;(ee.keyEncoding!==Ne||ee.valueEncoding!==De)&&(ee=Object.assign({},ee,{keyEncoding:Ne,valueEncoding:De}));const Dt=this.prefixKey(Me.encode(z),Ne),bt=it.encode(ne);return this._put(Dt,bt,ee,Nt=>{if(Nt)return ve(Nt);this.emit("put",z,ne),ve()}),ve[y]}_put(z,ne,ee,ve){this.nextTick(ve)}del(z,ne,ee){if(ee=l(ne,ee),ee=n(ee,y),ne=h(ne,this[H].key),this[B]==="opening")return this.defer(()=>this.del(z,ne,ee)),ee[y];if(dt(this,ee))return ee[y];const ve=this._checkKey(z);if(ve)return this.nextTick(ee,ve),ee[y];const Qe=this.keyEncoding(ne.keyEncoding),Me=Qe.format;return ne.keyEncoding!==Me&&(ne=Object.assign({},ne,{keyEncoding:Me})),this._del(this.prefixKey(Qe.encode(z),Me),ne,it=>{if(it)return ee(it);this.emit("del",z),ee()}),ee[y]}_del(z,ne,ee){this.nextTick(ee)}batch(z,ne,ee){if(!arguments.length){if(this[B]==="opening")return new f(this);if(this[B]!=="open")throw new i("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(typeof z=="function"?ee=z:ee=l(ne,ee),ee=n(ee,y),ne=h(ne,this[H].empty),this[B]==="opening")return this.defer(()=>this.batch(z,ne,ee)),ee[y];if(dt(this,ee))return ee[y];if(!Array.isArray(z))return this.nextTick(ee,new TypeError("The first argument 'operations' must be an array")),ee[y];if(z.length===0)return this.nextTick(ee),ee[y];const ve=new Array(z.length),{keyEncoding:Qe,valueEncoding:Me,...it}=ne;for(let Ne=0;Ne<z.length;Ne++){if(typeof z[Ne]!="object"||z[Ne]===null)return this.nextTick(ee,new TypeError("A batch operation must be an object")),ee[y];const De=Object.assign({},z[Ne]);if(De.type!=="put"&&De.type!=="del")return this.nextTick(ee,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),ee[y];const Dt=this._checkKey(De.key);if(Dt)return this.nextTick(ee,Dt),ee[y];const bt=De.sublevel!=null?De.sublevel:this,Nt=bt.keyEncoding(De.keyEncoding||Qe),fr=Nt.format;if(De.key=bt.prefixKey(Nt.encode(De.key),fr),De.keyEncoding=fr,De.type==="put"){const Ut=this._checkValue(De.value);if(Ut)return this.nextTick(ee,Ut),ee[y];const Yt=bt.valueEncoding(De.valueEncoding||Me);De.value=Yt.encode(De.value),De.valueEncoding=Yt.format}bt!==this&&(De.sublevel=null),ve[Ne]=De}return this._batch(ve,it,Ne=>{if(Ne)return ee(Ne);this.emit("batch",z),ee()}),ee[y]}_batch(z,ne,ee){this.nextTick(ee)}sublevel(z,ne){return this._sublevel(z,lt.defaults(ne))}_sublevel(z,ne){return new lt(this,z,ne)}prefixKey(z,ne){return z}clear(z,ne){if(ne=l(z,ne),ne=n(ne,y),z=h(z,this[H].empty),this[B]==="opening")return this.defer(()=>this.clear(z,ne)),ne[y];if(dt(this,ne))return ne[y];const ee=z,ve=this.keyEncoding(z.keyEncoding);return z=p(z,ve),z.keyEncoding=ve.format,z.limit===0?this.nextTick(ne):this._clear(z,Qe=>{if(Qe)return ne(Qe);this.emit("clear",ee),ne()}),ne[y]}_clear(z,ne){this.nextTick(ne)}iterator(z){const ne=this.keyEncoding(z&&z.keyEncoding),ee=this.valueEncoding(z&&z.valueEncoding);if(z=p(z,ne),z.keys=z.keys!==!1,z.values=z.values!==!1,z[s.keyEncoding]=ne,z[s.valueEncoding]=ee,z.keyEncoding=ne.format,z.valueEncoding=ee.format,this[B]==="opening")return new d(this,z);if(this[B]!=="open")throw new i("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(z)}_iterator(z){return new s(this,z)}keys(z){const ne=this.keyEncoding(z&&z.keyEncoding),ee=this.valueEncoding(z&&z.valueEncoding);if(z=p(z,ne),z[s.keyEncoding]=ne,z[s.valueEncoding]=ee,z.keyEncoding=ne.format,z.valueEncoding=ee.format,this[B]==="opening")return new g(this,z);if(this[B]!=="open")throw new i("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(z)}_keys(z){return new u(this,z)}values(z){const ne=this.keyEncoding(z&&z.keyEncoding),ee=this.valueEncoding(z&&z.valueEncoding);if(z=p(z,ne),z[s.keyEncoding]=ne,z[s.valueEncoding]=ee,z.keyEncoding=ne.format,z.valueEncoding=ee.format,this[B]==="opening")return new _(this,z);if(this[B]!=="open")throw new i("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(z)}_values(z){return new c(this,z)}defer(z){if(typeof z!="function")throw new TypeError("The first argument must be a function");this[P].push(z)}[R](){if(this[P].length===0)return;const z=this[P];this[P]=[];for(const ne of z)ne()}attachResource(z){if(typeof z!="object"||z===null||typeof z.close!="function")throw new TypeError("The first argument must be a resource object");this[v].add(z)}detachResource(z){this[v].delete(z)}_chainedBatch(){return new f(this)}_checkKey(z){if(z==null)return new i("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(z){if(z==null)return new i("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}}ct.prototype.nextTick=requireNextTickBrowser();const{AbstractSublevel:lt}=requireAbstractSublevel()({AbstractLevel:ct});abstractLevel.AbstractLevel=ct,abstractLevel.AbstractSublevel=lt;const dt=function(Ee,z){return Ee[B]!=="open"?(Ee.nextTick(z,new i("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0):!1},gt=function(Ee){return Object.keys(Ee.supports.encodings).filter(z=>!!Ee.supports.encodings[z])};return abstractLevel}var hasRequiredAbstractLevel;function requireAbstractLevel(){return hasRequiredAbstractLevel||(hasRequiredAbstractLevel=1,abstractLevel$1.AbstractLevel=requireAbstractLevel$1().AbstractLevel,abstractLevel$1.AbstractSublevel=requireAbstractLevel$1().AbstractSublevel,abstractLevel$1.AbstractIterator=requireAbstractIterator().AbstractIterator,abstractLevel$1.AbstractKeyIterator=requireAbstractIterator().AbstractKeyIterator,abstractLevel$1.AbstractValueIterator=requireAbstractIterator().AbstractValueIterator,abstractLevel$1.AbstractChainedBatch=requireAbstractChainedBatch().AbstractChainedBatch),abstractLevel$1}/*! run-parallel-limit. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var runParallelLimit_1,hasRequiredRunParallelLimit;function requireRunParallelLimit(){if(hasRequiredRunParallelLimit)return runParallelLimit_1;hasRequiredRunParallelLimit=1,runParallelLimit_1=e;const r=requireQueueMicrotask();function e(t,n,i){if(typeof n!="number")throw new Error("second argument must be a Number");let s,u,c,d,g,_=!0,f;Array.isArray(t)?(s=[],c=u=t.length):(d=Object.keys(t),s={},c=u=d.length);function l(p){function y(){i&&i(p,s),i=null}_?r(y):y()}function h(p,y,w){if(s[p]=w,y&&(g=!0),--c===0||y)l(y);else if(!g&&f<u){let v;d?(v=d[f],f+=1,t[v](function(C,P){h(v,C,P)})):(v=f,f+=1,t[v](function(C,P){h(v,C,P)}))}}f=n,c?d?d.some(function(p,y){return t[p](function(w,v){h(p,w,v)}),y===n-1}):t.some(function(p,y){return p(function(w,v){h(y,w,v)}),y===n-1}):l(null),_=!1}return runParallelLimit_1}var iterator={},keyRange,hasRequiredKeyRange;function requireKeyRange(){return hasRequiredKeyRange||(hasRequiredKeyRange=1,keyRange=function(e){const t=e.gte!==void 0?e.gte:e.gt!==void 0?e.gt:void 0,n=e.lte!==void 0?e.lte:e.lt!==void 0?e.lt:void 0,i=e.gte===void 0,s=e.lte===void 0;return t!==void 0&&n!==void 0?IDBKeyRange.bound(t,n,i,s):t!==void 0?IDBKeyRange.lowerBound(t,i):n!==void 0?IDBKeyRange.upperBound(n,s):null}),keyRange}var deserialize,hasRequiredDeserialize;function requireDeserialize(){if(hasRequiredDeserialize)return deserialize;hasRequiredDeserialize=1;const r=new TextEncoder;return deserialize=function(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):r.encode(e)},deserialize}var hasRequiredIterator;function requireIterator(){if(hasRequiredIterator)return iterator;hasRequiredIterator=1;const{AbstractIterator:r}=requireAbstractLevel(),e=requireKeyRange(),t=requireDeserialize(),n=Symbol("cache"),i=Symbol("finished"),s=Symbol("options"),u=Symbol("currentOptions"),c=Symbol("position"),d=Symbol("location"),g=Symbol("first"),_={};class f extends r{constructor(p,y,w){super(p,w),this[n]=[],this[i]=this.limit===0,this[s]=w,this[u]={...w},this[c]=void 0,this[d]=y,this[g]=!0}_nextv(p,y,w){if(this[g]=!1,this[i])return this.nextTick(w,null,[]);if(this[n].length>0)return p=Math.min(p,this[n].length),this.nextTick(w,null,this[n].splice(0,p));this[c]!==void 0&&(this[s].reverse?(this[u].lt=this[c],this[u].lte=void 0):(this[u].gt=this[c],this[u].gte=void 0));let v;try{v=e(this[u])}catch{return this[i]=!0,this.nextTick(w,null,[])}const C=this.db.db.transaction([this[d]],"readonly"),P=C.objectStore(this[d]),R=[];if(this[s].reverse){const F=!this[s].values&&P.openKeyCursor?"openKeyCursor":"openCursor";P[F](v,"prev").onsuccess=k=>{const B=k.target.result;if(B){const{key:H,value:re}=B;this[c]=H,R.push([this[s].keys&&H!==void 0?t(H):void 0,this[s].values&&re!==void 0?t(re):void 0]),R.length<p?B.continue():l(C)}else this[i]=!0}}else{let F,k;const B=()=>{if(F===void 0||k===void 0)return;const H=Math.max(F.length,k.length);H===0||p===1/0?this[i]=!0:this[c]=F[H-1],R.length=H;for(let re=0;re<H;re++){const le=F[re],me=k[re];R[re]=[this[s].keys&&le!==void 0?t(le):void 0,this[s].values&&me!==void 0?t(me):void 0]}l(C)};this[s].keys||p<1/0?P.getAllKeys(v,p<1/0?p:void 0).onsuccess=H=>{F=H.target.result,B()}:(F=[],this.nextTick(B)),this[s].values?P.getAll(v,p<1/0?p:void 0).onsuccess=H=>{k=H.target.result,B()}:(k=[],this.nextTick(B))}C.onabort=()=>{w(C.error||new Error("aborted by user")),w=null},C.oncomplete=()=>{w(null,R),w=null}}_next(p){if(this[n].length>0){const[y,w]=this[n].shift();this.nextTick(p,null,y,w)}else if(this[i])this.nextTick(p);else{let y=Math.min(100,this.limit-this.count);this[g]&&(this[g]=!1,y=1),this._nextv(y,_,(w,v)=>{if(w)return p(w);this[n]=v,this._next(p)})}}_all(p,y){this[g]=!1;const w=this[n].splice(0,this[n].length),v=this.limit-this.count-w.length;if(v<=0)return this.nextTick(y,null,w);this._nextv(v,_,(C,P)=>{if(C)return y(C);w.length>0&&(P=w.concat(P)),y(null,P)})}_seek(p,y){this[g]=!0,this[n]=[],this[i]=!1,this[c]=void 0,this[u]={...this[s]};let w;try{w=e(this[s])}catch{this[i]=!0;return}w!==null&&!w.includes(p)?this[i]=!0:this[s].reverse?this[u].lte=p:this[u].gte=p}}iterator.Iterator=f;function l(h){typeof h.commit=="function"&&h.commit()}return iterator}var clear,hasRequiredClear;function requireClear(){return hasRequiredClear||(hasRequiredClear=1,clear=function(e,t,n,i,s){if(i.limit===0)return e.nextTick(s);const u=e.db.transaction([t],"readwrite"),c=u.objectStore(t);let d=0;u.oncomplete=function(){s()},u.onabort=function(){s(u.error||new Error("aborted by user"))};const g=c.openKeyCursor?"openKeyCursor":"openCursor",_=i.reverse?"prev":"next";c[g](n,_).onsuccess=function(f){const l=f.target.result;l&&(c.delete(l.key).onsuccess=function(){(i.limit<=0||++d<i.limit)&&l.continue()})}}),clear}var hasRequiredBrowserLevel;function requireBrowserLevel(){if(hasRequiredBrowserLevel)return browserLevel;hasRequiredBrowserLevel=1;const{AbstractLevel:r}=requireAbstractLevel(),e=requireModuleError(),t=requireRunParallelLimit(),{fromCallback:n}=requireCatering(),{Iterator:i}=requireIterator(),s=requireDeserialize(),u=requireClear(),c=requireKeyRange(),d="level-js-",g=Symbol("idb"),_=Symbol("namePrefix"),f=Symbol("location"),l=Symbol("version"),h=Symbol("store"),p=Symbol("onComplete"),y=Symbol("promise");class w extends r{constructor(C,P,R){if(typeof P=="function"||typeof R=="function")throw new e("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});const{prefix:F,version:k,...B}=P||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},B),typeof C!="string")throw new Error("constructor requires a location string argument");this[f]=C,this[_]=F??d,this[l]=parseInt(k||1,10),this[g]=null}get location(){return this[f]}get namePrefix(){return this[_]}get version(){return this[l]}get db(){return this[g]}get type(){return"browser-level"}_open(C,P){const R=indexedDB.open(this[_]+this[f],this[l]);R.onerror=function(){P(R.error||new Error("unknown error"))},R.onsuccess=()=>{this[g]=R.result,P()},R.onupgradeneeded=F=>{const k=F.target.result;k.objectStoreNames.contains(this[f])||k.createObjectStore(this[f])}}[h](C){return this[g].transaction([this[f]],C).objectStore(this[f])}[p](C,P){const R=C.transaction;R.onabort=function(){P(R.error||new Error("aborted by user"))},R.oncomplete=function(){P(null,C.result)}}_get(C,P,R){const F=this[h]("readonly");let k;try{k=F.get(C)}catch(B){return this.nextTick(R,B)}this[p](k,function(B,H){if(B)return R(B);if(H===void 0)return R(new e("Entry not found",{code:"LEVEL_NOT_FOUND"}));R(null,s(H))})}_getMany(C,P,R){const F=this[h]("readonly"),k=C.map(B=>H=>{let re;try{re=F.get(B)}catch(le){return H(le)}re.onsuccess=()=>{const le=re.result;H(null,le===void 0?le:s(le))},re.onerror=le=>{le.stopPropagation(),H(re.error)}});t(k,16,R)}_del(C,P,R){const F=this[h]("readwrite");let k;try{k=F.delete(C)}catch(B){return this.nextTick(R,B)}this[p](k,R)}_put(C,P,R,F){const k=this[h]("readwrite");let B;try{B=k.put(P,C)}catch(H){return this.nextTick(F,H)}this[p](B,F)}_iterator(C){return new i(this,this[f],C)}_batch(C,P,R){const F=this[h]("readwrite"),k=F.transaction;let B=0,H;k.onabort=function(){R(H||k.error||new Error("aborted by user"))},k.oncomplete=function(){R()};function re(){const le=C[B++],me=le.key;let He;try{He=le.type==="del"?F.delete(me):F.put(le.value,me)}catch(ct){H=ct,k.abort();return}B<C.length?He.onsuccess=re:typeof k.commit=="function"&&k.commit()}re()}_clear(C,P){let R,F;try{R=c(C)}catch{return this.nextTick(P)}if(C.limit>=0)return u(this,this[f],R,C,P);try{const k=this[h]("readwrite");F=R?k.delete(R):k.clear()}catch(k){return this.nextTick(P,k)}this[p](F,P)}_close(C){this[g].close(),this.nextTick(C)}}return w.destroy=function(v,C,P){typeof C=="function"&&(P=C,C=d),P=n(P,y);const R=indexedDB.deleteDatabase(C+v);return R.onsuccess=function(){P()},R.onerror=function(F){P(F)},P[y]},browserLevel.BrowserLevel=w,browserLevel}var hasRequiredBrowser;function requireBrowser(){return hasRequiredBrowser||(hasRequiredBrowser=1,browser.Level=requireBrowserLevel().BrowserLevel),browser}var browserExports=requireBrowser();class LevelDatastore extends BaseDatastore{constructor(e,t={}){super(),this.db=typeof e=="string"?new browserExports.Level(e,{...t,keyEncoding:"utf8",valueEncoding:"view"}):e,this.opts={createIfMissing:!0,compression:!1,...t}}async open(){try{await this.db.open(this.opts)}catch(e){throw dbOpenFailedError(e)}}async put(e,t){try{await this.db.put(e.toString(),t)}catch(n){throw dbWriteFailedError(n)}}async get(e){let t;try{t=await this.db.get(e.toString())}catch(n){throw n.notFound?notFoundError(n):dbWriteFailedError(n)}return t}async has(e){try{await this.db.get(e.toString())}catch(t){if(t.notFound)return!1;throw t}return!0}async delete(e){try{await this.db.del(e.toString())}catch(t){throw dbDeleteFailedError(t)}}close(){return this.db&&this.db.close()}batch(){const e=[];return{put:(t,n)=>{e.push({type:"put",key:t.toString(),value:n})},delete:t=>{e.push({type:"del",key:t.toString()})},commit:()=>this.db.batch(e)}}query(e){let t=this._query({values:!0,prefix:e.prefix});Array.isArray(e.filters)&&(t=e.filters.reduce((s,u)=>filter(s,u),t)),Array.isArray(e.orders)&&(t=e.orders.reduce((s,u)=>sort(s,u),t));const{offset:n,limit:i}=e;if(n){let s=0;t=filter(t,()=>s++>=n)}return i&&(t=take(t,i)),t}queryKeys(e){let t=map(this._query({values:!1,prefix:e.prefix}),({key:s})=>s);Array.isArray(e.filters)&&(t=e.filters.reduce((s,u)=>filter(s,u),t)),Array.isArray(e.orders)&&(t=e.orders.reduce((s,u)=>sort(s,u),t));const{offset:n,limit:i}=e;if(n){let s=0;t=filter(t,()=>s++>=n)}return i&&(t=take(t,i)),t}_query(e){const t={keys:!0,keyEncoding:"buffer",values:e.values};if(e.prefix!=null){const i=e.prefix.toString();t.gte=i,t.lt=i+"ÿ"}const n=this.db.iterator(t);if(n[Symbol.asyncIterator])return levelIteratorToIterator(n);if(n.next!=null&&n.end!=null)return oldLevelIteratorToIterator(n);throw new Error("Level returned incompatible iterator")}}async function*levelIteratorToIterator(r){for await(const[e,t]of r)yield{key:new Key(e,!1),value:t};await r.close()}function oldLevelIteratorToIterator(r){return{[Symbol.asyncIterator](){return{next:()=>new Promise((e,t)=>{r.next((n,i,s)=>{if(n)return t(n);if(i==null)return r.end(u=>{if(u)return t(u);e({done:!0,value:void 0})});e({done:!1,value:{key:new Key(i,!1),value:s}})})}),return:()=>new Promise((e,t)=>{r.end(n=>{if(n)return t(n);e({done:!0,value:void 0})})})}}}}function create$1(){const r=new MemoryDatastore;return createRepo("fission-ipfs",e=>{const t={[code]:dagPB,[name]:dagPB,[code$1]:dagCBOR,[name$1]:dagCBOR,[code$2]:raw,[name$2]:raw};return Promise.resolve(t[e])},{root:new LevelDatastore("fission-ipfs/root",{prefix:"",version:2}),blocks:new BlockstoreDatastoreAdapter(new LevelDatastore("fission-ipfs/blocks",{prefix:"",version:2})),keys:new LevelDatastore("fission-ipfs/keys",{prefix:"",version:2}),datastore:r,pins:new LevelDatastore("fission-ipfs/pins",{prefix:"",version:2})},{repoLock:{lock:async()=>({close:async()=>{}}),locked:async()=>!1},autoMigrate:!1})}const latestPeerTimeoutIds={};var mu;const isSafari=/^((?!chrome|android).)*safari/i.test(((mu=globalThis.navigator)==null?void 0:mu.userAgent)||""),KEEP_ALIVE_INTERVAL=1*60*1e3,KEEP_TRYING_INTERVAL=5*60*1e3,BACKOFF_INIT={retryNumber:0,lastBackoff:0,currentBackoff:1e3},OPTIONS={config:{Addresses:{Delegates:[]},Bootstrap:[],Discovery:{webRTCStar:{Enabled:!1}},Pubsub:{Enabled:!1}},preload:{enabled:!1,addresses:[]},libp2p:{peerDiscovery:[],connectionManager:{autoDial:!1}},init:{algorithm:isSafari?RSA:void 0},repo:create$1()};async function createAndConnect(r){const e=await listPeers();if(e.length===0)throw new Error("💥 Couldn't start IPFS node, peer list is empty");const t=await r.create(OPTIONS);return e.forEach(n=>{latestPeerTimeoutIds[n.toString()]=null,tryConnecting(t,n)}),globalThis.addEventListener("online",async()=>{(await listPeers()).filter(n=>{const i=n.toString();return!i.includes("/localhost/")&&!i.includes("/127.0.0.1/")&&!i.includes("/0.0.0.0/")}).forEach(n=>{tryConnecting(t,n)})}),t}const STORAGE_KEY="ipfs_peers_1661540056";function fetchFissionPeers(){const r=`${setup.endpoints.api}/ipfs/peers`;return fetch(r).then(e=>e.json()).then(e=>Array.isArray(e)?e:[]).then(e=>e.filter(t=>isString(t)&&t.includes("/wss/"))).catch(e=>{throw new Error("💥 Couldn't start IPFS node, failed to fetch peer list")})}async function listPeers(){let r;const e=await localforage.getItem(STORAGE_KEY);return isString(e)&&e.trim()!==""?(r=JSON.parse(e),fetchFissionPeers().then(t=>localforage.setItem(STORAGE_KEY,JSON.stringify(t))).catch(t=>{console.error(t)})):(r=await fetchFissionPeers(),await localforage.setItem(STORAGE_KEY,JSON.stringify(r))),r.map(multiaddr$1)}function keepAlive(r,e,t,n){let i=null;t.currentBackoff<KEEP_TRYING_INTERVAL?i=setTimeout(()=>reconnect(r,e,t,n),t.currentBackoff):i=setTimeout(()=>reconnect(r,e,t,n),KEEP_TRYING_INTERVAL),latestPeerTimeoutIds[e.toString()]=i,ping(r,e).then(({latency:s})=>{const u={connected:!0,lastConnectedAt:Date.now(),latency:s};report(e,u),i&&clearTimeout(i),i===latestPeerTimeoutIds[e.toString()]&&setTimeout(()=>keepAlive(r,e,BACKOFF_INIT,u),KEEP_ALIVE_INTERVAL)}).catch(()=>{})}async function reconnect(r,e,t,n){const i={...n,connected:!1,latency:null};report(e,i);try{await r.swarm.disconnect(e),await r.swarm.connect(e)}catch{}if(t.currentBackoff<KEEP_TRYING_INTERVAL){const s={retryNumber:t.retryNumber+1,lastBackoff:t.currentBackoff,currentBackoff:t.lastBackoff+t.currentBackoff};keepAlive(r,e,s,i)}else keepAlive(r,e,t,i)}function tryConnecting(r,e){ping(r,e).then(({latency:t})=>r.swarm.connect(e,{timeout:60*1e3}).then(()=>{const n={connected:!0,lastConnectedAt:Date.now(),latency:t};report(e,n),setTimeout(()=>keepAlive(r,e,BACKOFF_INIT,n),KEEP_ALIVE_INTERVAL)})).catch(()=>{const t={connected:!1,lastConnectedAt:null,latency:null};report(e,t),keepAlive(r,e,BACKOFF_INIT,t)})}async function ping(r,e){return r.libp2p.ping(e).then(t=>({latency:t}))}let peerConnections=[];function report(r,e){peerConnections=peerConnections.filter(n=>n.peer!==r).concat({peer:r,status:e}),peerConnections.every(n=>!n.status.connected),peerConnections.reduce((n,{status:i})=>n>=(i.lastConnectedAt||0)?n:i.lastConnectedAt||0,0);const t=peerConnections.filter(n=>n.status.latency!==null);t.length>0&&peerConnections.reduce((n,i)=>n+(i.status.latency||0),0)/t.length}const DEFAULT_CDN_URL="https://unpkg.com/ipfs-core@0.15.4/dist/index.min.js";let ipfs=null;const get$1=async()=>(ipfs||(ipfs=await nodeWithPkg(await pkgFromCDN(DEFAULT_CDN_URL))),ipfs),nodeWithPkg=r=>createAndConnect(r),pkgFromCDN=async r=>import(r).then(e=>self.IpfsCore),DAG_NODE_DATA=new Uint8Array([8,1]),rawToDAGLink=r=>createLink(r.Name,r.Tsize,decodeCID(r.Hash)),rawToDAGNode=r=>{var n,i,s;const e=(n=r==null?void 0:r.value)==null?void 0:n.Data,t=(s=(i=r==null?void 0:r.value)==null?void 0:i.Links)==null?void 0:s.map(rawToDAGLink);return createNode(e,t)},add$1=async r=>{const t=await(await get$1()).add(r,{cidVersion:1,pin:setup.shouldPin});return{cid:decodeCID(t.cid),size:t.size,isFile:!0}},catRaw=async r=>{const e=typeCheckCID(r),t=await get$1(),n=[];await attemptPin();for await(const i of t.cat(e))n.push(i);return n},catBuf=async r=>{const e=typeCheckCID(r),t=await catRaw(e);return concat$2(t)},cat=async r=>{const e=typeCheckCID(r);return(await catBuf(e)).toString()},ls=async r=>{const e=typeCheckCID(r),t=await get$1(),n=[];for await(const i of t.ls(e))n.push({...i,cid:decodeCID(i.cid)});return n},dagGet=async r=>{const e=typeCheckCID(r),t=await get$1();await attemptPin();const n=await t.dag.get(e);return rawToDAGNode(n)},dagPut=async r=>{const e=await get$1(),t=createNode(r.Data||new Uint8Array,r.Links.map(s=>createLink(s.Name||"",s.Tsize||0,s.Hash))),n=await e.dag.put(t,{storeCodec:"dag-pb",hashAlg:"sha2-256"}).then(decodeCID);await attemptPin();const i=await size(n);return{cid:n,size:i,isFile:!1}},dagPutLinks=async r=>{const e=createNode(DAG_NODE_DATA,r);return dagPut(e)},size=async r=>{const e=typeCheckCID(r);return(await(await get$1()).files.stat(`/ipfs/${e}`)).cumulativeSize},attemptPin=async r=>{},typeCheckCID=r=>{const e=CID$1.asCID(r);if(!e)throw new Error(`Expected a CID class instance: Found ${r}`);return e},add=async(r,e)=>{const t=isBlob(r)?await toUint8Array(r):r,n=encode$9(t);if(!isJust(e))return add$1(n);const i=SymmAlg.AES_GCM,s=await aes.encrypt(n,e,i),u=encode$9({alg:i,cip:s});return add$1(u)},catAndDecode=async(r,e)=>{const t=await catBuf(r);if(!isJust(e))return decode$c(t);const n=decode$c(t);if(!isSymmAlg(n.alg)||!isDefined(n.cip))throw new Error('Unexpected private block. Expected "alg" and "cip" field.');const i=n.alg,s=await aes.decrypt(n.cip,e,i);return decode$c(s)};function isSymmAlg(r){return isString(r)&&Object.values(SymmAlg).includes(r)}const toDAGLink=r=>{const{name:e,cid:t,size:n}=r;return createLink(e,n,decodeCID(t))},fromFSFile=r=>{const{name:e="",cid:t,size:n,type:i}=r;return{name:e,cid:t,size:n,isFile:i!=="dir"}},fromDAGLink=r=>{const e=r.Name||"",t=r.Hash,n=r.Tsize||0;return{name:e,cid:t,size:n}},make=(r,e,t,n)=>({name:r,cid:e,size:n,isFile:t}),arrToMap=r=>r.reduce((e,t)=>(e[t.name]=t,e),{}),getFile=async r=>catBuf(r),getEncryptedFile=async(r,e)=>catAndDecode(r,e),putFile$1=async r=>add$1(r),putEncryptedFile=async(r,e)=>add(r,e),getSimpleLinks=async r=>{const e=await dagGet(r);return arrToMap(e.Links.map(fromDAGLink))},getFileSystemLinks=async r=>{const e=await dagGet(r),t=await Promise.all(e.Links.map(async n=>{const i=await dagGet(n.Hash),s=arrToMap(i.Links.map(fromDAGLink));if(!!s.softLink){const d=await catBuf(decodeCID(s.softLink.cid)),g=new TextDecoder().decode(d);return JSON.parse(g)}const c=await catAndDecode(decodeCID(s.metadata.cid),null);return{...fromDAGLink(n),isFile:hasProp(c,"isFile")?c.isFile:!1}}));return arrToMap(t)},putLinks=async r=>{const e=Object.values(r).filter(t=>t!==void 0).map(async t=>{if(isSoftLink(t)){const n=await add$1(JSON.stringify(t)),i=await dagPut(createNode(DAG_NODE_DATA,[createLink("softLink",n.size,n.cid)]));return createLink(t.name,i.size,i.cid)}else return t.Hash?t:toDAGLink(t)});return dagPutLinks(await Promise.all(e))},putTree=async(r,e,t,n)=>{const i=await putLinks(r),s=make("userland",i.cid,!0,i.size),[u,c]=await Promise.all([putAndMakeLink("metadata",t),putAndMakeLink("skeleton",e)]),d=n!=null?make("previous",n,!1,await size(n)):void 0,g={metadata:u,skeleton:c,userland:s,previous:d},{cid:_,size:f}=await putLinks(g);return{cid:_,userland:decodeCID(s.cid),metadata:decodeCID(u.cid),size:f,isFile:!1,skeleton:e}},putFile=async(r,e,t)=>{const n=await putFile$1(await normalizeFileContent(r)),i=make("userland",n.cid,!0,n.size),s=await putAndMakeLink("metadata",e),u=t!=null?make("previous",t,!1,await size(t)):void 0,c={metadata:s,userland:i,previous:u},{cid:d,size:g}=await putLinks(c);return{cid:d,userland:decodeCID(i.cid),metadata:decodeCID(s.cid),size:g,isFile:!0,skeleton:{}}},putAndMakeLink=async(r,e)=>{const{cid:t,size:n}=await add(e,null);return make(r,t,!0,n)},get=async r=>{var u,c;const e=await getSimpleLinks(r),t=await getAndCheckValue(e,"metadata",isMetadata),n=t.isFile?void 0:await getAndCheckValue(e,"skeleton",isSkeleton),i=((u=e.userland)==null?void 0:u.cid)||null;if(!isCID(i))throw new Error("Could not find userland");const s=((c=e.previous)==null?void 0:c.cid)||void 0;return{userland:i,metadata:t,previous:s,skeleton:n}},getValue=async(r,e)=>{const t=CID$1.asCID(r);if(isCID(r)){if(!t)return null;const n=await getSimpleLinks(t);return getValueFromLinks(n,e)}return getValueFromLinks(r,e)},getValueFromLinks=async(r,e)=>{var n;const t=(n=r[e])==null?void 0:n.cid;return t?catAndDecode(decodeCID(t),null):null},getAndCheckValue=async(r,e,t,n=!1)=>{const i=await getValue(r,e);return checkValue(i,e,t,n)},checkValue=(r,e,t,n=!1)=>{if(!isValue(r)){if(n)return r;throw new Error(`Could not find header value: ${e}`)}if(t(r))return r;throw new Error(`Improperly formatted header value: ${e}`)};async function normalizeFileContent(r){if(r instanceof Uint8Array)return r;if(typeof Blob<"u"&&r instanceof Blob)return await toUint8Array(r);const e=new TextEncoder;if(typeof r=="string")return e.encode(r);const t=JSON.stringify(r);return e.encode(t)}const isDecryptedNode=r=>isPrivateTreeInfo(r)||isPrivateFileInfo(r)||isSoftLink(r),isPrivateFileInfo=r=>isObject(r)&&isMetadata(r.metadata)&&r.metadata.isFile&&isString(r.key)&&notNull(r.content),isPrivateTreeInfo=r=>isObject(r)&&isMetadata(r.metadata)&&r.metadata.isFile===!1&&isNum(r.revision)&&isPrivateLinks(r.links)&&isPrivateSkeleton(r.skeleton),isPrivateLink=r=>isBaseLink(r)&&isString(r.key)&&isString(r.pointer),isPrivateLinks=r=>isObject(r)&&Object.values(r).every(e=>isPrivateLink(e)||isSoftLink(e)),isPrivateSkeleton=r=>isObject(r)&&Object.values(r).every(e=>isPrivateSkeletonInfo(e)||isSoftLink(e)),isPrivateSkeletonInfo=r=>isObject(r)&&notNull(r.cid)&&isString(r.key)&&isPrivateSkeleton(r.subSkeleton);var api={},bloomFilter={},baseFilter={},utils={},cuint={},uint32$1={exports:{}},uint32=uint32$1.exports,hasRequiredUint32;function requireUint32(){return hasRequiredUint32||(hasRequiredUint32=1,function(r){(function(e){t(Math.pow(36,5)),t(Math.pow(16,7)),t(Math.pow(10,9)),t(Math.pow(2,30)),t(36),t(16),t(10),t(2);function t(u,c){if(!(this instanceof t))return new t(u,c);if(this._low=0,this._high=0,this.remainder=null,typeof c>"u")return i.call(this,u);if(typeof u=="string")return s.call(this,u,c);n.call(this,u,c)}function n(u,c){return this._low=u|0,this._high=c|0,this}t.prototype.fromBits=n;function i(u){return this._low=u&65535,this._high=u>>>16,this}t.prototype.fromNumber=i;function s(u,c){var d=parseInt(u,c||10);return this._low=d&65535,this._high=d>>>16,this}t.prototype.fromString=s,t.prototype.toNumber=function(){return this._high*65536+this._low},t.prototype.toString=function(u){return this.toNumber().toString(u||10)},t.prototype.add=function(u){var c=this._low+u._low,d=c>>>16;return d+=this._high+u._high,this._low=c&65535,this._high=d&65535,this},t.prototype.subtract=function(u){return this.add(u.clone().negate())},t.prototype.multiply=function(u){var c=this._high,d=this._low,g=u._high,_=u._low,f,l;return l=d*_,f=l>>>16,f+=c*_,f&=65535,f+=d*g,this._low=l&65535,this._high=f&65535,this},t.prototype.div=function(u){if(u._low==0&&u._high==0)throw Error("division by zero");if(u._high==0&&u._low==1)return this.remainder=new t(0),this;if(u.gt(this))return this.remainder=this.clone(),this._low=0,this._high=0,this;if(this.eq(u))return this.remainder=new t(0),this._low=1,this._high=0,this;for(var c=u.clone(),d=-1;!this.lt(c);)c.shiftLeft(1,!0),d++;for(this.remainder=this.clone(),this._low=0,this._high=0;d>=0;d--)c.shiftRight(1),this.remainder.lt(c)||(this.remainder.subtract(c),d>=16?this._high|=1<<d-16:this._low|=1<<d);return this},t.prototype.negate=function(){var u=(~this._low&65535)+1;return this._low=u&65535,this._high=~this._high+(u>>>16)&65535,this},t.prototype.equals=t.prototype.eq=function(u){return this._low==u._low&&this._high==u._high},t.prototype.greaterThan=t.prototype.gt=function(u){return this._high>u._high?!0:this._high<u._high?!1:this._low>u._low},t.prototype.lessThan=t.prototype.lt=function(u){return this._high<u._high?!0:this._high>u._high?!1:this._low<u._low},t.prototype.or=function(u){return this._low|=u._low,this._high|=u._high,this},t.prototype.and=function(u){return this._low&=u._low,this._high&=u._high,this},t.prototype.not=function(){return this._low=~this._low&65535,this._high=~this._high&65535,this},t.prototype.xor=function(u){return this._low^=u._low,this._high^=u._high,this},t.prototype.shiftRight=t.prototype.shiftr=function(u){return u>16?(this._low=this._high>>u-16,this._high=0):u==16?(this._low=this._high,this._high=0):(this._low=this._low>>u|this._high<<16-u&65535,this._high>>=u),this},t.prototype.shiftLeft=t.prototype.shiftl=function(u,c){return u>16?(this._high=this._low<<u-16,this._low=0,c||(this._high&=65535)):u==16?(this._high=this._low,this._low=0):(this._high=this._high<<u|this._low>>16-u,this._low=this._low<<u&65535,c||(this._high&=65535)),this},t.prototype.rotateLeft=t.prototype.rotl=function(u){var c=this._high<<16|this._low;return c=c<<u|c>>>32-u,this._low=c&65535,this._high=c>>>16,this},t.prototype.rotateRight=t.prototype.rotr=function(u){var c=this._high<<16|this._low;return c=c>>>u|c<<32-u,this._low=c&65535,this._high=c>>>16,this},t.prototype.clone=function(){return new t(this._low,this._high)},r.exports?r.exports=t:e.UINT32=t})(uint32)}(uint32$1)),uint32$1.exports}var uint64$1={exports:{}},uint64=uint64$1.exports,hasRequiredUint64;function requireUint64(){return hasRequiredUint64||(hasRequiredUint64=1,function(r){(function(e){var t={16:i(Math.pow(16,5)),10:i(Math.pow(10,5)),2:i(Math.pow(2,5))},n={16:i(16),10:i(10),2:i(2)};function i(d,g,_,f){if(!(this instanceof i))return new i(d,g,_,f);if(this.remainder=null,typeof d=="string")return c.call(this,d,g);if(typeof g>"u")return u.call(this,d);s.apply(this,arguments)}function s(d,g,_,f){return typeof _>"u"?(this._a00=d&65535,this._a16=d>>>16,this._a32=g&65535,this._a48=g>>>16,this):(this._a00=d|0,this._a16=g|0,this._a32=_|0,this._a48=f|0,this)}i.prototype.fromBits=s;function u(d){return this._a00=d&65535,this._a16=d>>>16,this._a32=0,this._a48=0,this}i.prototype.fromNumber=u;function c(d,g){g=g||10,this._a00=0,this._a16=0,this._a32=0,this._a48=0;for(var _=t[g]||new i(Math.pow(g,5)),f=0,l=d.length;f<l;f+=5){var h=Math.min(5,l-f),p=parseInt(d.slice(f,f+h),g);this.multiply(h<5?new i(Math.pow(g,h)):_).add(new i(p))}return this}i.prototype.fromString=c,i.prototype.toNumber=function(){return this._a16*65536+this._a00},i.prototype.toString=function(d){d=d||10;var g=n[d]||new i(d);if(!this.gt(g))return this.toNumber().toString(d);for(var _=this.clone(),f=new Array(64),l=63;l>=0&&(_.div(g),f[l]=_.remainder.toNumber().toString(d),!!_.gt(g));l--);return f[l-1]=_.toNumber().toString(d),f.join("")},i.prototype.add=function(d){var g=this._a00+d._a00,_=g>>>16;_+=this._a16+d._a16;var f=_>>>16;f+=this._a32+d._a32;var l=f>>>16;return l+=this._a48+d._a48,this._a00=g&65535,this._a16=_&65535,this._a32=f&65535,this._a48=l&65535,this},i.prototype.subtract=function(d){return this.add(d.clone().negate())},i.prototype.multiply=function(d){var g=this._a00,_=this._a16,f=this._a32,l=this._a48,h=d._a00,p=d._a16,y=d._a32,w=d._a48,v=g*h,C=v>>>16;C+=g*p;var P=C>>>16;C&=65535,C+=_*h,P+=C>>>16,P+=g*y;var R=P>>>16;return P&=65535,P+=_*p,R+=P>>>16,P&=65535,P+=f*h,R+=P>>>16,R+=g*w,R&=65535,R+=_*y,R&=65535,R+=f*p,R&=65535,R+=l*h,this._a00=v&65535,this._a16=C&65535,this._a32=P&65535,this._a48=R&65535,this},i.prototype.div=function(d){if(d._a16==0&&d._a32==0&&d._a48==0){if(d._a00==0)throw Error("division by zero");if(d._a00==1)return this.remainder=new i(0),this}if(d.gt(this))return this.remainder=this.clone(),this._a00=0,this._a16=0,this._a32=0,this._a48=0,this;if(this.eq(d))return this.remainder=new i(0),this._a00=1,this._a16=0,this._a32=0,this._a48=0,this;for(var g=d.clone(),_=-1;!this.lt(g);)g.shiftLeft(1,!0),_++;for(this.remainder=this.clone(),this._a00=0,this._a16=0,this._a32=0,this._a48=0;_>=0;_--)g.shiftRight(1),this.remainder.lt(g)||(this.remainder.subtract(g),_>=48?this._a48|=1<<_-48:_>=32?this._a32|=1<<_-32:_>=16?this._a16|=1<<_-16:this._a00|=1<<_);return this},i.prototype.negate=function(){var d=(~this._a00&65535)+1;return this._a00=d&65535,d=(~this._a16&65535)+(d>>>16),this._a16=d&65535,d=(~this._a32&65535)+(d>>>16),this._a32=d&65535,this._a48=~this._a48+(d>>>16)&65535,this},i.prototype.equals=i.prototype.eq=function(d){return this._a48==d._a48&&this._a00==d._a00&&this._a32==d._a32&&this._a16==d._a16},i.prototype.greaterThan=i.prototype.gt=function(d){return this._a48>d._a48?!0:this._a48<d._a48?!1:this._a32>d._a32?!0:this._a32<d._a32?!1:this._a16>d._a16?!0:this._a16<d._a16?!1:this._a00>d._a00},i.prototype.lessThan=i.prototype.lt=function(d){return this._a48<d._a48?!0:this._a48>d._a48?!1:this._a32<d._a32?!0:this._a32>d._a32?!1:this._a16<d._a16?!0:this._a16>d._a16?!1:this._a00<d._a00},i.prototype.or=function(d){return this._a00|=d._a00,this._a16|=d._a16,this._a32|=d._a32,this._a48|=d._a48,this},i.prototype.and=function(d){return this._a00&=d._a00,this._a16&=d._a16,this._a32&=d._a32,this._a48&=d._a48,this},i.prototype.xor=function(d){return this._a00^=d._a00,this._a16^=d._a16,this._a32^=d._a32,this._a48^=d._a48,this},i.prototype.not=function(){return this._a00=~this._a00&65535,this._a16=~this._a16&65535,this._a32=~this._a32&65535,this._a48=~this._a48&65535,this},i.prototype.shiftRight=i.prototype.shiftr=function(d){return d%=64,d>=48?(this._a00=this._a48>>d-48,this._a16=0,this._a32=0,this._a48=0):d>=32?(d-=32,this._a00=(this._a32>>d|this._a48<<16-d)&65535,this._a16=this._a48>>d&65535,this._a32=0,this._a48=0):d>=16?(d-=16,this._a00=(this._a16>>d|this._a32<<16-d)&65535,this._a16=(this._a32>>d|this._a48<<16-d)&65535,this._a32=this._a48>>d&65535,this._a48=0):(this._a00=(this._a00>>d|this._a16<<16-d)&65535,this._a16=(this._a16>>d|this._a32<<16-d)&65535,this._a32=(this._a32>>d|this._a48<<16-d)&65535,this._a48=this._a48>>d&65535),this},i.prototype.shiftLeft=i.prototype.shiftl=function(d,g){return d%=64,d>=48?(this._a48=this._a00<<d-48,this._a32=0,this._a16=0,this._a00=0):d>=32?(d-=32,this._a48=this._a16<<d|this._a00>>16-d,this._a32=this._a00<<d&65535,this._a16=0,this._a00=0):d>=16?(d-=16,this._a48=this._a32<<d|this._a16>>16-d,this._a32=(this._a16<<d|this._a00>>16-d)&65535,this._a16=this._a00<<d&65535,this._a00=0):(this._a48=this._a48<<d|this._a32>>16-d,this._a32=(this._a32<<d|this._a16>>16-d)&65535,this._a16=(this._a16<<d|this._a00>>16-d)&65535,this._a00=this._a00<<d&65535),g||(this._a48&=65535),this},i.prototype.rotateLeft=i.prototype.rotl=function(d){if(d%=64,d==0)return this;if(d>=32){var g=this._a00;if(this._a00=this._a32,this._a32=g,g=this._a48,this._a48=this._a16,this._a16=g,d==32)return this;d-=32}var _=this._a48<<16|this._a32,f=this._a16<<16|this._a00,l=_<<d|f>>>32-d,h=f<<d|_>>>32-d;return this._a00=h&65535,this._a16=h>>>16,this._a32=l&65535,this._a48=l>>>16,this},i.prototype.rotateRight=i.prototype.rotr=function(d){if(d%=64,d==0)return this;if(d>=32){var g=this._a00;if(this._a00=this._a32,this._a32=g,g=this._a48,this._a48=this._a16,this._a16=g,d==32)return this;d-=32}var _=this._a48<<16|this._a32,f=this._a16<<16|this._a00,l=_>>>d|f<<32-d,h=f>>>d|_<<32-d;return this._a00=h&65535,this._a16=h>>>16,this._a32=l&65535,this._a48=l>>>16,this},i.prototype.clone=function(){return new i(this._a00,this._a16,this._a32,this._a48)},r.exports?r.exports=i:e.UINT64=i})(uint64)}(uint64$1)),uint64$1.exports}var hasRequiredCuint;function requireCuint(){return hasRequiredCuint||(hasRequiredCuint=1,cuint.UINT32=requireUint32(),cuint.UINT64=requireUint64()),cuint}var xxhash,hasRequiredXxhash;function requireXxhash(){if(hasRequiredXxhash)return xxhash;hasRequiredXxhash=1;var r=requireCuint().UINT32;r.prototype.xxh_update=function(g,_){var f=t._low,l=t._high,h,p;p=g*f,h=p>>>16,h+=_*f,h&=65535,h+=g*l;var y=this._low+(p&65535),w=y>>>16;w+=this._high+(h&65535);var v=w<<16|y&65535;v=v<<13|v>>>19,y=v&65535,w=v>>>16,f=e._low,l=e._high,p=y*f,h=p>>>16,h+=w*f,h&=65535,h+=y*l,this._low=p&65535,this._high=h&65535};var e=r("2654435761"),t=r("2246822519"),n=r("3266489917"),i=r("668265263"),s=r("374761393");function u(g){for(var _=[],f=0,l=g.length;f<l;f++){var h=g.charCodeAt(f);h<128?_.push(h):h<2048?_.push(192|h>>6,128|h&63):h<55296||h>=57344?_.push(224|h>>12,128|h>>6&63,128|h&63):(f++,h=65536+((h&1023)<<10|g.charCodeAt(f)&1023),_.push(240|h>>18,128|h>>12&63,128|h>>6&63,128|h&63))}return new Uint8Array(_)}function c(){if(arguments.length==2)return new c(arguments[1]).update(arguments[0]).digest();if(!(this instanceof c))return new c(arguments[0]);d.call(this,arguments[0])}function d(g){return this.seed=g instanceof r?g.clone():r(g),this.v1=this.seed.clone().add(e).add(t),this.v2=this.seed.clone().add(t),this.v3=this.seed.clone(),this.v4=this.seed.clone().subtract(e),this.total_len=0,this.memsize=0,this.memory=null,this}return c.prototype.init=d,c.prototype.update=function(g){var _=typeof g=="string",f;_&&(g=u(g),_=!1,f=!0),typeof ArrayBuffer<"u"&&g instanceof ArrayBuffer&&(f=!0,g=new Uint8Array(g));var l=0,h=g.length,p=l+h;if(h==0)return this;if(this.total_len+=h,this.memsize==0&&(_?this.memory="":f?this.memory=new Uint8Array(16):this.memory=new Buffer(16)),this.memsize+h<16)return _?this.memory+=g:f?this.memory.set(g.subarray(0,h),this.memsize):g.copy(this.memory,this.memsize,0,h),this.memsize+=h,this;if(this.memsize>0){_?this.memory+=g.slice(0,16-this.memsize):f?this.memory.set(g.subarray(0,16-this.memsize),this.memsize):g.copy(this.memory,this.memsize,0,16-this.memsize);var y=0;_?(this.v1.xxh_update(this.memory.charCodeAt(y+1)<<8|this.memory.charCodeAt(y),this.memory.charCodeAt(y+3)<<8|this.memory.charCodeAt(y+2)),y+=4,this.v2.xxh_update(this.memory.charCodeAt(y+1)<<8|this.memory.charCodeAt(y),this.memory.charCodeAt(y+3)<<8|this.memory.charCodeAt(y+2)),y+=4,this.v3.xxh_update(this.memory.charCodeAt(y+1)<<8|this.memory.charCodeAt(y),this.memory.charCodeAt(y+3)<<8|this.memory.charCodeAt(y+2)),y+=4,this.v4.xxh_update(this.memory.charCodeAt(y+1)<<8|this.memory.charCodeAt(y),this.memory.charCodeAt(y+3)<<8|this.memory.charCodeAt(y+2))):(this.v1.xxh_update(this.memory[y+1]<<8|this.memory[y],this.memory[y+3]<<8|this.memory[y+2]),y+=4,this.v2.xxh_update(this.memory[y+1]<<8|this.memory[y],this.memory[y+3]<<8|this.memory[y+2]),y+=4,this.v3.xxh_update(this.memory[y+1]<<8|this.memory[y],this.memory[y+3]<<8|this.memory[y+2]),y+=4,this.v4.xxh_update(this.memory[y+1]<<8|this.memory[y],this.memory[y+3]<<8|this.memory[y+2])),l+=16-this.memsize,this.memsize=0,_&&(this.memory="")}if(l<=p-16){var w=p-16;do _?(this.v1.xxh_update(g.charCodeAt(l+1)<<8|g.charCodeAt(l),g.charCodeAt(l+3)<<8|g.charCodeAt(l+2)),l+=4,this.v2.xxh_update(g.charCodeAt(l+1)<<8|g.charCodeAt(l),g.charCodeAt(l+3)<<8|g.charCodeAt(l+2)),l+=4,this.v3.xxh_update(g.charCodeAt(l+1)<<8|g.charCodeAt(l),g.charCodeAt(l+3)<<8|g.charCodeAt(l+2)),l+=4,this.v4.xxh_update(g.charCodeAt(l+1)<<8|g.charCodeAt(l),g.charCodeAt(l+3)<<8|g.charCodeAt(l+2))):(this.v1.xxh_update(g[l+1]<<8|g[l],g[l+3]<<8|g[l+2]),l+=4,this.v2.xxh_update(g[l+1]<<8|g[l],g[l+3]<<8|g[l+2]),l+=4,this.v3.xxh_update(g[l+1]<<8|g[l],g[l+3]<<8|g[l+2]),l+=4,this.v4.xxh_update(g[l+1]<<8|g[l],g[l+3]<<8|g[l+2])),l+=4;while(l<=w)}return l<p&&(_?this.memory+=g.slice(l):f?this.memory.set(g.subarray(l,p),this.memsize):g.copy(this.memory,this.memsize,l,p),this.memsize=p-l),this},c.prototype.digest=function(){var g=this.memory,_=typeof g=="string",f=0,l=this.memsize,h,p,y=new r;for(this.total_len>=16?h=this.v1.rotl(1).add(this.v2.rotl(7).add(this.v3.rotl(12).add(this.v4.rotl(18)))):h=this.seed.clone().add(s),h.add(y.fromNumber(this.total_len));f<=l-4;)_?y.fromBits(g.charCodeAt(f+1)<<8|g.charCodeAt(f),g.charCodeAt(f+3)<<8|g.charCodeAt(f+2)):y.fromBits(g[f+1]<<8|g[f],g[f+3]<<8|g[f+2]),h.add(y.multiply(n)).rotl(17).multiply(i),f+=4;for(;f<l;)y.fromBits(_?g.charCodeAt(f++):g[f++],0),h.add(y.multiply(s)).rotl(11).multiply(e);return p=h.clone().shiftRight(15),h.xor(p).multiply(t),p=h.clone().shiftRight(13),h.xor(p).multiply(n),p=h.clone().shiftRight(16),h.xor(p),this.init(this.seed),h},xxhash=c,xxhash}var xxhash64,hasRequiredXxhash64;function requireXxhash64(){if(hasRequiredXxhash64)return xxhash64;hasRequiredXxhash64=1;var r=requireCuint().UINT64,e=r("11400714785074694791"),t=r("14029467366897019727"),n=r("1609587929392839161"),i=r("9650029242287828579"),s=r("2870177450012600261");function u(g){for(var _=[],f=0,l=g.length;f<l;f++){var h=g.charCodeAt(f);h<128?_.push(h):h<2048?_.push(192|h>>6,128|h&63):h<55296||h>=57344?_.push(224|h>>12,128|h>>6&63,128|h&63):(f++,h=65536+((h&1023)<<10|g.charCodeAt(f)&1023),_.push(240|h>>18,128|h>>12&63,128|h>>6&63,128|h&63))}return new Uint8Array(_)}function c(){if(arguments.length==2)return new c(arguments[1]).update(arguments[0]).digest();if(!(this instanceof c))return new c(arguments[0]);d.call(this,arguments[0])}function d(g){return this.seed=g instanceof r?g.clone():r(g),this.v1=this.seed.clone().add(e).add(t),this.v2=this.seed.clone().add(t),this.v3=this.seed.clone(),this.v4=this.seed.clone().subtract(e),this.total_len=0,this.memsize=0,this.memory=null,this}return c.prototype.init=d,c.prototype.update=function(g){var _=typeof g=="string",f;_&&(g=u(g),_=!1,f=!0),typeof ArrayBuffer<"u"&&g instanceof ArrayBuffer&&(f=!0,g=new Uint8Array(g));var l=0,h=g.length,p=l+h;if(h==0)return this;if(this.total_len+=h,this.memsize==0&&(_?this.memory="":f?this.memory=new Uint8Array(32):this.memory=new Buffer(32)),this.memsize+h<32)return _?this.memory+=g:f?this.memory.set(g.subarray(0,h),this.memsize):g.copy(this.memory,this.memsize,0,h),this.memsize+=h,this;if(this.memsize>0){_?this.memory+=g.slice(0,32-this.memsize):f?this.memory.set(g.subarray(0,32-this.memsize),this.memsize):g.copy(this.memory,this.memsize,0,32-this.memsize);var y=0;if(_){var w;w=r(this.memory.charCodeAt(y+1)<<8|this.memory.charCodeAt(y),this.memory.charCodeAt(y+3)<<8|this.memory.charCodeAt(y+2),this.memory.charCodeAt(y+5)<<8|this.memory.charCodeAt(y+4),this.memory.charCodeAt(y+7)<<8|this.memory.charCodeAt(y+6)),this.v1.add(w.multiply(t)).rotl(31).multiply(e),y+=8,w=r(this.memory.charCodeAt(y+1)<<8|this.memory.charCodeAt(y),this.memory.charCodeAt(y+3)<<8|this.memory.charCodeAt(y+2),this.memory.charCodeAt(y+5)<<8|this.memory.charCodeAt(y+4),this.memory.charCodeAt(y+7)<<8|this.memory.charCodeAt(y+6)),this.v2.add(w.multiply(t)).rotl(31).multiply(e),y+=8,w=r(this.memory.charCodeAt(y+1)<<8|this.memory.charCodeAt(y),this.memory.charCodeAt(y+3)<<8|this.memory.charCodeAt(y+2),this.memory.charCodeAt(y+5)<<8|this.memory.charCodeAt(y+4),this.memory.charCodeAt(y+7)<<8|this.memory.charCodeAt(y+6)),this.v3.add(w.multiply(t)).rotl(31).multiply(e),y+=8,w=r(this.memory.charCodeAt(y+1)<<8|this.memory.charCodeAt(y),this.memory.charCodeAt(y+3)<<8|this.memory.charCodeAt(y+2),this.memory.charCodeAt(y+5)<<8|this.memory.charCodeAt(y+4),this.memory.charCodeAt(y+7)<<8|this.memory.charCodeAt(y+6)),this.v4.add(w.multiply(t)).rotl(31).multiply(e)}else{var w;w=r(this.memory[y+1]<<8|this.memory[y],this.memory[y+3]<<8|this.memory[y+2],this.memory[y+5]<<8|this.memory[y+4],this.memory[y+7]<<8|this.memory[y+6]),this.v1.add(w.multiply(t)).rotl(31).multiply(e),y+=8,w=r(this.memory[y+1]<<8|this.memory[y],this.memory[y+3]<<8|this.memory[y+2],this.memory[y+5]<<8|this.memory[y+4],this.memory[y+7]<<8|this.memory[y+6]),this.v2.add(w.multiply(t)).rotl(31).multiply(e),y+=8,w=r(this.memory[y+1]<<8|this.memory[y],this.memory[y+3]<<8|this.memory[y+2],this.memory[y+5]<<8|this.memory[y+4],this.memory[y+7]<<8|this.memory[y+6]),this.v3.add(w.multiply(t)).rotl(31).multiply(e),y+=8,w=r(this.memory[y+1]<<8|this.memory[y],this.memory[y+3]<<8|this.memory[y+2],this.memory[y+5]<<8|this.memory[y+4],this.memory[y+7]<<8|this.memory[y+6]),this.v4.add(w.multiply(t)).rotl(31).multiply(e)}l+=32-this.memsize,this.memsize=0,_&&(this.memory="")}if(l<=p-32){var v=p-32;do{if(_){var w;w=r(g.charCodeAt(l+1)<<8|g.charCodeAt(l),g.charCodeAt(l+3)<<8|g.charCodeAt(l+2),g.charCodeAt(l+5)<<8|g.charCodeAt(l+4),g.charCodeAt(l+7)<<8|g.charCodeAt(l+6)),this.v1.add(w.multiply(t)).rotl(31).multiply(e),l+=8,w=r(g.charCodeAt(l+1)<<8|g.charCodeAt(l),g.charCodeAt(l+3)<<8|g.charCodeAt(l+2),g.charCodeAt(l+5)<<8|g.charCodeAt(l+4),g.charCodeAt(l+7)<<8|g.charCodeAt(l+6)),this.v2.add(w.multiply(t)).rotl(31).multiply(e),l+=8,w=r(g.charCodeAt(l+1)<<8|g.charCodeAt(l),g.charCodeAt(l+3)<<8|g.charCodeAt(l+2),g.charCodeAt(l+5)<<8|g.charCodeAt(l+4),g.charCodeAt(l+7)<<8|g.charCodeAt(l+6)),this.v3.add(w.multiply(t)).rotl(31).multiply(e),l+=8,w=r(g.charCodeAt(l+1)<<8|g.charCodeAt(l),g.charCodeAt(l+3)<<8|g.charCodeAt(l+2),g.charCodeAt(l+5)<<8|g.charCodeAt(l+4),g.charCodeAt(l+7)<<8|g.charCodeAt(l+6)),this.v4.add(w.multiply(t)).rotl(31).multiply(e)}else{var w;w=r(g[l+1]<<8|g[l],g[l+3]<<8|g[l+2],g[l+5]<<8|g[l+4],g[l+7]<<8|g[l+6]),this.v1.add(w.multiply(t)).rotl(31).multiply(e),l+=8,w=r(g[l+1]<<8|g[l],g[l+3]<<8|g[l+2],g[l+5]<<8|g[l+4],g[l+7]<<8|g[l+6]),this.v2.add(w.multiply(t)).rotl(31).multiply(e),l+=8,w=r(g[l+1]<<8|g[l],g[l+3]<<8|g[l+2],g[l+5]<<8|g[l+4],g[l+7]<<8|g[l+6]),this.v3.add(w.multiply(t)).rotl(31).multiply(e),l+=8,w=r(g[l+1]<<8|g[l],g[l+3]<<8|g[l+2],g[l+5]<<8|g[l+4],g[l+7]<<8|g[l+6]),this.v4.add(w.multiply(t)).rotl(31).multiply(e)}l+=8}while(l<=v)}return l<p&&(_?this.memory+=g.slice(l):f?this.memory.set(g.subarray(l,p),this.memsize):g.copy(this.memory,this.memsize,l,p),this.memsize=p-l),this},c.prototype.digest=function(){var g=this.memory,_=typeof g=="string",f=0,l=this.memsize,h,p,y=new r;for(this.total_len>=32?(h=this.v1.clone().rotl(1),h.add(this.v2.clone().rotl(7)),h.add(this.v3.clone().rotl(12)),h.add(this.v4.clone().rotl(18)),h.xor(this.v1.multiply(t).rotl(31).multiply(e)),h.multiply(e).add(i),h.xor(this.v2.multiply(t).rotl(31).multiply(e)),h.multiply(e).add(i),h.xor(this.v3.multiply(t).rotl(31).multiply(e)),h.multiply(e).add(i),h.xor(this.v4.multiply(t).rotl(31).multiply(e)),h.multiply(e).add(i)):h=this.seed.clone().add(s),h.add(y.fromNumber(this.total_len));f<=l-8;)_?y.fromBits(g.charCodeAt(f+1)<<8|g.charCodeAt(f),g.charCodeAt(f+3)<<8|g.charCodeAt(f+2),g.charCodeAt(f+5)<<8|g.charCodeAt(f+4),g.charCodeAt(f+7)<<8|g.charCodeAt(f+6)):y.fromBits(g[f+1]<<8|g[f],g[f+3]<<8|g[f+2],g[f+5]<<8|g[f+4],g[f+7]<<8|g[f+6]),y.multiply(t).rotl(31).multiply(e),h.xor(y).rotl(27).multiply(e).add(i),f+=8;for(f+4<=l&&(_?y.fromBits(g.charCodeAt(f+1)<<8|g.charCodeAt(f),g.charCodeAt(f+3)<<8|g.charCodeAt(f+2),0,0):y.fromBits(g[f+1]<<8|g[f],g[f+3]<<8|g[f+2],0,0),h.xor(y.multiply(e)).rotl(23).multiply(t).add(n),f+=4);f<l;)y.fromBits(_?g.charCodeAt(f++):g[f++],0,0,0),h.xor(y.multiply(s)).rotl(11).multiply(e);return p=h.clone().shiftRight(33),h.xor(p).multiply(t),p=h.clone().shiftRight(29),h.xor(p).multiply(n),p=h.clone().shiftRight(32),h.xor(p),this.init(this.seed),h},xxhash64=c,xxhash64}var lib,hasRequiredLib;function requireLib(){return hasRequiredLib||(hasRequiredLib=1,lib={h32:requireXxhash(),h64:requireXxhash64()}),lib}var hasRequiredUtils;function requireUtils(){if(hasRequiredUtils)return utils;hasRequiredUtils=1;var r=utils&&utils.__values||function(k){var B=typeof Symbol=="function"&&Symbol.iterator,H=B&&k[B],re=0;if(H)return H.call(k);if(k&&typeof k.length=="number")return{next:function(){return k&&re>=k.length&&(k=void 0),{value:k&&k[re++],done:!k}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")},e=utils&&utils.__importDefault||function(k){return k&&k.__esModule?k:{default:k}};Object.defineProperty(utils,"__esModule",{value:!0});var t=e(requireLib()),n=requireBuffer();function i(k,B){for(var H=new Array(k),re=typeof B=="function"?B:function(){return B},le=0;le<k;le++)H[le]=re();return H}utils.allocateArray=i;function s(k,B,H){B===void 0&&(B=!1),H===void 0&&(H=v());var re=t.default.h64(k,H+1),le=t.default.h64(k,H+2);if(B)return{first:re.toNumber(),second:le.toNumber()};var me=re.toString(16);me.length<16&&(me="0".repeat(16-me.length)+me);var He=le.toString(16);return He.length<16&&(He="0".repeat(16-He.length)+He),{first:Number(me),second:Number(He)}}utils.hashTwice=s;function u(k,B){B===void 0&&(B=v());var H=t.default.h64(k,B+1),re=t.default.h64(k,B+2),le=H.toString(16);le.length<16&&(le="0".repeat(16-le.length)+le);var me=re.toString(16);return me.length<16&&(me="0".repeat(16-me.length)+me),{first:le,second:me}}utils.hashTwiceAsString=u;function c(k,B){B===void 0&&(B=v());var H=t.default.h64(k,B+1),re=t.default.h64(k,B+2),le=H.toString(16);le.length<16&&(le="0".repeat(16-le.length)+le);var me=re.toString(16);return me.length<16&&(me="0".repeat(16-me.length)+me),{int:{first:H.toNumber(),second:re.toNumber()},string:{first:le,second:me}}}utils.allInOneHashTwice=c;function d(k,B,H,re){return Math.abs((B+k*H)%re)}utils.doubleHashing=d;function g(k,B,H,re){re===void 0&&(re=v());function le(me,He,ct,lt,dt){if(dt===void 0&&(dt=[]),dt.length===lt)return dt;var gt=s(He,!0,re+ct%me),Ee=d(me,gt.first,gt.second,ct);return dt.includes(Ee)||dt.push(Ee),le(me+1,He,ct,lt,dt)}return le(1,k,B,H)}utils.getDistinctIndices=g;function _(k,B,H,re){re===void 0&&(re=v());for(var le=[],me=1;me<=H;me++){var He=s(k,!0,re+B%me);le.push(d(me,He.first,He.second,B))}if(le.length!==H)throw new Error("report this, please, shouldnt be of different size");return le}utils.getIndices=_;function f(k,B,H){H===void 0&&(H=Math.random),k=Math.ceil(k),B=Math.floor(B);var re=H();return Math.floor(re*(B-k+1))+k}utils.randomInt=f;function l(k,B){for(var H=Math.max(k.length,B.length),re=n.Buffer.allocUnsafe(H).fill(0),le=0;le<H;++le)le<k.length&&le<B.length?re[H-le-1]=k[k.length-le-1]^B[B.length-le-1]:le<k.length&&le>=B.length?re[H-le-1]^=k[k.length-le-1]:le<B.length&&le>=k.length&&(re[H-le-1]^=B[B.length-le-1]);for(var me=0,He=re.values(),ct=He.next();!ct.done&&ct.value===0;)me++,ct=He.next();var lt=re.slice(me);return lt}utils.xorBuffer=l;function h(k){var B,H;if(k===null||!k)return!0;try{for(var re=r(k),le=re.next();!le.done;le=re.next()){var me=le.value;if(me!==0)return!1}}catch(He){B={error:He}}finally{try{le&&!le.done&&(H=re.return)&&H.call(re)}finally{if(B)throw B.error}}return!0}utils.isEmptyBuffer=h;function p(k,B,H){switch(B===void 0&&(B=v()),H){case 32:return t.default.h32(k,B).toNumber();case 64:return t.default.h64(k,B).toNumber();default:return t.default.h64(k,B).toNumber()}}utils.hashAsInt=p;function y(k,B,H,re){B===void 0&&(B=v()),H===void 0&&(H=16),re===void 0&&(re=64);var le;switch(re){case 32:le=t.default.h32(k,B);break;case 64:le=t.default.h64(k,B);break;default:le=t.default.h64(k,B);break}var me="";return H===16?(me=le.toString(H),me.length<re/4&&(me="0".repeat(re/4-me.length)+me)):H===2&&(me=P(le.toString(16)),me.length<re&&(me="0".repeat(re-me.length)+me)),me}utils.hashAsString=y;function w(k,B,H,re){B===void 0&&(B=v()),H===void 0&&(H=16),re===void 0&&(re=64);var le;switch(re){case 32:le=t.default.h32(k,B);break;case 64:le=t.default.h64(k,B);break;default:le=t.default.h64(k,B);break}var me="";return H===16?(me=le.toString(H),me.length<re/4&&(me="0".repeat(re/4-me.length)+me)):H===2&&(me=P(le.toString(16)),me.length<re&&(me="0".repeat(re-me.length)+me)),{int:le.toNumber(),string:me}}utils.hashIntAndString=w;function v(){return 78187493520}utils.getDefaultSeed=v;function C(k){return Math.ceil(Math.pow(2,Math.floor(Math.log(k)/Math.log(2))))}utils.power2=C;function P(k){return parseInt(k,16).toString(2)}utils.hex2bin=P;function R(k){return[128,64,32,16,8,4,2,1].map(function(B){return(B&k)>0?1:0})}utils.uint8ToBits=R;function F(k){return k.reduce(function(B,H,re){if(H===0)return B;if(H===1)return B+Math.pow(2,7-re);throw new Error("Not binary")},0)}return utils.bitsToUint8=F,utils}var alea$1={exports:{}},alea=alea$1.exports,hasRequiredAlea;function requireAlea(){return hasRequiredAlea||(hasRequiredAlea=1,function(r){(function(e,t,n){function i(d){var g=this,_=c();g.next=function(){var f=2091639*g.s0+g.c*23283064365386963e-26;return g.s0=g.s1,g.s1=g.s2,g.s2=f-(g.c=f|0)},g.c=1,g.s0=_(" "),g.s1=_(" "),g.s2=_(" "),g.s0-=_(d),g.s0<0&&(g.s0+=1),g.s1-=_(d),g.s1<0&&(g.s1+=1),g.s2-=_(d),g.s2<0&&(g.s2+=1),_=null}function s(d,g){return g.c=d.c,g.s0=d.s0,g.s1=d.s1,g.s2=d.s2,g}function u(d,g){var _=new i(d),f=g&&g.state,l=_.next;return l.int32=function(){return _.next()*4294967296|0},l.double=function(){return l()+(l()*2097152|0)*11102230246251565e-32},l.quick=l,f&&(typeof f=="object"&&s(f,_),l.state=function(){return s(_,{})}),l}function c(){var d=4022871197,g=function(_){_=String(_);for(var f=0;f<_.length;f++){d+=_.charCodeAt(f);var l=.02519603282416938*d;d=l>>>0,l-=d,l*=d,d=l>>>0,l-=d,d+=l*4294967296}return(d>>>0)*23283064365386963e-26};return g}t&&t.exports?t.exports=u:this.alea=u})(alea,r)}(alea$1)),alea$1.exports}var xor128$1={exports:{}},xor128=xor128$1.exports,hasRequiredXor128;function requireXor128(){return hasRequiredXor128||(hasRequiredXor128=1,function(r){(function(e,t,n){function i(c){var d=this,g="";d.x=0,d.y=0,d.z=0,d.w=0,d.next=function(){var f=d.x^d.x<<11;return d.x=d.y,d.y=d.z,d.z=d.w,d.w^=d.w>>>19^f^f>>>8},c===(c|0)?d.x=c:g+=c;for(var _=0;_<g.length+64;_++)d.x^=g.charCodeAt(_)|0,d.next()}function s(c,d){return d.x=c.x,d.y=c.y,d.z=c.z,d.w=c.w,d}function u(c,d){var g=new i(c),_=d&&d.state,f=function(){return(g.next()>>>0)/4294967296};return f.double=function(){do var l=g.next()>>>11,h=(g.next()>>>0)/4294967296,p=(l+h)/(1<<21);while(p===0);return p},f.int32=g.next,f.quick=f,_&&(typeof _=="object"&&s(_,g),f.state=function(){return s(g,{})}),f}t&&t.exports?t.exports=u:this.xor128=u})(xor128,r)}(xor128$1)),xor128$1.exports}var xorwow$1={exports:{}},xorwow=xorwow$1.exports,hasRequiredXorwow;function requireXorwow(){return hasRequiredXorwow||(hasRequiredXorwow=1,function(r){(function(e,t,n){function i(c){var d=this,g="";d.next=function(){var f=d.x^d.x>>>2;return d.x=d.y,d.y=d.z,d.z=d.w,d.w=d.v,(d.d=d.d+362437|0)+(d.v=d.v^d.v<<4^(f^f<<1))|0},d.x=0,d.y=0,d.z=0,d.w=0,d.v=0,c===(c|0)?d.x=c:g+=c;for(var _=0;_<g.length+64;_++)d.x^=g.charCodeAt(_)|0,_==g.length&&(d.d=d.x<<10^d.x>>>4),d.next()}function s(c,d){return d.x=c.x,d.y=c.y,d.z=c.z,d.w=c.w,d.v=c.v,d.d=c.d,d}function u(c,d){var g=new i(c),_=d&&d.state,f=function(){return(g.next()>>>0)/4294967296};return f.double=function(){do var l=g.next()>>>11,h=(g.next()>>>0)/4294967296,p=(l+h)/(1<<21);while(p===0);return p},f.int32=g.next,f.quick=f,_&&(typeof _=="object"&&s(_,g),f.state=function(){return s(g,{})}),f}t&&t.exports?t.exports=u:this.xorwow=u})(xorwow,r)}(xorwow$1)),xorwow$1.exports}var xorshift7$1={exports:{}},xorshift7=xorshift7$1.exports,hasRequiredXorshift7;function requireXorshift7(){return hasRequiredXorshift7||(hasRequiredXorshift7=1,function(r){(function(e,t,n){function i(c){var d=this;d.next=function(){var _=d.x,f=d.i,l,h;return l=_[f],l^=l>>>7,h=l^l<<24,l=_[f+1&7],h^=l^l>>>10,l=_[f+3&7],h^=l^l>>>3,l=_[f+4&7],h^=l^l<<7,l=_[f+7&7],l=l^l<<13,h^=l^l<<9,_[f]=h,d.i=f+1&7,h};function g(_,f){var l,h=[];if(f===(f|0))h[0]=f;else for(f=""+f,l=0;l<f.length;++l)h[l&7]=h[l&7]<<15^f.charCodeAt(l)+h[l+1&7]<<13;for(;h.length<8;)h.push(0);for(l=0;l<8&&h[l]===0;++l);for(l==8?h[7]=-1:h[l],_.x=h,_.i=0,l=256;l>0;--l)_.next()}g(d,c)}function s(c,d){return d.x=c.x.slice(),d.i=c.i,d}function u(c,d){c==null&&(c=+new Date);var g=new i(c),_=d&&d.state,f=function(){return(g.next()>>>0)/4294967296};return f.double=function(){do var l=g.next()>>>11,h=(g.next()>>>0)/4294967296,p=(l+h)/(1<<21);while(p===0);return p},f.int32=g.next,f.quick=f,_&&(_.x&&s(_,g),f.state=function(){return s(g,{})}),f}t&&t.exports?t.exports=u:this.xorshift7=u})(xorshift7,r)}(xorshift7$1)),xorshift7$1.exports}var xor4096$1={exports:{}},xor4096=xor4096$1.exports,hasRequiredXor4096;function requireXor4096(){return hasRequiredXor4096||(hasRequiredXor4096=1,function(r){(function(e,t,n){function i(c){var d=this;d.next=function(){var _=d.w,f=d.X,l=d.i,h,p;return d.w=_=_+1640531527|0,p=f[l+34&127],h=f[l=l+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,p=f[l]=p^h,d.i=l,p+(_^_>>>16)|0};function g(_,f){var l,h,p,y,w,v=[],C=128;for(f===(f|0)?(h=f,f=null):(f=f+"\0",h=0,C=Math.max(C,f.length)),p=0,y=-32;y<C;++y)f&&(h^=f.charCodeAt((y+32)%f.length)),y===0&&(w=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,y>=0&&(w=w+1640531527|0,l=v[y&127]^=h+w,p=l==0?p+1:0);for(p>=128&&(v[(f&&f.length||0)&127]=-1),p=127,y=4*128;y>0;--y)h=v[p+34&127],l=v[p=p+1&127],h^=h<<13,l^=l<<17,h^=h>>>15,l^=l>>>12,v[p]=h^l;_.w=w,_.X=v,_.i=p}g(d,c)}function s(c,d){return d.i=c.i,d.w=c.w,d.X=c.X.slice(),d}function u(c,d){c==null&&(c=+new Date);var g=new i(c),_=d&&d.state,f=function(){return(g.next()>>>0)/4294967296};return f.double=function(){do var l=g.next()>>>11,h=(g.next()>>>0)/4294967296,p=(l+h)/(1<<21);while(p===0);return p},f.int32=g.next,f.quick=f,_&&(_.X&&s(_,g),f.state=function(){return s(g,{})}),f}t&&t.exports?t.exports=u:this.xor4096=u})(xor4096,r)}(xor4096$1)),xor4096$1.exports}var tychei$1={exports:{}},tychei=tychei$1.exports,hasRequiredTychei;function requireTychei(){return hasRequiredTychei||(hasRequiredTychei=1,function(r){(function(e,t,n){function i(c){var d=this,g="";d.next=function(){var f=d.b,l=d.c,h=d.d,p=d.a;return f=f<<25^f>>>7^l,l=l-h|0,h=h<<24^h>>>8^p,p=p-f|0,d.b=f=f<<20^f>>>12^l,d.c=l=l-h|0,d.d=h<<16^l>>>16^p,d.a=p-f|0},d.a=0,d.b=0,d.c=-1640531527,d.d=1367130551,c===Math.floor(c)?(d.a=c/4294967296|0,d.b=c|0):g+=c;for(var _=0;_<g.length+20;_++)d.b^=g.charCodeAt(_)|0,d.next()}function s(c,d){return d.a=c.a,d.b=c.b,d.c=c.c,d.d=c.d,d}function u(c,d){var g=new i(c),_=d&&d.state,f=function(){return(g.next()>>>0)/4294967296};return f.double=function(){do var l=g.next()>>>11,h=(g.next()>>>0)/4294967296,p=(l+h)/(1<<21);while(p===0);return p},f.int32=g.next,f.quick=f,_&&(typeof _=="object"&&s(_,g),f.state=function(){return s(g,{})}),f}t&&t.exports?t.exports=u:this.tychei=u})(tychei,r)}(tychei$1)),tychei$1.exports}var seedrandom$2={exports:{}},seedrandom$1=seedrandom$2.exports,hasRequiredSeedrandom$1;function requireSeedrandom$1(){return hasRequiredSeedrandom$1||(hasRequiredSeedrandom$1=1,function(r){(function(e,t,n){var i=256,s=6,u=52,c="random",d=n.pow(i,s),g=n.pow(2,u),_=g*2,f=i-1,l;function h(R,F,k){var B=[];F=F==!0?{entropy:!0}:F||{};var H=v(w(F.entropy?[R,P(t)]:R??C(),3),B),re=new p(B),le=function(){for(var me=re.g(s),He=d,ct=0;me<g;)me=(me+ct)*i,He*=i,ct=re.g(1);for(;me>=_;)me/=2,He/=2,ct>>>=1;return(me+ct)/He};return le.int32=function(){return re.g(4)|0},le.quick=function(){return re.g(4)/4294967296},le.double=le,v(P(re.S),t),(F.pass||k||function(me,He,ct,lt){return lt&&(lt.S&&y(lt,re),me.state=function(){return y(re,{})}),ct?(n[c]=me,He):me})(le,H,"global"in F?F.global:this==n,F.state)}function p(R){var F,k=R.length,B=this,H=0,re=B.i=B.j=0,le=B.S=[];for(k||(R=[k++]);H<i;)le[H]=H++;for(H=0;H<i;H++)le[H]=le[re=f&re+R[H%k]+(F=le[H])],le[re]=F;(B.g=function(me){for(var He,ct=0,lt=B.i,dt=B.j,gt=B.S;me--;)He=gt[lt=f&lt+1],ct=ct*i+gt[f&(gt[lt]=gt[dt=f&dt+He])+(gt[dt]=He)];return B.i=lt,B.j=dt,ct})(i)}function y(R,F){return F.i=R.i,F.j=R.j,F.S=R.S.slice(),F}function w(R,F){var k=[],B=typeof R,H;if(F&&B=="object")for(H in R)try{k.push(w(R[H],F-1))}catch{}return k.length?k:B=="string"?R:R+"\0"}function v(R,F){for(var k=R+"",B,H=0;H<k.length;)F[f&H]=f&(B^=F[f&H]*19)+k.charCodeAt(H++);return P(F)}function C(){try{var R;return l&&(R=l.randomBytes)?R=R(i):(R=new Uint8Array(i),(e.crypto||e.msCrypto).getRandomValues(R)),P(R)}catch{var F=e.navigator,k=F&&F.plugins;return[+new Date,e,k,e.screen,P(t)]}}function P(R){return String.fromCharCode.apply(0,R)}if(v(n.random(),t),r.exports){r.exports=h;try{l=require$$0}catch{}}else n["seed"+c]=h})(typeof self<"u"?self:seedrandom$1,[],Math)}(seedrandom$2)),seedrandom$2.exports}var seedrandom,hasRequiredSeedrandom;function requireSeedrandom(){if(hasRequiredSeedrandom)return seedrandom;hasRequiredSeedrandom=1;var r=requireAlea(),e=requireXor128(),t=requireXorwow(),n=requireXorshift7(),i=requireXor4096(),s=requireTychei(),u=requireSeedrandom$1();return u.alea=r,u.xor128=e,u.xorwow=t,u.xorshift7=n,u.xor4096=i,u.tychei=s,seedrandom=u,seedrandom}var hasRequiredBaseFilter;function requireBaseFilter(){if(hasRequiredBaseFilter)return baseFilter;hasRequiredBaseFilter=1;var r=baseFilter&&baseFilter.__importStar||function(s){if(s&&s.__esModule)return s;var u={};if(s!=null)for(var c in s)Object.hasOwnProperty.call(s,c)&&(u[c]=s[c]);return u.default=s,u},e=baseFilter&&baseFilter.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(baseFilter,"__esModule",{value:!0});var t=r(requireUtils()),n=e(requireSeedrandom()),i=function(){function s(){this._seed=t.getDefaultSeed(),this._rng=n.default(""+this._seed)}return Object.defineProperty(s.prototype,"seed",{get:function(){return this._seed},set:function(u){this._seed=u,this._rng=n.default(""+this._seed)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"random",{get:function(){return this._rng},enumerable:!0,configurable:!0}),s.prototype.saveAsJSON=function(){throw new Error("not-implemented")},s.fromJSON=function(u){throw new Error("not-implemented")},s}();return baseFilter.default=i,baseFilter}var exportable={},_Reflect={},hasRequired_Reflect;function require_Reflect(){if(hasRequired_Reflect)return _Reflect;hasRequired_Reflect=1;var r={};/*! *****************************************************************************
	Copyright (C) Microsoft. All rights reserved.
	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
	this file except in compliance with the License. You may obtain a copy of the
	License at http://www.apache.org/licenses/LICENSE-2.0

	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
	MERCHANTABLITY OR NON-INFRINGEMENT.

	See the Apache Version 2.0 License for specific language governing permissions
	and limitations under the License.
	***************************************************************************** */var e;return function(t){(function(n){var i=typeof commonjsGlobal=="object"?commonjsGlobal:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),s=u(t);typeof i.Reflect>"u"?i.Reflect=t:s=u(i.Reflect,s),n(s);function u(c,d){return function(g,_){typeof c[g]!="function"&&Object.defineProperty(c,g,{configurable:!0,writable:!0,value:_}),d&&d(g,_)}}})(function(n){var i=Object.prototype.hasOwnProperty,s=typeof Symbol=="function",u=s&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",c=s&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",d=typeof Object.create=="function",g={__proto__:[]}instanceof Array,_=!d&&!g,f={create:d?function(){return Bt(Object.create(null))}:g?function(){return Bt({__proto__:null})}:function(){return Bt({})},has:_?function(ce,S){return i.call(ce,S)}:function(ce,S){return S in ce},get:_?function(ce,S){return i.call(ce,S)?ce[S]:void 0}:function(ce,S){return ce[S]}},l=Object.getPrototypeOf(Function),h=typeof process=="object"&&r&&r.REFLECT_METADATA_USE_MAP_POLYFILL==="true",p=!h&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Rt(),y=!h&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:ar(),w=!h&&typeof WeakMap=="function"?WeakMap:Er(),v=new w;function C(ce,S,b,E){if(Me(b)){if(!Yt(ce))throw new TypeError;if(!qt(S))throw new TypeError;return He(ce,S)}else{if(!Yt(ce))throw new TypeError;if(!De(S))throw new TypeError;if(!De(E)&&!Me(E)&&!it(E))throw new TypeError;return it(E)&&(E=void 0),b=Ut(b),ct(ce,S,b,E)}}n("decorate",C);function P(ce,S){function b(E,q){if(!De(E))throw new TypeError;if(!Me(q)&&!Xt(q))throw new TypeError;ne(ce,S,E,q)}return b}n("metadata",P);function R(ce,S,b,E){if(!De(b))throw new TypeError;return Me(E)||(E=Ut(E)),ne(ce,S,b,E)}n("defineMetadata",R);function F(ce,S,b){if(!De(S))throw new TypeError;return Me(b)||(b=Ut(b)),dt(ce,S,b)}n("hasMetadata",F);function k(ce,S,b){if(!De(S))throw new TypeError;return Me(b)||(b=Ut(b)),gt(ce,S,b)}n("hasOwnMetadata",k);function B(ce,S,b){if(!De(S))throw new TypeError;return Me(b)||(b=Ut(b)),Ee(ce,S,b)}n("getMetadata",B);function H(ce,S,b){if(!De(S))throw new TypeError;return Me(b)||(b=Ut(b)),z(ce,S,b)}n("getOwnMetadata",H);function re(ce,S){if(!De(ce))throw new TypeError;return Me(S)||(S=Ut(S)),ee(ce,S)}n("getMetadataKeys",re);function le(ce,S){if(!De(ce))throw new TypeError;return Me(S)||(S=Ut(S)),ve(ce,S)}n("getOwnMetadataKeys",le);function me(ce,S,b){if(!De(S))throw new TypeError;Me(b)||(b=Ut(b));var E=lt(S,b,!1);if(Me(E)||!E.delete(ce))return!1;if(E.size>0)return!0;var q=v.get(S);return q.delete(b),q.size>0||v.delete(S),!0}n("deleteMetadata",me);function He(ce,S){for(var b=ce.length-1;b>=0;--b){var E=ce[b],q=E(S);if(!Me(q)&&!it(q)){if(!qt(q))throw new TypeError;S=q}}return S}function ct(ce,S,b,E){for(var q=ce.length-1;q>=0;--q){var X=ce[q],Z=X(S,b,E);if(!Me(Z)&&!it(Z)){if(!De(Z))throw new TypeError;E=Z}}return E}function lt(ce,S,b){var E=v.get(ce);if(Me(E)){if(!b)return;E=new p,v.set(ce,E)}var q=E.get(S);if(Me(q)){if(!b)return;q=new p,E.set(S,q)}return q}function dt(ce,S,b){var E=gt(ce,S,b);if(E)return!0;var q=kt(S);return it(q)?!1:dt(ce,q,b)}function gt(ce,S,b){var E=lt(S,b,!1);return Me(E)?!1:Nt(E.has(ce))}function Ee(ce,S,b){var E=gt(ce,S,b);if(E)return z(ce,S,b);var q=kt(S);if(!it(q))return Ee(ce,q,b)}function z(ce,S,b){var E=lt(S,b,!1);if(!Me(E))return E.get(ce)}function ne(ce,S,b,E){var q=lt(b,E,!0);q.set(ce,S)}function ee(ce,S){var b=ve(ce,S),E=kt(ce);if(E===null)return b;var q=ee(E,S);if(q.length<=0)return b;if(b.length<=0)return q;for(var X=new y,Z=[],se=0,Se=b;se<Se.length;se++){var qe=Se[se],Ue=X.has(qe);Ue||(X.add(qe),Z.push(qe))}for(var ht=0,mt=q;ht<mt.length;ht++){var qe=mt[ht],Ue=X.has(qe);Ue||(X.add(qe),Z.push(qe))}return Z}function ve(ce,S){var b=[],E=lt(ce,S,!1);if(Me(E))return b;for(var q=E.keys(),X=Wt(q),Z=0;;){var se=sr(X);if(!se)return b.length=Z,b;var Se=mr(se);try{b[Z]=Se}catch(qe){try{er(X)}finally{throw qe}}Z++}}function Qe(ce){if(ce===null)return 1;switch(typeof ce){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return ce===null?1:6;default:return 6}}function Me(ce){return ce===void 0}function it(ce){return ce===null}function Ne(ce){return typeof ce=="symbol"}function De(ce){return typeof ce=="object"?ce!==null:typeof ce=="function"}function Dt(ce,S){switch(Qe(ce)){case 0:return ce;case 1:return ce;case 2:return ce;case 3:return ce;case 4:return ce;case 5:return ce}var b="string",E=zr(ce,u);if(E!==void 0){var q=E.call(ce,b);if(De(q))throw new TypeError;return q}return bt(ce)}function bt(ce,S){var b,E,q;{var X=ce.toString;if(Zt(X)){var E=X.call(ce);if(!De(E))return E}var b=ce.valueOf;if(Zt(b)){var E=b.call(ce);if(!De(E))return E}}throw new TypeError}function Nt(ce){return!!ce}function fr(ce){return""+ce}function Ut(ce){var S=Dt(ce);return Ne(S)?S:fr(S)}function Yt(ce){return Array.isArray?Array.isArray(ce):ce instanceof Object?ce instanceof Array:Object.prototype.toString.call(ce)==="[object Array]"}function Zt(ce){return typeof ce=="function"}function qt(ce){return typeof ce=="function"}function Xt(ce){switch(Qe(ce)){case 3:return!0;case 4:return!0;default:return!1}}function zr(ce,S){var b=ce[S];if(b!=null){if(!Zt(b))throw new TypeError;return b}}function Wt(ce){var S=zr(ce,c);if(!Zt(S))throw new TypeError;var b=S.call(ce);if(!De(b))throw new TypeError;return b}function mr(ce){return ce.value}function sr(ce){var S=ce.next();return S.done?!1:S}function er(ce){var S=ce.return;S&&S.call(ce)}function kt(ce){var S=Object.getPrototypeOf(ce);if(typeof ce!="function"||ce===l||S!==l)return S;var b=ce.prototype,E=b&&Object.getPrototypeOf(b);if(E==null||E===Object.prototype)return S;var q=E.constructor;return typeof q!="function"||q===ce?S:q}function Rt(){var ce={},S=[],b=function(){function Z(se,Se,qe){this._index=0,this._keys=se,this._values=Se,this._selector=qe}return Z.prototype["@@iterator"]=function(){return this},Z.prototype[c]=function(){return this},Z.prototype.next=function(){var se=this._index;if(se>=0&&se<this._keys.length){var Se=this._selector(this._keys[se],this._values[se]);return se+1>=this._keys.length?(this._index=-1,this._keys=S,this._values=S):this._index++,{value:Se,done:!1}}return{value:void 0,done:!0}},Z.prototype.throw=function(se){throw this._index>=0&&(this._index=-1,this._keys=S,this._values=S),se},Z.prototype.return=function(se){return this._index>=0&&(this._index=-1,this._keys=S,this._values=S),{value:se,done:!0}},Z}();return function(){function Z(){this._keys=[],this._values=[],this._cacheKey=ce,this._cacheIndex=-2}return Object.defineProperty(Z.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Z.prototype.has=function(se){return this._find(se,!1)>=0},Z.prototype.get=function(se){var Se=this._find(se,!1);return Se>=0?this._values[Se]:void 0},Z.prototype.set=function(se,Se){var qe=this._find(se,!0);return this._values[qe]=Se,this},Z.prototype.delete=function(se){var Se=this._find(se,!1);if(Se>=0){for(var qe=this._keys.length,Ue=Se+1;Ue<qe;Ue++)this._keys[Ue-1]=this._keys[Ue],this._values[Ue-1]=this._values[Ue];return this._keys.length--,this._values.length--,se===this._cacheKey&&(this._cacheKey=ce,this._cacheIndex=-2),!0}return!1},Z.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=ce,this._cacheIndex=-2},Z.prototype.keys=function(){return new b(this._keys,this._values,E)},Z.prototype.values=function(){return new b(this._keys,this._values,q)},Z.prototype.entries=function(){return new b(this._keys,this._values,X)},Z.prototype["@@iterator"]=function(){return this.entries()},Z.prototype[c]=function(){return this.entries()},Z.prototype._find=function(se,Se){return this._cacheKey!==se&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=se)),this._cacheIndex<0&&Se&&(this._cacheIndex=this._keys.length,this._keys.push(se),this._values.push(void 0)),this._cacheIndex},Z}();function E(Z,se){return Z}function q(Z,se){return se}function X(Z,se){return[Z,se]}}function ar(){return function(){function ce(){this._map=new p}return Object.defineProperty(ce.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),ce.prototype.has=function(S){return this._map.has(S)},ce.prototype.add=function(S){return this._map.set(S,S),this},ce.prototype.delete=function(S){return this._map.delete(S)},ce.prototype.clear=function(){this._map.clear()},ce.prototype.keys=function(){return this._map.keys()},ce.prototype.values=function(){return this._map.values()},ce.prototype.entries=function(){return this._map.entries()},ce.prototype["@@iterator"]=function(){return this.keys()},ce.prototype[c]=function(){return this.keys()},ce}()}function Er(){var ce=16,S=f.create(),b=E();return function(){function Se(){this._key=E()}return Se.prototype.has=function(qe){var Ue=q(qe,!1);return Ue!==void 0?f.has(Ue,this._key):!1},Se.prototype.get=function(qe){var Ue=q(qe,!1);return Ue!==void 0?f.get(Ue,this._key):void 0},Se.prototype.set=function(qe,Ue){var ht=q(qe,!0);return ht[this._key]=Ue,this},Se.prototype.delete=function(qe){var Ue=q(qe,!1);return Ue!==void 0?delete Ue[this._key]:!1},Se.prototype.clear=function(){this._key=E()},Se}();function E(){var Se;do Se="@@WeakMap@@"+se();while(f.has(S,Se));return S[Se]=!0,Se}function q(Se,qe){if(!i.call(Se,b)){if(!qe)return;Object.defineProperty(Se,b,{value:f.create()})}return Se[b]}function X(Se,qe){for(var Ue=0;Ue<qe;++Ue)Se[Ue]=Math.random()*255|0;return Se}function Z(Se){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(Se)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(Se)):X(new Uint8Array(Se),Se):X(new Array(Se),Se)}function se(){var Se=Z(ce);Se[6]=Se[6]&79|64,Se[8]=Se[8]&191|128;for(var qe="",Ue=0;Ue<ce;++Ue){var ht=Se[Ue];(Ue===4||Ue===6||Ue===8)&&(qe+="-"),ht<16&&(qe+="0"),qe+=ht.toString(16).toLowerCase()}return qe}}function Bt(ce){return ce.__=void 0,delete ce.__,ce}})}(e||(e={})),_Reflect}var hasRequiredExportable;function requireExportable(){if(hasRequiredExportable)return exportable;hasRequiredExportable=1;var r=exportable&&exportable.__read||function(f,l){var h=typeof Symbol=="function"&&f[Symbol.iterator];if(!h)return f;var p=h.call(f),y,w=[],v;try{for(;(l===void 0||l-- >0)&&!(y=p.next()).done;)w.push(y.value)}catch(C){v={error:C}}finally{try{y&&!y.done&&(h=p.return)&&h.call(p)}finally{if(v)throw v.error}}return w},e=exportable&&exportable.__spread||function(){for(var f=[],l=0;l<arguments.length;l++)f=f.concat(r(arguments[l]));return f};Object.defineProperty(exportable,"__esModule",{value:!0}),require_Reflect();function t(f){return f==null?f:Array.isArray(f)?f.map(t):typeof f=="object"?"saveAsJSON"in f?f.saveAsJSON():Object.assign({},f):f}exportable.cloneField=t;function n(f){for(var l=[],h=1;h<arguments.length;h++)l[h-1]=arguments[h];return function(p){var y={type:f};return l.forEach(function(w){y[w]=t(p[w])}),y}}exportable.cloneObject=n;function i(f){return function(l){return l.prototype.saveAsJSON=function(){return f.export(this)},l.fromJSON=function(h){return f.import(h)},l}}exportable.Exportable=i;var s=Symbol("bloom-filters:exportable:class-name"),u=Symbol("bloom-filters:exportable:fields"),c=Symbol("bloom-filters:exportable:constructor-parameters");function d(f,l){return f===void 0&&(f=t),l===void 0&&(l=function(h){return h}),function(h,p){var y=[];Reflect.hasMetadata(u,h)&&(y=Reflect.getMetadata(u,h)),y.push({name:p,exporter:f,importer:l}),Reflect.defineMetadata(u,y,h)}}exportable.Field=d;function g(f){return function(l,h,p){var y=new Map;Reflect.hasMetadata(c,l)&&(y=Reflect.getMetadata(c,l)),y.set(f,p),Reflect.defineMetadata(c,y,l)}}exportable.Parameter=g;function _(f,l){return l===void 0&&(l=[]),function(h){if(Reflect.defineMetadata(s,f,h.prototype),!Reflect.hasMetadata(u,h.prototype)||l.length===0)throw new SyntaxError("No exported fields declared when @AutoExportable is called");Reflect.hasMetadata(c,h)||Reflect.defineMetadata(c,new Map,h),h.prototype.saveAsJSON=function(){var p=this,y={type:Reflect.getMetadata(s,h.prototype)},w=Reflect.getMetadata(u,h.prototype);return w.forEach(function(v){y[v.name]=v.exporter(p[v.name])}),l.forEach(function(v){y[v]=t(p[v])}),y},h.fromJSON=function(p){var y=Reflect.getMetadata(s,h.prototype),w=Reflect.getMetadata(c,h),v=Reflect.getMetadata(u,h.prototype);if(p.type!==y)throw new Error("Cannot create an object "+y+' from a JSON export with type "'+p.type+'"');var C=[],P=[];l.map(function(F){return{name:F,importer:function(k){return k}}}).concat(v).forEach(function(F){if(!(F.name in p))throw new Error('Invalid import: required field "'+F+'" not found in JSON export "'+p+'"');w.has(F.name)?C[w.get(F.name)]=F.importer(p[F.name]):P.push({name:F.name,value:F.importer(p[F.name])})});var R=new(h.bind.apply(h,e([void 0],C)));return P.forEach(function(F){R[F.name]=F.value}),R}}}return exportable.AutoExportable=_,exportable}var formulas={},hasRequiredFormulas;function requireFormulas(){if(hasRequiredFormulas)return formulas;hasRequiredFormulas=1,Object.defineProperty(formulas,"__esModule",{value:!0});function r(t,n){return Math.ceil(-(t*Math.log(n)/Math.pow(Math.log(2),2)))}formulas.optimalFilterSize=r;function e(t,n){return Math.ceil(t/n*Math.log(2))}return formulas.optimalHashes=e,formulas}var hasRequiredBloomFilter;function requireBloomFilter(){if(hasRequiredBloomFilter)return bloomFilter;hasRequiredBloomFilter=1;var r=bloomFilter&&bloomFilter.__extends||function(){var _=function(f,l){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,p){h.__proto__=p}||function(h,p){for(var y in p)p.hasOwnProperty(y)&&(h[y]=p[y])},_(f,l)};return function(f,l){_(f,l);function h(){this.constructor=f}f.prototype=l===null?Object.create(l):(h.prototype=l.prototype,new h)}}(),e=bloomFilter&&bloomFilter.__decorate||function(_,f,l,h){var p=arguments.length,y=p<3?f:h===null?h=Object.getOwnPropertyDescriptor(f,l):h,w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(_,f,l,h);else for(var v=_.length-1;v>=0;v--)(w=_[v])&&(y=(p<3?w(y):p>3?w(f,l,y):w(f,l))||y);return p>3&&y&&Object.defineProperty(f,l,y),y},t=bloomFilter&&bloomFilter.__metadata||function(_,f){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(_,f)},n=bloomFilter&&bloomFilter.__param||function(_,f){return function(l,h){f(l,h,_)}},i=bloomFilter&&bloomFilter.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(bloomFilter,"__esModule",{value:!0});var s=i(requireBaseFilter()),u=requireExportable(),c=requireFormulas(),d=requireUtils(),g=function(_){r(f,_);function f(h,p){var y=_.call(this)||this;if(p<1)throw new Error("A BloomFilter cannot uses less than one hash function, while you tried to use "+p+".");return y._size=h,y._nbHashes=p,y._filter=d.allocateArray(y._size,0),y._length=0,y}l=f,f.create=function(h,p){var y=c.optimalFilterSize(h,p),w=c.optimalHashes(y,h);return new l(y,w)},f.from=function(h,p){var y=Array.from(h),w=l.create(y.length,p);return y.forEach(function(v){return w.add(v)}),w},f.fromBytes=function(h,p){for(var y=[],w=0;w<h.length;w++){var v=d.uint8ToBits(h[w]);y=y.concat(v)}var C=new l(y.length,p);return C._filter=y,C},Object.defineProperty(f.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),f.prototype.add=function(h){for(var p=d.getDistinctIndices(h,this._size,this._nbHashes,this.seed),y=0;y<p.length;y++)this._filter[p[y]]=1;this._length++},f.prototype.has=function(h){for(var p=d.getDistinctIndices(h,this._size,this._nbHashes,this.seed),y=0;y<p.length;y++)if(!this._filter[p[y]])return!1;return!0},f.prototype.rate=function(){return Math.pow(1-Math.exp(-this._nbHashes*this._length/this._size),this._nbHashes)},f.prototype.equals=function(h){return this._size!==h._size||this._nbHashes!==h._nbHashes?!1:this._filter.every(function(p,y){return h._filter[y]===p})},f.prototype.toBytes=function(){for(var h=new Uint8Array(Math.ceil(this._size/8)),p=0;p<h.length;p++){var y=this._filter.slice(p*8,p*8+8);h[p]=d.bitsToUint8(y)}return h};var l;return e([u.Field(),t("design:type",Number)],f.prototype,"_size",void 0),e([u.Field(),t("design:type",Number)],f.prototype,"_nbHashes",void 0),e([u.Field(),t("design:type",Array)],f.prototype,"_filter",void 0),e([u.Field(),t("design:type",Number)],f.prototype,"_length",void 0),f=l=e([u.AutoExportable("BloomFilter",["_seed"]),n(0,u.Parameter("_size")),n(1,u.Parameter("_nbHashes")),t("design:paramtypes",[Number,Number])],f),f}(s.default);return bloomFilter.default=g,bloomFilter}var countingBloomFilter={},hasRequiredCountingBloomFilter;function requireCountingBloomFilter(){if(hasRequiredCountingBloomFilter)return countingBloomFilter;hasRequiredCountingBloomFilter=1;var r=countingBloomFilter&&countingBloomFilter.__extends||function(){var _=function(f,l){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,p){h.__proto__=p}||function(h,p){for(var y in p)p.hasOwnProperty(y)&&(h[y]=p[y])},_(f,l)};return function(f,l){_(f,l);function h(){this.constructor=f}f.prototype=l===null?Object.create(l):(h.prototype=l.prototype,new h)}}(),e=countingBloomFilter&&countingBloomFilter.__decorate||function(_,f,l,h){var p=arguments.length,y=p<3?f:h===null?h=Object.getOwnPropertyDescriptor(f,l):h,w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(_,f,l,h);else for(var v=_.length-1;v>=0;v--)(w=_[v])&&(y=(p<3?w(y):p>3?w(f,l,y):w(f,l))||y);return p>3&&y&&Object.defineProperty(f,l,y),y},t=countingBloomFilter&&countingBloomFilter.__metadata||function(_,f){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(_,f)},n=countingBloomFilter&&countingBloomFilter.__param||function(_,f){return function(l,h){f(l,h,_)}},i=countingBloomFilter&&countingBloomFilter.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(countingBloomFilter,"__esModule",{value:!0});var s=i(requireBaseFilter()),u=requireExportable(),c=requireFormulas(),d=requireUtils(),g=function(_){r(f,_);function f(h,p){var y=_.call(this)||this;if(p<1)throw new Error("A CountingBloomFilter must used at least one hash function, but you tried to use "+p+" functions. Consider increasing it.");return y._size=h,y._nbHashes=p,y._filter=d.allocateArray(y._size,function(){return[0,0]}),y._length=0,y}l=f,f.create=function(h,p){var y=c.optimalFilterSize(h,p);return new l(y,c.optimalHashes(y,h))},f.from=function(h,p){var y=Array.from(h),w=l.create(y.length,p);return y.forEach(function(v){return w.add(v)}),w},Object.defineProperty(f.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),f.prototype.add=function(h){for(var p=d.getDistinctIndices(h,this._size,this._nbHashes,this.seed),y=0;y<p.length;y++)this._filter[p[y]][1]+=1,this._filter[p[y]][1]>0&&(this._filter[p[y]][0]=1);this._length++},f.prototype.remove=function(h){for(var p=d.getDistinctIndices(h,this._size,this._nbHashes,this.seed),y=!0,w=0;w<p.length;w++)this._filter[p[w]][1]-=1,this._filter[p[w]][1]<=0&&(this._filter[p[w]][0]=0);return this._length--,y},f.prototype.has=function(h){for(var p=d.getDistinctIndices(h,this._size,this._nbHashes,this.seed),y=0;y<p.length;y++)if(!this._filter[p[y]][0])return!1;return!0},f.prototype.rate=function(){return Math.pow(1-Math.exp(-this._nbHashes*this._length/this._size),this._nbHashes)},f.prototype.equals=function(h){return this._size!==h._size||this._nbHashes!==h._nbHashes||this._length!==h._length?!1:this._filter.every(function(p,y){return h._filter[y][0]===p[0]&&h._filter[y][1]===p[1]})};var l;return e([u.Field(),t("design:type",Number)],f.prototype,"_size",void 0),e([u.Field(),t("design:type",Number)],f.prototype,"_nbHashes",void 0),e([u.Field(),t("design:type",Array)],f.prototype,"_filter",void 0),e([u.Field(),t("design:type",Number)],f.prototype,"_length",void 0),f=l=e([u.AutoExportable("CountingBloomFilter",["_seed"]),n(0,u.Parameter("_size")),n(1,u.Parameter("_nbHashes")),t("design:paramtypes",[Number,Number])],f),f}(s.default);return countingBloomFilter.default=g,countingBloomFilter}var partitionedBloomFilter={},hasRequiredPartitionedBloomFilter;function requirePartitionedBloomFilter(){if(hasRequiredPartitionedBloomFilter)return partitionedBloomFilter;hasRequiredPartitionedBloomFilter=1;var r=partitionedBloomFilter&&partitionedBloomFilter.__extends||function(){var l=function(h,p){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,w){y.__proto__=w}||function(y,w){for(var v in w)w.hasOwnProperty(v)&&(y[v]=w[v])},l(h,p)};return function(h,p){l(h,p);function y(){this.constructor=h}h.prototype=p===null?Object.create(p):(y.prototype=p.prototype,new y)}}(),e=partitionedBloomFilter&&partitionedBloomFilter.__decorate||function(l,h,p,y){var w=arguments.length,v=w<3?h:y===null?y=Object.getOwnPropertyDescriptor(h,p):y,C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(l,h,p,y);else for(var P=l.length-1;P>=0;P--)(C=l[P])&&(v=(w<3?C(v):w>3?C(h,p,v):C(h,p))||v);return w>3&&v&&Object.defineProperty(h,p,v),v},t=partitionedBloomFilter&&partitionedBloomFilter.__metadata||function(l,h){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(l,h)},n=partitionedBloomFilter&&partitionedBloomFilter.__param||function(l,h){return function(p,y){h(p,y,l)}},i=partitionedBloomFilter&&partitionedBloomFilter.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(partitionedBloomFilter,"__esModule",{value:!0});var s=i(requireBaseFilter()),u=requireExportable(),c=requireUtils();function d(l,h){return Math.ceil(Math.log(l)/Math.log(h))}function g(l,h,p){return Math.ceil(l*-Math.log(h)/(Math.log(p)*Math.log(1-p)))}function _(l,h,p){return Math.ceil(l*(Math.log(h)*Math.log(1-h))/-(p*Math.log(h)))}var f=function(l){r(h,l);function h(y,w,v,C){var P=l.call(this)||this;return P._size=y,P._nbHashes=w,P._loadFactor=v,P._m=Math.ceil(P._size/P._nbHashes),P._filter=c.allocateArray(P._nbHashes,function(){return c.allocateArray(P._m,0)}),P._capacity=C!==void 0?C:_(P._size,v,w),P._length=0,P}p=h,h.create=function(y,w,v){v===void 0&&(v=.5);var C=g(y,w,v),P=d(w,v);return new p(C,P,v,y)},h.from=function(y,w,v){v===void 0&&(v=.5);var C=Array.from(y),P=p.create(C.length,w,v);return C.forEach(function(R){return P.add(R)}),P},Object.defineProperty(h.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"loadFactor",{get:function(){return this._loadFactor},enumerable:!0,configurable:!0}),h.prototype.add=function(y){for(var w=c.getIndices(y,this._m,this._nbHashes,this.seed),v=0;v<this._nbHashes;v++)this._filter[v][w[v]]=1;this._length++},h.prototype.has=function(y){for(var w=c.getIndices(y,this._m,this._nbHashes,this.seed),v=0;v<this._nbHashes;v++)if(!this._filter[v][w[v]])return!1;return!0},h.prototype.rate=function(){var y=this._currentload();return Math.pow(y,this._nbHashes)},h.prototype.equals=function(y){return this._size!==y._size||this._nbHashes!==y._nbHashes||this._length!==y._length||this._loadFactor!==y._loadFactor?!1:this._filter.every(function(w,v){return y._filter[v].every(function(C,P){return w[P]===C})})},h.prototype._currentload=function(){var y=this._filter.map(function(v){return v.reduce(function(C,P){return C+P},0)}),w=y.reduce(function(v,C){return v+C},0);return w/this._size};var p;return e([u.Field(),t("design:type",Number)],h.prototype,"_size",void 0),e([u.Field(),t("design:type",Number)],h.prototype,"_nbHashes",void 0),e([u.Field(),t("design:type",Number)],h.prototype,"_loadFactor",void 0),e([u.Field(),t("design:type",Number)],h.prototype,"_m",void 0),e([u.Field(),t("design:type",Array)],h.prototype,"_filter",void 0),e([u.Field(),t("design:type",Number)],h.prototype,"_capacity",void 0),e([u.Field(),t("design:type",Number)],h.prototype,"_length",void 0),h=p=e([u.AutoExportable("PartitionedBloomFilter",["_seed"]),n(0,u.Parameter("_size")),n(1,u.Parameter("_nbHashes")),n(2,u.Parameter("_loadFactor")),n(3,u.Parameter("_capacity")),t("design:paramtypes",[Number,Number,Number,Number])],h),h}(s.default);return partitionedBloomFilter.default=f,partitionedBloomFilter}var countMinSketch={},hasRequiredCountMinSketch;function requireCountMinSketch(){if(hasRequiredCountMinSketch)return countMinSketch;hasRequiredCountMinSketch=1;var r=countMinSketch&&countMinSketch.__extends||function(){var _=function(f,l){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,p){h.__proto__=p}||function(h,p){for(var y in p)p.hasOwnProperty(y)&&(h[y]=p[y])},_(f,l)};return function(f,l){_(f,l);function h(){this.constructor=f}f.prototype=l===null?Object.create(l):(h.prototype=l.prototype,new h)}}(),e=countMinSketch&&countMinSketch.__decorate||function(_,f,l,h){var p=arguments.length,y=p<3?f:h===null?h=Object.getOwnPropertyDescriptor(f,l):h,w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(_,f,l,h);else for(var v=_.length-1;v>=0;v--)(w=_[v])&&(y=(p<3?w(y):p>3?w(f,l,y):w(f,l))||y);return p>3&&y&&Object.defineProperty(f,l,y),y},t=countMinSketch&&countMinSketch.__metadata||function(_,f){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(_,f)},n=countMinSketch&&countMinSketch.__param||function(_,f){return function(l,h){f(l,h,_)}},i=countMinSketch&&countMinSketch.__values||function(_){var f=typeof Symbol=="function"&&Symbol.iterator,l=f&&_[f],h=0;if(l)return l.call(_);if(_&&typeof _.length=="number")return{next:function(){return _&&h>=_.length&&(_=void 0),{value:_&&_[h++],done:!_}}};throw new TypeError(f?"Object is not iterable.":"Symbol.iterator is not defined.")},s=countMinSketch&&countMinSketch.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(countMinSketch,"__esModule",{value:!0});var u=s(requireBaseFilter()),c=requireExportable(),d=requireUtils(),g=function(_){r(f,_);function f(h,p){var y=_.call(this)||this;return y._columns=h,y._rows=p,y._matrix=d.allocateArray(y._rows,function(){return d.allocateArray(y._columns,0)}),y._allSums=0,y}l=f,f.create=function(h,p){p===void 0&&(p=.999);var y=Math.ceil(Math.E/h),w=Math.ceil(Math.log(1/p));return new l(y,w)},f.from=function(h,p,y){var w,v;y===void 0&&(y=.999);var C=l.create(p,y);try{for(var P=i(h),R=P.next();!R.done;R=P.next()){var F=R.value;C.update(F)}}catch(k){w={error:k}}finally{try{R&&!R.done&&(v=P.return)&&v.call(P)}finally{if(w)throw w.error}}return C},Object.defineProperty(f.prototype,"columns",{get:function(){return this._columns},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"sum",{get:function(){return this._allSums},enumerable:!0,configurable:!0}),f.prototype.update=function(h,p){p===void 0&&(p=1),this._allSums+=p;for(var y=d.getDistinctIndices(h,this._columns,this._rows,this.seed),w=0;w<this._rows;w++)this._matrix[w][y[w]]+=p},f.prototype.count=function(h){for(var p=1/0,y=d.getDistinctIndices(h,this._columns,this._rows,this.seed),w=0;w<this._rows;w++){var v=this._matrix[w][y[w]];p=Math.min(v,p)}return p},f.prototype.equals=function(h){if(this._columns!==h._columns||this._rows!==h._rows)return!1;for(var p=0;p<this._rows;p++)for(var y=0;y<this._columns;y++)if(this._matrix[p][y]!==h._matrix[p][y])return!1;return!0},f.prototype.merge=function(h){if(this._columns!==h._columns)throw new Error("Cannot merge two sketches with different number of columns");if(this._rows!==h._rows)throw new Error("Cannot merge two sketches with different number of rows");for(var p=0;p<this._rows;p++)for(var y=0;y<this._columns;y++)this._matrix[p][y]+=h._matrix[p][y]},f.prototype.clone=function(){var h=new l(this._columns,this._rows);return h.merge(this),h.seed=this.seed,h};var l;return e([c.Field(),t("design:type",Number)],f.prototype,"_columns",void 0),e([c.Field(),t("design:type",Number)],f.prototype,"_rows",void 0),e([c.Field(),t("design:type",Array)],f.prototype,"_matrix",void 0),e([c.Field(),t("design:type",Number)],f.prototype,"_allSums",void 0),f=l=e([c.AutoExportable("CountMinSketch",["_seed"]),n(0,c.Parameter("_columns")),n(1,c.Parameter("_rows")),t("design:paramtypes",[Number,Number])],f),f}(u.default);return countMinSketch.default=g,countMinSketch}var hyperloglog={},hasRequiredHyperloglog;function requireHyperloglog(){if(hasRequiredHyperloglog)return hyperloglog;hasRequiredHyperloglog=1;var r=hyperloglog&&hyperloglog.__extends||function(){var f=function(l,h){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,y){p.__proto__=y}||function(p,y){for(var w in y)y.hasOwnProperty(w)&&(p[w]=y[w])},f(l,h)};return function(l,h){f(l,h);function p(){this.constructor=l}l.prototype=h===null?Object.create(h):(p.prototype=h.prototype,new p)}}(),e=hyperloglog&&hyperloglog.__decorate||function(f,l,h,p){var y=arguments.length,w=y<3?l:p===null?p=Object.getOwnPropertyDescriptor(l,h):p,v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(f,l,h,p);else for(var C=f.length-1;C>=0;C--)(v=f[C])&&(w=(y<3?v(w):y>3?v(l,h,w):v(l,h))||w);return y>3&&w&&Object.defineProperty(l,h,w),w},t=hyperloglog&&hyperloglog.__metadata||function(f,l){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(f,l)},n=hyperloglog&&hyperloglog.__param||function(f,l){return function(h,p){l(h,p,f)}},i=hyperloglog&&hyperloglog.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(hyperloglog,"__esModule",{value:!0});var s=i(requireBaseFilter()),u=requireExportable(),c=requireUtils(),d=Math.pow(2,32);function g(f){switch(f){case 16:return .673;case 32:return .697;case 64:return .709;default:return .7213/(1+1.079/f)}}var _=function(f){r(l,f);function l(p){var y=f.call(this)||this;return y._nbRegisters=p,y._nbBytesPerHash=Math.round(Math.log2(p)),y._correctionBias=g(p),y._registers=c.allocateArray(y._nbRegisters,0),y}h=l,Object.defineProperty(l.prototype,"nbRegisters",{get:function(){return this._nbRegisters},enumerable:!0,configurable:!0}),l.prototype.update=function(p){for(var y=c.hashAsInt(p,this.seed).toString(2),w=1+parseInt(y.slice(0,this._nbBytesPerHash-1),2),v=y.slice(this._nbBytesPerHash),C=0;v[C]!=="1"&&C<v.length-1;)C++;this._registers[w]=Math.max(this._registers[w],C)},l.prototype.count=function(p){p===void 0&&(p=!1);var y=this._registers.reduce(function(v,C){return v+Math.pow(2,-C)},0),w=this._correctionBias*Math.pow(this._nbRegisters,2)/y;return w>d/30&&(w=-d*Math.log(1-w/d)),p&&(w=Math.round(w)),w},l.prototype.accuracy=function(){return 1.04/Math.sqrt(this._nbRegisters)},l.prototype.merge=function(p){if(this.nbRegisters!==p.nbRegisters)throw new Error("Two HyperLogLog must have the same number of registers to be merged. Tried to merge two HyperLogLog with m = "+this.nbRegisters+" and m = "+p.nbRegisters);for(var y=new h(this.nbRegisters),w=0;w<this.nbRegisters-1;w++)y._registers[w]=Math.max(this._registers[w],p._registers[w]);return y},l.prototype.equals=function(p){if(this.nbRegisters!==p.nbRegisters)return!1;for(var y=0;y<this.nbRegisters-1;y++)if(this._registers[y]!==p._registers[y])return!1;return!0};var h;return e([u.Field(),t("design:type",Number)],l.prototype,"_nbRegisters",void 0),e([u.Field(),t("design:type",Number)],l.prototype,"_nbBytesPerHash",void 0),e([u.Field(),t("design:type",Number)],l.prototype,"_correctionBias",void 0),e([u.Field(),t("design:type",Array)],l.prototype,"_registers",void 0),l=h=e([u.AutoExportable("HyperLogLog",["_seed"]),n(0,u.Parameter("_nbRegisters")),t("design:paramtypes",[Number])],l),l}(s.default);return hyperloglog.default=_,hyperloglog}var topk={},lodash$1={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */var lodash=lodash$1.exports,hasRequiredLodash;function requireLodash(){return hasRequiredLodash||(hasRequiredLodash=1,function(r,e){(function(){var t,n="4.17.21",i=200,s="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",u="Expected a function",c="Invalid `variable` option passed into `_.template`",d="__lodash_hash_undefined__",g=500,_="__lodash_placeholder__",f=1,l=2,h=4,p=1,y=2,w=1,v=2,C=4,P=8,R=16,F=32,k=64,B=128,H=256,re=512,le=30,me="...",He=800,ct=16,lt=1,dt=2,gt=3,Ee=1/0,z=9007199254740991,ne=17976931348623157e292,ee=NaN,ve=4294967295,Qe=ve-1,Me=ve>>>1,it=[["ary",B],["bind",w],["bindKey",v],["curry",P],["curryRight",R],["flip",re],["partial",F],["partialRight",k],["rearg",H]],Ne="[object Arguments]",De="[object Array]",Dt="[object AsyncFunction]",bt="[object Boolean]",Nt="[object Date]",fr="[object DOMException]",Ut="[object Error]",Yt="[object Function]",Zt="[object GeneratorFunction]",qt="[object Map]",Xt="[object Number]",zr="[object Null]",Wt="[object Object]",mr="[object Promise]",sr="[object Proxy]",er="[object RegExp]",kt="[object Set]",Rt="[object String]",ar="[object Symbol]",Er="[object Undefined]",Bt="[object WeakMap]",ce="[object WeakSet]",S="[object ArrayBuffer]",b="[object DataView]",E="[object Float32Array]",q="[object Float64Array]",X="[object Int8Array]",Z="[object Int16Array]",se="[object Int32Array]",Se="[object Uint8Array]",qe="[object Uint8ClampedArray]",Ue="[object Uint16Array]",ht="[object Uint32Array]",mt=/\b__p \+= '';/g,Qr=/\b(__p \+=) '' \+/g,_r=/(__e\(.*?\)|\b__t\)) \+\n'';/g,gn=/&(?:amp|lt|gt|quot|#39);/g,Sn=/[&<>"']/g,Tn=RegExp(gn.source),$r=RegExp(Sn.source),Nr=/<%-([\s\S]+?)%>/g,Hr=/<%([\s\S]+?)%>/g,sn=/<%=([\s\S]+?)%>/g,mn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Dn=/^\w*$/,zn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,tr=/[\\^$.*+?()[\]{}|]/g,In=RegExp(tr.source),A=/^\s+/,L=/\s/,O=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,x=/\{\n\/\* \[wrapped with (.+)\] \*/,K=/,? & /,ie=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ae=/[()=,{}\[\]\/\s]/,we=/\\(\\)?/g,Te=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,We=/\w*$/,ke=/^[-+]0x[0-9a-f]+$/i,Et=/^0b[01]+$/i,Be=/^\[object .+?Constructor\]$/,Ze=/^0o[0-7]+$/i,ot=/^(?:0|[1-9]\d*)$/,ft=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,st=/($^)/,et=/['\n\r\u2028\u2029\\]/g,Ye="\\ud800-\\udfff",tt="\\u0300-\\u036f",Re="\\ufe20-\\ufe2f",Ve="\\u20d0-\\u20ff",Ie=tt+Re+Ve,Le="\\u2700-\\u27bf",Ke="a-z\\xdf-\\xf6\\xf8-\\xff",Fe="\\xac\\xb1\\xd7\\xf7",fe="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",de="\\u2000-\\u206f",$e=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",T="A-Z\\xc0-\\xd6\\xd8-\\xde",U="\\ufe0e\\ufe0f",I=Fe+fe+de+$e,W="['’]",Y="["+Ye+"]",Q="["+I+"]",ue="["+Ie+"]",N="\\d+",pe="["+Le+"]",ye="["+Ke+"]",_e="[^"+Ye+I+N+Le+Ke+T+"]",Ce="\\ud83c[\\udffb-\\udfff]",Pe="(?:"+ue+"|"+Ce+")",je="[^"+Ye+"]",Xe="(?:\\ud83c[\\udde6-\\uddff]){2}",Je="[\\ud800-\\udbff][\\udc00-\\udfff]",rt="["+T+"]",xt="\\u200d",St="(?:"+ye+"|"+_e+")",Lt="(?:"+rt+"|"+_e+")",Vt="(?:"+W+"(?:d|ll|m|re|s|t|ve))?",Kt="(?:"+W+"(?:D|LL|M|RE|S|T|VE))?",Jt=Pe+"?",ai="["+U+"]?",Qi="(?:"+xt+"(?:"+[je,Xe,Je].join("|")+")"+ai+Jt+")*",ui="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",_u="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",os=ai+Jt+Qi,wu="(?:"+[pe,Xe,Je].join("|")+")"+os,bu="(?:"+[je+ue+"?",ue,Xe,Je,Y].join("|")+")",vu=RegExp(W,"g"),xu=RegExp(ue,"g"),Yi=RegExp(Ce+"(?="+Ce+")|"+bu+os,"g"),Eu=RegExp([rt+"?"+ye+"+"+Vt+"(?="+[Q,rt,"$"].join("|")+")",Lt+"+"+Kt+"(?="+[Q,rt+St,"$"].join("|")+")",rt+"?"+St+"+"+Vt,rt+"+"+Kt,_u,ui,N,wu].join("|"),"g"),$u=RegExp("["+xt+Ye+Ie+U+"]"),Cu=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Au=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Su=-1,Mt={};Mt[E]=Mt[q]=Mt[X]=Mt[Z]=Mt[se]=Mt[Se]=Mt[qe]=Mt[Ue]=Mt[ht]=!0,Mt[Ne]=Mt[De]=Mt[S]=Mt[bt]=Mt[b]=Mt[Nt]=Mt[Ut]=Mt[Yt]=Mt[qt]=Mt[Xt]=Mt[Wt]=Mt[er]=Mt[kt]=Mt[Rt]=Mt[Bt]=!1;var Ot={};Ot[Ne]=Ot[De]=Ot[S]=Ot[b]=Ot[bt]=Ot[Nt]=Ot[E]=Ot[q]=Ot[X]=Ot[Z]=Ot[se]=Ot[qt]=Ot[Xt]=Ot[Wt]=Ot[er]=Ot[kt]=Ot[Rt]=Ot[ar]=Ot[Se]=Ot[qe]=Ot[Ue]=Ot[ht]=!0,Ot[Ut]=Ot[Yt]=Ot[Bt]=!1;var Tu={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},Du={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Iu={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Fu={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ku=parseFloat,Pu=parseInt,ss=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,Ou=typeof self=="object"&&self&&self.Object===Object&&self,ur=ss||Ou||Function("return this")(),Xi=e&&!e.nodeType&&e,_n=Xi&&!0&&r&&!r.nodeType&&r,as=_n&&_n.exports===Xi,Ji=as&&ss.process,Fr=function(){try{var te=_n&&_n.require&&_n.require("util").types;return te||Ji&&Ji.binding&&Ji.binding("util")}catch{}}(),us=Fr&&Fr.isArrayBuffer,cs=Fr&&Fr.isDate,fs=Fr&&Fr.isMap,ds=Fr&&Fr.isRegExp,hs=Fr&&Fr.isSet,ps=Fr&&Fr.isTypedArray;function Cr(te,ge,he){switch(he.length){case 0:return te.call(ge);case 1:return te.call(ge,he[0]);case 2:return te.call(ge,he[0],he[1]);case 3:return te.call(ge,he[0],he[1],he[2])}return te.apply(ge,he)}function Ru(te,ge,he,ze){for(var pt=-1,Tt=te==null?0:te.length;++pt<Tt;){var rr=te[pt];ge(ze,rr,he(rr),te)}return ze}function kr(te,ge){for(var he=-1,ze=te==null?0:te.length;++he<ze&&ge(te[he],he,te)!==!1;);return te}function Bu(te,ge){for(var he=te==null?0:te.length;he--&&ge(te[he],he,te)!==!1;);return te}function ys(te,ge){for(var he=-1,ze=te==null?0:te.length;++he<ze;)if(!ge(te[he],he,te))return!1;return!0}function an(te,ge){for(var he=-1,ze=te==null?0:te.length,pt=0,Tt=[];++he<ze;){var rr=te[he];ge(rr,he,te)&&(Tt[pt++]=rr)}return Tt}function ci(te,ge){var he=te==null?0:te.length;return!!he&&Fn(te,ge,0)>-1}function Zi(te,ge,he){for(var ze=-1,pt=te==null?0:te.length;++ze<pt;)if(he(ge,te[ze]))return!0;return!1}function jt(te,ge){for(var he=-1,ze=te==null?0:te.length,pt=Array(ze);++he<ze;)pt[he]=ge(te[he],he,te);return pt}function un(te,ge){for(var he=-1,ze=ge.length,pt=te.length;++he<ze;)te[pt+he]=ge[he];return te}function eo(te,ge,he,ze){var pt=-1,Tt=te==null?0:te.length;for(ze&&Tt&&(he=te[++pt]);++pt<Tt;)he=ge(he,te[pt],pt,te);return he}function Lu(te,ge,he,ze){var pt=te==null?0:te.length;for(ze&&pt&&(he=te[--pt]);pt--;)he=ge(he,te[pt],pt,te);return he}function to(te,ge){for(var he=-1,ze=te==null?0:te.length;++he<ze;)if(ge(te[he],he,te))return!0;return!1}var Mu=ro("length");function Nu(te){return te.split("")}function Uu(te){return te.match(ie)||[]}function gs(te,ge,he){var ze;return he(te,function(pt,Tt,rr){if(ge(pt,Tt,rr))return ze=Tt,!1}),ze}function fi(te,ge,he,ze){for(var pt=te.length,Tt=he+(ze?1:-1);ze?Tt--:++Tt<pt;)if(ge(te[Tt],Tt,te))return Tt;return-1}function Fn(te,ge,he){return ge===ge?Ju(te,ge,he):fi(te,_s,he)}function qu(te,ge,he,ze){for(var pt=he-1,Tt=te.length;++pt<Tt;)if(ze(te[pt],ge))return pt;return-1}function _s(te){return te!==te}function ws(te,ge){var he=te==null?0:te.length;return he?io(te,ge)/he:ee}function ro(te){return function(ge){return ge==null?t:ge[te]}}function no(te){return function(ge){return te==null?t:te[ge]}}function bs(te,ge,he,ze,pt){return pt(te,function(Tt,rr,Pt){he=ze?(ze=!1,Tt):ge(he,Tt,rr,Pt)}),he}function ju(te,ge){var he=te.length;for(te.sort(ge);he--;)te[he]=te[he].value;return te}function io(te,ge){for(var he,ze=-1,pt=te.length;++ze<pt;){var Tt=ge(te[ze]);Tt!==t&&(he=he===t?Tt:he+Tt)}return he}function oo(te,ge){for(var he=-1,ze=Array(te);++he<te;)ze[he]=ge(he);return ze}function Ku(te,ge){return jt(ge,function(he){return[he,te[he]]})}function vs(te){return te&&te.slice(0,Cs(te)+1).replace(A,"")}function Ar(te){return function(ge){return te(ge)}}function so(te,ge){return jt(ge,function(he){return te[he]})}function Hn(te,ge){return te.has(ge)}function xs(te,ge){for(var he=-1,ze=te.length;++he<ze&&Fn(ge,te[he],0)>-1;);return he}function Es(te,ge){for(var he=te.length;he--&&Fn(ge,te[he],0)>-1;);return he}function zu(te,ge){for(var he=te.length,ze=0;he--;)te[he]===ge&&++ze;return ze}var Hu=no(Tu),Wu=no(Du);function Vu(te){return"\\"+Fu[te]}function Gu(te,ge){return te==null?t:te[ge]}function kn(te){return $u.test(te)}function Qu(te){return Cu.test(te)}function Yu(te){for(var ge,he=[];!(ge=te.next()).done;)he.push(ge.value);return he}function ao(te){var ge=-1,he=Array(te.size);return te.forEach(function(ze,pt){he[++ge]=[pt,ze]}),he}function $s(te,ge){return function(he){return te(ge(he))}}function cn(te,ge){for(var he=-1,ze=te.length,pt=0,Tt=[];++he<ze;){var rr=te[he];(rr===ge||rr===_)&&(te[he]=_,Tt[pt++]=he)}return Tt}function li(te){var ge=-1,he=Array(te.size);return te.forEach(function(ze){he[++ge]=ze}),he}function Xu(te){var ge=-1,he=Array(te.size);return te.forEach(function(ze){he[++ge]=[ze,ze]}),he}function Ju(te,ge,he){for(var ze=he-1,pt=te.length;++ze<pt;)if(te[ze]===ge)return ze;return-1}function Zu(te,ge,he){for(var ze=he+1;ze--;)if(te[ze]===ge)return ze;return ze}function Pn(te){return kn(te)?tc(te):Mu(te)}function Ur(te){return kn(te)?rc(te):Nu(te)}function Cs(te){for(var ge=te.length;ge--&&L.test(te.charAt(ge)););return ge}var ec=no(Iu);function tc(te){for(var ge=Yi.lastIndex=0;Yi.test(te);)++ge;return ge}function rc(te){return te.match(Yi)||[]}function nc(te){return te.match(Eu)||[]}var ic=function te(ge){ge=ge==null?ur:On.defaults(ur.Object(),ge,On.pick(ur,Au));var he=ge.Array,ze=ge.Date,pt=ge.Error,Tt=ge.Function,rr=ge.Math,Pt=ge.Object,uo=ge.RegExp,oc=ge.String,Pr=ge.TypeError,di=he.prototype,sc=Tt.prototype,Rn=Pt.prototype,hi=ge["__core-js_shared__"],pi=sc.toString,Ft=Rn.hasOwnProperty,ac=0,As=function(){var o=/[^.]+$/.exec(hi&&hi.keys&&hi.keys.IE_PROTO||"");return o?"Symbol(src)_1."+o:""}(),yi=Rn.toString,uc=pi.call(Pt),cc=ur._,fc=uo("^"+pi.call(Ft).replace(tr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),gi=as?ge.Buffer:t,fn=ge.Symbol,mi=ge.Uint8Array,Ss=gi?gi.allocUnsafe:t,_i=$s(Pt.getPrototypeOf,Pt),Ts=Pt.create,Ds=Rn.propertyIsEnumerable,wi=di.splice,Is=fn?fn.isConcatSpreadable:t,Wn=fn?fn.iterator:t,wn=fn?fn.toStringTag:t,bi=function(){try{var o=$n(Pt,"defineProperty");return o({},"",{}),o}catch{}}(),lc=ge.clearTimeout!==ur.clearTimeout&&ge.clearTimeout,dc=ze&&ze.now!==ur.Date.now&&ze.now,hc=ge.setTimeout!==ur.setTimeout&&ge.setTimeout,vi=rr.ceil,xi=rr.floor,co=Pt.getOwnPropertySymbols,pc=gi?gi.isBuffer:t,Fs=ge.isFinite,yc=di.join,mc=$s(Pt.keys,Pt),nr=rr.max,lr=rr.min,_c=ze.now,wc=ge.parseInt,Ps=rr.random,bc=di.reverse,fo=$n(ge,"DataView"),Vn=$n(ge,"Map"),lo=$n(ge,"Promise"),Bn=$n(ge,"Set"),Gn=$n(ge,"WeakMap"),Qn=$n(Pt,"create"),Ei=Gn&&new Gn,Ln={},vc=Cn(fo),xc=Cn(Vn),Ec=Cn(lo),$c=Cn(Bn),Cc=Cn(Gn),$i=fn?fn.prototype:t,Yn=$i?$i.valueOf:t,Os=$i?$i.toString:t;function M(o){if(Ht(o)&&!yt(o)&&!(o instanceof Ct)){if(o instanceof Or)return o;if(Ft.call(o,"__wrapped__"))return Ba(o)}return new Or(o)}var Mn=function(){function o(){}return function(a){if(!zt(a))return{};if(Ts)return Ts(a);o.prototype=a;var m=new o;return o.prototype=t,m}}();function Ci(){}function Or(o,a){this.__wrapped__=o,this.__actions__=[],this.__chain__=!!a,this.__index__=0,this.__values__=t}M.templateSettings={escape:Nr,evaluate:Hr,interpolate:sn,variable:"",imports:{_:M}},M.prototype=Ci.prototype,M.prototype.constructor=M,Or.prototype=Mn(Ci.prototype),Or.prototype.constructor=Or;function Ct(o){this.__wrapped__=o,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ve,this.__views__=[]}function Ac(){var o=new Ct(this.__wrapped__);return o.__actions__=wr(this.__actions__),o.__dir__=this.__dir__,o.__filtered__=this.__filtered__,o.__iteratees__=wr(this.__iteratees__),o.__takeCount__=this.__takeCount__,o.__views__=wr(this.__views__),o}function Sc(){if(this.__filtered__){var o=new Ct(this);o.__dir__=-1,o.__filtered__=!0}else o=this.clone(),o.__dir__*=-1;return o}function Tc(){var o=this.__wrapped__.value(),a=this.__dir__,m=yt(o),$=a<0,D=m?o.length:0,j=qf(0,D,this.__views__),G=j.start,J=j.end,oe=J-G,be=$?J:G-1,xe=this.__iteratees__,Ae=xe.length,Oe=0,Ge=lr(oe,this.__takeCount__);if(!m||!$&&D==oe&&Ge==oe)return ia(o,this.__actions__);var at=[];e:for(;oe--&&Oe<Ge;){be+=a;for(var wt=-1,ut=o[be];++wt<Ae;){var $t=xe[wt],At=$t.iteratee,Dr=$t.type,yr=At(ut);if(Dr==dt)ut=yr;else if(!yr){if(Dr==lt)continue e;break e}}at[Oe++]=ut}return at}Ct.prototype=Mn(Ci.prototype),Ct.prototype.constructor=Ct;function bn(o){var a=-1,m=o==null?0:o.length;for(this.clear();++a<m;){var $=o[a];this.set($[0],$[1])}}function Dc(){this.__data__=Qn?Qn(null):{},this.size=0}function Ic(o){var a=this.has(o)&&delete this.__data__[o];return this.size-=a?1:0,a}function Fc(o){var a=this.__data__;if(Qn){var m=a[o];return m===d?t:m}return Ft.call(a,o)?a[o]:t}function kc(o){var a=this.__data__;return Qn?a[o]!==t:Ft.call(a,o)}function Pc(o,a){var m=this.__data__;return this.size+=this.has(o)?0:1,m[o]=Qn&&a===t?d:a,this}bn.prototype.clear=Dc,bn.prototype.delete=Ic,bn.prototype.get=Fc,bn.prototype.has=kc,bn.prototype.set=Pc;function Yr(o){var a=-1,m=o==null?0:o.length;for(this.clear();++a<m;){var $=o[a];this.set($[0],$[1])}}function Oc(){this.__data__=[],this.size=0}function Rc(o){var a=this.__data__,m=Ai(a,o);if(m<0)return!1;var $=a.length-1;return m==$?a.pop():wi.call(a,m,1),--this.size,!0}function Bc(o){var a=this.__data__,m=Ai(a,o);return m<0?t:a[m][1]}function Lc(o){return Ai(this.__data__,o)>-1}function Mc(o,a){var m=this.__data__,$=Ai(m,o);return $<0?(++this.size,m.push([o,a])):m[$][1]=a,this}Yr.prototype.clear=Oc,Yr.prototype.delete=Rc,Yr.prototype.get=Bc,Yr.prototype.has=Lc,Yr.prototype.set=Mc;function Xr(o){var a=-1,m=o==null?0:o.length;for(this.clear();++a<m;){var $=o[a];this.set($[0],$[1])}}function Nc(){this.size=0,this.__data__={hash:new bn,map:new(Vn||Yr),string:new bn}}function Uc(o){var a=Mi(this,o).delete(o);return this.size-=a?1:0,a}function qc(o){return Mi(this,o).get(o)}function jc(o){return Mi(this,o).has(o)}function Kc(o,a){var m=Mi(this,o),$=m.size;return m.set(o,a),this.size+=m.size==$?0:1,this}Xr.prototype.clear=Nc,Xr.prototype.delete=Uc,Xr.prototype.get=qc,Xr.prototype.has=jc,Xr.prototype.set=Kc;function vn(o){var a=-1,m=o==null?0:o.length;for(this.__data__=new Xr;++a<m;)this.add(o[a])}function zc(o){return this.__data__.set(o,d),this}function Hc(o){return this.__data__.has(o)}vn.prototype.add=vn.prototype.push=zc,vn.prototype.has=Hc;function qr(o){var a=this.__data__=new Yr(o);this.size=a.size}function Wc(){this.__data__=new Yr,this.size=0}function Vc(o){var a=this.__data__,m=a.delete(o);return this.size=a.size,m}function Gc(o){return this.__data__.get(o)}function Qc(o){return this.__data__.has(o)}function Yc(o,a){var m=this.__data__;if(m instanceof Yr){var $=m.__data__;if(!Vn||$.length<i-1)return $.push([o,a]),this.size=++m.size,this;m=this.__data__=new Xr($)}return m.set(o,a),this.size=m.size,this}qr.prototype.clear=Wc,qr.prototype.delete=Vc,qr.prototype.get=Gc,qr.prototype.has=Qc,qr.prototype.set=Yc;function Rs(o,a){var m=yt(o),$=!m&&An(o),D=!m&&!$&&yn(o),j=!m&&!$&&!D&&jn(o),G=m||$||D||j,J=G?oo(o.length,oc):[],oe=J.length;for(var be in o)(a||Ft.call(o,be))&&!(G&&(be=="length"||D&&(be=="offset"||be=="parent")||j&&(be=="buffer"||be=="byteLength"||be=="byteOffset")||tn(be,oe)))&&J.push(be);return J}function Bs(o){var a=o.length;return a?o[Eo(0,a-1)]:t}function Xc(o,a){return Ni(wr(o),xn(a,0,o.length))}function Jc(o){return Ni(wr(o))}function ho(o,a,m){(m!==t&&!jr(o[a],m)||m===t&&!(a in o))&&Jr(o,a,m)}function Xn(o,a,m){var $=o[a];(!(Ft.call(o,a)&&jr($,m))||m===t&&!(a in o))&&Jr(o,a,m)}function Ai(o,a){for(var m=o.length;m--;)if(jr(o[m][0],a))return m;return-1}function Zc(o,a,m,$){return ln(o,function(D,j,G){a($,D,m(D),G)}),$}function Ls(o,a){return o&&Vr(a,ir(a),o)}function ef(o,a){return o&&Vr(a,vr(a),o)}function Jr(o,a,m){a=="__proto__"&&bi?bi(o,a,{configurable:!0,enumerable:!0,value:m,writable:!0}):o[a]=m}function po(o,a){for(var m=-1,$=a.length,D=he($),j=o==null;++m<$;)D[m]=j?t:Go(o,a[m]);return D}function xn(o,a,m){return o===o&&(m!==t&&(o=o<=m?o:m),a!==t&&(o=o>=a?o:a)),o}function Rr(o,a,m,$,D,j){var G,J=a&f,oe=a&l,be=a&h;if(m&&(G=D?m(o,$,D,j):m(o)),G!==t)return G;if(!zt(o))return o;var xe=yt(o);if(xe){if(G=Kf(o),!J)return wr(o,G)}else{var Ae=dr(o),Oe=Ae==Yt||Ae==Zt;if(yn(o))return aa(o,J);if(Ae==Wt||Ae==Ne||Oe&&!D){if(G=oe||Oe?{}:Sa(o),!J)return oe?kf(o,ef(G,o)):Ff(o,Ls(G,o))}else{if(!Ot[Ae])return D?o:{};G=zf(o,Ae,J)}}j||(j=new qr);var Ge=j.get(o);if(Ge)return Ge;j.set(o,G),ru(o)?o.forEach(function(ut){G.add(Rr(ut,a,m,ut,o,j))}):eu(o)&&o.forEach(function(ut,$t){G.set($t,Rr(ut,a,m,$t,o,j))});var at=be?oe?Oo:Po:oe?vr:ir,wt=xe?t:at(o);return kr(wt||o,function(ut,$t){wt&&($t=ut,ut=o[$t]),Xn(G,$t,Rr(ut,a,m,$t,o,j))}),G}function tf(o){var a=ir(o);return function(m){return Ms(m,o,a)}}function Ms(o,a,m){var $=m.length;if(o==null)return!$;for(o=Pt(o);$--;){var D=m[$],j=a[D],G=o[D];if(G===t&&!(D in o)||!j(G))return!1}return!0}function Ns(o,a,m){if(typeof o!="function")throw new Pr(u);return ii(function(){o.apply(t,m)},a)}function Jn(o,a,m,$){var D=-1,j=ci,G=!0,J=o.length,oe=[],be=a.length;if(!J)return oe;m&&(a=jt(a,Ar(m))),$?(j=Zi,G=!1):a.length>=i&&(j=Hn,G=!1,a=new vn(a));e:for(;++D<J;){var xe=o[D],Ae=m==null?xe:m(xe);if(xe=$||xe!==0?xe:0,G&&Ae===Ae){for(var Oe=be;Oe--;)if(a[Oe]===Ae)continue e;oe.push(xe)}else j(a,Ae,$)||oe.push(xe)}return oe}var ln=da(Wr),Us=da(go,!0);function rf(o,a){var m=!0;return ln(o,function($,D,j){return m=!!a($,D,j),m}),m}function Si(o,a,m){for(var $=-1,D=o.length;++$<D;){var j=o[$],G=a(j);if(G!=null&&(J===t?G===G&&!Tr(G):m(G,J)))var J=G,oe=j}return oe}function nf(o,a,m,$){var D=o.length;for(m=_t(m),m<0&&(m=-m>D?0:D+m),$=$===t||$>D?D:_t($),$<0&&($+=D),$=m>$?0:iu($);m<$;)o[m++]=a;return o}function qs(o,a){var m=[];return ln(o,function($,D,j){a($,D,j)&&m.push($)}),m}function cr(o,a,m,$,D){var j=-1,G=o.length;for(m||(m=Wf),D||(D=[]);++j<G;){var J=o[j];a>0&&m(J)?a>1?cr(J,a-1,m,$,D):un(D,J):$||(D[D.length]=J)}return D}var yo=ha(),js=ha(!0);function Wr(o,a){return o&&yo(o,a,ir)}function go(o,a){return o&&js(o,a,ir)}function Ti(o,a){return an(a,function(m){return rn(o[m])})}function En(o,a){a=hn(a,o);for(var m=0,$=a.length;o!=null&&m<$;)o=o[Gr(a[m++])];return m&&m==$?o:t}function Ks(o,a,m){var $=a(o);return yt(o)?$:un($,m(o))}function hr(o){return o==null?o===t?Er:zr:wn&&wn in Pt(o)?Uf(o):Zf(o)}function mo(o,a){return o>a}function of(o,a){return o!=null&&Ft.call(o,a)}function sf(o,a){return o!=null&&a in Pt(o)}function af(o,a,m){return o>=lr(a,m)&&o<nr(a,m)}function _o(o,a,m){for(var $=m?Zi:ci,D=o[0].length,j=o.length,G=j,J=he(j),oe=1/0,be=[];G--;){var xe=o[G];G&&a&&(xe=jt(xe,Ar(a))),oe=lr(xe.length,oe),J[G]=!m&&(a||D>=120&&xe.length>=120)?new vn(G&&xe):t}xe=o[0];var Ae=-1,Oe=J[0];e:for(;++Ae<D&&be.length<oe;){var Ge=xe[Ae],at=a?a(Ge):Ge;if(Ge=m||Ge!==0?Ge:0,!(Oe?Hn(Oe,at):$(be,at,m))){for(G=j;--G;){var wt=J[G];if(!(wt?Hn(wt,at):$(o[G],at,m)))continue e}Oe&&Oe.push(at),be.push(Ge)}}return be}function uf(o,a,m,$){return Wr(o,function(D,j,G){a($,m(D),j,G)}),$}function Zn(o,a,m){a=hn(a,o),o=Fa(o,a);var $=o==null?o:o[Gr(Lr(a))];return $==null?t:Cr($,o,m)}function zs(o){return Ht(o)&&hr(o)==Ne}function cf(o){return Ht(o)&&hr(o)==S}function ff(o){return Ht(o)&&hr(o)==Nt}function ei(o,a,m,$,D){return o===a?!0:o==null||a==null||!Ht(o)&&!Ht(a)?o!==o&&a!==a:lf(o,a,m,$,ei,D)}function lf(o,a,m,$,D,j){var G=yt(o),J=yt(a),oe=G?De:dr(o),be=J?De:dr(a);oe=oe==Ne?Wt:oe,be=be==Ne?Wt:be;var xe=oe==Wt,Ae=be==Wt,Oe=oe==be;if(Oe&&yn(o)){if(!yn(a))return!1;G=!0,xe=!1}if(Oe&&!xe)return j||(j=new qr),G||jn(o)?$a(o,a,m,$,D,j):Mf(o,a,oe,m,$,D,j);if(!(m&p)){var Ge=xe&&Ft.call(o,"__wrapped__"),at=Ae&&Ft.call(a,"__wrapped__");if(Ge||at){var wt=Ge?o.value():o,ut=at?a.value():a;return j||(j=new qr),D(wt,ut,m,$,j)}}return Oe?(j||(j=new qr),Nf(o,a,m,$,D,j)):!1}function df(o){return Ht(o)&&dr(o)==qt}function wo(o,a,m,$){var D=m.length,j=D,G=!$;if(o==null)return!j;for(o=Pt(o);D--;){var J=m[D];if(G&&J[2]?J[1]!==o[J[0]]:!(J[0]in o))return!1}for(;++D<j;){J=m[D];var oe=J[0],be=o[oe],xe=J[1];if(G&&J[2]){if(be===t&&!(oe in o))return!1}else{var Ae=new qr;if($)var Oe=$(be,xe,oe,o,a,Ae);if(!(Oe===t?ei(xe,be,p|y,$,Ae):Oe))return!1}}return!0}function Hs(o){if(!zt(o)||Gf(o))return!1;var a=rn(o)?fc:Be;return a.test(Cn(o))}function hf(o){return Ht(o)&&hr(o)==er}function pf(o){return Ht(o)&&dr(o)==kt}function yf(o){return Ht(o)&&Hi(o.length)&&!!Mt[hr(o)]}function Ws(o){return typeof o=="function"?o:o==null?xr:typeof o=="object"?yt(o)?Qs(o[0],o[1]):Gs(o):yu(o)}function bo(o){if(!ni(o))return mc(o);var a=[];for(var m in Pt(o))Ft.call(o,m)&&m!="constructor"&&a.push(m);return a}function gf(o){if(!zt(o))return Jf(o);var a=ni(o),m=[];for(var $ in o)$=="constructor"&&(a||!Ft.call(o,$))||m.push($);return m}function vo(o,a){return o<a}function Vs(o,a){var m=-1,$=br(o)?he(o.length):[];return ln(o,function(D,j,G){$[++m]=a(D,j,G)}),$}function Gs(o){var a=Bo(o);return a.length==1&&a[0][2]?Da(a[0][0],a[0][1]):function(m){return m===o||wo(m,o,a)}}function Qs(o,a){return Mo(o)&&Ta(a)?Da(Gr(o),a):function(m){var $=Go(m,o);return $===t&&$===a?Qo(m,o):ei(a,$,p|y)}}function Di(o,a,m,$,D){o!==a&&yo(a,function(j,G){if(D||(D=new qr),zt(j))mf(o,a,G,m,Di,$,D);else{var J=$?$(Uo(o,G),j,G+"",o,a,D):t;J===t&&(J=j),ho(o,G,J)}},vr)}function mf(o,a,m,$,D,j,G){var J=Uo(o,m),oe=Uo(a,m),be=G.get(oe);if(be){ho(o,m,be);return}var xe=j?j(J,oe,m+"",o,a,G):t,Ae=xe===t;if(Ae){var Oe=yt(oe),Ge=!Oe&&yn(oe),at=!Oe&&!Ge&&jn(oe);xe=oe,Oe||Ge||at?yt(J)?xe=J:Gt(J)?xe=wr(J):Ge?(Ae=!1,xe=aa(oe,!0)):at?(Ae=!1,xe=ua(oe,!0)):xe=[]:oi(oe)||An(oe)?(xe=J,An(J)?xe=ou(J):(!zt(J)||rn(J))&&(xe=Sa(oe))):Ae=!1}Ae&&(G.set(oe,xe),D(xe,oe,$,j,G),G.delete(oe)),ho(o,m,xe)}function Ys(o,a){var m=o.length;if(m)return a+=a<0?m:0,tn(a,m)?o[a]:t}function Xs(o,a,m){a.length?a=jt(a,function(j){return yt(j)?function(G){return En(G,j.length===1?j[0]:j)}:j}):a=[xr];var $=-1;a=jt(a,Ar(nt()));var D=Vs(o,function(j,G,J){var oe=jt(a,function(be){return be(j)});return{criteria:oe,index:++$,value:j}});return ju(D,function(j,G){return If(j,G,m)})}function _f(o,a){return Js(o,a,function(m,$){return Qo(o,$)})}function Js(o,a,m){for(var $=-1,D=a.length,j={};++$<D;){var G=a[$],J=En(o,G);m(J,G)&&ti(j,hn(G,o),J)}return j}function wf(o){return function(a){return En(a,o)}}function xo(o,a,m,$){var D=$?qu:Fn,j=-1,G=a.length,J=o;for(o===a&&(a=wr(a)),m&&(J=jt(o,Ar(m)));++j<G;)for(var oe=0,be=a[j],xe=m?m(be):be;(oe=D(J,xe,oe,$))>-1;)J!==o&&wi.call(J,oe,1),wi.call(o,oe,1);return o}function Zs(o,a){for(var m=o?a.length:0,$=m-1;m--;){var D=a[m];if(m==$||D!==j){var j=D;tn(D)?wi.call(o,D,1):Ao(o,D)}}return o}function Eo(o,a){return o+xi(Ps()*(a-o+1))}function bf(o,a,m,$){for(var D=-1,j=nr(vi((a-o)/(m||1)),0),G=he(j);j--;)G[$?j:++D]=o,o+=m;return G}function $o(o,a){var m="";if(!o||a<1||a>z)return m;do a%2&&(m+=o),a=xi(a/2),a&&(o+=o);while(a);return m}function vt(o,a){return qo(Ia(o,a,xr),o+"")}function vf(o){return Bs(Kn(o))}function xf(o,a){var m=Kn(o);return Ni(m,xn(a,0,m.length))}function ti(o,a,m,$){if(!zt(o))return o;a=hn(a,o);for(var D=-1,j=a.length,G=j-1,J=o;J!=null&&++D<j;){var oe=Gr(a[D]),be=m;if(oe==="__proto__"||oe==="constructor"||oe==="prototype")return o;if(D!=G){var xe=J[oe];be=$?$(xe,oe,J):t,be===t&&(be=zt(xe)?xe:tn(a[D+1])?[]:{})}Xn(J,oe,be),J=J[oe]}return o}var ea=Ei?function(o,a){return Ei.set(o,a),o}:xr,Ef=bi?function(o,a){return bi(o,"toString",{configurable:!0,enumerable:!1,value:Xo(a),writable:!0})}:xr;function $f(o){return Ni(Kn(o))}function Br(o,a,m){var $=-1,D=o.length;a<0&&(a=-a>D?0:D+a),m=m>D?D:m,m<0&&(m+=D),D=a>m?0:m-a>>>0,a>>>=0;for(var j=he(D);++$<D;)j[$]=o[$+a];return j}function Cf(o,a){var m;return ln(o,function($,D,j){return m=a($,D,j),!m}),!!m}function Ii(o,a,m){var $=0,D=o==null?$:o.length;if(typeof a=="number"&&a===a&&D<=Me){for(;$<D;){var j=$+D>>>1,G=o[j];G!==null&&!Tr(G)&&(m?G<=a:G<a)?$=j+1:D=j}return D}return Co(o,a,xr,m)}function Co(o,a,m,$){var D=0,j=o==null?0:o.length;if(j===0)return 0;a=m(a);for(var G=a!==a,J=a===null,oe=Tr(a),be=a===t;D<j;){var xe=xi((D+j)/2),Ae=m(o[xe]),Oe=Ae!==t,Ge=Ae===null,at=Ae===Ae,wt=Tr(Ae);if(G)var ut=$||at;else be?ut=at&&($||Oe):J?ut=at&&Oe&&($||!Ge):oe?ut=at&&Oe&&!Ge&&($||!wt):Ge||wt?ut=!1:ut=$?Ae<=a:Ae<a;ut?D=xe+1:j=xe}return lr(j,Qe)}function ta(o,a){for(var m=-1,$=o.length,D=0,j=[];++m<$;){var G=o[m],J=a?a(G):G;if(!m||!jr(J,oe)){var oe=J;j[D++]=G===0?0:G}}return j}function ra(o){return typeof o=="number"?o:Tr(o)?ee:+o}function Sr(o){if(typeof o=="string")return o;if(yt(o))return jt(o,Sr)+"";if(Tr(o))return Os?Os.call(o):"";var a=o+"";return a=="0"&&1/o==-1/0?"-0":a}function dn(o,a,m){var $=-1,D=ci,j=o.length,G=!0,J=[],oe=J;if(m)G=!1,D=Zi;else if(j>=i){var be=a?null:Bf(o);if(be)return li(be);G=!1,D=Hn,oe=new vn}else oe=a?[]:J;e:for(;++$<j;){var xe=o[$],Ae=a?a(xe):xe;if(xe=m||xe!==0?xe:0,G&&Ae===Ae){for(var Oe=oe.length;Oe--;)if(oe[Oe]===Ae)continue e;a&&oe.push(Ae),J.push(xe)}else D(oe,Ae,m)||(oe!==J&&oe.push(Ae),J.push(xe))}return J}function Ao(o,a){return a=hn(a,o),o=Fa(o,a),o==null||delete o[Gr(Lr(a))]}function na(o,a,m,$){return ti(o,a,m(En(o,a)),$)}function Fi(o,a,m,$){for(var D=o.length,j=$?D:-1;($?j--:++j<D)&&a(o[j],j,o););return m?Br(o,$?0:j,$?j+1:D):Br(o,$?j+1:0,$?D:j)}function ia(o,a){var m=o;return m instanceof Ct&&(m=m.value()),eo(a,function($,D){return D.func.apply(D.thisArg,un([$],D.args))},m)}function So(o,a,m){var $=o.length;if($<2)return $?dn(o[0]):[];for(var D=-1,j=he($);++D<$;)for(var G=o[D],J=-1;++J<$;)J!=D&&(j[D]=Jn(j[D]||G,o[J],a,m));return dn(cr(j,1),a,m)}function oa(o,a,m){for(var $=-1,D=o.length,j=a.length,G={};++$<D;){var J=$<j?a[$]:t;m(G,o[$],J)}return G}function To(o){return Gt(o)?o:[]}function Do(o){return typeof o=="function"?o:xr}function hn(o,a){return yt(o)?o:Mo(o,a)?[o]:Ra(It(o))}var Af=vt;function pn(o,a,m){var $=o.length;return m=m===t?$:m,!a&&m>=$?o:Br(o,a,m)}var sa=lc||function(o){return ur.clearTimeout(o)};function aa(o,a){if(a)return o.slice();var m=o.length,$=Ss?Ss(m):new o.constructor(m);return o.copy($),$}function Io(o){var a=new o.constructor(o.byteLength);return new mi(a).set(new mi(o)),a}function Sf(o,a){var m=a?Io(o.buffer):o.buffer;return new o.constructor(m,o.byteOffset,o.byteLength)}function Tf(o){var a=new o.constructor(o.source,We.exec(o));return a.lastIndex=o.lastIndex,a}function Df(o){return Yn?Pt(Yn.call(o)):{}}function ua(o,a){var m=a?Io(o.buffer):o.buffer;return new o.constructor(m,o.byteOffset,o.length)}function ca(o,a){if(o!==a){var m=o!==t,$=o===null,D=o===o,j=Tr(o),G=a!==t,J=a===null,oe=a===a,be=Tr(a);if(!J&&!be&&!j&&o>a||j&&G&&oe&&!J&&!be||$&&G&&oe||!m&&oe||!D)return 1;if(!$&&!j&&!be&&o<a||be&&m&&D&&!$&&!j||J&&m&&D||!G&&D||!oe)return-1}return 0}function If(o,a,m){for(var $=-1,D=o.criteria,j=a.criteria,G=D.length,J=m.length;++$<G;){var oe=ca(D[$],j[$]);if(oe){if($>=J)return oe;var be=m[$];return oe*(be=="desc"?-1:1)}}return o.index-a.index}function fa(o,a,m,$){for(var D=-1,j=o.length,G=m.length,J=-1,oe=a.length,be=nr(j-G,0),xe=he(oe+be),Ae=!$;++J<oe;)xe[J]=a[J];for(;++D<G;)(Ae||D<j)&&(xe[m[D]]=o[D]);for(;be--;)xe[J++]=o[D++];return xe}function la(o,a,m,$){for(var D=-1,j=o.length,G=-1,J=m.length,oe=-1,be=a.length,xe=nr(j-J,0),Ae=he(xe+be),Oe=!$;++D<xe;)Ae[D]=o[D];for(var Ge=D;++oe<be;)Ae[Ge+oe]=a[oe];for(;++G<J;)(Oe||D<j)&&(Ae[Ge+m[G]]=o[D++]);return Ae}function wr(o,a){var m=-1,$=o.length;for(a||(a=he($));++m<$;)a[m]=o[m];return a}function Vr(o,a,m,$){var D=!m;m||(m={});for(var j=-1,G=a.length;++j<G;){var J=a[j],oe=$?$(m[J],o[J],J,m,o):t;oe===t&&(oe=o[J]),D?Jr(m,J,oe):Xn(m,J,oe)}return m}function Ff(o,a){return Vr(o,Lo(o),a)}function kf(o,a){return Vr(o,Ca(o),a)}function ki(o,a){return function(m,$){var D=yt(m)?Ru:Zc,j=a?a():{};return D(m,o,nt($,2),j)}}function Nn(o){return vt(function(a,m){var $=-1,D=m.length,j=D>1?m[D-1]:t,G=D>2?m[2]:t;for(j=o.length>3&&typeof j=="function"?(D--,j):t,G&&pr(m[0],m[1],G)&&(j=D<3?t:j,D=1),a=Pt(a);++$<D;){var J=m[$];J&&o(a,J,$,j)}return a})}function da(o,a){return function(m,$){if(m==null)return m;if(!br(m))return o(m,$);for(var D=m.length,j=a?D:-1,G=Pt(m);(a?j--:++j<D)&&$(G[j],j,G)!==!1;);return m}}function ha(o){return function(a,m,$){for(var D=-1,j=Pt(a),G=$(a),J=G.length;J--;){var oe=G[o?J:++D];if(m(j[oe],oe,j)===!1)break}return a}}function Pf(o,a,m){var $=a&w,D=ri(o);function j(){var G=this&&this!==ur&&this instanceof j?D:o;return G.apply($?m:this,arguments)}return j}function pa(o){return function(a){a=It(a);var m=kn(a)?Ur(a):t,$=m?m[0]:a.charAt(0),D=m?pn(m,1).join(""):a.slice(1);return $[o]()+D}}function Un(o){return function(a){return eo(hu(du(a).replace(vu,"")),o,"")}}function ri(o){return function(){var a=arguments;switch(a.length){case 0:return new o;case 1:return new o(a[0]);case 2:return new o(a[0],a[1]);case 3:return new o(a[0],a[1],a[2]);case 4:return new o(a[0],a[1],a[2],a[3]);case 5:return new o(a[0],a[1],a[2],a[3],a[4]);case 6:return new o(a[0],a[1],a[2],a[3],a[4],a[5]);case 7:return new o(a[0],a[1],a[2],a[3],a[4],a[5],a[6])}var m=Mn(o.prototype),$=o.apply(m,a);return zt($)?$:m}}function Of(o,a,m){var $=ri(o);function D(){for(var j=arguments.length,G=he(j),J=j,oe=qn(D);J--;)G[J]=arguments[J];var be=j<3&&G[0]!==oe&&G[j-1]!==oe?[]:cn(G,oe);if(j-=be.length,j<m)return ba(o,a,Pi,D.placeholder,t,G,be,t,t,m-j);var xe=this&&this!==ur&&this instanceof D?$:o;return Cr(xe,this,G)}return D}function ya(o){return function(a,m,$){var D=Pt(a);if(!br(a)){var j=nt(m,3);a=ir(a),m=function(J){return j(D[J],J,D)}}var G=o(a,m,$);return G>-1?D[j?a[G]:G]:t}}function ga(o){return en(function(a){var m=a.length,$=m,D=Or.prototype.thru;for(o&&a.reverse();$--;){var j=a[$];if(typeof j!="function")throw new Pr(u);if(D&&!G&&Li(j)=="wrapper")var G=new Or([],!0)}for($=G?$:m;++$<m;){j=a[$];var J=Li(j),oe=J=="wrapper"?Ro(j):t;oe&&No(oe[0])&&oe[1]==(B|P|F|H)&&!oe[4].length&&oe[9]==1?G=G[Li(oe[0])].apply(G,oe[3]):G=j.length==1&&No(j)?G[J]():G.thru(j)}return function(){var be=arguments,xe=be[0];if(G&&be.length==1&&yt(xe))return G.plant(xe).value();for(var Ae=0,Oe=m?a[Ae].apply(this,be):xe;++Ae<m;)Oe=a[Ae].call(this,Oe);return Oe}})}function Pi(o,a,m,$,D,j,G,J,oe,be){var xe=a&B,Ae=a&w,Oe=a&v,Ge=a&(P|R),at=a&re,wt=Oe?t:ri(o);function ut(){for(var $t=arguments.length,At=he($t),Dr=$t;Dr--;)At[Dr]=arguments[Dr];if(Ge)var yr=qn(ut),Ir=zu(At,yr);if($&&(At=fa(At,$,D,Ge)),j&&(At=la(At,j,G,Ge)),$t-=Ir,Ge&&$t<be){var Qt=cn(At,yr);return ba(o,a,Pi,ut.placeholder,m,At,Qt,J,oe,be-$t)}var Kr=Ae?m:this,on=Oe?Kr[o]:o;return $t=At.length,J?At=el(At,J):at&&$t>1&&At.reverse(),xe&&oe<$t&&(At.length=oe),this&&this!==ur&&this instanceof ut&&(on=wt||ri(on)),on.apply(Kr,At)}return ut}function ma(o,a){return function(m,$){return uf(m,o,a($),{})}}function Oi(o,a){return function(m,$){var D;if(m===t&&$===t)return a;if(m!==t&&(D=m),$!==t){if(D===t)return $;typeof m=="string"||typeof $=="string"?(m=Sr(m),$=Sr($)):(m=ra(m),$=ra($)),D=o(m,$)}return D}}function Fo(o){return en(function(a){return a=jt(a,Ar(nt())),vt(function(m){var $=this;return o(a,function(D){return Cr(D,$,m)})})})}function Ri(o,a){a=a===t?" ":Sr(a);var m=a.length;if(m<2)return m?$o(a,o):a;var $=$o(a,vi(o/Pn(a)));return kn(a)?pn(Ur($),0,o).join(""):$.slice(0,o)}function Rf(o,a,m,$){var D=a&w,j=ri(o);function G(){for(var J=-1,oe=arguments.length,be=-1,xe=$.length,Ae=he(xe+oe),Oe=this&&this!==ur&&this instanceof G?j:o;++be<xe;)Ae[be]=$[be];for(;oe--;)Ae[be++]=arguments[++J];return Cr(Oe,D?m:this,Ae)}return G}function wa(o){return function(a,m,$){return $&&typeof $!="number"&&pr(a,m,$)&&(m=$=t),a=nn(a),m===t?(m=a,a=0):m=nn(m),$=$===t?a<m?1:-1:nn($),bf(a,m,$,o)}}function Bi(o){return function(a,m){return typeof a=="string"&&typeof m=="string"||(a=Mr(a),m=Mr(m)),o(a,m)}}function ba(o,a,m,$,D,j,G,J,oe,be){var xe=a&P,Ae=xe?G:t,Oe=xe?t:G,Ge=xe?j:t,at=xe?t:j;a|=xe?F:k,a&=~(xe?k:F),a&C||(a&=-4);var wt=[o,a,D,Ge,Ae,at,Oe,J,oe,be],ut=m.apply(t,wt);return No(o)&&ka(ut,wt),ut.placeholder=$,Pa(ut,o,a)}function ko(o){var a=rr[o];return function(m,$){if(m=Mr(m),$=$==null?0:lr(_t($),292),$&&Fs(m)){var D=(It(m)+"e").split("e"),j=a(D[0]+"e"+(+D[1]+$));return D=(It(j)+"e").split("e"),+(D[0]+"e"+(+D[1]-$))}return a(m)}}var Bf=Bn&&1/li(new Bn([,-0]))[1]==Ee?function(o){return new Bn(o)}:es;function va(o){return function(a){var m=dr(a);return m==qt?ao(a):m==kt?Xu(a):Ku(a,o(a))}}function Zr(o,a,m,$,D,j,G,J){var oe=a&v;if(!oe&&typeof o!="function")throw new Pr(u);var be=$?$.length:0;if(be||(a&=-97,$=D=t),G=G===t?G:nr(_t(G),0),J=J===t?J:_t(J),be-=D?D.length:0,a&k){var xe=$,Ae=D;$=D=t}var Oe=oe?t:Ro(o),Ge=[o,a,m,$,D,xe,Ae,j,G,J];if(Oe&&Xf(Ge,Oe),o=Ge[0],a=Ge[1],m=Ge[2],$=Ge[3],D=Ge[4],J=Ge[9]=Ge[9]===t?oe?0:o.length:nr(Ge[9]-be,0),!J&&a&(P|R)&&(a&=-25),!a||a==w)var at=Pf(o,a,m);else a==P||a==R?at=Of(o,a,J):(a==F||a==(w|F))&&!D.length?at=Rf(o,a,m,$):at=Pi.apply(t,Ge);var wt=Oe?ea:ka;return Pa(wt(at,Ge),o,a)}function xa(o,a,m,$){return o===t||jr(o,Rn[m])&&!Ft.call($,m)?a:o}function Ea(o,a,m,$,D,j){return zt(o)&&zt(a)&&(j.set(a,o),Di(o,a,t,Ea,j),j.delete(a)),o}function Lf(o){return oi(o)?t:o}function $a(o,a,m,$,D,j){var G=m&p,J=o.length,oe=a.length;if(J!=oe&&!(G&&oe>J))return!1;var be=j.get(o),xe=j.get(a);if(be&&xe)return be==a&&xe==o;var Ae=-1,Oe=!0,Ge=m&y?new vn:t;for(j.set(o,a),j.set(a,o);++Ae<J;){var at=o[Ae],wt=a[Ae];if($)var ut=G?$(wt,at,Ae,a,o,j):$(at,wt,Ae,o,a,j);if(ut!==t){if(ut)continue;Oe=!1;break}if(Ge){if(!to(a,function($t,At){if(!Hn(Ge,At)&&(at===$t||D(at,$t,m,$,j)))return Ge.push(At)})){Oe=!1;break}}else if(!(at===wt||D(at,wt,m,$,j))){Oe=!1;break}}return j.delete(o),j.delete(a),Oe}function Mf(o,a,m,$,D,j,G){switch(m){case b:if(o.byteLength!=a.byteLength||o.byteOffset!=a.byteOffset)return!1;o=o.buffer,a=a.buffer;case S:return!(o.byteLength!=a.byteLength||!j(new mi(o),new mi(a)));case bt:case Nt:case Xt:return jr(+o,+a);case Ut:return o.name==a.name&&o.message==a.message;case er:case Rt:return o==a+"";case qt:var J=ao;case kt:var oe=$&p;if(J||(J=li),o.size!=a.size&&!oe)return!1;var be=G.get(o);if(be)return be==a;$|=y,G.set(o,a);var xe=$a(J(o),J(a),$,D,j,G);return G.delete(o),xe;case ar:if(Yn)return Yn.call(o)==Yn.call(a)}return!1}function Nf(o,a,m,$,D,j){var G=m&p,J=Po(o),oe=J.length,be=Po(a),xe=be.length;if(oe!=xe&&!G)return!1;for(var Ae=oe;Ae--;){var Oe=J[Ae];if(!(G?Oe in a:Ft.call(a,Oe)))return!1}var Ge=j.get(o),at=j.get(a);if(Ge&&at)return Ge==a&&at==o;var wt=!0;j.set(o,a),j.set(a,o);for(var ut=G;++Ae<oe;){Oe=J[Ae];var $t=o[Oe],At=a[Oe];if($)var Dr=G?$(At,$t,Oe,a,o,j):$($t,At,Oe,o,a,j);if(!(Dr===t?$t===At||D($t,At,m,$,j):Dr)){wt=!1;break}ut||(ut=Oe=="constructor")}if(wt&&!ut){var yr=o.constructor,Ir=a.constructor;yr!=Ir&&"constructor"in o&&"constructor"in a&&!(typeof yr=="function"&&yr instanceof yr&&typeof Ir=="function"&&Ir instanceof Ir)&&(wt=!1)}return j.delete(o),j.delete(a),wt}function en(o){return qo(Ia(o,t,Na),o+"")}function Po(o){return Ks(o,ir,Lo)}function Oo(o){return Ks(o,vr,Ca)}var Ro=Ei?function(o){return Ei.get(o)}:es;function Li(o){for(var a=o.name+"",m=Ln[a],$=Ft.call(Ln,a)?m.length:0;$--;){var D=m[$],j=D.func;if(j==null||j==o)return D.name}return a}function qn(o){var a=Ft.call(M,"placeholder")?M:o;return a.placeholder}function nt(){var o=M.iteratee||Jo;return o=o===Jo?Ws:o,arguments.length?o(arguments[0],arguments[1]):o}function Mi(o,a){var m=o.__data__;return Vf(a)?m[typeof a=="string"?"string":"hash"]:m.map}function Bo(o){for(var a=ir(o),m=a.length;m--;){var $=a[m],D=o[$];a[m]=[$,D,Ta(D)]}return a}function $n(o,a){var m=Gu(o,a);return Hs(m)?m:t}function Uf(o){var a=Ft.call(o,wn),m=o[wn];try{o[wn]=t;var $=!0}catch{}var D=yi.call(o);return $&&(a?o[wn]=m:delete o[wn]),D}var Lo=co?function(o){return o==null?[]:(o=Pt(o),an(co(o),function(a){return Ds.call(o,a)}))}:ts,Ca=co?function(o){for(var a=[];o;)un(a,Lo(o)),o=_i(o);return a}:ts,dr=hr;(fo&&dr(new fo(new ArrayBuffer(1)))!=b||Vn&&dr(new Vn)!=qt||lo&&dr(lo.resolve())!=mr||Bn&&dr(new Bn)!=kt||Gn&&dr(new Gn)!=Bt)&&(dr=function(o){var a=hr(o),m=a==Wt?o.constructor:t,$=m?Cn(m):"";if($)switch($){case vc:return b;case xc:return qt;case Ec:return mr;case $c:return kt;case Cc:return Bt}return a});function qf(o,a,m){for(var $=-1,D=m.length;++$<D;){var j=m[$],G=j.size;switch(j.type){case"drop":o+=G;break;case"dropRight":a-=G;break;case"take":a=lr(a,o+G);break;case"takeRight":o=nr(o,a-G);break}}return{start:o,end:a}}function jf(o){var a=o.match(x);return a?a[1].split(K):[]}function Aa(o,a,m){a=hn(a,o);for(var $=-1,D=a.length,j=!1;++$<D;){var G=Gr(a[$]);if(!(j=o!=null&&m(o,G)))break;o=o[G]}return j||++$!=D?j:(D=o==null?0:o.length,!!D&&Hi(D)&&tn(G,D)&&(yt(o)||An(o)))}function Kf(o){var a=o.length,m=new o.constructor(a);return a&&typeof o[0]=="string"&&Ft.call(o,"index")&&(m.index=o.index,m.input=o.input),m}function Sa(o){return typeof o.constructor=="function"&&!ni(o)?Mn(_i(o)):{}}function zf(o,a,m){var $=o.constructor;switch(a){case S:return Io(o);case bt:case Nt:return new $(+o);case b:return Sf(o,m);case E:case q:case X:case Z:case se:case Se:case qe:case Ue:case ht:return ua(o,m);case qt:return new $;case Xt:case Rt:return new $(o);case er:return Tf(o);case kt:return new $;case ar:return Df(o)}}function Hf(o,a){var m=a.length;if(!m)return o;var $=m-1;return a[$]=(m>1?"& ":"")+a[$],a=a.join(m>2?", ":" "),o.replace(O,`{
/* [wrapped with `+a+`] */
`)}function Wf(o){return yt(o)||An(o)||!!(Is&&o&&o[Is])}function tn(o,a){var m=typeof o;return a=a??z,!!a&&(m=="number"||m!="symbol"&&ot.test(o))&&o>-1&&o%1==0&&o<a}function pr(o,a,m){if(!zt(m))return!1;var $=typeof a;return($=="number"?br(m)&&tn(a,m.length):$=="string"&&a in m)?jr(m[a],o):!1}function Mo(o,a){if(yt(o))return!1;var m=typeof o;return m=="number"||m=="symbol"||m=="boolean"||o==null||Tr(o)?!0:Dn.test(o)||!mn.test(o)||a!=null&&o in Pt(a)}function Vf(o){var a=typeof o;return a=="string"||a=="number"||a=="symbol"||a=="boolean"?o!=="__proto__":o===null}function No(o){var a=Li(o),m=M[a];if(typeof m!="function"||!(a in Ct.prototype))return!1;if(o===m)return!0;var $=Ro(m);return!!$&&o===$[0]}function Gf(o){return!!As&&As in o}var Qf=hi?rn:rs;function ni(o){var a=o&&o.constructor,m=typeof a=="function"&&a.prototype||Rn;return o===m}function Ta(o){return o===o&&!zt(o)}function Da(o,a){return function(m){return m==null?!1:m[o]===a&&(a!==t||o in Pt(m))}}function Yf(o){var a=Ki(o,function($){return m.size===g&&m.clear(),$}),m=a.cache;return a}function Xf(o,a){var m=o[1],$=a[1],D=m|$,j=D<(w|v|B),G=$==B&&m==P||$==B&&m==H&&o[7].length<=a[8]||$==(B|H)&&a[7].length<=a[8]&&m==P;if(!(j||G))return o;$&w&&(o[2]=a[2],D|=m&w?0:C);var J=a[3];if(J){var oe=o[3];o[3]=oe?fa(oe,J,a[4]):J,o[4]=oe?cn(o[3],_):a[4]}return J=a[5],J&&(oe=o[5],o[5]=oe?la(oe,J,a[6]):J,o[6]=oe?cn(o[5],_):a[6]),J=a[7],J&&(o[7]=J),$&B&&(o[8]=o[8]==null?a[8]:lr(o[8],a[8])),o[9]==null&&(o[9]=a[9]),o[0]=a[0],o[1]=D,o}function Jf(o){var a=[];if(o!=null)for(var m in Pt(o))a.push(m);return a}function Zf(o){return yi.call(o)}function Ia(o,a,m){return a=nr(a===t?o.length-1:a,0),function(){for(var $=arguments,D=-1,j=nr($.length-a,0),G=he(j);++D<j;)G[D]=$[a+D];D=-1;for(var J=he(a+1);++D<a;)J[D]=$[D];return J[a]=m(G),Cr(o,this,J)}}function Fa(o,a){return a.length<2?o:En(o,Br(a,0,-1))}function el(o,a){for(var m=o.length,$=lr(a.length,m),D=wr(o);$--;){var j=a[$];o[$]=tn(j,m)?D[j]:t}return o}function Uo(o,a){if(!(a==="constructor"&&typeof o[a]=="function")&&a!="__proto__")return o[a]}var ka=Oa(ea),ii=hc||function(o,a){return ur.setTimeout(o,a)},qo=Oa(Ef);function Pa(o,a,m){var $=a+"";return qo(o,Hf($,tl(jf($),m)))}function Oa(o){var a=0,m=0;return function(){var $=_c(),D=ct-($-m);if(m=$,D>0){if(++a>=He)return arguments[0]}else a=0;return o.apply(t,arguments)}}function Ni(o,a){var m=-1,$=o.length,D=$-1;for(a=a===t?$:a;++m<a;){var j=Eo(m,D),G=o[j];o[j]=o[m],o[m]=G}return o.length=a,o}var Ra=Yf(function(o){var a=[];return o.charCodeAt(0)===46&&a.push(""),o.replace(zn,function(m,$,D,j){a.push(D?j.replace(we,"$1"):$||m)}),a});function Gr(o){if(typeof o=="string"||Tr(o))return o;var a=o+"";return a=="0"&&1/o==-1/0?"-0":a}function Cn(o){if(o!=null){try{return pi.call(o)}catch{}try{return o+""}catch{}}return""}function tl(o,a){return kr(it,function(m){var $="_."+m[0];a&m[1]&&!ci(o,$)&&o.push($)}),o.sort()}function Ba(o){if(o instanceof Ct)return o.clone();var a=new Or(o.__wrapped__,o.__chain__);return a.__actions__=wr(o.__actions__),a.__index__=o.__index__,a.__values__=o.__values__,a}function rl(o,a,m){(m?pr(o,a,m):a===t)?a=1:a=nr(_t(a),0);var $=o==null?0:o.length;if(!$||a<1)return[];for(var D=0,j=0,G=he(vi($/a));D<$;)G[j++]=Br(o,D,D+=a);return G}function nl(o){for(var a=-1,m=o==null?0:o.length,$=0,D=[];++a<m;){var j=o[a];j&&(D[$++]=j)}return D}function il(){var o=arguments.length;if(!o)return[];for(var a=he(o-1),m=arguments[0],$=o;$--;)a[$-1]=arguments[$];return un(yt(m)?wr(m):[m],cr(a,1))}var ol=vt(function(o,a){return Gt(o)?Jn(o,cr(a,1,Gt,!0)):[]}),sl=vt(function(o,a){var m=Lr(a);return Gt(m)&&(m=t),Gt(o)?Jn(o,cr(a,1,Gt,!0),nt(m,2)):[]}),al=vt(function(o,a){var m=Lr(a);return Gt(m)&&(m=t),Gt(o)?Jn(o,cr(a,1,Gt,!0),t,m):[]});function ul(o,a,m){var $=o==null?0:o.length;return $?(a=m||a===t?1:_t(a),Br(o,a<0?0:a,$)):[]}function cl(o,a,m){var $=o==null?0:o.length;return $?(a=m||a===t?1:_t(a),a=$-a,Br(o,0,a<0?0:a)):[]}function fl(o,a){return o&&o.length?Fi(o,nt(a,3),!0,!0):[]}function ll(o,a){return o&&o.length?Fi(o,nt(a,3),!0):[]}function dl(o,a,m,$){var D=o==null?0:o.length;return D?(m&&typeof m!="number"&&pr(o,a,m)&&(m=0,$=D),nf(o,a,m,$)):[]}function La(o,a,m){var $=o==null?0:o.length;if(!$)return-1;var D=m==null?0:_t(m);return D<0&&(D=nr($+D,0)),fi(o,nt(a,3),D)}function Ma(o,a,m){var $=o==null?0:o.length;if(!$)return-1;var D=$-1;return m!==t&&(D=_t(m),D=m<0?nr($+D,0):lr(D,$-1)),fi(o,nt(a,3),D,!0)}function Na(o){var a=o==null?0:o.length;return a?cr(o,1):[]}function hl(o){var a=o==null?0:o.length;return a?cr(o,Ee):[]}function pl(o,a){var m=o==null?0:o.length;return m?(a=a===t?1:_t(a),cr(o,a)):[]}function yl(o){for(var a=-1,m=o==null?0:o.length,$={};++a<m;){var D=o[a];$[D[0]]=D[1]}return $}function Ua(o){return o&&o.length?o[0]:t}function gl(o,a,m){var $=o==null?0:o.length;if(!$)return-1;var D=m==null?0:_t(m);return D<0&&(D=nr($+D,0)),Fn(o,a,D)}function ml(o){var a=o==null?0:o.length;return a?Br(o,0,-1):[]}var _l=vt(function(o){var a=jt(o,To);return a.length&&a[0]===o[0]?_o(a):[]}),wl=vt(function(o){var a=Lr(o),m=jt(o,To);return a===Lr(m)?a=t:m.pop(),m.length&&m[0]===o[0]?_o(m,nt(a,2)):[]}),bl=vt(function(o){var a=Lr(o),m=jt(o,To);return a=typeof a=="function"?a:t,a&&m.pop(),m.length&&m[0]===o[0]?_o(m,t,a):[]});function vl(o,a){return o==null?"":yc.call(o,a)}function Lr(o){var a=o==null?0:o.length;return a?o[a-1]:t}function xl(o,a,m){var $=o==null?0:o.length;if(!$)return-1;var D=$;return m!==t&&(D=_t(m),D=D<0?nr($+D,0):lr(D,$-1)),a===a?Zu(o,a,D):fi(o,_s,D,!0)}function El(o,a){return o&&o.length?Ys(o,_t(a)):t}var $l=vt(qa);function qa(o,a){return o&&o.length&&a&&a.length?xo(o,a):o}function Cl(o,a,m){return o&&o.length&&a&&a.length?xo(o,a,nt(m,2)):o}function Al(o,a,m){return o&&o.length&&a&&a.length?xo(o,a,t,m):o}var Sl=en(function(o,a){var m=o==null?0:o.length,$=po(o,a);return Zs(o,jt(a,function(D){return tn(D,m)?+D:D}).sort(ca)),$});function Tl(o,a){var m=[];if(!(o&&o.length))return m;var $=-1,D=[],j=o.length;for(a=nt(a,3);++$<j;){var G=o[$];a(G,$,o)&&(m.push(G),D.push($))}return Zs(o,D),m}function jo(o){return o==null?o:bc.call(o)}function Dl(o,a,m){var $=o==null?0:o.length;return $?(m&&typeof m!="number"&&pr(o,a,m)?(a=0,m=$):(a=a==null?0:_t(a),m=m===t?$:_t(m)),Br(o,a,m)):[]}function Il(o,a){return Ii(o,a)}function Fl(o,a,m){return Co(o,a,nt(m,2))}function kl(o,a){var m=o==null?0:o.length;if(m){var $=Ii(o,a);if($<m&&jr(o[$],a))return $}return-1}function Pl(o,a){return Ii(o,a,!0)}function Ol(o,a,m){return Co(o,a,nt(m,2),!0)}function Rl(o,a){var m=o==null?0:o.length;if(m){var $=Ii(o,a,!0)-1;if(jr(o[$],a))return $}return-1}function Ll(o){return o&&o.length?ta(o):[]}function Ml(o,a){return o&&o.length?ta(o,nt(a,2)):[]}function Nl(o){var a=o==null?0:o.length;return a?Br(o,1,a):[]}function Ul(o,a,m){return o&&o.length?(a=m||a===t?1:_t(a),Br(o,0,a<0?0:a)):[]}function ql(o,a,m){var $=o==null?0:o.length;return $?(a=m||a===t?1:_t(a),a=$-a,Br(o,a<0?0:a,$)):[]}function jl(o,a){return o&&o.length?Fi(o,nt(a,3),!1,!0):[]}function Kl(o,a){return o&&o.length?Fi(o,nt(a,3)):[]}var zl=vt(function(o){return dn(cr(o,1,Gt,!0))}),Hl=vt(function(o){var a=Lr(o);return Gt(a)&&(a=t),dn(cr(o,1,Gt,!0),nt(a,2))}),Wl=vt(function(o){var a=Lr(o);return a=typeof a=="function"?a:t,dn(cr(o,1,Gt,!0),t,a)});function Vl(o){return o&&o.length?dn(o):[]}function Gl(o,a){return o&&o.length?dn(o,nt(a,2)):[]}function Ql(o,a){return a=typeof a=="function"?a:t,o&&o.length?dn(o,t,a):[]}function Ko(o){if(!(o&&o.length))return[];var a=0;return o=an(o,function(m){if(Gt(m))return a=nr(m.length,a),!0}),oo(a,function(m){return jt(o,ro(m))})}function ja(o,a){if(!(o&&o.length))return[];var m=Ko(o);return a==null?m:jt(m,function($){return Cr(a,t,$)})}var Yl=vt(function(o,a){return Gt(o)?Jn(o,a):[]}),Xl=vt(function(o){return So(an(o,Gt))}),Jl=vt(function(o){var a=Lr(o);return Gt(a)&&(a=t),So(an(o,Gt),nt(a,2))}),Zl=vt(function(o){var a=Lr(o);return a=typeof a=="function"?a:t,So(an(o,Gt),t,a)}),ed=vt(Ko);function td(o,a){return oa(o||[],a||[],Xn)}function rd(o,a){return oa(o||[],a||[],ti)}var nd=vt(function(o){var a=o.length,m=a>1?o[a-1]:t;return m=typeof m=="function"?(o.pop(),m):t,ja(o,m)});function Ka(o){var a=M(o);return a.__chain__=!0,a}function id(o,a){return a(o),o}function Ui(o,a){return a(o)}var od=en(function(o){var a=o.length,m=a?o[0]:0,$=this.__wrapped__,D=function(j){return po(j,o)};return a>1||this.__actions__.length||!($ instanceof Ct)||!tn(m)?this.thru(D):($=$.slice(m,+m+(a?1:0)),$.__actions__.push({func:Ui,args:[D],thisArg:t}),new Or($,this.__chain__).thru(function(j){return a&&!j.length&&j.push(t),j}))});function sd(){return Ka(this)}function ad(){return new Or(this.value(),this.__chain__)}function ud(){this.__values__===t&&(this.__values__=nu(this.value()));var o=this.__index__>=this.__values__.length,a=o?t:this.__values__[this.__index__++];return{done:o,value:a}}function cd(){return this}function fd(o){for(var a,m=this;m instanceof Ci;){var $=Ba(m);$.__index__=0,$.__values__=t,a?D.__wrapped__=$:a=$;var D=$;m=m.__wrapped__}return D.__wrapped__=o,a}function ld(){var o=this.__wrapped__;if(o instanceof Ct){var a=o;return this.__actions__.length&&(a=new Ct(this)),a=a.reverse(),a.__actions__.push({func:Ui,args:[jo],thisArg:t}),new Or(a,this.__chain__)}return this.thru(jo)}function dd(){return ia(this.__wrapped__,this.__actions__)}var hd=ki(function(o,a,m){Ft.call(o,m)?++o[m]:Jr(o,m,1)});function pd(o,a,m){var $=yt(o)?ys:rf;return m&&pr(o,a,m)&&(a=t),$(o,nt(a,3))}function yd(o,a){var m=yt(o)?an:qs;return m(o,nt(a,3))}var gd=ya(La),md=ya(Ma);function _d(o,a){return cr(qi(o,a),1)}function wd(o,a){return cr(qi(o,a),Ee)}function bd(o,a,m){return m=m===t?1:_t(m),cr(qi(o,a),m)}function za(o,a){var m=yt(o)?kr:ln;return m(o,nt(a,3))}function Ha(o,a){var m=yt(o)?Bu:Us;return m(o,nt(a,3))}var vd=ki(function(o,a,m){Ft.call(o,m)?o[m].push(a):Jr(o,m,[a])});function xd(o,a,m,$){o=br(o)?o:Kn(o),m=m&&!$?_t(m):0;var D=o.length;return m<0&&(m=nr(D+m,0)),Wi(o)?m<=D&&o.indexOf(a,m)>-1:!!D&&Fn(o,a,m)>-1}var Ed=vt(function(o,a,m){var $=-1,D=typeof a=="function",j=br(o)?he(o.length):[];return ln(o,function(G){j[++$]=D?Cr(a,G,m):Zn(G,a,m)}),j}),$d=ki(function(o,a,m){Jr(o,m,a)});function qi(o,a){var m=yt(o)?jt:Vs;return m(o,nt(a,3))}function Cd(o,a,m,$){return o==null?[]:(yt(a)||(a=a==null?[]:[a]),m=$?t:m,yt(m)||(m=m==null?[]:[m]),Xs(o,a,m))}var Ad=ki(function(o,a,m){o[m?0:1].push(a)},function(){return[[],[]]});function Sd(o,a,m){var $=yt(o)?eo:bs,D=arguments.length<3;return $(o,nt(a,4),m,D,ln)}function Td(o,a,m){var $=yt(o)?Lu:bs,D=arguments.length<3;return $(o,nt(a,4),m,D,Us)}function Dd(o,a){var m=yt(o)?an:qs;return m(o,zi(nt(a,3)))}function Id(o){var a=yt(o)?Bs:vf;return a(o)}function Fd(o,a,m){(m?pr(o,a,m):a===t)?a=1:a=_t(a);var $=yt(o)?Xc:xf;return $(o,a)}function kd(o){var a=yt(o)?Jc:$f;return a(o)}function Pd(o){if(o==null)return 0;if(br(o))return Wi(o)?Pn(o):o.length;var a=dr(o);return a==qt||a==kt?o.size:bo(o).length}function Od(o,a,m){var $=yt(o)?to:Cf;return m&&pr(o,a,m)&&(a=t),$(o,nt(a,3))}var Rd=vt(function(o,a){if(o==null)return[];var m=a.length;return m>1&&pr(o,a[0],a[1])?a=[]:m>2&&pr(a[0],a[1],a[2])&&(a=[a[0]]),Xs(o,cr(a,1),[])}),ji=dc||function(){return ur.Date.now()};function Bd(o,a){if(typeof a!="function")throw new Pr(u);return o=_t(o),function(){if(--o<1)return a.apply(this,arguments)}}function Wa(o,a,m){return a=m?t:a,a=o&&a==null?o.length:a,Zr(o,B,t,t,t,t,a)}function Va(o,a){var m;if(typeof a!="function")throw new Pr(u);return o=_t(o),function(){return--o>0&&(m=a.apply(this,arguments)),o<=1&&(a=t),m}}var zo=vt(function(o,a,m){var $=w;if(m.length){var D=cn(m,qn(zo));$|=F}return Zr(o,$,a,m,D)}),Ga=vt(function(o,a,m){var $=w|v;if(m.length){var D=cn(m,qn(Ga));$|=F}return Zr(a,$,o,m,D)});function Qa(o,a,m){a=m?t:a;var $=Zr(o,P,t,t,t,t,t,a);return $.placeholder=Qa.placeholder,$}function Ya(o,a,m){a=m?t:a;var $=Zr(o,R,t,t,t,t,t,a);return $.placeholder=Ya.placeholder,$}function Xa(o,a,m){var $,D,j,G,J,oe,be=0,xe=!1,Ae=!1,Oe=!0;if(typeof o!="function")throw new Pr(u);a=Mr(a)||0,zt(m)&&(xe=!!m.leading,Ae="maxWait"in m,j=Ae?nr(Mr(m.maxWait)||0,a):j,Oe="trailing"in m?!!m.trailing:Oe);function Ge(Qt){var Kr=$,on=D;return $=D=t,be=Qt,G=o.apply(on,Kr),G}function at(Qt){return be=Qt,J=ii($t,a),xe?Ge(Qt):G}function wt(Qt){var Kr=Qt-oe,on=Qt-be,gu=a-Kr;return Ae?lr(gu,j-on):gu}function ut(Qt){var Kr=Qt-oe,on=Qt-be;return oe===t||Kr>=a||Kr<0||Ae&&on>=j}function $t(){var Qt=ji();if(ut(Qt))return At(Qt);J=ii($t,wt(Qt))}function At(Qt){return J=t,Oe&&$?Ge(Qt):($=D=t,G)}function Dr(){J!==t&&sa(J),be=0,$=oe=D=J=t}function yr(){return J===t?G:At(ji())}function Ir(){var Qt=ji(),Kr=ut(Qt);if($=arguments,D=this,oe=Qt,Kr){if(J===t)return at(oe);if(Ae)return sa(J),J=ii($t,a),Ge(oe)}return J===t&&(J=ii($t,a)),G}return Ir.cancel=Dr,Ir.flush=yr,Ir}var Ld=vt(function(o,a){return Ns(o,1,a)}),Md=vt(function(o,a,m){return Ns(o,Mr(a)||0,m)});function Nd(o){return Zr(o,re)}function Ki(o,a){if(typeof o!="function"||a!=null&&typeof a!="function")throw new Pr(u);var m=function(){var $=arguments,D=a?a.apply(this,$):$[0],j=m.cache;if(j.has(D))return j.get(D);var G=o.apply(this,$);return m.cache=j.set(D,G)||j,G};return m.cache=new(Ki.Cache||Xr),m}Ki.Cache=Xr;function zi(o){if(typeof o!="function")throw new Pr(u);return function(){var a=arguments;switch(a.length){case 0:return!o.call(this);case 1:return!o.call(this,a[0]);case 2:return!o.call(this,a[0],a[1]);case 3:return!o.call(this,a[0],a[1],a[2])}return!o.apply(this,a)}}function Ud(o){return Va(2,o)}var qd=Af(function(o,a){a=a.length==1&&yt(a[0])?jt(a[0],Ar(nt())):jt(cr(a,1),Ar(nt()));var m=a.length;return vt(function($){for(var D=-1,j=lr($.length,m);++D<j;)$[D]=a[D].call(this,$[D]);return Cr(o,this,$)})}),Ho=vt(function(o,a){var m=cn(a,qn(Ho));return Zr(o,F,t,a,m)}),Ja=vt(function(o,a){var m=cn(a,qn(Ja));return Zr(o,k,t,a,m)}),jd=en(function(o,a){return Zr(o,H,t,t,t,a)});function Kd(o,a){if(typeof o!="function")throw new Pr(u);return a=a===t?a:_t(a),vt(o,a)}function zd(o,a){if(typeof o!="function")throw new Pr(u);return a=a==null?0:nr(_t(a),0),vt(function(m){var $=m[a],D=pn(m,0,a);return $&&un(D,$),Cr(o,this,D)})}function Hd(o,a,m){var $=!0,D=!0;if(typeof o!="function")throw new Pr(u);return zt(m)&&($="leading"in m?!!m.leading:$,D="trailing"in m?!!m.trailing:D),Xa(o,a,{leading:$,maxWait:a,trailing:D})}function Wd(o){return Wa(o,1)}function Vd(o,a){return Ho(Do(a),o)}function Gd(){if(!arguments.length)return[];var o=arguments[0];return yt(o)?o:[o]}function Qd(o){return Rr(o,h)}function Yd(o,a){return a=typeof a=="function"?a:t,Rr(o,h,a)}function Xd(o){return Rr(o,f|h)}function Jd(o,a){return a=typeof a=="function"?a:t,Rr(o,f|h,a)}function Zd(o,a){return a==null||Ms(o,a,ir(a))}function jr(o,a){return o===a||o!==o&&a!==a}var eh=Bi(mo),th=Bi(function(o,a){return o>=a}),An=zs(function(){return arguments}())?zs:function(o){return Ht(o)&&Ft.call(o,"callee")&&!Ds.call(o,"callee")},yt=he.isArray,rh=us?Ar(us):cf;function br(o){return o!=null&&Hi(o.length)&&!rn(o)}function Gt(o){return Ht(o)&&br(o)}function nh(o){return o===!0||o===!1||Ht(o)&&hr(o)==bt}var yn=pc||rs,ih=cs?Ar(cs):ff;function oh(o){return Ht(o)&&o.nodeType===1&&!oi(o)}function sh(o){if(o==null)return!0;if(br(o)&&(yt(o)||typeof o=="string"||typeof o.splice=="function"||yn(o)||jn(o)||An(o)))return!o.length;var a=dr(o);if(a==qt||a==kt)return!o.size;if(ni(o))return!bo(o).length;for(var m in o)if(Ft.call(o,m))return!1;return!0}function ah(o,a){return ei(o,a)}function uh(o,a,m){m=typeof m=="function"?m:t;var $=m?m(o,a):t;return $===t?ei(o,a,t,m):!!$}function Wo(o){if(!Ht(o))return!1;var a=hr(o);return a==Ut||a==fr||typeof o.message=="string"&&typeof o.name=="string"&&!oi(o)}function ch(o){return typeof o=="number"&&Fs(o)}function rn(o){if(!zt(o))return!1;var a=hr(o);return a==Yt||a==Zt||a==Dt||a==sr}function Za(o){return typeof o=="number"&&o==_t(o)}function Hi(o){return typeof o=="number"&&o>-1&&o%1==0&&o<=z}function zt(o){var a=typeof o;return o!=null&&(a=="object"||a=="function")}function Ht(o){return o!=null&&typeof o=="object"}var eu=fs?Ar(fs):df;function fh(o,a){return o===a||wo(o,a,Bo(a))}function lh(o,a,m){return m=typeof m=="function"?m:t,wo(o,a,Bo(a),m)}function dh(o){return tu(o)&&o!=+o}function hh(o){if(Qf(o))throw new pt(s);return Hs(o)}function ph(o){return o===null}function yh(o){return o==null}function tu(o){return typeof o=="number"||Ht(o)&&hr(o)==Xt}function oi(o){if(!Ht(o)||hr(o)!=Wt)return!1;var a=_i(o);if(a===null)return!0;var m=Ft.call(a,"constructor")&&a.constructor;return typeof m=="function"&&m instanceof m&&pi.call(m)==uc}var Vo=ds?Ar(ds):hf;function gh(o){return Za(o)&&o>=-9007199254740991&&o<=z}var ru=hs?Ar(hs):pf;function Wi(o){return typeof o=="string"||!yt(o)&&Ht(o)&&hr(o)==Rt}function Tr(o){return typeof o=="symbol"||Ht(o)&&hr(o)==ar}var jn=ps?Ar(ps):yf;function mh(o){return o===t}function _h(o){return Ht(o)&&dr(o)==Bt}function wh(o){return Ht(o)&&hr(o)==ce}var bh=Bi(vo),vh=Bi(function(o,a){return o<=a});function nu(o){if(!o)return[];if(br(o))return Wi(o)?Ur(o):wr(o);if(Wn&&o[Wn])return Yu(o[Wn]());var a=dr(o),m=a==qt?ao:a==kt?li:Kn;return m(o)}function nn(o){if(!o)return o===0?o:0;if(o=Mr(o),o===Ee||o===-1/0){var a=o<0?-1:1;return a*ne}return o===o?o:0}function _t(o){var a=nn(o),m=a%1;return a===a?m?a-m:a:0}function iu(o){return o?xn(_t(o),0,ve):0}function Mr(o){if(typeof o=="number")return o;if(Tr(o))return ee;if(zt(o)){var a=typeof o.valueOf=="function"?o.valueOf():o;o=zt(a)?a+"":a}if(typeof o!="string")return o===0?o:+o;o=vs(o);var m=Et.test(o);return m||Ze.test(o)?Pu(o.slice(2),m?2:8):ke.test(o)?ee:+o}function ou(o){return Vr(o,vr(o))}function xh(o){return o?xn(_t(o),-9007199254740991,z):o===0?o:0}function It(o){return o==null?"":Sr(o)}var Eh=Nn(function(o,a){if(ni(a)||br(a)){Vr(a,ir(a),o);return}for(var m in a)Ft.call(a,m)&&Xn(o,m,a[m])}),su=Nn(function(o,a){Vr(a,vr(a),o)}),Vi=Nn(function(o,a,m,$){Vr(a,vr(a),o,$)}),$h=Nn(function(o,a,m,$){Vr(a,ir(a),o,$)}),Ch=en(po);function Ah(o,a){var m=Mn(o);return a==null?m:Ls(m,a)}var Sh=vt(function(o,a){o=Pt(o);var m=-1,$=a.length,D=$>2?a[2]:t;for(D&&pr(a[0],a[1],D)&&($=1);++m<$;)for(var j=a[m],G=vr(j),J=-1,oe=G.length;++J<oe;){var be=G[J],xe=o[be];(xe===t||jr(xe,Rn[be])&&!Ft.call(o,be))&&(o[be]=j[be])}return o}),Th=vt(function(o){return o.push(t,Ea),Cr(au,t,o)});function Dh(o,a){return gs(o,nt(a,3),Wr)}function Ih(o,a){return gs(o,nt(a,3),go)}function Fh(o,a){return o==null?o:yo(o,nt(a,3),vr)}function kh(o,a){return o==null?o:js(o,nt(a,3),vr)}function Ph(o,a){return o&&Wr(o,nt(a,3))}function Oh(o,a){return o&&go(o,nt(a,3))}function Rh(o){return o==null?[]:Ti(o,ir(o))}function Bh(o){return o==null?[]:Ti(o,vr(o))}function Go(o,a,m){var $=o==null?t:En(o,a);return $===t?m:$}function Lh(o,a){return o!=null&&Aa(o,a,of)}function Qo(o,a){return o!=null&&Aa(o,a,sf)}var Mh=ma(function(o,a,m){a!=null&&typeof a.toString!="function"&&(a=yi.call(a)),o[a]=m},Xo(xr)),Nh=ma(function(o,a,m){a!=null&&typeof a.toString!="function"&&(a=yi.call(a)),Ft.call(o,a)?o[a].push(m):o[a]=[m]},nt),Uh=vt(Zn);function ir(o){return br(o)?Rs(o):bo(o)}function vr(o){return br(o)?Rs(o,!0):gf(o)}function qh(o,a){var m={};return a=nt(a,3),Wr(o,function($,D,j){Jr(m,a($,D,j),$)}),m}function jh(o,a){var m={};return a=nt(a,3),Wr(o,function($,D,j){Jr(m,D,a($,D,j))}),m}var Kh=Nn(function(o,a,m){Di(o,a,m)}),au=Nn(function(o,a,m,$){Di(o,a,m,$)}),zh=en(function(o,a){var m={};if(o==null)return m;var $=!1;a=jt(a,function(j){return j=hn(j,o),$||($=j.length>1),j}),Vr(o,Oo(o),m),$&&(m=Rr(m,f|l|h,Lf));for(var D=a.length;D--;)Ao(m,a[D]);return m});function Hh(o,a){return uu(o,zi(nt(a)))}var Wh=en(function(o,a){return o==null?{}:_f(o,a)});function uu(o,a){if(o==null)return{};var m=jt(Oo(o),function($){return[$]});return a=nt(a),Js(o,m,function($,D){return a($,D[0])})}function Vh(o,a,m){a=hn(a,o);var $=-1,D=a.length;for(D||(D=1,o=t);++$<D;){var j=o==null?t:o[Gr(a[$])];j===t&&($=D,j=m),o=rn(j)?j.call(o):j}return o}function Gh(o,a,m){return o==null?o:ti(o,a,m)}function Qh(o,a,m,$){return $=typeof $=="function"?$:t,o==null?o:ti(o,a,m,$)}var cu=va(ir),fu=va(vr);function Yh(o,a,m){var $=yt(o),D=$||yn(o)||jn(o);if(a=nt(a,4),m==null){var j=o&&o.constructor;D?m=$?new j:[]:zt(o)?m=rn(j)?Mn(_i(o)):{}:m={}}return(D?kr:Wr)(o,function(G,J,oe){return a(m,G,J,oe)}),m}function Xh(o,a){return o==null?!0:Ao(o,a)}function Jh(o,a,m){return o==null?o:na(o,a,Do(m))}function Zh(o,a,m,$){return $=typeof $=="function"?$:t,o==null?o:na(o,a,Do(m),$)}function Kn(o){return o==null?[]:so(o,ir(o))}function ep(o){return o==null?[]:so(o,vr(o))}function tp(o,a,m){return m===t&&(m=a,a=t),m!==t&&(m=Mr(m),m=m===m?m:0),a!==t&&(a=Mr(a),a=a===a?a:0),xn(Mr(o),a,m)}function rp(o,a,m){return a=nn(a),m===t?(m=a,a=0):m=nn(m),o=Mr(o),af(o,a,m)}function np(o,a,m){if(m&&typeof m!="boolean"&&pr(o,a,m)&&(a=m=t),m===t&&(typeof a=="boolean"?(m=a,a=t):typeof o=="boolean"&&(m=o,o=t)),o===t&&a===t?(o=0,a=1):(o=nn(o),a===t?(a=o,o=0):a=nn(a)),o>a){var $=o;o=a,a=$}if(m||o%1||a%1){var D=Ps();return lr(o+D*(a-o+ku("1e-"+((D+"").length-1))),a)}return Eo(o,a)}var ip=Un(function(o,a,m){return a=a.toLowerCase(),o+(m?lu(a):a)});function lu(o){return Yo(It(o).toLowerCase())}function du(o){return o=It(o),o&&o.replace(ft,Hu).replace(xu,"")}function op(o,a,m){o=It(o),a=Sr(a);var $=o.length;m=m===t?$:xn(_t(m),0,$);var D=m;return m-=a.length,m>=0&&o.slice(m,D)==a}function sp(o){return o=It(o),o&&$r.test(o)?o.replace(Sn,Wu):o}function ap(o){return o=It(o),o&&In.test(o)?o.replace(tr,"\\$&"):o}var up=Un(function(o,a,m){return o+(m?"-":"")+a.toLowerCase()}),cp=Un(function(o,a,m){return o+(m?" ":"")+a.toLowerCase()}),fp=pa("toLowerCase");function lp(o,a,m){o=It(o),a=_t(a);var $=a?Pn(o):0;if(!a||$>=a)return o;var D=(a-$)/2;return Ri(xi(D),m)+o+Ri(vi(D),m)}function dp(o,a,m){o=It(o),a=_t(a);var $=a?Pn(o):0;return a&&$<a?o+Ri(a-$,m):o}function hp(o,a,m){o=It(o),a=_t(a);var $=a?Pn(o):0;return a&&$<a?Ri(a-$,m)+o:o}function pp(o,a,m){return m||a==null?a=0:a&&(a=+a),wc(It(o).replace(A,""),a||0)}function yp(o,a,m){return(m?pr(o,a,m):a===t)?a=1:a=_t(a),$o(It(o),a)}function gp(){var o=arguments,a=It(o[0]);return o.length<3?a:a.replace(o[1],o[2])}var mp=Un(function(o,a,m){return o+(m?"_":"")+a.toLowerCase()});function _p(o,a,m){return m&&typeof m!="number"&&pr(o,a,m)&&(a=m=t),m=m===t?ve:m>>>0,m?(o=It(o),o&&(typeof a=="string"||a!=null&&!Vo(a))&&(a=Sr(a),!a&&kn(o))?pn(Ur(o),0,m):o.split(a,m)):[]}var wp=Un(function(o,a,m){return o+(m?" ":"")+Yo(a)});function bp(o,a,m){return o=It(o),m=m==null?0:xn(_t(m),0,o.length),a=Sr(a),o.slice(m,m+a.length)==a}function vp(o,a,m){var $=M.templateSettings;m&&pr(o,a,m)&&(a=t),o=It(o),a=Vi({},a,$,xa);var D=Vi({},a.imports,$.imports,xa),j=ir(D),G=so(D,j),J,oe,be=0,xe=a.interpolate||st,Ae="__p += '",Oe=uo((a.escape||st).source+"|"+xe.source+"|"+(xe===sn?Te:st).source+"|"+(a.evaluate||st).source+"|$","g"),Ge="//# sourceURL="+(Ft.call(a,"sourceURL")?(a.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Su+"]")+`
`;o.replace(Oe,function(ut,$t,At,Dr,yr,Ir){return At||(At=Dr),Ae+=o.slice(be,Ir).replace(et,Vu),$t&&(J=!0,Ae+=`' +
__e(`+$t+`) +
'`),yr&&(oe=!0,Ae+=`';
`+yr+`;
__p += '`),At&&(Ae+=`' +
((__t = (`+At+`)) == null ? '' : __t) +
'`),be=Ir+ut.length,ut}),Ae+=`';
`;var at=Ft.call(a,"variable")&&a.variable;if(!at)Ae=`with (obj) {
`+Ae+`
}
`;else if(ae.test(at))throw new pt(c);Ae=(oe?Ae.replace(mt,""):Ae).replace(Qr,"$1").replace(_r,"$1;"),Ae="function("+(at||"obj")+`) {
`+(at?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(J?", __e = _.escape":"")+(oe?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Ae+`return __p
}`;var wt=pu(function(){return Tt(j,Ge+"return "+Ae).apply(t,G)});if(wt.source=Ae,Wo(wt))throw wt;return wt}function xp(o){return It(o).toLowerCase()}function Ep(o){return It(o).toUpperCase()}function $p(o,a,m){if(o=It(o),o&&(m||a===t))return vs(o);if(!o||!(a=Sr(a)))return o;var $=Ur(o),D=Ur(a),j=xs($,D),G=Es($,D)+1;return pn($,j,G).join("")}function Cp(o,a,m){if(o=It(o),o&&(m||a===t))return o.slice(0,Cs(o)+1);if(!o||!(a=Sr(a)))return o;var $=Ur(o),D=Es($,Ur(a))+1;return pn($,0,D).join("")}function Ap(o,a,m){if(o=It(o),o&&(m||a===t))return o.replace(A,"");if(!o||!(a=Sr(a)))return o;var $=Ur(o),D=xs($,Ur(a));return pn($,D).join("")}function Sp(o,a){var m=le,$=me;if(zt(a)){var D="separator"in a?a.separator:D;m="length"in a?_t(a.length):m,$="omission"in a?Sr(a.omission):$}o=It(o);var j=o.length;if(kn(o)){var G=Ur(o);j=G.length}if(m>=j)return o;var J=m-Pn($);if(J<1)return $;var oe=G?pn(G,0,J).join(""):o.slice(0,J);if(D===t)return oe+$;if(G&&(J+=oe.length-J),Vo(D)){if(o.slice(J).search(D)){var be,xe=oe;for(D.global||(D=uo(D.source,It(We.exec(D))+"g")),D.lastIndex=0;be=D.exec(xe);)var Ae=be.index;oe=oe.slice(0,Ae===t?J:Ae)}}else if(o.indexOf(Sr(D),J)!=J){var Oe=oe.lastIndexOf(D);Oe>-1&&(oe=oe.slice(0,Oe))}return oe+$}function Tp(o){return o=It(o),o&&Tn.test(o)?o.replace(gn,ec):o}var Dp=Un(function(o,a,m){return o+(m?" ":"")+a.toUpperCase()}),Yo=pa("toUpperCase");function hu(o,a,m){return o=It(o),a=m?t:a,a===t?Qu(o)?nc(o):Uu(o):o.match(a)||[]}var pu=vt(function(o,a){try{return Cr(o,t,a)}catch(m){return Wo(m)?m:new pt(m)}}),Ip=en(function(o,a){return kr(a,function(m){m=Gr(m),Jr(o,m,zo(o[m],o))}),o});function Fp(o){var a=o==null?0:o.length,m=nt();return o=a?jt(o,function($){if(typeof $[1]!="function")throw new Pr(u);return[m($[0]),$[1]]}):[],vt(function($){for(var D=-1;++D<a;){var j=o[D];if(Cr(j[0],this,$))return Cr(j[1],this,$)}})}function kp(o){return tf(Rr(o,f))}function Xo(o){return function(){return o}}function Pp(o,a){return o==null||o!==o?a:o}var Op=ga(),Rp=ga(!0);function xr(o){return o}function Jo(o){return Ws(typeof o=="function"?o:Rr(o,f))}function Bp(o){return Gs(Rr(o,f))}function Lp(o,a){return Qs(o,Rr(a,f))}var Mp=vt(function(o,a){return function(m){return Zn(m,o,a)}}),Np=vt(function(o,a){return function(m){return Zn(o,m,a)}});function Zo(o,a,m){var $=ir(a),D=Ti(a,$);m==null&&!(zt(a)&&(D.length||!$.length))&&(m=a,a=o,o=this,D=Ti(a,ir(a)));var j=!(zt(m)&&"chain"in m)||!!m.chain,G=rn(o);return kr(D,function(J){var oe=a[J];o[J]=oe,G&&(o.prototype[J]=function(){var be=this.__chain__;if(j||be){var xe=o(this.__wrapped__),Ae=xe.__actions__=wr(this.__actions__);return Ae.push({func:oe,args:arguments,thisArg:o}),xe.__chain__=be,xe}return oe.apply(o,un([this.value()],arguments))})}),o}function Up(){return ur._===this&&(ur._=cc),this}function es(){}function qp(o){return o=_t(o),vt(function(a){return Ys(a,o)})}var jp=Fo(jt),Kp=Fo(ys),zp=Fo(to);function yu(o){return Mo(o)?ro(Gr(o)):wf(o)}function Hp(o){return function(a){return o==null?t:En(o,a)}}var Wp=wa(),Vp=wa(!0);function ts(){return[]}function rs(){return!1}function Gp(){return{}}function Qp(){return""}function Yp(){return!0}function Xp(o,a){if(o=_t(o),o<1||o>z)return[];var m=ve,$=lr(o,ve);a=nt(a),o-=ve;for(var D=oo($,a);++m<o;)a(m);return D}function Jp(o){return yt(o)?jt(o,Gr):Tr(o)?[o]:wr(Ra(It(o)))}function Zp(o){var a=++ac;return It(o)+a}var ey=Oi(function(o,a){return o+a},0),ty=ko("ceil"),ry=Oi(function(o,a){return o/a},1),ny=ko("floor");function iy(o){return o&&o.length?Si(o,xr,mo):t}function oy(o,a){return o&&o.length?Si(o,nt(a,2),mo):t}function sy(o){return ws(o,xr)}function ay(o,a){return ws(o,nt(a,2))}function uy(o){return o&&o.length?Si(o,xr,vo):t}function cy(o,a){return o&&o.length?Si(o,nt(a,2),vo):t}var fy=Oi(function(o,a){return o*a},1),ly=ko("round"),dy=Oi(function(o,a){return o-a},0);function hy(o){return o&&o.length?io(o,xr):0}function py(o,a){return o&&o.length?io(o,nt(a,2)):0}return M.after=Bd,M.ary=Wa,M.assign=Eh,M.assignIn=su,M.assignInWith=Vi,M.assignWith=$h,M.at=Ch,M.before=Va,M.bind=zo,M.bindAll=Ip,M.bindKey=Ga,M.castArray=Gd,M.chain=Ka,M.chunk=rl,M.compact=nl,M.concat=il,M.cond=Fp,M.conforms=kp,M.constant=Xo,M.countBy=hd,M.create=Ah,M.curry=Qa,M.curryRight=Ya,M.debounce=Xa,M.defaults=Sh,M.defaultsDeep=Th,M.defer=Ld,M.delay=Md,M.difference=ol,M.differenceBy=sl,M.differenceWith=al,M.drop=ul,M.dropRight=cl,M.dropRightWhile=fl,M.dropWhile=ll,M.fill=dl,M.filter=yd,M.flatMap=_d,M.flatMapDeep=wd,M.flatMapDepth=bd,M.flatten=Na,M.flattenDeep=hl,M.flattenDepth=pl,M.flip=Nd,M.flow=Op,M.flowRight=Rp,M.fromPairs=yl,M.functions=Rh,M.functionsIn=Bh,M.groupBy=vd,M.initial=ml,M.intersection=_l,M.intersectionBy=wl,M.intersectionWith=bl,M.invert=Mh,M.invertBy=Nh,M.invokeMap=Ed,M.iteratee=Jo,M.keyBy=$d,M.keys=ir,M.keysIn=vr,M.map=qi,M.mapKeys=qh,M.mapValues=jh,M.matches=Bp,M.matchesProperty=Lp,M.memoize=Ki,M.merge=Kh,M.mergeWith=au,M.method=Mp,M.methodOf=Np,M.mixin=Zo,M.negate=zi,M.nthArg=qp,M.omit=zh,M.omitBy=Hh,M.once=Ud,M.orderBy=Cd,M.over=jp,M.overArgs=qd,M.overEvery=Kp,M.overSome=zp,M.partial=Ho,M.partialRight=Ja,M.partition=Ad,M.pick=Wh,M.pickBy=uu,M.property=yu,M.propertyOf=Hp,M.pull=$l,M.pullAll=qa,M.pullAllBy=Cl,M.pullAllWith=Al,M.pullAt=Sl,M.range=Wp,M.rangeRight=Vp,M.rearg=jd,M.reject=Dd,M.remove=Tl,M.rest=Kd,M.reverse=jo,M.sampleSize=Fd,M.set=Gh,M.setWith=Qh,M.shuffle=kd,M.slice=Dl,M.sortBy=Rd,M.sortedUniq=Ll,M.sortedUniqBy=Ml,M.split=_p,M.spread=zd,M.tail=Nl,M.take=Ul,M.takeRight=ql,M.takeRightWhile=jl,M.takeWhile=Kl,M.tap=id,M.throttle=Hd,M.thru=Ui,M.toArray=nu,M.toPairs=cu,M.toPairsIn=fu,M.toPath=Jp,M.toPlainObject=ou,M.transform=Yh,M.unary=Wd,M.union=zl,M.unionBy=Hl,M.unionWith=Wl,M.uniq=Vl,M.uniqBy=Gl,M.uniqWith=Ql,M.unset=Xh,M.unzip=Ko,M.unzipWith=ja,M.update=Jh,M.updateWith=Zh,M.values=Kn,M.valuesIn=ep,M.without=Yl,M.words=hu,M.wrap=Vd,M.xor=Xl,M.xorBy=Jl,M.xorWith=Zl,M.zip=ed,M.zipObject=td,M.zipObjectDeep=rd,M.zipWith=nd,M.entries=cu,M.entriesIn=fu,M.extend=su,M.extendWith=Vi,Zo(M,M),M.add=ey,M.attempt=pu,M.camelCase=ip,M.capitalize=lu,M.ceil=ty,M.clamp=tp,M.clone=Qd,M.cloneDeep=Xd,M.cloneDeepWith=Jd,M.cloneWith=Yd,M.conformsTo=Zd,M.deburr=du,M.defaultTo=Pp,M.divide=ry,M.endsWith=op,M.eq=jr,M.escape=sp,M.escapeRegExp=ap,M.every=pd,M.find=gd,M.findIndex=La,M.findKey=Dh,M.findLast=md,M.findLastIndex=Ma,M.findLastKey=Ih,M.floor=ny,M.forEach=za,M.forEachRight=Ha,M.forIn=Fh,M.forInRight=kh,M.forOwn=Ph,M.forOwnRight=Oh,M.get=Go,M.gt=eh,M.gte=th,M.has=Lh,M.hasIn=Qo,M.head=Ua,M.identity=xr,M.includes=xd,M.indexOf=gl,M.inRange=rp,M.invoke=Uh,M.isArguments=An,M.isArray=yt,M.isArrayBuffer=rh,M.isArrayLike=br,M.isArrayLikeObject=Gt,M.isBoolean=nh,M.isBuffer=yn,M.isDate=ih,M.isElement=oh,M.isEmpty=sh,M.isEqual=ah,M.isEqualWith=uh,M.isError=Wo,M.isFinite=ch,M.isFunction=rn,M.isInteger=Za,M.isLength=Hi,M.isMap=eu,M.isMatch=fh,M.isMatchWith=lh,M.isNaN=dh,M.isNative=hh,M.isNil=yh,M.isNull=ph,M.isNumber=tu,M.isObject=zt,M.isObjectLike=Ht,M.isPlainObject=oi,M.isRegExp=Vo,M.isSafeInteger=gh,M.isSet=ru,M.isString=Wi,M.isSymbol=Tr,M.isTypedArray=jn,M.isUndefined=mh,M.isWeakMap=_h,M.isWeakSet=wh,M.join=vl,M.kebabCase=up,M.last=Lr,M.lastIndexOf=xl,M.lowerCase=cp,M.lowerFirst=fp,M.lt=bh,M.lte=vh,M.max=iy,M.maxBy=oy,M.mean=sy,M.meanBy=ay,M.min=uy,M.minBy=cy,M.stubArray=ts,M.stubFalse=rs,M.stubObject=Gp,M.stubString=Qp,M.stubTrue=Yp,M.multiply=fy,M.nth=El,M.noConflict=Up,M.noop=es,M.now=ji,M.pad=lp,M.padEnd=dp,M.padStart=hp,M.parseInt=pp,M.random=np,M.reduce=Sd,M.reduceRight=Td,M.repeat=yp,M.replace=gp,M.result=Vh,M.round=ly,M.runInContext=te,M.sample=Id,M.size=Pd,M.snakeCase=mp,M.some=Od,M.sortedIndex=Il,M.sortedIndexBy=Fl,M.sortedIndexOf=kl,M.sortedLastIndex=Pl,M.sortedLastIndexBy=Ol,M.sortedLastIndexOf=Rl,M.startCase=wp,M.startsWith=bp,M.subtract=dy,M.sum=hy,M.sumBy=py,M.template=vp,M.times=Xp,M.toFinite=nn,M.toInteger=_t,M.toLength=iu,M.toLower=xp,M.toNumber=Mr,M.toSafeInteger=xh,M.toString=It,M.toUpper=Ep,M.trim=$p,M.trimEnd=Cp,M.trimStart=Ap,M.truncate=Sp,M.unescape=Tp,M.uniqueId=Zp,M.upperCase=Dp,M.upperFirst=Yo,M.each=za,M.eachRight=Ha,M.first=Ua,Zo(M,function(){var o={};return Wr(M,function(a,m){Ft.call(M.prototype,m)||(o[m]=a)}),o}(),{chain:!1}),M.VERSION=n,kr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(o){M[o].placeholder=M}),kr(["drop","take"],function(o,a){Ct.prototype[o]=function(m){m=m===t?1:nr(_t(m),0);var $=this.__filtered__&&!a?new Ct(this):this.clone();return $.__filtered__?$.__takeCount__=lr(m,$.__takeCount__):$.__views__.push({size:lr(m,ve),type:o+($.__dir__<0?"Right":"")}),$},Ct.prototype[o+"Right"]=function(m){return this.reverse()[o](m).reverse()}}),kr(["filter","map","takeWhile"],function(o,a){var m=a+1,$=m==lt||m==gt;Ct.prototype[o]=function(D){var j=this.clone();return j.__iteratees__.push({iteratee:nt(D,3),type:m}),j.__filtered__=j.__filtered__||$,j}}),kr(["head","last"],function(o,a){var m="take"+(a?"Right":"");Ct.prototype[o]=function(){return this[m](1).value()[0]}}),kr(["initial","tail"],function(o,a){var m="drop"+(a?"":"Right");Ct.prototype[o]=function(){return this.__filtered__?new Ct(this):this[m](1)}}),Ct.prototype.compact=function(){return this.filter(xr)},Ct.prototype.find=function(o){return this.filter(o).head()},Ct.prototype.findLast=function(o){return this.reverse().find(o)},Ct.prototype.invokeMap=vt(function(o,a){return typeof o=="function"?new Ct(this):this.map(function(m){return Zn(m,o,a)})}),Ct.prototype.reject=function(o){return this.filter(zi(nt(o)))},Ct.prototype.slice=function(o,a){o=_t(o);var m=this;return m.__filtered__&&(o>0||a<0)?new Ct(m):(o<0?m=m.takeRight(-o):o&&(m=m.drop(o)),a!==t&&(a=_t(a),m=a<0?m.dropRight(-a):m.take(a-o)),m)},Ct.prototype.takeRightWhile=function(o){return this.reverse().takeWhile(o).reverse()},Ct.prototype.toArray=function(){return this.take(ve)},Wr(Ct.prototype,function(o,a){var m=/^(?:filter|find|map|reject)|While$/.test(a),$=/^(?:head|last)$/.test(a),D=M[$?"take"+(a=="last"?"Right":""):a],j=$||/^find/.test(a);D&&(M.prototype[a]=function(){var G=this.__wrapped__,J=$?[1]:arguments,oe=G instanceof Ct,be=J[0],xe=oe||yt(G),Ae=function($t){var At=D.apply(M,un([$t],J));return $&&Oe?At[0]:At};xe&&m&&typeof be=="function"&&be.length!=1&&(oe=xe=!1);var Oe=this.__chain__,Ge=!!this.__actions__.length,at=j&&!Oe,wt=oe&&!Ge;if(!j&&xe){G=wt?G:new Ct(this);var ut=o.apply(G,J);return ut.__actions__.push({func:Ui,args:[Ae],thisArg:t}),new Or(ut,Oe)}return at&&wt?o.apply(this,J):(ut=this.thru(Ae),at?$?ut.value()[0]:ut.value():ut)})}),kr(["pop","push","shift","sort","splice","unshift"],function(o){var a=di[o],m=/^(?:push|sort|unshift)$/.test(o)?"tap":"thru",$=/^(?:pop|shift)$/.test(o);M.prototype[o]=function(){var D=arguments;if($&&!this.__chain__){var j=this.value();return a.apply(yt(j)?j:[],D)}return this[m](function(G){return a.apply(yt(G)?G:[],D)})}}),Wr(Ct.prototype,function(o,a){var m=M[a];if(m){var $=m.name+"";Ft.call(Ln,$)||(Ln[$]=[]),Ln[$].push({name:a,func:m})}}),Ln[Pi(t,v).name]=[{name:"wrapper",func:t}],Ct.prototype.clone=Ac,Ct.prototype.reverse=Sc,Ct.prototype.value=Tc,M.prototype.at=od,M.prototype.chain=sd,M.prototype.commit=ad,M.prototype.next=ud,M.prototype.plant=fd,M.prototype.reverse=ld,M.prototype.toJSON=M.prototype.valueOf=M.prototype.value=dd,M.prototype.first=M.prototype.head,Wn&&(M.prototype[Wn]=cd),M},On=ic();_n?((_n.exports=On)._=On,Xi._=On):ur._=On}).call(lodash)}(lodash$1,lodash$1.exports)),lodash$1.exports}var hasRequiredTopk;function requireTopk(){if(hasRequiredTopk)return topk;hasRequiredTopk=1;var r=topk&&topk.__extends||function(){var l=function(h,p){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,w){y.__proto__=w}||function(y,w){for(var v in w)w.hasOwnProperty(v)&&(y[v]=w[v])},l(h,p)};return function(h,p){l(h,p);function y(){this.constructor=h}h.prototype=p===null?Object.create(p):(y.prototype=p.prototype,new y)}}(),e=topk&&topk.__decorate||function(l,h,p,y){var w=arguments.length,v=w<3?h:y===null?y=Object.getOwnPropertyDescriptor(h,p):y,C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(l,h,p,y);else for(var P=l.length-1;P>=0;P--)(C=l[P])&&(v=(w<3?C(v):w>3?C(h,p,v):C(h,p))||v);return w>3&&v&&Object.defineProperty(h,p,v),v},t=topk&&topk.__metadata||function(l,h){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(l,h)},n=topk&&topk.__param||function(l,h){return function(p,y){h(p,y,l)}},i=topk&&topk.__generator||function(l,h){var p={label:0,sent:function(){if(v[0]&1)throw v[1];return v[1]},trys:[],ops:[]},y,w,v,C;return C={next:P(0),throw:P(1),return:P(2)},typeof Symbol=="function"&&(C[Symbol.iterator]=function(){return this}),C;function P(F){return function(k){return R([F,k])}}function R(F){if(y)throw new TypeError("Generator is already executing.");for(;p;)try{if(y=1,w&&(v=F[0]&2?w.return:F[0]?w.throw||((v=w.return)&&v.call(w),0):w.next)&&!(v=v.call(w,F[1])).done)return v;switch(w=0,v&&(F=[F[0]&2,v.value]),F[0]){case 0:case 1:v=F;break;case 4:return p.label++,{value:F[1],done:!1};case 5:p.label++,w=F[1],F=[0];continue;case 7:F=p.ops.pop(),p.trys.pop();continue;default:if(v=p.trys,!(v=v.length>0&&v[v.length-1])&&(F[0]===6||F[0]===2)){p=0;continue}if(F[0]===3&&(!v||F[1]>v[0]&&F[1]<v[3])){p.label=F[1];break}if(F[0]===6&&p.label<v[1]){p.label=v[1],v=F;break}if(v&&p.label<v[2]){p.label=v[2],p.ops.push(F);break}v[2]&&p.ops.pop(),p.trys.pop();continue}F=h.call(l,p)}catch(k){F=[6,k],w=0}finally{y=v=0}if(F[0]&5)throw F[1];return{value:F[0]?F[1]:void 0,done:!0}}},s=topk&&topk.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(topk,"__esModule",{value:!0});var u=s(requireBaseFilter()),c=s(requireCountMinSketch()),d=requireExportable(),g=requireLodash(),_=function(){function l(){this._content=[]}return Object.defineProperty(l.prototype,"length",{get:function(){return this._content.length},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"content",{get:function(){return this._content},set:function(h){this._content=h},enumerable:!0,configurable:!0}),l.prototype.get=function(h){return this._content[h]},l.prototype.add=function(h){var p=g.sortedIndexBy(this._content,h,function(y){return y.frequency});this._content.splice(p,0,h)},l.prototype.remove=function(h){this._content.splice(h,1)},l.prototype.popMin=function(){return this._content.shift()},l.prototype.indexOf=function(h){return this._content.findIndex(function(p){return p.value===h})},l.prototype.clear=function(){this._content=[]},l}(),f=function(l){r(h,l);function h(p,y,w){var v=l.call(this)||this;return v._k=p,v._errorRate=y,v._accuracy=w,v._sketch=c.default.create(y,w),v._heap=new _,v}return h.prototype.add=function(p){this._sketch.update(p);var y=this._sketch.count(p);if(this._heap.length<this._k||y>=this._heap.get(0).frequency){var w=this._heap.indexOf(p);w>-1&&this._heap.remove(w),this._heap.add({value:p,frequency:y}),this._heap.length>this._k&&this._heap.popMin()}},h.prototype.clear=function(){this._sketch=c.default.create(this._errorRate,this._accuracy),this._heap.clear()},h.prototype.values=function(){for(var p=[],y=this._heap.length-1;y>=0;y--){var w=this._heap.get(y);p.push({value:w.value,frequency:w.frequency,rank:this._heap.length-y})}return p},h.prototype.iterator=function(){var p=this._heap;return function(){var y,w;return i(this,function(v){switch(v.label){case 0:y=p.length-1,v.label=1;case 1:return y>=0?(w=p.get(y),[4,{value:w.value,frequency:w.frequency,rank:p.length-y}]):[3,4];case 2:v.sent(),v.label=3;case 3:return y--,[3,1];case 4:return[2]}})}()},e([d.Field(),t("design:type",Number)],h.prototype,"_k",void 0),e([d.Field(),t("design:type",Number)],h.prototype,"_errorRate",void 0),e([d.Field(),t("design:type",Number)],h.prototype,"_accuracy",void 0),e([d.Field(),t("design:type",c.default)],h.prototype,"_sketch",void 0),e([d.Field(function(p){return p.content},function(p){var y=new _;return y.content=p,y}),t("design:type",_)],h.prototype,"_heap",void 0),h=e([d.AutoExportable("TopK",["_seed"]),n(0,d.Parameter("_k")),n(1,d.Parameter("_errorRate")),n(2,d.Parameter("_accuracy")),t("design:paramtypes",[Number,Number,Number])],h),h}(u.default);return topk.default=f,topk}var minHash={},hasRequiredMinHash;function requireMinHash(){if(hasRequiredMinHash)return minHash;hasRequiredMinHash=1;var r=minHash&&minHash.__extends||function(){var p=function(y,w){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,C){v.__proto__=C}||function(v,C){for(var P in C)C.hasOwnProperty(P)&&(v[P]=C[P])},p(y,w)};return function(y,w){p(y,w);function v(){this.constructor=y}y.prototype=w===null?Object.create(w):(v.prototype=w.prototype,new v)}}(),e=minHash&&minHash.__decorate||function(p,y,w,v){var C=arguments.length,P=C<3?y:v===null?v=Object.getOwnPropertyDescriptor(y,w):v,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")P=Reflect.decorate(p,y,w,v);else for(var F=p.length-1;F>=0;F--)(R=p[F])&&(P=(C<3?R(P):C>3?R(y,w,P):R(y,w))||P);return C>3&&P&&Object.defineProperty(y,w,P),P},t=minHash&&minHash.__metadata||function(p,y){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(p,y)},n=minHash&&minHash.__param||function(p,y){return function(w,v){y(w,v,p)}},i=minHash&&minHash.__read||function(p,y){var w=typeof Symbol=="function"&&p[Symbol.iterator];if(!w)return p;var v=w.call(p),C,P=[],R;try{for(;(y===void 0||y-- >0)&&!(C=v.next()).done;)P.push(C.value)}catch(F){R={error:F}}finally{try{C&&!C.done&&(w=v.return)&&w.call(v)}finally{if(R)throw R.error}}return P},s=minHash&&minHash.__spread||function(){for(var p=[],y=0;y<arguments.length;y++)p=p.concat(i(arguments[y]));return p},u=minHash&&minHash.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty(minHash,"__esModule",{value:!0});var c=u(requireBaseFilter()),d=requireExportable(),g=requireUtils(),_=requireLodash(),f=function(p){r(y,p);function y(){return p!==null&&p.apply(this,arguments)||this}return y}(Error);function l(p,y){return(y.a*p+y.b)%y.c}var h=function(p){r(y,p);function y(w,v){var C=p.call(this)||this;return C._nbHashes=w,C._hashFunctions=v,C._signature=g.allocateArray(C._nbHashes,1/0),C}return Object.defineProperty(y.prototype,"nbHashes",{get:function(){return this._nbHashes},enumerable:!0,configurable:!0}),y.prototype.isEmpty=function(){return this._signature[0]===1/0},y.prototype.add=function(w){for(var v=0;v<this._nbHashes;v++)this._signature[v]=Math.min(this._signature[v],l(w,this._hashFunctions[v]))},y.prototype.bulkLoad=function(w){for(var v=this,C=function(F){var k=w.map(function(B){return l(B,v._hashFunctions[F])});P._signature[F]=Math.min.apply(Math,s([P._signature[F]],k))},P=this,R=0;R<this._nbHashes;R++)C(R)},y.prototype.compareWith=function(w){if(this.isEmpty()||w.isEmpty())throw new f("Cannot compute a Jaccard similairty with a MinHash that contains no values");return _.intersection(this._signature,w._signature).length/this._nbHashes},e([d.Field(),t("design:type",Number)],y.prototype,"_nbHashes",void 0),e([d.Field(),t("design:type",Array)],y.prototype,"_hashFunctions",void 0),e([d.Field(),t("design:type",Array)],y.prototype,"_signature",void 0),y=e([d.AutoExportable("MinHash",["_seed"]),n(0,d.Parameter("_nbHashes")),n(1,d.Parameter("_hashFunctions")),t("design:paramtypes",[Number,Array])],y),y}(c.default);return minHash.MinHash=h,minHash}var minHashFactory={},hasRequiredMinHashFactory;function requireMinHashFactory(){if(hasRequiredMinHashFactory)return minHashFactory;hasRequiredMinHashFactory=1,Object.defineProperty(minHashFactory,"__esModule",{value:!0});var r=requireMinHash(),e=requireLodash();function t(s){if(s!==2&&s%2===0)return!1;for(var u=2;u<Math.sqrt(s);u++)if(s%u===0)return!1;return!0}function n(s){for(var u=0;;){if(t(s+u))return s+u;u++}}var i=function(){function s(u,c){this._nbHashes=u,this._maxValue=c,this._hashFunctions=[];for(var d=n(this._maxValue),g=0;g<this._nbHashes;g++){var _=e.random(0,this._maxValue,!1),f=e.random(0,this._maxValue,!1);this._hashFunctions.push({a:_,b:f,c:d})}}return s.prototype.create=function(){return new r.MinHash(this._nbHashes,this._hashFunctions)},s}();return minHashFactory.default=i,minHashFactory}var cuckooFilter={},bucket={},lodash_eq,hasRequiredLodash_eq;function requireLodash_eq(){if(hasRequiredLodash_eq)return lodash_eq;hasRequiredLodash_eq=1;function r(e,t){return e===t||e!==e&&t!==t}return lodash_eq=r,lodash_eq}var lodash_indexof,hasRequiredLodash_indexof;function requireLodash_indexof(){if(hasRequiredLodash_indexof)return lodash_indexof;hasRequiredLodash_indexof=1;var r=1/0,e=17976931348623157e292,t=NaN,n="[object Symbol]",i=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,u=/^0b[01]+$/i,c=/^0o[0-7]+$/i,d=parseInt;function g(k,B,H,re){for(var le=k.length,me=H+-1;++me<le;)if(B(k[me],me,k))return me;return-1}function _(k,B,H){if(B!==B)return g(k,f,H);for(var re=H-1,le=k.length;++re<le;)if(k[re]===B)return re;return-1}function f(k){return k!==k}var l=Object.prototype,h=l.toString,p=Math.max;function y(k,B,H){var re=k?k.length:0;if(!re)return-1;var le=H==null?0:R(H);return le<0&&(le=p(re+le,0)),_(k,B,le)}function w(k){var B=typeof k;return!!k&&(B=="object"||B=="function")}function v(k){return!!k&&typeof k=="object"}function C(k){return typeof k=="symbol"||v(k)&&h.call(k)==n}function P(k){if(!k)return k===0?k:0;if(k=F(k),k===r||k===-1/0){var B=k<0?-1:1;return B*e}return k===k?k:0}function R(k){var B=P(k),H=B%1;return B===B?H?B-H:B:0}function F(k){if(typeof k=="number")return k;if(C(k))return t;if(w(k)){var B=typeof k.valueOf=="function"?k.valueOf():k;k=w(B)?B+"":B}if(typeof k!="string")return k===0?k:+k;k=k.replace(i,"");var H=u.test(k);return H||c.test(k)?d(k.slice(2),H?2:8):s.test(k)?t:+k}return lodash_indexof=y,lodash_indexof}var hasRequiredBucket;function requireBucket(){if(hasRequiredBucket)return bucket;hasRequiredBucket=1;var r=bucket&&bucket.__decorate||function(_,f,l,h){var p=arguments.length,y=p<3?f:h===null?h=Object.getOwnPropertyDescriptor(f,l):h,w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(_,f,l,h);else for(var v=_.length-1;v>=0;v--)(w=_[v])&&(y=(p<3?w(y):p>3?w(f,l,y):w(f,l))||y);return p>3&&y&&Object.defineProperty(f,l,y),y},e=bucket&&bucket.__metadata||function(_,f){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(_,f)},t=bucket&&bucket.__importDefault||function(_){return _&&_.__esModule?_:{default:_}},n=bucket&&bucket.__importStar||function(_){if(_&&_.__esModule)return _;var f={};if(_!=null)for(var l in _)Object.hasOwnProperty.call(_,l)&&(f[l]=_[l]);return f.default=_,f};Object.defineProperty(bucket,"__esModule",{value:!0});var i=t(requireLodash_eq()),s=t(requireLodash_indexof()),u=n(requireUtils()),c=requireExportable(),d=requireExportable(),g=function(){function _(l){this._elements=u.allocateArray(l,null),this._size=l,this._length=0}f=_,Object.defineProperty(_.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),_.prototype.isFree=function(){return this._length<this._size},_.prototype.nextEmptySlot=function(){return s.default(this._elements,null)},_.prototype.at=function(l){return this._elements[l]},_.prototype.add=function(l){return l===null||!this.isFree()?!1:(this.set(this.nextEmptySlot(),l),this._length++,!0)},_.prototype.remove=function(l){var h=s.default(this._elements,l);return h<=-1?!1:(this.unset(h),!0)},_.prototype.has=function(l){return s.default(this._elements,l)>-1},_.prototype.set=function(l,h){this._elements[l]=h},_.prototype.unset=function(l){this._elements[l]=null,this._length--},_.prototype.swapRandom=function(l,h){h===void 0&&(h=Math.random);var p=u.randomInt(0,this._length-1,h),y=this._elements[p];return this._elements[p]=l,y},_.prototype.swap=function(l,h){var p=this._elements[l];return this._elements[l]=h,p},_.prototype.equals=function(l){return this._size!==l.size||this._length!==l.length?!1:this._elements.every(function(h,p){return i.default(l.at(p),h)})};var f;return _=f=r([c.Exportable({export:d.cloneObject("Bucket","_size","_elements"),import:function(l){if(l.type!=="Bucket"||"_size"in l,!("_elements"in l))throw new Error("Cannot create a Bucket from a JSON export which does not represent a bucket");var h=new f(l._size);return l._elements.forEach(function(p,y){p!==null&&(h._elements[y]=p,h._length++)}),h}}),e("design:paramtypes",[Number])],_),_}();return bucket.default=g,bucket}var hasRequiredCuckooFilter;function requireCuckooFilter(){if(hasRequiredCuckooFilter)return cuckooFilter;hasRequiredCuckooFilter=1;var r=cuckooFilter&&cuckooFilter.__extends||function(){var _=function(f,l){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,p){h.__proto__=p}||function(h,p){for(var y in p)p.hasOwnProperty(y)&&(h[y]=p[y])},_(f,l)};return function(f,l){_(f,l);function h(){this.constructor=f}f.prototype=l===null?Object.create(l):(h.prototype=l.prototype,new h)}}(),e=cuckooFilter&&cuckooFilter.__decorate||function(_,f,l,h){var p=arguments.length,y=p<3?f:h===null?h=Object.getOwnPropertyDescriptor(f,l):h,w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(_,f,l,h);else for(var v=_.length-1;v>=0;v--)(w=_[v])&&(y=(p<3?w(y):p>3?w(f,l,y):w(f,l))||y);return p>3&&y&&Object.defineProperty(f,l,y),y},t=cuckooFilter&&cuckooFilter.__metadata||function(_,f){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(_,f)},n=cuckooFilter&&cuckooFilter.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(cuckooFilter,"__esModule",{value:!0});var i=n(requireBaseFilter()),s=n(requireBucket()),u=requireExportable(),c=requireUtils();function d(_,f){var l=Math.ceil(Math.log2(1/f)+Math.log2(2*_));return Math.ceil(l/4)}var g=function(_){r(f,_);function f(h,p,y,w){w===void 0&&(w=500);var v=_.call(this)||this;return v._filter=c.allocateArray(h,function(){return new s.default(y)}),v._size=h,v._bucketSize=y,v._fingerprintLength=p,v._length=0,v._maxKicks=w,v}l=f,f.create=function(h,p,y,w){y===void 0&&(y=4),w===void 0&&(w=500);var v=d(y,p),C=Math.ceil(h/y/.955);return new l(C,v,y,w)},f.from=function(h,p,y,w){y===void 0&&(y=4),w===void 0&&(w=500);var v=Array.from(h),C=l.create(v.length,p,y,w);return v.forEach(function(P){return C.add(P)}),C},Object.defineProperty(f.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"fullSize",{get:function(){return this.size*this.bucketSize},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"fingerprintLength",{get:function(){return this._fingerprintLength},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"bucketSize",{get:function(){return this._bucketSize},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"maxKicks",{get:function(){return this._maxKicks},enumerable:!0,configurable:!0}),f.prototype.add=function(h,p,y){p===void 0&&(p=!1),y===void 0&&(y=!1);var w=this._locations(h);if(this._filter[w.firstIndex].isFree())this._filter[w.firstIndex].add(w.fingerprint);else if(this._filter[w.secondIndex].isFree())this._filter[w.secondIndex].add(w.fingerprint);else{for(var v=this.random()<.5?w.firstIndex:w.secondIndex,C=w.fingerprint,P=[],R=0;R<this._maxKicks;R++){var F=c.randomInt(0,this._filter[v].length-1,this.random),k=this._filter[v].at(F);P.push([v,F,k]),this._filter[v].set(F,C),C=k;var B=c.hashAsInt(C,this.seed,64);if(v=Math.abs(v^Math.abs(B))%this._filter.length,this._filter[v].isFree())return this._filter[v].add(C),this._length++,!0}if(!y)for(var H=P.length-1;H>=0;H--){var re=P[H];this._filter[re[0]].set(re[1],re[2])}if(p)throw new Error('The Cuckoo Filter is full, cannot insert element "'+h+'"');return!1}return this._length++,!0},f.prototype.remove=function(h){var p=this._locations(h);return this._filter[p.firstIndex].has(p.fingerprint)?(this._filter[p.firstIndex].remove(p.fingerprint),this._length--,!0):this._filter[p.secondIndex].has(p.fingerprint)?(this._filter[p.secondIndex].remove(p.fingerprint),this._length--,!0):!1},f.prototype.has=function(h){var p=this._locations(h);return this._filter[p.firstIndex].has(p.fingerprint)||this._filter[p.secondIndex].has(p.fingerprint)},f.prototype.rate=function(){var h=this._computeHashTableLoad(),p=this._fingerprintLength/h.load;return Math.pow(2,Math.log2(2*this._bucketSize)-h.load*p)},f.prototype._computeHashTableLoad=function(){var h=this._filter.length*this._bucketSize,p=this._filter.reduce(function(y,w){return y+w.length},0);return{used:p,free:h-p,size:h,load:p/h}},f.prototype._locations=function(h){var p=c.hashIntAndString(h,this.seed,16,64),y=p.int;if(this._fingerprintLength>p.string.length)throw new Error("The fingerprint length ("+this._fingerprintLength+") is higher than the hash length ("+p.string.length+"). Please reduce the fingerprint length or report if it is an unexpected behavior.");var w=p.string.substring(0,this._fingerprintLength),v=Math.abs(y),C=Math.abs(c.hashAsInt(w,this.seed,64)),P=Math.abs(v^C),R={fingerprint:w,firstIndex:v%this._size,secondIndex:P%this._size};return R},f.prototype.equals=function(h){for(var p=0,y=!0;y&&p<this._filter.length;){var w=this._filter[p];h._filter[p].equals(w)||(y=!1),p++}return y};var l;return f=l=e([u.Exportable({export:u.cloneObject("CuckooFilter","_size","_fingerprintLength","_length","_maxKicks","_filter","_seed"),import:function(h){if(h.type!=="CuckooFilter"||!("_size"in h)||!("_fingerprintLength"in h)||!("_length"in h)||!("_maxKicks"in h)||!("_filter"in h)||!("_seed"in h))throw new Error("Cannot create a CuckooFilter from a JSON export which does not represent a cuckoo filter");var p=new l(h._size,h._fingerprintLength,h._bucketSize,h._maxKicks);return p._length=h._length,p._filter=h._filter.map(function(y){var w=new s.default(y._size);return y._elements.forEach(function(v,C){v!==null&&(w._elements[C]=v,w._length++)}),w}),p.seed=h.seed,p}}),t("design:paramtypes",[Number,Number,Number,Number])],f),f}(i.default);return cuckooFilter.default=g,cuckooFilter}var invertibleBloomLookupTables={},cell={},hasRequiredCell;function requireCell(){if(hasRequiredCell)return cell;hasRequiredCell=1;var r=cell&&cell.__extends||function(){var f=function(l,h){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,y){p.__proto__=y}||function(p,y){for(var w in y)y.hasOwnProperty(w)&&(p[w]=y[w])},f(l,h)};return function(l,h){f(l,h);function p(){this.constructor=l}l.prototype=h===null?Object.create(h):(p.prototype=h.prototype,new p)}}(),e=cell&&cell.__decorate||function(f,l,h,p){var y=arguments.length,w=y<3?l:p===null?p=Object.getOwnPropertyDescriptor(l,h):p,v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(f,l,h,p);else for(var C=f.length-1;C>=0;C--)(v=f[C])&&(w=(y<3?v(w):y>3?v(l,h,w):v(l,h))||w);return y>3&&w&&Object.defineProperty(l,h,w),w},t=cell&&cell.__metadata||function(f,l){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(f,l)},n=cell&&cell.__param||function(f,l){return function(h,p){l(h,p,f)}},i=cell&&cell.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(cell,"__esModule",{value:!0});var s=requireBuffer(),u=requireUtils(),c=requireExportable(),d=i(requireBaseFilter()),g=Symbol.for("nodejs.util.inspect.custom"),_=function(f){r(l,f);function l(p,y,w){var v=f.call(this)||this;return v._idSum=p,v._hashSum=y,v._count=w,v}h=l,l.empty=function(){return new h(s.Buffer.allocUnsafe(0).fill(0),s.Buffer.allocUnsafe(0).fill(0),0)},l.prototype[g]=function(){return"Cell:<"+JSON.stringify(this._idSum.toJSON().data)+", "+JSON.stringify(this._hashSum.toJSON().data)+", "+this._count+">"},Object.defineProperty(l.prototype,"idSum",{get:function(){return this._idSum},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"hashSum",{get:function(){return this._hashSum},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),l.prototype.add=function(p,y){this._idSum=u.xorBuffer(this._idSum,p),this._hashSum=u.xorBuffer(this._hashSum,y),this._count++},l.prototype.xorm=function(p){return new h(u.xorBuffer(this._idSum,p.idSum),u.xorBuffer(this._hashSum,p.hashSum),this._count-p.count)},l.prototype.isEmpty=function(){return this._idSum.equals(s.Buffer.from(""))&&this._hashSum.equals(s.Buffer.from(""))&&this._count===0},l.prototype.equals=function(p){return this._count===p.count&&this._idSum.equals(p.idSum)&&this._hashSum.equals(p.hashSum)},l.prototype.isPure=function(){if(this.isEmpty()||this._count!==1&&this._count!==-1)return!1;var p=u.hashTwiceAsString(JSON.stringify(this._idSum.toJSON()),this.seed);return this._hashSum.equals(s.Buffer.from(p.first))};var h;return e([c.Field(function(p){return p.toString()},s.Buffer.from),t("design:type",Object)],l.prototype,"_idSum",void 0),e([c.Field(function(p){return p.toString()},s.Buffer.from),t("design:type",Object)],l.prototype,"_hashSum",void 0),e([c.Field(),t("design:type",Number)],l.prototype,"_count",void 0),l=h=e([c.AutoExportable("Cell",["_seed"]),n(0,c.Parameter("_idSum")),n(1,c.Parameter("_hashSum")),n(2,c.Parameter("_count")),t("design:paramtypes",[Object,Object,Number])],l),l}(d.default);return cell.default=_,cell}var hasRequiredInvertibleBloomLookupTables;function requireInvertibleBloomLookupTables(){if(hasRequiredInvertibleBloomLookupTables)return invertibleBloomLookupTables;hasRequiredInvertibleBloomLookupTables=1;var r=invertibleBloomLookupTables&&invertibleBloomLookupTables.__extends||function(){var h=function(p,y){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,v){w.__proto__=v}||function(w,v){for(var C in v)v.hasOwnProperty(C)&&(w[C]=v[C])},h(p,y)};return function(p,y){h(p,y);function w(){this.constructor=p}p.prototype=y===null?Object.create(y):(w.prototype=y.prototype,new w)}}(),e=invertibleBloomLookupTables&&invertibleBloomLookupTables.__decorate||function(h,p,y,w){var v=arguments.length,C=v<3?p:w===null?w=Object.getOwnPropertyDescriptor(p,y):w,P;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(h,p,y,w);else for(var R=h.length-1;R>=0;R--)(P=h[R])&&(C=(v<3?P(C):v>3?P(p,y,C):P(p,y))||C);return v>3&&C&&Object.defineProperty(p,y,C),C},t=invertibleBloomLookupTables&&invertibleBloomLookupTables.__metadata||function(h,p){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(h,p)},n=invertibleBloomLookupTables&&invertibleBloomLookupTables.__param||function(h,p){return function(y,w){p(y,w,h)}},i=invertibleBloomLookupTables&&invertibleBloomLookupTables.__generator||function(h,p){var y={label:0,sent:function(){if(C[0]&1)throw C[1];return C[1]},trys:[],ops:[]},w,v,C,P;return P={next:R(0),throw:R(1),return:R(2)},typeof Symbol=="function"&&(P[Symbol.iterator]=function(){return this}),P;function R(k){return function(B){return F([k,B])}}function F(k){if(w)throw new TypeError("Generator is already executing.");for(;y;)try{if(w=1,v&&(C=k[0]&2?v.return:k[0]?v.throw||((C=v.return)&&C.call(v),0):v.next)&&!(C=C.call(v,k[1])).done)return C;switch(v=0,C&&(k=[k[0]&2,C.value]),k[0]){case 0:case 1:C=k;break;case 4:return y.label++,{value:k[1],done:!1};case 5:y.label++,v=k[1],k=[0];continue;case 7:k=y.ops.pop(),y.trys.pop();continue;default:if(C=y.trys,!(C=C.length>0&&C[C.length-1])&&(k[0]===6||k[0]===2)){y=0;continue}if(k[0]===3&&(!C||k[1]>C[0]&&k[1]<C[3])){y.label=k[1];break}if(k[0]===6&&y.label<C[1]){y.label=C[1],C=k;break}if(C&&y.label<C[2]){y.label=C[2],y.ops.push(k);break}C[2]&&y.ops.pop(),y.trys.pop();continue}k=p.call(h,y)}catch(B){k=[6,B],v=0}finally{w=C=0}if(k[0]&5)throw k[1];return{value:k[0]?k[1]:void 0,done:!0}}},s=invertibleBloomLookupTables&&invertibleBloomLookupTables.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(invertibleBloomLookupTables,"__esModule",{value:!0});var u=requireBuffer(),c=s(requireBaseFilter()),d=s(requireCell()),g=requireExportable(),_=requireUtils(),f=requireFormulas(),l=function(h){r(p,h);function p(w,v){v===void 0&&(v=3);var C=h.call(this)||this;if(u.Buffer===void 0)throw new Error('No native Buffer implementation bound in your JavaScript env. If you are in a Web browser, consider importing the polyfill "feross/buffer" (https://github.com/feross/buffer).');if(v<=0)throw new Error("The hashCount must be a non-zero, positive integer");return C._size=w,C._hashCount=v,C._elements=_.allocateArray(C._size,function(){return d.default.empty()}),C}y=p,p.create=function(w,v){var C=f.optimalFilterSize(w,v),P=f.optimalHashes(C,w);return new y(C,P)},p.from=function(w,v){var C=Array.from(w),P=y.create(C.length,v);return C.forEach(function(R){return P.add(R)}),P},Object.defineProperty(p.prototype,"hashCount",{get:function(){return this._hashCount},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"length",{get:function(){return this._elements.reduce(function(w,v){return w+v.count},0)/this._hashCount},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"elements",{get:function(){return this._elements},enumerable:!0,configurable:!0}),p.prototype.add=function(w){for(var v=_.allInOneHashTwice(JSON.stringify(w.toJSON()),this.seed),C=_.getDistinctIndices(v.string.first,this._size,this._hashCount,this.seed),P=0;P<this._hashCount;++P)this._elements[C[P]].add(w,u.Buffer.from(v.string.first))},p.prototype.remove=function(w){for(var v=_.allInOneHashTwice(JSON.stringify(w.toJSON()),this.seed),C=_.getDistinctIndices(v.string.first,this.size,this._hashCount,this.seed),P=0;P<this._hashCount;++P)this._elements[C[P]]=this._elements[C[P]].xorm(new d.default(u.Buffer.from(w),u.Buffer.from(v.string.first),1));return!0},p.prototype.has=function(w){for(var v=_.allInOneHashTwice(JSON.stringify(w.toJSON()),this.seed),C=_.getDistinctIndices(v.string.first,this.size,this._hashCount,this.seed),P=0;P<this._hashCount;++P){if(this._elements[C[P]].count===0)return!1;if(this._elements[C[P]].count===1)return!!this._elements[C[P]].idSum.equals(w)}return!0},p.prototype.listEntries=function(){var w=this,v=[];return function(){var C,P,R;return i(this,function(F){switch(F.label){case 0:C=function(k){var B;return i(this,function(H){switch(H.label){case 0:return B=w._elements[k],B.count>0&&v.findIndex(function(re){return re.equals(B.idSum)})===-1?w.has(B.idSum)?(v.push(B.idSum),[4,B.idSum]):[3,2]:[3,3];case 1:return H.sent(),[3,3];case 2:return[2,{value:!1}];case 3:return[2]}})},P=0,F.label=1;case 1:return P<w._elements.length-1?[5,C(P)]:[3,4];case 2:if(R=F.sent(),typeof R=="object")return[2,R.value];F.label=3;case 3:return P++,[3,1];case 4:return[2,!0]}})}()},p.prototype.substract=function(w){if(this.size!==w.size)throw new Error("The two Invertible Bloom Filters must be of the same size");var v=new y(w._size,w._hashCount);v.seed=this.seed;for(var C=0;C<this.size;++C)v._elements[C]=this._elements[C].xorm(w._elements[C]);return v},p.prototype.equals=function(w){if(w._size!==this._size||w._hashCount!==this._hashCount||w.seed!==this.seed)return!1;for(var v=0;v<w._elements.length;++v)if(!w._elements[v].equals(this._elements[v]))return!1;return!0},p.prototype.decode=function(w,v){w===void 0&&(w=[]),v===void 0&&(v=[]);for(var C=[],P=null,R=0;R<this._elements.length;++R)P=this._elements[R],P.isPure()&&C.push(R);for(;C.length!==0;){P=this._elements[C.pop()];var F=P.idSum,k=P.count;if(P.isPure()){if(k===1)w.push(F);else if(k===-1)v.push(F);else throw new Error("Please report, not possible");for(var B=_.allInOneHashTwice(JSON.stringify(F.toJSON()),this.seed),H=_.getDistinctIndices(B.string.first,this._size,this._hashCount,this.seed),R=0;R<H.length;++R)this._elements[H[R]]=this._elements[H[R]].xorm(new d.default(F,u.Buffer.from(B.string.first),k)),this._elements[H[R]].isPure()&&C.push(H[R])}}return this._elements.findIndex(function(re){return!re.isEmpty()})>-1?{success:!1,reason:{cell:P,iblt:this},additional:w,missing:v}:{success:!0,additional:w,missing:v}};var y;return e([g.Field(),t("design:type",Number)],p.prototype,"_size",void 0),e([g.Field(),t("design:type",Number)],p.prototype,"_hashCount",void 0),e([g.Field(void 0,function(w){return w.map(function(v){var C=new d.default(u.Buffer.from(v._idSum),u.Buffer.from(v._hashSum),v._count);return C.seed=v._seed,C})}),t("design:type",Array)],p.prototype,"_elements",void 0),p=y=e([g.AutoExportable("InvertibleBloomFilter",["_seed"]),n(0,g.Parameter("_size")),n(1,g.Parameter("_hashCount")),t("design:paramtypes",[Number,Number])],p),p}(c.default);return invertibleBloomLookupTables.default=l,invertibleBloomLookupTables}var hasRequiredApi;function requireApi(){if(hasRequiredApi)return api;hasRequiredApi=1,Object.defineProperty(api,"__esModule",{value:!0});var r=requireBloomFilter();api.BloomFilter=r.default;var e=requireCountingBloomFilter();api.CountingBloomFilter=e.default;var t=requirePartitionedBloomFilter();api.PartitionedBloomFilter=t.default;var n=requireCountMinSketch();api.CountMinSketch=n.default;var i=requireHyperloglog();api.HyperLogLog=i.default;var s=requireTopk();api.TopK=s.default;var u=requireMinHash();api.MinHash=u.MinHash;var c=requireMinHashFactory();api.MinHashFactory=c.default;var d=requireCuckooFilter();api.CuckooFilter=d.default;var g=requireInvertibleBloomLookupTables();api.InvertibleBloomFilter=g.default;var _=requireCell();return api.Cell=_.default,api}var apiExports=requireApi();const fromBytes=r=>Array.prototype.map.call(r,e=>("00"+e.toString(16)).slice(-2)).join(""),toBytes=r=>{const e=new Uint8Array(r.length/2);for(let t=0;t<e.length;t++)e[t]=parseInt(r.slice(t*2,t*2+2),16);return e},FILTER_SIZE=1024,HASH_COUNT=16,SATURATION_THRESHOLD=320,createBare=async r=>{const e="0".repeat(FILTER_SIZE/4);return addToBare(e,r)},addToBare=async(r,e)=>{const t=fromHex(r),n=await hash$1.sha256Str(e);return t.add(n),await toHex(t)},addRevision=async(r,e,t)=>await addToBare(r,`${t}${e}`),toPrivateName=async r=>{const e=await saturateFilter(fromHex(r));return toHash(e)},toHash=async r=>{const e=new Uint8Array(r.toBytes()),t=await hash$1.sha256(e);return fromBytes(t)},saturate=async(r,e=SATURATION_THRESHOLD)=>{const t=await saturateFilter(fromHex(r),e);return await toHex(t)},saturateFilter=async(r,e=SATURATION_THRESHOLD)=>{if(e>r.toBytes().byteLength*8)throw new Error("threshold is bigger than filter size");if(countOnes(r)>=e)return r;const n=r.toBytes();let i=n;do{const s=await hash$1.sha256(i);r.add(fromBytes(s)),i=s}while(bufEquals(n,r.toBytes()));return saturateFilter(r,e)},countOnes=r=>{const e=new Uint32Array(r.toBytes());let t=0;for(let n=0;n<e.length;n++)t+=bitCount32(e[n]);return t},toHex=r=>fromBytes(r.toBytes()),fromHex=r=>{const e=toBytes(r);return apiExports.BloomFilter.fromBytes(e,HASH_COUNT)},bufEquals=(r,e)=>{if(r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let i=0;i<t.length;i++)if(t[i]!==n[i])return!1;return!0},bitCount32=r=>{const e=r-(r>>1&1431655765),t=(e&858993459)+(e>>2&858993459);return(t+(t>>4)&252645135)*16843009>>24},addNode=async(r,e,t)=>{const{cid:n,size:i}=await putEncryptedFile(e,t),s=await addRevision(e.bareNameFilter,t,e.revision),u=await toPrivateName(s);if(await r.add(u,n),isPrivateFileInfo(e)){const g=await addToBare(e.bareNameFilter,e.key),_=await addRevision(g,e.key,e.revision),f=await toPrivateName(_);await r.add(f,decodeCID(e.content))}const[c,d]=isPrivateFileInfo(e)?[{},!0]:[e.skeleton,!1];return{cid:n,name:u,key:t,size:i,isFile:d,skeleton:c}},readNode=async(r,e)=>{const t=await catAndDecode(r,e);if(!isDecryptedNode(t))throw new Error(`Could not parse a valid filesystem object, ${r}`);return t},getByName=async(r,e,t)=>{const n=await r.get(e);return n===null?null:getByCID(n,t)},getByCID=async(r,e)=>await readNode(r,e),getLatestByName=async(r,e,t)=>{const n=await r.get(e);return n===null?null:getLatestByCID(r,n,t)},getLatestByCID=async(r,e,t)=>{const n=await getByCID(e,t),i=await findLatestRevision(r,n.bareNameFilter,t,n.revision);return i!=null&&i.cid?await getByCID(decodeCID(i==null?void 0:i.cid),t):n},getLatestByBareNameFilter=async(r,e,t)=>{const n=await addRevision(e,t,1),i=await toPrivateName(n);return getLatestByName(r,i,t)},findLatestRevision=async(r,e,t,n)=>{let i=n,s=null,u=0,c=null;for(;s===null;){const d=n+Math.pow(2,u),g=await getRevision(r,e,t,d);g!==null?(c=g,i=d):s=d,u++}for(;i<s-1;){const d=Math.floor((s+i)/2),g=await getRevision(r,e,t,d);g!==null?(c=g,i=d):s=d}return c},getRevision=async(r,e,t,n)=>{const i=await addRevision(e,t,n),s=await toPrivateName(i),u=await r.get(s);return u?{cid:u,name:s,number:n}:null};class BaseFile{constructor(e){this.content=e,this.readOnly=!1}async put(){const{cid:e}=await this.putDetailed();return e}async updateContent(e){if(this.readOnly)throw new Error("File is read-only");return this.content=e,this}}class BareFile extends BaseFile{static create(e){return new BareFile(e)}static async fromCID(e){const t=await getFile(e);return new BareFile(t)}static instanceOf(e){return isObject(e)&&hasProp(e,"content")}async put(){const{cid:e}=await this.putDetailed();return e}async putDetailed(){return putFile$1(await normalizeFileContent(this.content))}}class BaseTree{constructor(){this.readOnly=!1}async put(){const{cid:e}=await this.putDetailed();return e}async ls(e){const t=await this.get(e);if(t===null)throw new Error("Path does not exist");if(isFile(t))throw new Error("Can not `ls` a file");return t.getLinks()}async cat(e){const t=await this.get(e);if(t===null)throw new Error("Path does not exist");if(!isFile(t))throw new Error("Can not `cat` a directory");return t.content}async mkdir(e){return this.mkdirRecurse(e,()=>this.put())}async mkdirRecurse(e,t){const[n,...i]=e;if(!n)throw new Error("Invalid path: empty");const s=await this.getOrCreateDirectChild(n,t);if(isFile(s))throw new Error(`There is a file along the given path: ${log$8(e)}`);return i.length&&await s.mkdirRecurse(i,()=>this.updateDirectChild(s,n,t)),this}async add(e,t){return await this.addRecurse(e,t,()=>this.put()),this}async addRecurse(e,t,n){const[i,...s]=e;if(!i)throw new Error("Invalid path: empty");if(s.length===0)await this.createOrUpdateChildFile(t,i,n);else{const u=await this.getOrCreateDirectChild(i,n);if(isFile(u))throw new Error(`There is a file along the given path: ${log$8(e)}`);await u.addRecurse(s,t,async()=>{await this.updateDirectChild(u,i,n)})}return this}async rm(e){return await this.rmRecurse(e,()=>this.put()),this}async rmRecurse(e,t){const[n,...i]=e;if(!n)throw new Error("Invalid path: empty");if(i.length===0)this.removeDirectChild(n),t&&await t();else{const s=await this.getDirectChild(n);if(s===null)throw new Error("Invalid path: does not exist");if(isFile(s))throw new Error(`There is a file along the given path: ${log$8(e)}`);await s.rmRecurse(i,async()=>{await this.updateDirectChild(s,n,t)})}return this}async mv(e,t){const n=await this.get(e);if(n===null)throw new Error(`Path does not exist: ${log$8(e)}`);if(t.length<1)throw new Error(`Path does not exist: ${log$8(t)}`);const i=t.slice(0,-1);let s=await this.get(i);if(!s)await this.mkdir(i),s=await this.get(i);else if(isFile(s))throw new Error(`Can not \`mv\` to a file: ${log$8(i)}`);return await this.rm(e),await[...t].reverse().reduce((u,c,d)=>u.then(async g=>{const _=t.slice(0,-(d+1)),f=_.length?await this.get(_):this;if(f&&!isFile(f))return await f.updateDirectChild(g,c,null),f;throw new Error("Failed to update tree while moving node")}),Promise.resolve(n)),this}async exists(e){return await this.get(e)!==null}read(e){return this.get(e)}write(e,t){return this.add(e,t)}async getOrCreateDirectChild(e,t){const n=await this.getDirectChild(e);return n!==null?n:this.createChildTree(e,t)}async updateChild(e,t){const n=[];return await t.reduce(async(i,s,u)=>{const c=await i;if(n.push([s,c]),u+1===t.length)return c;const d=await c.getDirectChild(s);if(!isTree(d)){const g=t.slice(u+1);throw new Error(`Expected a tree at the given path: ${log$8(g)}`)}return d},Promise.resolve(this)),await n.reverse().reduce(async(i,[s,u])=>(await u.updateDirectChild(await i,s,null),u),Promise.resolve(e)),this}}class BareTree extends BaseTree{constructor(e){super(),this.type="BareTree",this.links=e,this.children={}}static async empty(){return new BareTree({})}static async fromCID(e){const t=arrToMap((await ls(e)).map(fromFSFile));return new BareTree(t)}static fromLinks(e){return new BareTree(e)}static instanceOf(e){return isObject(e)&&hasProp(e,"links")&&hasProp(e,"children")&&hasProp(e,"type")&&e.type==="BareTree"}async createChildTree(e,t){const n=await BareTree.empty(),i=this.children[e];if(i){if(isFile(i))throw new Error(`There is a file at the given path: ${e}`);return i}return await this.updateDirectChild(n,e,t),n}async createOrUpdateChildFile(e,t,n){const i=await this.getDirectChild(t);let s;if(i===null)s=await BareFile.create(e);else if(BareFile.instanceOf(i))s=await i.updateContent(e);else throw new Error(`There is already a directory with that name: ${t}`);return await this.updateDirectChild(s,t,n),s}async putDetailed(){return putLinks(this.links)}async putAndUpdateLink(e,t,n){const i=await e.putDetailed();return this.updateLink(t,i),n&&await n(),this}async updateDirectChild(e,t,n){return this.children[t]=e,this.putAndUpdateLink(e,t,n)}removeDirectChild(e){return delete this.links[e],this.children[e]&&delete this.children[e],this}async getDirectChild(e){if(this.children[e])return this.children[e];const t=this.links[e]||null;if(t===null)return null;const n=decodeCID(t.cid),i=t.isFile?await BareFile.fromCID(n):await BareTree.fromCID(n);return this.children[e]?this.children[e]:(this.children[e]=i,i)}async get(e){const[t,...n]=e;if(!t)return this;const i=await this.getDirectChild(t);if(n.length){if(i===null||isFile(i))return null}else return i;return i.get(n)}updateLink(e,t){const{cid:n,size:i,isFile:s}=t;return this.links[e]=make(e,n,s,i),this}getLinks(){return this.links}}const nibbles={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0,a:!0,b:!0,c:!0,d:!0,e:!0,f:!0},isNibble=r=>nibbles[r]===!0;class MMPT{constructor(e){this.links=e,this.children={}}static create(){return new MMPT({})}static async fromCID(e){const t=await getSimpleLinks(e);return new MMPT(t)}async putDetailed(){return putLinks(this.links)}async put(){const{cid:e}=await this.putDetailed();return e}async add(e,t){if(!isNibble(e[0]))throw new Error("Not a valid name, must be hexadecimal");const n=this.nextTreeOrSiblingName(e);if(e!==n)if(n===null)this.links[e]=make(e,t,!0,0);else if(n.length===1)await(await this.getDirectChild(n)).add(e.slice(1),t),await this.putAndUpdateChildLink(n);else{const i=this.addEmptyChild(e[0]),s=this.links[n].cid;this.removeChild(n),await Promise.all([i.add(e.slice(1),t),i.add(n.slice(1),decodeCID(s))]),await this.putAndUpdateChildLink(e[0])}}async putAndUpdateChildLink(e){var u,c;const t=(u=this.links[e])==null?void 0:u.cid,{cid:n,size:i}=await this.children[e].putDetailed(),s=(c=this.links[e])==null?void 0:c.cid;if(t!=s)return await this.putAndUpdateChildLink(e);this.links[e]=make(e,n,!1,i)}addEmptyChild(e){const t=MMPT.create();return this.children[e]=t,t}async get(e){const t=this.nextTreeName(e);return t===null?null:t.length>1?decodeCID(this.links[t].cid):(await this.getDirectChild(t)).get(e.slice(1))}async exists(e){return await this.get(e)!==null}async members(){return(await Promise.all(Object.values(this.links).map(async({name:t,cid:n})=>t.length>1?[{name:t,cid:decodeCID(n)}]:(await(await MMPT.fromCID(decodeCID(n))).members()).map(u=>({...u,name:t+u.name}))))).reduce((t,n)=>t.concat(n))}async getDirectChild(e){if(this.children[e])return this.children[e];const t=await MMPT.fromCID(decodeCID(this.links[e].cid));return this.children[e]?this.children[e]:(this.children[e]=t,t)}removeChild(e){delete this.links[e],this.children[e]&&delete this.children[e]}directChildExists(e){return this.links[e]!==void 0||this.children[e]!==void 0}nextTreeName(e){return this.directChildExists(e[0])?e[0]:this.directChildExists(e)?e:null}nextTreeOrSiblingName(e){const t=e[0];return this.directChildExists(t)?t:Object.keys(this.links).find(n=>t===n[0])||null}}class PublicHistory{constructor(e){this.node=e}back(e=-1){const t=Math.abs(Math.min(e,-1));return Array.from({length:t},(n,i)=>i).reduce(n=>n.then(i=>i?PublicHistory._getPreviousVersion(i):null),Promise.resolve(this.node))}async prior(e){return PublicHistory._prior(this.node,e)}async list(e=5){const{acc:t}=await Array.from({length:e},(n,i)=>i).reduce((n,i)=>n.then(({node:s,acc:u})=>s?PublicHistory._getPreviousVersion(s).then(c=>({node:c,acc:[...u,{delta:-(i+1),timestamp:s.header.metadata.unixMeta.mtime}]})):Promise.resolve({node:null,acc:u})),PublicHistory._getPreviousVersion(this.node).then(n=>({node:n,acc:[]})));return t}static async _getPreviousVersion(e){return e.header.previous?e.constructor.fromCID(e.header.previous):Promise.resolve(null)}static async _prior(e,t){if(e.header.metadata.unixMeta.mtime<t)return e;const n=await PublicHistory._getPreviousVersion(e);return n?PublicHistory._prior(n,t):null}}var UnixNodeType;(function(r){r.Raw="raw",r.Directory="dir",r.File="file",r.Metadata="metadata",r.Symlink="symlink",r.HAMTShard="hamtShard"})(UnixNodeType||(UnixNodeType={}));const emptyUnix=r=>({mtime:Date.now(),ctime:Date.now(),mode:r?644:755,_type:r?UnixNodeType.File:UnixNodeType.Directory}),empty=(r,e)=>({isFile:r,version:e,unixMeta:emptyUnix(r)}),updateMtime=r=>({...r,unixMeta:{...r.unixMeta,mtime:Date.now()}});let PublicFile$1=class Gi extends BaseFile{constructor({content:e,header:t,cid:n}){super(e),this.cid=n,this.header=t,this.history=new PublicHistory(this)}static instanceOf(e){return isObject(e)&&hasProp(e,"content")&&hasProp(e,"header")&&isFileHeader(e.header)}static async create(e){return new Gi({content:e,header:{metadata:empty(!0,latest)},cid:null})}static async fromCID(e){const t=await get(e);return Gi.fromInfo(t,e)}static async fromInfo(e,t){const{userland:n,metadata:i,previous:s}=e,u=await getFile(decodeCID(n));return new Gi({content:u,header:{metadata:i,previous:s},cid:t})}async putDetailed(){const e=await putFile(this.content,updateMtime(this.header.metadata),this.cid);return this.cid=e.cid,e}};function nextNonEmpty(r){const e=r.slice(1);return e.length<1?null:e}class PublicTree extends BaseTree{constructor({links:e,header:t,cid:n}){super(),this.children={},this.cid=n,this.links=e,this.header=t,this.history=new PublicHistory(this)}static async empty(){return new PublicTree({links:{},header:{metadata:empty(!1,latest),skeleton:{}},cid:null})}static async fromCID(e){const t=await get(e);if(!isTreeInfo(t))throw new Error(`Could not parse a valid public tree at: ${e}`);return PublicTree.fromInfo(t,e)}static async fromInfo(e,t){const{userland:n,metadata:i,previous:s,skeleton:u}=e,c=await getFileSystemLinks(decodeCID(n));return new PublicTree({links:c,header:{metadata:i,previous:s,skeleton:u},cid:t})}static instanceOf(e){return hasProp(e,"links")&&hasProp(e,"header")&&isLinks(e.links)&&isTreeHeader(e.header)}async createChildTree(e,t){const n=await PublicTree.empty(),i=this.children[e];if(i){if(PublicFile$1.instanceOf(i))throw new Error(`There is a file at the given path: ${e}`);if(PublicTree.instanceOf(i))return i;throw new Error(`Not a public tree at the given path: ${e}`)}return await this.updateDirectChild(n,e,t),n}async createOrUpdateChildFile(e,t,n){const i=await this.getDirectChild(t);let s;if(i===null)s=await PublicFile$1.create(e);else if(PublicFile$1.instanceOf(i))s=await i.updateContent(e);else throw new Error(`There is already a directory with that name: ${t}`);return await this.updateDirectChild(s,t,n),s}async putDetailed(){const e=await putTree(this.links,this.header.skeleton,this.header.metadata,this.cid);return this.header.previous=this.cid||void 0,this.cid=e.cid,e}async updateDirectChild(e,t,n){if(this.readOnly)throw new Error("Tree is read-only");this.children[t]=e;const i=await e.putDetailed();return this.updateLink(t,i),n&&await n(),this}removeDirectChild(e){return delete this.links[e],delete this.header.skeleton[e],this.children[e]&&delete this.children[e],this}async getDirectChild(e){let t=null;if(this.children[e])return this.children[e];const n=this.header.skeleton[e]||null;if(n===null)return null;if(isSkeletonInfo(n)){const i=decodeCID(n.cid);t=n.isFile?await PublicFile$1.fromCID(i):await PublicTree.fromCID(i)}else if(isSoftLink(n))return PublicTree.resolveSoftLink(n);return this.children[e]?this.children[e]:(t&&(this.children[e]=t),t)}async get(e){if(e.length<1)return this;const t=await this.getRecurse(this.header.skeleton,e);if(isSkeletonInfo(t)){const n=decodeCID(t.cid),i=await get(n);return isFileInfo(i)?PublicFile$1.fromInfo(i,n):PublicTree.fromInfo(i,n)}return t}async getRecurse(e,t){const n=t[0],i=e[n]||null,s=nextNonEmpty(t);if(isSoftLink(i)){const u=await PublicTree.resolveSoftLink(i);return s?PublicTree.instanceOf(u)?u.get(s).then(makeReadOnly$1):null:u}else return i===null||s===null?i:i.subSkeleton?this.getRecurse(i.subSkeleton,s):null}assignLink({name:e,link:t,skeleton:n}){this.links[e]=t,this.header.skeleton[e]=n,this.header.metadata.unixMeta.mtime=Date.now()}static async resolveSoftLink(e){const[t,...n]=e.ipns.split("/"),i=fromPosix(n.join("/"));if(!(isBranch(Branch.Public,i)||isBranch(Branch.Pretty,i)))throw new Error("Mixing public and private soft links is not supported yet.");const u=t===await authenticatedUserDomain({withFiles:!0})?await newest():await lookupDnsLink(t);if(!u)throw new Error(`Failed to resolve the soft link: ${e.ipns} - Could not resolve DNSLink`);const c=(await getSimpleLinks(decodeCID(u))).public.cid,d=removeBranch(i),_=await(await PublicTree.fromCID(decodeCID(c))).get(unwrap$2(d));return _&&(_.readOnly=!0),_}getLinks(){return Object.values(this.links).reduce((e,t)=>{const n=this.header.skeleton[t.name];return{...e,[t.name]:n&&n.isFile!==void 0?{...t,isFile:n.isFile}:{...t}}},{})}updateLink(e,t){const{cid:n,metadata:i,userland:s,size:u,isFile:c,skeleton:d}=t;return this.assignLink({name:e,link:make(e,n,!1,u),skeleton:{cid:n,metadata:i,userland:s,subSkeleton:d,isFile:c}}),this}insertSoftLink({name:e,path:t,username:n}){const i={ipns:`${n}.files.${setup.endpoints.user}/public/${toPosix(t)}`,name:e};return this.assignLink({name:e,link:i,skeleton:i}),this}}function makeReadOnly$1(r){return r&&(r.readOnly=!0),r}class PrivateHistory{constructor(e){this.node=e}async back(e=-1){var i;const t=Math.min(e,-1),n=(i=this.node.header)==null?void 0:i.revision;return n&&await this._getRevision(n+t)||null}async prior(e){return this.node.header.metadata.unixMeta.mtime<e?this.node:this._prior(this.node.header.revision-1,e)}async list(e=5){const t=this.node.header.revision;return Promise.all(Array.from({length:e},(n,i)=>{const s=i+1;return this._getRevisionInfoFromNumber(t-s).then(u=>({revisionInfo:u,delta:-s}))})).then(n=>n.filter(i=>!!i.revisionInfo)).then(n=>n.map(i=>{const s=i.revisionInfo.metadata.unixMeta.mtime;return{delta:i.delta,timestamp:s}}))}async _getRevision(e){const t=await this._getRevisionInfoFromNumber(e);return t&&await this.node.constructor.fromInfo(this.node.mmpt,this.node.key,t)}_getRevisionInfo(e){return readNode(decodeCID(e.cid),this.node.key)}async _getRevisionInfoFromNumber(e){const{key:t,mmpt:n}=this.node,{bareNameFilter:i}=this.node.header,s=await getRevision(n,i,t,e);return s&&this._getRevisionInfo(s)}async _prior(e,t){const n=await this._getRevisionInfoFromNumber(e);return n!=null&&n.revision?n.metadata.unixMeta.mtime<t?this._getRevision(n.revision):this._prior(n.revision-1,t):null}}let PrivateFile$1=class si extends BaseFile{constructor({content:e,mmpt:t,key:n,header:i}){super(e),this.header=i,this.history=new PrivateHistory(this),this.key=n,this.mmpt=t}static instanceOf(e){return isObject(e)&&hasProp(e,"content")&&hasProp(e,"mmpt")&&hasProp(e,"header")&&isPrivateFileInfo(e.header)}static async create(e,t,n,i){const s=await addToBare(n,i),u=await aes.genKeyStr(),c=await putEncryptedFile(t,u);return new si({content:t,mmpt:e,key:i,header:{bareNameFilter:s,key:u,revision:1,metadata:empty(!0,latest),content:c.cid}})}static async fromBareNameFilter(e,t,n){const i=await getLatestByBareNameFilter(e,t,n);return this.fromInfo(e,n,i)}static async fromLatestName(e,t,n){const i=await getLatestByName(e,t,n);return si.fromInfo(e,n,i)}static async fromName(e,t,n){const i=await getByName(e,t,n);return si.fromInfo(e,n,i)}static async fromInfo(e,t,n){if(!isPrivateFileInfo(n))throw new Error("Could not parse a valid private file using the given key");const i=await getEncryptedFile(decodeCID(n.content),n.key);return new si({content:i,key:t,mmpt:e,header:n})}async getName(){const{bareNameFilter:e,revision:t}=this.header,n=await addRevision(e,this.key,t);return toPrivateName(n)}async updateParentNameFilter(e){return this.header.bareNameFilter=await addToBare(e,this.header.key),this}async updateContent(e){const t=await putEncryptedFile(e,this.header.key);return this.content=e,this.header={...this.header,revision:this.header.revision+1,content:t.cid},this}async putDetailed(){return addNode(this.mmpt,{...this.header,metadata:updateMtime(this.header.metadata)},this.key)}};class PrivateTree extends BaseTree{constructor({mmpt:e,key:t,header:n}){super(),this.children={},this.header=n,this.history=new PrivateHistory(this),this.key=t,this.mmpt=e}static instanceOf(e){return isObject(e)&&hasProp(e,"mmpt")&&hasProp(e,"header")&&isPrivateTreeInfo(e.header)}static async create(e,t,n){const i=n?await addToBare(n,t):await createBare(t);return new PrivateTree({mmpt:e,key:t,header:{metadata:empty(!1,latest),bareNameFilter:i,revision:1,links:{},skeleton:{}}})}static async fromBaseKey(e,t){const n=await createBare(t);return this.fromBareNameFilter(e,n,t)}static async fromBareNameFilter(e,t,n){const i=await getLatestByBareNameFilter(e,t,n);return this.fromInfo(e,n,i)}static async fromLatestName(e,t,n){const i=await getLatestByName(e,t,n);return this.fromInfo(e,n,i)}static async fromName(e,t,n){const i=await getByName(e,t,n);return this.fromInfo(e,n,i)}static async fromInfo(e,t,n){if(!isPrivateTreeInfo(n))throw new Error("Could not parse a valid private tree using the given key");return new PrivateTree({mmpt:e,key:t,header:n})}async createChildTree(e,t){const n=await aes.genKeyStr(),i=await PrivateTree.create(this.mmpt,n,this.header.bareNameFilter),s=this.children[e];if(s){if(PrivateFile$1.instanceOf(s))throw new Error(`There is a file at the given path: ${e}`);return s}return await this.updateDirectChild(i,e,t),i}async createOrUpdateChildFile(e,t,n){const i=await this.getDirectChild(t);let s;if(i===null){const u=await aes.genKeyStr();s=await PrivateFile$1.create(this.mmpt,e,this.header.bareNameFilter,u)}else if(PrivateFile$1.instanceOf(i))s=await i.updateContent(e);else throw new Error(`There is already a directory with that name: ${t}`);return await this.updateDirectChild(s,t,n),s}async putDetailed(){const e=Object.assign({},this.header);return addNode(this.mmpt,e,this.key)}async updateDirectChild(e,t,n){if(this.readOnly)throw new Error("Tree is read-only");await e.updateParentNameFilter(this.header.bareNameFilter),this.children[t]=e;const i=await e.putDetailed();return this.updateLink(t,i),n&&await n(),this}removeDirectChild(e){return this.header={...this.header,revision:this.header.revision+1,links:removeKeyFromObj(this.header.links,e),skeleton:removeKeyFromObj(this.header.skeleton,e)},this.children[e]&&delete this.children[e],this}async getDirectChild(e){let t=null;if(this.children[e])return this.children[e];const n=this.header.links[e];if(n===void 0)return null;if(isPrivateLink(n))t=n.isFile?await PrivateFile$1.fromLatestName(this.mmpt,n.pointer,n.key):await PrivateTree.fromLatestName(this.mmpt,n.pointer,n.key);else if(isSoftLink(n))return PrivateTree.resolveSoftLink(n);return this.children[e]?this.children[e]:(t&&(this.children[e]=t),t)}async getName(){const{bareNameFilter:e,revision:t}=this.header,n=await addRevision(e,this.key,t);return toPrivateName(n)}async updateParentNameFilter(e){return this.header.bareNameFilter=await addToBare(e,this.key),this}async get(e){if(e.length===0)return this;const[t,...n]=e,i=this.header.skeleton[t];return i===void 0?null:this.getRecurse(i,n)}async getRecurse(e,t){const[n,...i]=t;if(isSoftLink(e)){const d=await PrivateTree.resolveSoftLink(e);if(!d)return null;if(n===void 0)return d;if(PrivateTree.instanceOf(d))return d.get(t).then(makeReadOnly);throw new Error("Was expecting a directory at: "+log$8(t))}if(n===void 0)return getNode(this.mmpt,e);const s=e.subSkeleton[n];if(s!==void 0)return this.getRecurse(s,i);const u=await getLatestByCID(this.mmpt,decodeCID(e.cid),e.key);if(!isPrivateTreeInfo(u))return null;const c=u.skeleton[n];return c===void 0?null:this.getRecurse(c,i)}assignLink({name:e,link:t,skeleton:n}){this.header.links[e]=t,this.header.skeleton[e]=n,this.header.revision=this.header.revision+1,this.header.metadata.unixMeta.mtime=Date.now()}static async resolveSoftLink(e){const t=e.ipns.split("/")[0];if(!e.privateName||!e.key)throw new Error("Mixing public and private soft links is not supported yet.");const n=t===await authenticatedUserDomain({withFiles:!0})?await newest():await lookupDnsLink(t);if(!n)throw new Error(`Failed to resolve the soft link: ${e.ipns} - Could not resolve DNSLink`);const i=(await getSimpleLinks(decodeCID(n))).private.cid,s=await MMPT.fromCID(decodeCID(i)),u=await getLatestByName(s,e.privateName,e.key);if(!u)return null;const c=u.metadata.isFile?await PrivateFile$1.fromInfo(s,e.key,u):await PrivateTree.fromInfo(s,e.key,u);return c&&(c.readOnly=!0),c}getLinks(){return mapObj(this.header.links,e=>{if(isSoftLink(e))return{...e};{const{key:t,...n}=e;return{...n}}})}updateLink(e,t){const{cid:n,size:i,key:s,isFile:u,skeleton:c}=t,d=t.name;return this.assignLink({name:e,link:{name:e,key:s,pointer:d,size:i,isFile:u},skeleton:{cid:n,key:s,subSkeleton:c}}),this}insertSoftLink({name:e,username:t,key:n,privateName:i}){const s={ipns:`${t}.files.${setup.endpoints.user}`,name:e,privateName:i,key:n};return this.assignLink({name:e,link:s,skeleton:s}),this}}async function getNode(r,e){const t=await getLatestByCID(r,decodeCID(e.cid),e.key);return isPrivateFileInfo(t)?await PrivateFile$1.fromInfo(r,e.key,t):await PrivateTree.fromInfo(r,e.key,t)}function makeReadOnly(r){return r&&(r.readOnly=!0),r}let wasm;const heap=new Array(32).fill(void 0);heap.push(void 0,null,!0,!1);function getObject(r){return heap[r]}let heap_next=heap.length;function dropObject(r){r<36||(heap[r]=heap_next,heap_next=r)}function takeObject(r){const e=getObject(r);return dropObject(r),e}let WASM_VECTOR_LEN=0,cachedUint8Memory0=new Uint8Array;function getUint8Memory0(){return cachedUint8Memory0.byteLength===0&&(cachedUint8Memory0=new Uint8Array(wasm.memory.buffer)),cachedUint8Memory0}const cachedTextEncoder=new TextEncoder("utf-8"),encodeString=typeof cachedTextEncoder.encodeInto=="function"?function(r,e){return cachedTextEncoder.encodeInto(r,e)}:function(r,e){const t=cachedTextEncoder.encode(r);return e.set(t),{read:r.length,written:t.length}};function passStringToWasm0(r,e,t){if(t===void 0){const c=cachedTextEncoder.encode(r),d=e(c.length);return getUint8Memory0().subarray(d,d+c.length).set(c),WASM_VECTOR_LEN=c.length,d}let n=r.length,i=e(n);const s=getUint8Memory0();let u=0;for(;u<n;u++){const c=r.charCodeAt(u);if(c>127)break;s[i+u]=c}if(u!==n){u!==0&&(r=r.slice(u)),i=t(i,n,n=u+r.length*3);const c=getUint8Memory0().subarray(i+u,i+n),d=encodeString(r,c);u+=d.written}return WASM_VECTOR_LEN=u,i}function isLikeNone(r){return r==null}let cachedInt32Memory0=new Int32Array;function getInt32Memory0(){return cachedInt32Memory0.byteLength===0&&(cachedInt32Memory0=new Int32Array(wasm.memory.buffer)),cachedInt32Memory0}const cachedTextDecoder=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});cachedTextDecoder.decode();function getStringFromWasm0(r,e){return cachedTextDecoder.decode(getUint8Memory0().subarray(r,r+e))}function addHeapObject(r){heap_next===heap.length&&heap.push(heap.length+1);const e=heap_next;return heap_next=heap[e],heap[e]=r,e}function debugString(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let s="[";i>0&&(s+=debugString(r[0]));for(let u=1;u<i;u++)s+=", "+debugString(r[u]);return s+="]",s}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}const CLOSURE_DTORS=new FinalizationRegistry(r=>{wasm.__wbindgen_export_2.get(r.dtor)(r.a,r.b)});function makeMutClosure(r,e,t,n){const i={a:r,b:e,cnt:1,dtor:t},s=(...u)=>{i.cnt++;const c=i.a;i.a=0;try{return n(c,i.b,...u)}finally{--i.cnt===0?(wasm.__wbindgen_export_2.get(i.dtor)(c,i.b),CLOSURE_DTORS.unregister(i)):i.a=c}};return s.original=i,CLOSURE_DTORS.register(s,i,i),s}function __wbg_adapter_20(r,e,t){wasm._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__hc27b8398328eaeb8(r,e,addHeapObject(t))}let stack_pointer=32;function addBorrowedObject(r){if(stack_pointer==1)throw new Error("out of js stack");return heap[--stack_pointer]=r,stack_pointer}function passArray8ToWasm0(r,e){const t=e(r.length*1);return getUint8Memory0().set(r,t/1),WASM_VECTOR_LEN=r.length,t}let cachedUint32Memory0=new Uint32Array;function getUint32Memory0(){return cachedUint32Memory0.byteLength===0&&(cachedUint32Memory0=new Uint32Array(wasm.memory.buffer)),cachedUint32Memory0}function getArrayJsValueFromWasm0(r,e){const n=getUint32Memory0().subarray(r/4,r/4+e),i=[];for(let s=0;s<n.length;s++)i.push(takeObject(n[s]));return i}function getArrayU8FromWasm0(r,e){return getUint8Memory0().subarray(r/1,r/1+e)}function _assertClass(r,e){if(!(r instanceof e))throw new Error(`expected instance of ${e.name}`);return r.ptr}function handleError(r,e){try{return r.apply(this,e)}catch(t){wasm.__wbindgen_exn_store(addHeapObject(t))}}function __wbg_adapter_114(r,e,t,n){wasm.wasm_bindgen__convert__closures__invoke2_mut__h0dd9664dc5d57891(r,e,addHeapObject(t),addHeapObject(n))}new FinalizationRegistry(r=>wasm.__wbg_foreignblockstore_free(r));const NamefilterFinalization=new FinalizationRegistry(r=>wasm.__wbg_namefilter_free(r));class Namefilter{static __wrap(e){const t=Object.create(Namefilter.prototype);return t.ptr=e,NamefilterFinalization.register(t,t.ptr,t),t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,NamefilterFinalization.unregister(this),e}free(){const e=this.__destroy_into_raw();wasm.__wbg_namefilter_free(e)}constructor(){const e=wasm.namefilter_new();return Namefilter.__wrap(e)}}const PrivateDirectoryFinalization=new FinalizationRegistry(r=>wasm.__wbg_privatedirectory_free(r));class PrivateDirectory{static __wrap(e){const t=Object.create(PrivateDirectory.prototype);return t.ptr=e,PrivateDirectoryFinalization.register(t,t.ptr,t),t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,PrivateDirectoryFinalization.unregister(this),e}free(){const e=this.__destroy_into_raw();wasm.__wbg_privatedirectory_free(e)}constructor(e,t,n){try{const d=wasm.__wbindgen_add_to_stack_pointer(-16);_assertClass(e,Namefilter);var i=e.ptr;e.ptr=0,wasm.privatedirectory_new(d,i,addBorrowedObject(t),addHeapObject(n));var s=getInt32Memory0()[d/4+0],u=getInt32Memory0()[d/4+1],c=getInt32Memory0()[d/4+2];if(c)throw takeObject(u);return PrivateDirectory.__wrap(s)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0}}static withSeed(e,t,n,i){try{const g=wasm.__wbindgen_add_to_stack_pointer(-16);_assertClass(e,Namefilter);var s=e.ptr;e.ptr=0;const _=passArray8ToWasm0(n,wasm.__wbindgen_malloc),f=WASM_VECTOR_LEN,l=passArray8ToWasm0(i,wasm.__wbindgen_malloc),h=WASM_VECTOR_LEN;wasm.privatedirectory_withSeed(g,s,addBorrowedObject(t),_,f,l,h);var u=getInt32Memory0()[g/4+0],c=getInt32Memory0()[g/4+1],d=getInt32Memory0()[g/4+2];if(d)throw takeObject(c);return PrivateDirectory.__wrap(u)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0}}getNode(e,t,n,i){try{const g=wasm.__wbindgen_add_to_stack_pointer(-16);_assertClass(n,PrivateForest);var s=n.ptr;n.ptr=0,wasm.privatedirectory_getNode(g,this.ptr,addBorrowedObject(e),t,s,addHeapObject(i));var u=getInt32Memory0()[g/4+0],c=getInt32Memory0()[g/4+1],d=getInt32Memory0()[g/4+2];if(d)throw takeObject(c);return takeObject(u)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0}}lookupNode(e,t,n,i){try{const g=wasm.__wbindgen_add_to_stack_pointer(-16),_=passStringToWasm0(e,wasm.__wbindgen_malloc,wasm.__wbindgen_realloc),f=WASM_VECTOR_LEN;_assertClass(n,PrivateForest);var s=n.ptr;n.ptr=0,wasm.privatedirectory_lookupNode(g,this.ptr,_,f,t,s,addHeapObject(i));var u=getInt32Memory0()[g/4+0],c=getInt32Memory0()[g/4+1],d=getInt32Memory0()[g/4+2];if(d)throw takeObject(c);return takeObject(u)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}read(e,t,n,i){try{const g=wasm.__wbindgen_add_to_stack_pointer(-16);_assertClass(n,PrivateForest);var s=n.ptr;n.ptr=0,wasm.privatedirectory_read(g,this.ptr,addBorrowedObject(e),t,s,addHeapObject(i));var u=getInt32Memory0()[g/4+0],c=getInt32Memory0()[g/4+1],d=getInt32Memory0()[g/4+2];if(d)throw takeObject(c);return takeObject(u)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0}}ls(e,t,n,i){try{const g=wasm.__wbindgen_add_to_stack_pointer(-16);_assertClass(n,PrivateForest);var s=n.ptr;n.ptr=0,wasm.privatedirectory_ls(g,this.ptr,addBorrowedObject(e),t,s,addHeapObject(i));var u=getInt32Memory0()[g/4+0],c=getInt32Memory0()[g/4+1],d=getInt32Memory0()[g/4+2];if(d)throw takeObject(c);return takeObject(u)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0}}rm(e,t,n,i,s){try{const _=wasm.__wbindgen_add_to_stack_pointer(-16);_assertClass(n,PrivateForest);var u=n.ptr;n.ptr=0,wasm.privatedirectory_rm(_,this.ptr,addBorrowedObject(e),t,u,addHeapObject(i),addHeapObject(s));var c=getInt32Memory0()[_/4+0],d=getInt32Memory0()[_/4+1],g=getInt32Memory0()[_/4+2];if(g)throw takeObject(d);return takeObject(c)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0}}write(e,t,n,i,s,u,c){try{const l=wasm.__wbindgen_add_to_stack_pointer(-16),h=passArray8ToWasm0(n,wasm.__wbindgen_malloc),p=WASM_VECTOR_LEN;_assertClass(s,PrivateForest);var d=s.ptr;s.ptr=0,wasm.privatedirectory_write(l,this.ptr,addBorrowedObject(e),t,h,p,addBorrowedObject(i),d,addHeapObject(u),addHeapObject(c));var g=getInt32Memory0()[l/4+0],_=getInt32Memory0()[l/4+1],f=getInt32Memory0()[l/4+2];if(f)throw takeObject(_);return takeObject(g)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0,heap[stack_pointer++]=void 0}}basicMv(e,t,n,i,s,u,c){try{const l=wasm.__wbindgen_add_to_stack_pointer(-16);_assertClass(s,PrivateForest);var d=s.ptr;s.ptr=0,wasm.privatedirectory_basicMv(l,this.ptr,addBorrowedObject(e),addBorrowedObject(t),n,addBorrowedObject(i),d,addHeapObject(u),addHeapObject(c));var g=getInt32Memory0()[l/4+0],_=getInt32Memory0()[l/4+1],f=getInt32Memory0()[l/4+2];if(f)throw takeObject(_);return takeObject(g)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0,heap[stack_pointer++]=void 0,heap[stack_pointer++]=void 0}}cp(e,t,n,i,s,u,c){try{const l=wasm.__wbindgen_add_to_stack_pointer(-16);_assertClass(s,PrivateForest);var d=s.ptr;s.ptr=0,wasm.privatedirectory_cp(l,this.ptr,addBorrowedObject(e),addBorrowedObject(t),n,addBorrowedObject(i),d,addHeapObject(u),addHeapObject(c));var g=getInt32Memory0()[l/4+0],_=getInt32Memory0()[l/4+1],f=getInt32Memory0()[l/4+2];if(f)throw takeObject(_);return takeObject(g)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0,heap[stack_pointer++]=void 0,heap[stack_pointer++]=void 0}}mkdir(e,t,n,i,s,u){try{const f=wasm.__wbindgen_add_to_stack_pointer(-16);_assertClass(i,PrivateForest);var c=i.ptr;i.ptr=0,wasm.privatedirectory_mkdir(f,this.ptr,addBorrowedObject(e),t,addBorrowedObject(n),c,addHeapObject(s),addHeapObject(u));var d=getInt32Memory0()[f/4+0],g=getInt32Memory0()[f/4+1],_=getInt32Memory0()[f/4+2];if(_)throw takeObject(g);return takeObject(d)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0,heap[stack_pointer++]=void 0}}getId(){try{const n=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.privatedirectory_getId(n,this.ptr);var e=getInt32Memory0()[n/4+0],t=getInt32Memory0()[n/4+1];return getStringFromWasm0(e,t)}finally{wasm.__wbindgen_add_to_stack_pointer(16),wasm.__wbindgen_free(e,t)}}}const PrivateFileFinalization=new FinalizationRegistry(r=>wasm.__wbg_privatefile_free(r));class PrivateFile{static __wrap(e){const t=Object.create(PrivateFile.prototype);return t.ptr=e,PrivateFileFinalization.register(t,t.ptr,t),t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,PrivateFileFinalization.unregister(this),e}free(){const e=this.__destroy_into_raw();wasm.__wbg_privatefile_free(e)}constructor(e,t,n){try{const d=wasm.__wbindgen_add_to_stack_pointer(-16);_assertClass(e,Namefilter);var i=e.ptr;e.ptr=0,wasm.privatefile_new(d,i,addBorrowedObject(t),addHeapObject(n));var s=getInt32Memory0()[d/4+0],u=getInt32Memory0()[d/4+1],c=getInt32Memory0()[d/4+2];if(c)throw takeObject(u);return PrivateFile.__wrap(s)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0}}static withContent(e,t,n,i,s,u){try{const l=wasm.__wbindgen_add_to_stack_pointer(-16);_assertClass(e,Namefilter);var c=e.ptr;e.ptr=0;const h=passArray8ToWasm0(n,wasm.__wbindgen_malloc),p=WASM_VECTOR_LEN;_assertClass(i,PrivateForest);var d=i.ptr;i.ptr=0,wasm.privatefile_withContent(l,c,addBorrowedObject(t),h,p,d,addHeapObject(s),addHeapObject(u));var g=getInt32Memory0()[l/4+0],_=getInt32Memory0()[l/4+1],f=getInt32Memory0()[l/4+2];if(f)throw takeObject(_);return takeObject(g)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0}}getContent(e,t){try{const c=wasm.__wbindgen_add_to_stack_pointer(-16);_assertClass(e,PrivateForest);var n=e.ptr;e.ptr=0,wasm.privatefile_getContent(c,this.ptr,n,addHeapObject(t));var i=getInt32Memory0()[c/4+0],s=getInt32Memory0()[c/4+1],u=getInt32Memory0()[c/4+2];if(u)throw takeObject(s);return takeObject(i)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}getId(){try{const n=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.privatefile_getId(n,this.ptr);var e=getInt32Memory0()[n/4+0],t=getInt32Memory0()[n/4+1];return getStringFromWasm0(e,t)}finally{wasm.__wbindgen_add_to_stack_pointer(16),wasm.__wbindgen_free(e,t)}}}const PrivateForestFinalization=new FinalizationRegistry(r=>wasm.__wbg_privateforest_free(r));class PrivateForest{static __wrap(e){const t=Object.create(PrivateForest.prototype);return t.ptr=e,PrivateForestFinalization.register(t,t.ptr,t),t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,PrivateForestFinalization.unregister(this),e}free(){const e=this.__destroy_into_raw();wasm.__wbg_privateforest_free(e)}constructor(){const e=wasm.privateforest_new();return PrivateForest.__wrap(e)}get(e,t,n){try{const c=wasm.__wbindgen_add_to_stack_pointer(-16),d=passArray8ToWasm0(e,wasm.__wbindgen_malloc),g=WASM_VECTOR_LEN,_=passArray8ToWasm0(t,wasm.__wbindgen_malloc),f=WASM_VECTOR_LEN;wasm.privateforest_get(c,this.ptr,d,g,_,f,addHeapObject(n));var i=getInt32Memory0()[c/4+0],s=getInt32Memory0()[c/4+1],u=getInt32Memory0()[c/4+2];if(u)throw takeObject(s);return takeObject(i)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}}const PrivateNodeFinalization=new FinalizationRegistry(r=>wasm.__wbg_privatenode_free(r));class PrivateNode{static __wrap(e){const t=Object.create(PrivateNode.prototype);return t.ptr=e,PrivateNodeFinalization.register(t,t.ptr,t),t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,PrivateNodeFinalization.unregister(this),e}free(){const e=this.__destroy_into_raw();wasm.__wbg_privatenode_free(e)}asDir(){try{const i=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.privatenode_asDir(i,this.ptr);var e=getInt32Memory0()[i/4+0],t=getInt32Memory0()[i/4+1],n=getInt32Memory0()[i/4+2];if(n)throw takeObject(t);return PrivateDirectory.__wrap(e)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}isDir(){return wasm.privatenode_isDir(this.ptr)!==0}getId(){try{const n=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.privatenode_getId(n,this.ptr);var e=getInt32Memory0()[n/4+0],t=getInt32Memory0()[n/4+1];return getStringFromWasm0(e,t)}finally{wasm.__wbindgen_add_to_stack_pointer(16),wasm.__wbindgen_free(e,t)}}}const PublicDirectoryFinalization=new FinalizationRegistry(r=>wasm.__wbg_publicdirectory_free(r));class PublicDirectory{static __wrap(e){const t=Object.create(PublicDirectory.prototype);return t.ptr=e,PublicDirectoryFinalization.register(t,t.ptr,t),t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,PublicDirectoryFinalization.unregister(this),e}free(){const e=this.__destroy_into_raw();wasm.__wbg_publicdirectory_free(e)}constructor(e){try{const t=wasm.publicdirectory_new(addBorrowedObject(e));return PublicDirectory.__wrap(t)}finally{heap[stack_pointer++]=void 0}}getNode(e,t){try{const u=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicdirectory_getNode(u,this.ptr,addBorrowedObject(e),addHeapObject(t));var n=getInt32Memory0()[u/4+0],i=getInt32Memory0()[u/4+1],s=getInt32Memory0()[u/4+2];if(s)throw takeObject(i);return takeObject(n)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0}}lookupNode(e,t){try{const u=wasm.__wbindgen_add_to_stack_pointer(-16),c=passStringToWasm0(e,wasm.__wbindgen_malloc,wasm.__wbindgen_realloc),d=WASM_VECTOR_LEN;wasm.publicdirectory_lookupNode(u,this.ptr,c,d,addHeapObject(t));var n=getInt32Memory0()[u/4+0],i=getInt32Memory0()[u/4+1],s=getInt32Memory0()[u/4+2];if(s)throw takeObject(i);return takeObject(n)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}store(e){try{const s=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicdirectory_store(s,this.ptr,addHeapObject(e));var t=getInt32Memory0()[s/4+0],n=getInt32Memory0()[s/4+1],i=getInt32Memory0()[s/4+2];if(i)throw takeObject(n);return takeObject(t)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}static load(e,t){try{const u=wasm.__wbindgen_add_to_stack_pointer(-16),c=passArray8ToWasm0(e,wasm.__wbindgen_malloc),d=WASM_VECTOR_LEN;wasm.publicdirectory_load(u,c,d,addHeapObject(t));var n=getInt32Memory0()[u/4+0],i=getInt32Memory0()[u/4+1],s=getInt32Memory0()[u/4+2];if(s)throw takeObject(i);return takeObject(n)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}read(e,t){try{const u=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicdirectory_read(u,this.ptr,addBorrowedObject(e),addHeapObject(t));var n=getInt32Memory0()[u/4+0],i=getInt32Memory0()[u/4+1],s=getInt32Memory0()[u/4+2];if(s)throw takeObject(i);return takeObject(n)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0}}ls(e,t){try{const u=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicdirectory_ls(u,this.ptr,addBorrowedObject(e),addHeapObject(t));var n=getInt32Memory0()[u/4+0],i=getInt32Memory0()[u/4+1],s=getInt32Memory0()[u/4+2];if(s)throw takeObject(i);return takeObject(n)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0}}rm(e,t){try{const u=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicdirectory_rm(u,this.ptr,addBorrowedObject(e),addHeapObject(t));var n=getInt32Memory0()[u/4+0],i=getInt32Memory0()[u/4+1],s=getInt32Memory0()[u/4+2];if(s)throw takeObject(i);return takeObject(n)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0}}write(e,t,n,i){try{const d=wasm.__wbindgen_add_to_stack_pointer(-16),g=passArray8ToWasm0(t,wasm.__wbindgen_malloc),_=WASM_VECTOR_LEN;wasm.publicdirectory_write(d,this.ptr,addBorrowedObject(e),g,_,addBorrowedObject(n),addHeapObject(i));var s=getInt32Memory0()[d/4+0],u=getInt32Memory0()[d/4+1],c=getInt32Memory0()[d/4+2];if(c)throw takeObject(u);return takeObject(s)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0,heap[stack_pointer++]=void 0}}basicMv(e,t,n,i){try{const d=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicdirectory_basicMv(d,this.ptr,addBorrowedObject(e),addBorrowedObject(t),addBorrowedObject(n),addHeapObject(i));var s=getInt32Memory0()[d/4+0],u=getInt32Memory0()[d/4+1],c=getInt32Memory0()[d/4+2];if(c)throw takeObject(u);return takeObject(s)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0,heap[stack_pointer++]=void 0,heap[stack_pointer++]=void 0}}mkdir(e,t,n){try{const c=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicdirectory_mkdir(c,this.ptr,addBorrowedObject(e),addBorrowedObject(t),addHeapObject(n));var i=getInt32Memory0()[c/4+0],s=getInt32Memory0()[c/4+1],u=getInt32Memory0()[c/4+2];if(u)throw takeObject(s);return takeObject(i)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0,heap[stack_pointer++]=void 0}}baseHistoryOn(e,t){try{const u=wasm.__wbindgen_add_to_stack_pointer(-16);_assertClass(e,PublicDirectory),wasm.publicdirectory_baseHistoryOn(u,this.ptr,e.ptr,addHeapObject(t));var n=getInt32Memory0()[u/4+0],i=getInt32Memory0()[u/4+1],s=getInt32Memory0()[u/4+2];if(s)throw takeObject(i);return takeObject(n)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}previousCids(){try{const i=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicdirectory_previousCids(i,this.ptr);var e=getInt32Memory0()[i/4+0],t=getInt32Memory0()[i/4+1],n=getArrayJsValueFromWasm0(e,t).slice();return wasm.__wbindgen_free(e,t*4),n}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}metadata(){try{const i=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicdirectory_metadata(i,this.ptr);var e=getInt32Memory0()[i/4+0],t=getInt32Memory0()[i/4+1],n=getInt32Memory0()[i/4+2];if(n)throw takeObject(t);return takeObject(e)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}asNode(){const e=wasm.publicdirectory_asNode(this.ptr);return PublicNode.__wrap(e)}getId(){try{const n=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicdirectory_getId(n,this.ptr);var e=getInt32Memory0()[n/4+0],t=getInt32Memory0()[n/4+1];return getStringFromWasm0(e,t)}finally{wasm.__wbindgen_add_to_stack_pointer(16),wasm.__wbindgen_free(e,t)}}}const PublicFileFinalization=new FinalizationRegistry(r=>wasm.__wbg_publicfile_free(r));class PublicFile{static __wrap(e){const t=Object.create(PublicFile.prototype);return t.ptr=e,PublicFileFinalization.register(t,t.ptr,t),t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,PublicFileFinalization.unregister(this),e}free(){const e=this.__destroy_into_raw();wasm.__wbg_publicfile_free(e)}constructor(e,t){try{const u=wasm.__wbindgen_add_to_stack_pointer(-16),c=passArray8ToWasm0(t,wasm.__wbindgen_malloc),d=WASM_VECTOR_LEN;wasm.publicfile_new(u,addBorrowedObject(e),c,d);var n=getInt32Memory0()[u/4+0],i=getInt32Memory0()[u/4+1],s=getInt32Memory0()[u/4+2];if(s)throw takeObject(i);return PublicFile.__wrap(n)}finally{wasm.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0}}getId(){try{const n=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicfile_getId(n,this.ptr);var e=getInt32Memory0()[n/4+0],t=getInt32Memory0()[n/4+1];return getStringFromWasm0(e,t)}finally{wasm.__wbindgen_add_to_stack_pointer(16),wasm.__wbindgen_free(e,t)}}store(e){try{const s=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicfile_store(s,this.ptr,addHeapObject(e));var t=getInt32Memory0()[s/4+0],n=getInt32Memory0()[s/4+1],i=getInt32Memory0()[s/4+2];if(i)throw takeObject(n);return takeObject(t)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}static load(e,t){try{const u=wasm.__wbindgen_add_to_stack_pointer(-16),c=passArray8ToWasm0(e,wasm.__wbindgen_malloc),d=WASM_VECTOR_LEN;wasm.publicfile_load(u,c,d,addHeapObject(t));var n=getInt32Memory0()[u/4+0],i=getInt32Memory0()[u/4+1],s=getInt32Memory0()[u/4+2];if(s)throw takeObject(i);return takeObject(n)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}previousCids(){try{const i=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicfile_previousCids(i,this.ptr);var e=getInt32Memory0()[i/4+0],t=getInt32Memory0()[i/4+1],n=getArrayJsValueFromWasm0(e,t).slice();return wasm.__wbindgen_free(e,t*4),n}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}metadata(){try{const i=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicfile_metadata(i,this.ptr);var e=getInt32Memory0()[i/4+0],t=getInt32Memory0()[i/4+1],n=getInt32Memory0()[i/4+2];if(n)throw takeObject(t);return takeObject(e)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}contentCid(){try{const i=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicfile_contentCid(i,this.ptr);var e=getInt32Memory0()[i/4+0],t=getInt32Memory0()[i/4+1],n=getArrayU8FromWasm0(e,t).slice();return wasm.__wbindgen_free(e,t*1),n}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}}const PublicNodeFinalization=new FinalizationRegistry(r=>wasm.__wbg_publicnode_free(r));class PublicNode{static __wrap(e){const t=Object.create(PublicNode.prototype);return t.ptr=e,PublicNodeFinalization.register(t,t.ptr,t),t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,PublicNodeFinalization.unregister(this),e}free(){const e=this.__destroy_into_raw();wasm.__wbg_publicnode_free(e)}asDir(){try{const i=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicnode_asDir(i,this.ptr);var e=getInt32Memory0()[i/4+0],t=getInt32Memory0()[i/4+1],n=getInt32Memory0()[i/4+2];if(n)throw takeObject(t);return PublicDirectory.__wrap(e)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}asFile(){try{const i=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicnode_asFile(i,this.ptr);var e=getInt32Memory0()[i/4+0],t=getInt32Memory0()[i/4+1],n=getInt32Memory0()[i/4+2];if(n)throw takeObject(t);return PublicFile.__wrap(e)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}isDir(){return wasm.publicnode_isDir(this.ptr)!==0}isFile(){return wasm.publicnode_isFile(this.ptr)!==0}getId(){try{const n=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.publicnode_getId(n,this.ptr);var e=getInt32Memory0()[n/4+0],t=getInt32Memory0()[n/4+1];return getStringFromWasm0(e,t)}finally{wasm.__wbindgen_add_to_stack_pointer(16),wasm.__wbindgen_free(e,t)}}}async function load(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function getImports(){const r={};return r.wbg={},r.wbg.__wbg_randomBytes_144eadee6f31f75a=function(e,t,n){const i=getObject(t).randomBytes(n>>>0),s=passArray8ToWasm0(i,wasm.__wbindgen_malloc),u=WASM_VECTOR_LEN;getInt32Memory0()[e/4+1]=u,getInt32Memory0()[e/4+0]=s},r.wbg.__wbg_privatenode_new=function(e){const t=PrivateNode.__wrap(e);return addHeapObject(t)},r.wbg.__wbg_publicnode_new=function(e){const t=PublicNode.__wrap(e);return addHeapObject(t)},r.wbg.__wbindgen_object_drop_ref=function(e){takeObject(e)},r.wbg.__wbindgen_cb_drop=function(e){const t=takeObject(e).original;return t.cnt--==1?(t.a=0,!0):!1},r.wbg.__wbindgen_string_get=function(e,t){const n=getObject(t),i=typeof n=="string"?n:void 0;var s=isLikeNone(i)?0:passStringToWasm0(i,wasm.__wbindgen_malloc,wasm.__wbindgen_realloc),u=WASM_VECTOR_LEN;getInt32Memory0()[e/4+1]=u,getInt32Memory0()[e/4+0]=s},r.wbg.__wbg_privatefile_new=function(e){const t=PrivateFile.__wrap(e);return addHeapObject(t)},r.wbg.__wbg_privateforest_new=function(e){const t=PrivateForest.__wrap(e);return addHeapObject(t)},r.wbg.__wbindgen_string_new=function(e,t){const n=getStringFromWasm0(e,t);return addHeapObject(n)},r.wbg.__wbindgen_bigint_from_i64=function(e){return addHeapObject(e)},r.wbg.__wbg_privatedirectory_new=function(e){const t=PrivateDirectory.__wrap(e);return addHeapObject(t)},r.wbg.__wbg_publicdirectory_new=function(e){const t=PublicDirectory.__wrap(e);return addHeapObject(t)},r.wbg.__wbg_publicfile_new=function(e){const t=PublicFile.__wrap(e);return addHeapObject(t)},r.wbg.__wbindgen_number_new=function(e){return addHeapObject(e)},r.wbg.__wbg_putBlock_9bc9e503a4dcbd78=function(e,t,n,i){var s=getArrayU8FromWasm0(t,n).slice();wasm.__wbindgen_free(t,n*1);const u=getObject(e).putBlock(s,i>>>0);return addHeapObject(u)},r.wbg.__wbg_getBlock_8a2e41b08bda3b12=function(e,t,n){var i=getArrayU8FromWasm0(t,n).slice();wasm.__wbindgen_free(t,n*1);const s=getObject(e).getBlock(i);return addHeapObject(s)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return addHeapObject(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=getObject(t).stack,i=passStringToWasm0(n,wasm.__wbindgen_malloc,wasm.__wbindgen_realloc),s=WASM_VECTOR_LEN;getInt32Memory0()[e/4+1]=s,getInt32Memory0()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(getStringFromWasm0(e,t))}finally{wasm.__wbindgen_free(e,t)}},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=getObject(e)[t>>>0];return addHeapObject(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return getObject(e).length},r.wbg.__wbg_new_1d9a920c6bfc44a8=function(){const e=new Array;return addHeapObject(e)},r.wbg.__wbg_new_0b9bfdd97583284e=function(){const e=new Object;return addHeapObject(e)},r.wbg.__wbg_push_740e4b286702d964=function(e,t){return getObject(e).push(getObject(t))},r.wbg.__wbg_new_8d2af00bc1e329ee=function(e,t){const n=new Error(getStringFromWasm0(e,t));return addHeapObject(n)},r.wbg.__wbg_call_168da88779e35f61=function(){return handleError(function(e,t,n){const i=getObject(e).call(getObject(t),getObject(n));return addHeapObject(i)},arguments)},r.wbg.__wbg_getTime_cb82adb2556ed13e=function(e){return getObject(e).getTime()},r.wbg.__wbg_new_9962f939219f1820=function(e,t){try{var n={a:e,b:t},i=(u,c)=>{const d=n.a;n.a=0;try{return __wbg_adapter_114(d,n.b,u,c)}finally{n.a=d}};const s=new Promise(i);return addHeapObject(s)}finally{n.a=n.b=0}},r.wbg.__wbg_resolve_99fe17964f31ffc0=function(e){const t=Promise.resolve(getObject(e));return addHeapObject(t)},r.wbg.__wbg_then_11f7a54d67b4bfad=function(e,t){const n=getObject(e).then(getObject(t));return addHeapObject(n)},r.wbg.__wbg_then_cedad20fbbd9418a=function(e,t,n){const i=getObject(e).then(getObject(t),getObject(n));return addHeapObject(i)},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=getObject(e).buffer;return addHeapObject(t)},r.wbg.__wbg_newwithbyteoffsetandlength_d9aa266703cb98be=function(e,t,n){const i=new Uint8Array(getObject(e),t>>>0,n>>>0);return addHeapObject(i)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(getObject(e));return addHeapObject(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){getObject(e).set(getObject(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return getObject(e).length},r.wbg.__wbg_set_bf3f89b92d5a34bf=function(){return handleError(function(e,t,n){return Reflect.set(getObject(e),getObject(t),getObject(n))},arguments)},r.wbg.__wbindgen_debug_string=function(e,t){const n=debugString(getObject(t)),i=passStringToWasm0(n,wasm.__wbindgen_malloc,wasm.__wbindgen_realloc),s=WASM_VECTOR_LEN;getInt32Memory0()[e/4+1]=s,getInt32Memory0()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(getStringFromWasm0(e,t))},r.wbg.__wbindgen_memory=function(){const e=wasm.memory;return addHeapObject(e)},r.wbg.__wbindgen_closure_wrapper1591=function(e,t,n){const i=makeMutClosure(e,t,662,__wbg_adapter_20);return addHeapObject(i)},r}function finalizeInit(r,e){return wasm=r.exports,init$1.__wbindgen_wasm_module=e,cachedInt32Memory0=new Int32Array,cachedUint32Memory0=new Uint32Array,cachedUint8Memory0=new Uint8Array,wasm}async function init$1(r){typeof r>"u"&&(r=new URL(""+new URL("../assets/wnfs_wasm_bg.Bf4PKT4-.wasm",import.meta.url).href,import.meta.url));const e=getImports();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await load(await r,e);return finalizeInit(t,n)}const CODECS={[code]:dagPB,[code$1]:dagCBOR,[code$2]:raw};class IpfsBlockStore{constructor(e){this.ipfs=e}async getBlock(e){const t=CID$1.decode(e);return await this.ipfs.block.get(t)}async putBlock(e,t){const n=CODECS[t].name;if(n==null)throw new Error(`Error during putBlock: Unknown codec: ${numberHex(t)}. Is it part of the multicodec table (https://github.com/multiformats/multicodec/blob/master/table.csv)?`);return(await this.ipfs.block.put(e,{format:n,mhtype:"sha2-256",version:1,pin:!1})).bytes}}function numberHex(r){const e=new Uint8Array(4);return new DataView(e.buffer).setUint32(0,r),`0x${toString$a(e,"hex").replace(/^(00)*/,"")}`}let initialized=!1;async function initOnce(){if(!initialized){initialized=!0;const r=performance.now();await init$1(setup.wnfsWasmLookup(WASM_WNFS_VERSION));const e=performance.now()-r;log$9(`🧪 Loaded WNFS WASM (${e.toFixed(0)}ms)`)}}class PublicRootWasm{constructor(e,t,n,i){this.root=Promise.resolve(e),this.lastRoot=e,this.store=t,this.ipfs=n,this.readOnly=i}static async empty(e){await initOnce();const t=new IpfsBlockStore(e),n=new PublicDirectory(new Date);return new PublicRootWasm(n,t,e,!1)}static async fromCID(e,t){await initOnce();const n=new IpfsBlockStore(e),i=await PublicDirectory.load(t.bytes,n);return new PublicRootWasm(i,n,e,!1)}async atomically(e){const t=await this.root;this.root=e(t),await this.root}async withError(e,t){try{return await e}catch(n){throw console.error(`Error during WASM operation ${t}:`),n}}async ls(e){const t=await this.root,{result:n}=await this.withError(t.getNode(e,this.store),`ls(${e.join("/")})`);if(n==null)throw new Error(`Can't ls ${e.join("/")}: No such directory`);if(!n.isDir())throw new Error(`Can't ls ${e.join("/")}: Not a directory`);const i=n.asDir(),{result:s}=await this.withError(t.ls(e,this.store),`ls(${e.join("/")})`),u={};for(const c of s){const d=await i.lookupNode(c.name,this.store),g=d.isFile()?CID$1.decode(await d.asFile().store(this.store)):CID$1.decode(await d.asDir().store(this.store));u[c.name]={name:c.name,isFile:c.metadata.unixMeta.kind==="file",size:0,cid:g}}return u}async mkdir(e){return await this.atomically(async t=>{const{rootDir:n}=await this.withError(t.mkdir(e,new Date,this.store),`mkdir(${e.join("/")})`);return n}),this}async cat(e){const t=await this.root,{result:n}=await this.withError(t.read(e,this.store),`read(${e.join("/")})`),i=CID$1.decode(n),s=[];for await(const u of this.ipfs.cat(i,{preload:!1}))s.push(u);return concat$2(s)}async add(e,t){const n=await normalizeFileContent(t),{cid:i}=await this.ipfs.add(n,{cidVersion:1,hashAlg:"sha2-256",rawLeaves:!0,wrapWithDirectory:!1,preload:!1,pin:!1});return await this.atomically(async s=>{const{rootDir:u}=await this.withError(s.write(e,i.bytes,new Date,this.store),`write(${e.join("/")})`);return u}),this}async rm(e){return await this.atomically(async t=>{const{rootDir:n}=await this.withError(t.rm(e,this.store),`rm(${e.join("/")})`);return n}),this}async mv(e,t){return await this.atomically(async n=>{const{rootDir:i}=await this.withError(n.basicMv(e,t,new Date,this.store),`basicMv(${e.join("/")}, ${t.join("/")})`);return i}),this}async get(e){const t=await this.root,{result:n}=await this.withError(t.getNode(e,this.store),`getNode(${e.join("/")})`);if(n==null)return null;if(n.isFile()){const i=n.asFile(),s=await this.cat(e),u=e.slice(0,-1),c=e[e.length-1];return new PublicFileWasm(s,u,c,this,i)}else if(n.isDir()){const i=n.asDir();return new PublicDirectoryWasm(this.readOnly,e,this,i)}throw new Error("Unknown node type. Can only handle files and directories.")}async exists(e){const t=await this.root;try{return await t.getNode(e,this.store),!0}catch{return!1}}async historyStep(){return await this.atomically(async e=>{const{rootDir:t}=await e.baseHistoryOn(this.lastRoot,this.store);return this.lastRoot=e,t}),await this.root}async put(){const t=await(await this.historyStep()).store(this.store);return CID$1.decode(t)}async putDetailed(){return{cid:await this.put(),size:0,isFile:!1}}}class PublicDirectoryWasm{constructor(e,t,n,i){this.readOnly=e,this.directory=t,this.publicRoot=n,this.cachedDir=i}checkMutability(e){if(this.readOnly)throw new Error(`Directory is read-only. Cannot ${e}`)}async updateCache(){const t=await(await this.publicRoot.root).getNode(this.directory,this.publicRoot.store);this.cachedDir=t.asDir()}get header(){return nodeHeader(this.cachedDir)}async ls(e){return await this.publicRoot.ls([...this.directory,...e])}async mkdir(e){return this.checkMutability(`mkdir at ${[...this.directory,...e].join("/")}`),await this.publicRoot.mkdir([...this.directory,...e]),await this.updateCache(),this}async cat(e){return await this.publicRoot.cat([...this.directory,...e])}async add(e,t){return this.checkMutability(`write at ${[...this.directory,...e].join("/")}`),await this.publicRoot.add([...this.directory,...e],t),await this.updateCache(),this}async rm(e){return this.checkMutability(`remove at ${[...this.directory,...e].join("/")}`),await this.publicRoot.rm([...this.directory,...e]),await this.updateCache(),this}async mv(e,t){return this.checkMutability(`mv from ${[...this.directory,...e].join("/")} to ${[...this.directory,...t].join("/")}`),await this.publicRoot.mv([...this.directory,...e],[...this.directory,...t]),await this.updateCache(),this}async get(e){return await this.publicRoot.get([...this.directory,...e])}async exists(e){return await this.publicRoot.exists([...this.directory,...e])}async put(){await this.publicRoot.put();const t=await(await this.publicRoot.root).store(this.publicRoot.store);return CID$1.decode(t)}async putDetailed(){return{isFile:!1,size:0,cid:await this.put()}}}class PublicFileWasm extends BaseFile{constructor(e,t,n,i,s){super(e),this.directory=t,this.filename=n,this.publicRoot=i,this.cachedFile=s}async updateCache(){const t=await(await this.publicRoot.root).getNode([...this.directory,this.filename],this.publicRoot.store);this.cachedFile=t.asFile()}get header(){return nodeHeader(this.cachedFile)}async updateContent(e){return await super.updateContent(e),await this.updateCache(),this}async putDetailed(){const e=await this.publicRoot.root,t=[...this.directory,this.filename],{result:n}=await e.getNode(t,this.publicRoot.store);if(n==null)throw new Error(`No file at /${t.join("/")}.`);if(!n.isFile())throw new Error(`Not a file at /${t.join("/")}`);const i=n.asFile();return{isFile:!0,size:0,cid:CID$1.decode(await i.store(this.publicRoot.store))}}}function nodeHeader(r){const e=r.metadata(),t={isFile:e.unixMeta.kind==="file",version:e.version,unixMeta:{_type:e.unixMeta.kind,ctime:Number(e.unixMeta.created),mtime:Number(e.unixMeta.modified),mode:e.unixMeta.mode}},n=r.previousCid();return n==null?{metadata:t}:{metadata:t,previous:CID$1.decode(n)}}class RootTree{constructor({links:e,mmpt:t,privateLog:n,sharedCounter:i,sharedLinks:s,publicTree:u,prettyTree:c,privateNodes:d}){this.links=e,this.mmpt=t,this.privateLog=n,this.sharedCounter=i,this.sharedLinks=s,this.publicTree=u,this.prettyTree=c,this.privateNodes=d}static async empty({rootKey:e,wnfsWasm:t}){const n=t?await PublicRootWasm.empty(await get$1()):await PublicTree.empty(),i=await BareTree.empty(),s=MMPT.create(),u=toPosix(directory(Branch.Private)),c=await PrivateTree.create(s,e,null);await c.put();const d=new RootTree({links:{},mmpt:s,privateLog:[],sharedCounter:1,sharedLinks:{},publicTree:n,prettyTree:i,privateNodes:{[u]:c}});return await RootTree.storeRootKey(e),await d.setVersion(t?wnfsWasm:latest),await Promise.all([d.updatePuttable(Branch.Public,n),d.updatePuttable(Branch.Pretty,i),d.updatePuttable(Branch.Private,s)]),d}static async fromCID({cid:e,permissions:t}){var R,F,k,B,H;const n=await getSimpleLinks(e),i=t?await permissionKeys(t):[],s=await parseVersionFromLinks(n),u=equals$6(s,wnfsWasm),c=((R=n[Branch.Public])==null?void 0:R.cid)||null,d=c===null?await PublicTree.empty():u?await PublicRootWasm.fromCID(await get$1(),decodeCID(c)):await PublicTree.fromCID(decodeCID(c)),g=n[Branch.Pretty]?await BareTree.fromCID(decodeCID(n[Branch.Pretty].cid)):await BareTree.empty(),_=((F=n[Branch.Private])==null?void 0:F.cid)||null;let f,l;_===null?(f=MMPT.create(),l={}):(f=await MMPT.fromCID(decodeCID(_)),l=await loadPrivateNodes(i,f));const h=(k=n[Branch.PrivateLog])==null?void 0:k.cid,p=h?await dagGet(decodeCID(h)).then(re=>re.Links.map(fromDAGLink)).then(re=>re.sort((le,me)=>parseInt(le.name,10)-parseInt(me.name,10))):[],y=((B=n[Branch.Shared])==null?void 0:B.cid)||null,w=y?await this.getSharedLinks(decodeCID(y)):{},v=((H=n[Branch.SharedCounter])==null?void 0:H.cid)||null,C=v?await getFile(decodeCID(v)).then(re=>JSON.parse(toString$a(re,"utf8"))):1,P=new RootTree({links:n,mmpt:f,privateLog:p,sharedCounter:C,sharedLinks:w,publicTree:d,prettyTree:g,privateNodes:l});return n[Branch.Version]==null&&await P.setVersion(latest),P}async put(){const{cid:e}=await this.putDetailed();return e}async putDetailed(){return putLinks(this.links)}updateLink(e,t){const{cid:n,size:i,isFile:s}=t;return this.links[e]=make(e,n,s,i),this}async updatePuttable(e,t){return this.updateLink(e,await t.putDetailed())}static async storeRootKey(e){const t=directory(Branch.Private),n=await readKey({path:t});await keystore.importSymmKey(e,n)}static async retrieveRootKey(){const e=directory(Branch.Private),t=await readKey({path:e});return await keystore.exportSymmKey(t)}findPrivateNode(e){return findPrivateNode(this.privateNodes,e)}async addPrivateLogEntry(e){var _;const t=[...this.privateLog];let n=Math.max(0,t.length-1),i=(_=t[n])!=null&&_.cid?(await cat(decodeCID(t[n].cid))).split(","):[];i.length+1>RootTree.LOG_CHUNK_SIZE&&(n=n+1,i=[]);const u=await hash$1.sha256Str(e.toString()),c=[...i,u],d=await putFile$1(c.join(","));t[n]={name:n.toString(),cid:d.cid,size:d.size};const g=await dagPutLinks(t.map(toDAGLink));this.updateLink(Branch.PrivateLog,{cid:g.cid,isFile:!1,size:await size(g.cid)}),this.privateLog=t}async addShares(e){this.sharedLinks=e.reduce((s,u)=>({...s,[u.name]:u}),this.sharedLinks);const t=Object.values(this.sharedLinks).reduce((s,{cid:u,name:c,size:d})=>({...s,[c]:{cid:u,name:c,size:d}}),{}),i=await(await get$1()).block.put(encode$9(t),{format:name$1,mhtype:"sha2-256",pin:!1,version:1});return this.updateLink(Branch.Shared,{cid:i,isFile:!1,size:await size(i)}),this}static async getSharedLinks(e){const n=await(await get$1()).block.get(e),i=decode$c(n);if(!isObject(i))throw new Error("Invalid shared section, not an object");return Object.values(i).reduce((s,u)=>{if(!isObject(u))return s;const c=u.name?u.name:null,d=u.cid?decodeCID(u.cid):null;return!c||!d?s:{...s,[c]:{name:c,cid:d,size:u.size||0}}},{})}async setSharedCounter(e){this.sharedCounter=e;const{cid:t,size:n}=await putFile$1(JSON.stringify(e));return this.updateLink(Branch.SharedCounter,{cid:t,isFile:!0,size:n}),e}async bumpSharedCounter(){const e=this.sharedCounter+1;return this.setSharedCounter(e)}async setVersion(e){const t=await putFile$1(toString$c(e));return this.updateLink(Branch.Version,t)}async getVersion(){return await parseVersionFromLinks(this.links)}}RootTree.LOG_CHUNK_SIZE=1020;async function parseVersionFromLinks(r){const e=await getFile(decodeCID(r[Branch.Version].cid));return fromString$a(toString$a(e))??v0}async function findBareNameFilter(r,e){const t=await bareNameFilter({path:e}),n=await getItem(t);if(n)return n;const[i,s]=findPrivateNode(r,e);if(!s)return null;const c=unwrap$2(e).slice(unwrap$2(i).length);return PrivateFile$1.instanceOf(s)?c.length===0?s.header.bareNameFilter:null:(s.exists(c)||(isDirectory(e)?await s.mkdir(c):await s.add(c,"")),s.get(c).then(d=>d?d.header.bareNameFilter:null))}function findPrivateNode(r,e){const t=r[toPosix(e)];if(t)return[e,t];const n=parent(e);return n?findPrivateNode(r,n):[e,null]}function loadPrivateNodes(r,e){return sortedPathKeys(r).reduce((t,{path:n,key:i})=>t.then(async s=>{let u;const c=unwrap$2(n);if(c.length===1&&c[0]===Branch.Private)u=await PrivateTree.fromBaseKey(e,i);else{const g=await findBareNameFilter(s,n);if(!g)throw new Error(`Was trying to load the PrivateTree for the path \`${n}\`, but couldn't find the bare name filter for it.`);isDirectory(n)?u=await PrivateTree.fromBareNameFilter(e,g,i):u=await PrivateFile$1.fromBareNameFilter(e,g,i)}const d=toPosix(n);return{...s,[d]:u}}),Promise.resolve({}))}async function permissionKeys(r){return paths(r).reduce(async(e,t)=>{if(isBranch(Branch.Public,t))return e;const n=await readKey({path:t}),i=await keystore.exportSymmKey(n),s={path:t,key:i};return e.then(u=>[...u,s])},Promise.resolve([]))}function sortedPathKeys(r){return r.sort((e,t)=>toPosix(e.path).localeCompare(toPosix(t.path)))}function create({counter:r,recipientExchangeDid:e,senderRootDid:t}){return sha256Str(`${e}${t}${r}`)}function payload({entryIndexCid:r,symmKey:e,symmKeyAlgo:t}){const n=r;return{algo:t,key:typeof e=="string"?fromString$8(e,"base64pad"):e,cid:n}}async function namefilter({bareFilter:r,shareKey:e}){const t=await hash$1.sha256Str(e);return saturate(await addToBare(r,t))}const EXCHANGE_PATH=directory(Branch.Public,".well-known","exchange");async function privateNode(r,e,{shareWith:t,sharedBy:n}){const i=Array.isArray(t)?t:t.startsWith("did:")?[t]:await listExchangeDIDs(t),s=r.sharedCounter||1,u=r.mmpt,c=await Promise.all(i.map(async y=>[y,await create({counter:s,recipientExchangeDid:y,senderRootDid:n.rootDid})])),d=await aes.genKeyStr(SymmAlg.AES_GCM),g=await PrivateTree.create(u,d,null);await Promise.all(e.map(async([y,w])=>{const v=await w.getName();return g.insertSoftLink({key:w.key,name:y,privateName:v,username:n.username})}));const _=SymmAlg.AES_GCM,f=Object.assign({},g.header),l=await putFile$1(await aes.encrypt(new TextEncoder().encode(JSON.stringify(f)),g.key,_));if(c.length){const y=await namefilter({bareFilter:f.bareNameFilter,shareKey:c[0][1]});await u.add(y,l.cid)}const h=encode$9(payload({entryIndexCid:l.cid.toString(),symmKey:g.key,symmKeyAlgo:_})),p=await Promise.all(c.map(async([y,w])=>{const{publicKey:v}=didToPublicKey(y),C=await rsa.encrypt(h,v),P=await add$1(C);return{name:w,cid:P.cid,size:P.size}}));return await r.addShares(p),{shareId:s.toString(),sharedBy:n}}async function listExchangeDIDs(r){var c;const e=await lookup(r);if(!e)throw new Error("This person doesn't have a filesystem yet.");const n=((c=(await getSimpleLinks(e))[Branch.Pretty])==null?void 0:c.cid)||null;if(!n)throw new Error("This person's filesystem doesn't have a pretty tree.");const i=await BareTree.fromCID(decodeCID(n)),s=unwrap$2(removeBranch(EXCHANGE_PATH)),u=await i.get(s);return u&&u instanceof BareTree?Object.keys(u.getLinks()):[]}class NoPermissionError extends Error{constructor(e){super(e),this.name="NoPermissionError"}}class FileSystem{constructor({root:e,permissions:t,localOnly:n}){this.localOnly=n||!1,this.proofs={},this.publishHooks=[],this.root=e,this._publishWhenOnline=[],this._publishing=!1,this._whenOnline=this._whenOnline.bind(this),this._beforeLeaving=this._beforeLeaving.bind(this);const i=globalThis;i.filesystems=i.filesystems||[],i.filesystems.push(this),t&&t.app&&t.app.creator&&t.app.name&&(this.appPath=appPath(t));const s=async c=>{await add$2(c.toString()),log$9("📓 Adding to the CID ledger:",c.toString())},u=throttle(3e3,!1,(c,d)=>{if(globalThis.navigator.onLine)return this._publishing=[c,!0],update(c,d).then(()=>{this._publishing&&this._publishing[0]===c&&(this._publishing=!1)});this._publishWhenOnline.push([c,d])});this.publishHooks.push(s),this.publishHooks.push(u),this.localOnly||(globalThis.addEventListener("online",this._whenOnline),globalThis.addEventListener("beforeunload",this._beforeLeaving))}static async empty(e={}){const{permissions:t,localOnly:n}=e,i=e.rootKey||await aes.genKeyStr(),s=setup.fsVersion===toString$c(wnfsWasm),u=await RootTree.empty({rootKey:i,wnfsWasm:s});return new FileSystem({root:u,permissions:t,localOnly:n})}static async fromCID(e,t={}){const{permissions:n,localOnly:i}=t,s=await RootTree.fromCID({cid:e,permissions:n});return new FileSystem({root:s,permissions:n,localOnly:i})}deactivate(){if(this.localOnly)return;const e=globalThis;e.filesystems=e.filesystems.filter(t=>t!==this),e.removeEventListener("online",this._whenOnline),e.removeEventListener("beforeunload",this._beforeLeaving)}async ls(e){if(isFile$1(e))throw new Error("`ls` only accepts directory paths");return this.runOnNode(e,{public:async(t,n)=>t.ls(n),private:async(t,n)=>{if(isFile(t))throw new Error("Tried to `ls` a file");return t.ls(n)}})}async mkdir(e,t={}){if(isFile$1(e))throw new Error("`mkdir` only accepts directory paths");return await this.runMutationOnNode(e,{public:async(n,i)=>{await n.mkdir(i)},private:async(n,i)=>{if(isFile(n))throw new Error("Tried to `mkdir` a file");await n.mkdir(i)}}),t.publish&&await this.publish(),this}async add(e,t,n={}){if(isSoftLink(t)||isSoftLinkDictionary(t)||isSoftLinkList(t)){if(isFile$1(e))throw new Error("Can't add soft links to a file");await this.runMutationOnNode(e,{public:async(s,u)=>{const c=Array.isArray(t)?t:isObject(t)?Object.values(t):[t];await this.runOnChildTree(s,u,async d=>(c.forEach(g=>{(PrivateTree.instanceOf(d)||PublicTree.instanceOf(d))&&d.assignLink({name:g.name,link:g,skeleton:g})}),d))},private:async(s,u)=>{const c=Array.isArray(t)?t:isObject(t)?Object.values(t):[t];await this.runOnChildTree(s,u,async d=>(c.forEach(g=>{(PrivateTree.instanceOf(d)||PublicTree.instanceOf(d))&&d.assignLink({name:g.name,link:g,skeleton:g})}),d))}})}else{if(isDirectory(e))throw new Error("`add` only accepts file paths when working with regular files");await this.runMutationOnNode(e,{public:async(s,u)=>{await s.add(u,t)},private:async(s,u)=>{isFile(s)?await s.updateContent(t):await s.add(u,t)}})}return n.publish&&await this.publish(),this}async cat(e){if(isDirectory(e))throw new Error("`cat` only accepts file paths");return this.runOnNode(e,{public:async(t,n)=>await t.cat(n),private:async(t,n)=>isFile(t)?t.content:await t.cat(n)})}async read(e){if(isDirectory(e))throw new Error("`read` only accepts file paths");return this.cat(e)}async write(e,t,n={}){if(isDirectory(e))throw new Error("`write` only accepts file paths");return this.add(e,t,n)}async exists(e){return this.runOnNode(e,{public:async(t,n)=>await t.exists(n),private:async(t,n)=>isFile(t)||await t.exists(n)})}async get(e){return this.runOnNode(e,{public:async(t,n)=>await t.get(n),private:async(t,n)=>isFile(t)?t:await t.get(n)})}async mv(e,t){const n=isSameBranch(e,t);if(!isSameKind(e,t)){const i=kind(e),s=kind(t);throw new Error(`Can't move to a different kind of path, from is a ${i} and to is a ${s}`)}if(!n)throw new Error("`mv` is only supported on the same tree for now");if(await this.exists(t))throw new Error("Destination already exists");return await this.runOnNode(e,{public:async(i,s)=>{const[u,...c]=unwrap$2(t);await i.mv(s,c)},private:async(i,s)=>{if(isFile(i))throw new Error("Tried to `mv` within a file");const[u,...c]=unwrap$2(t);await i.mv(s,c)}}),this}async rm(e){return await this.runMutationOnNode(e,{public:async(t,n)=>{await t.rm(n)},private:async(t,n)=>{if(isFile(t))throw new Error("Cannot `rm` a file you've asked permission for");await t.rm(n)}}),this}async symlink(e){const{at:t,referringTo:n,name:i}=e;if(t==null)throw new Error("Missing parameter `symlink.at`");if(isFile$1(t))throw new Error("`symlink.at` only accepts directory paths");const s=e.username||await authenticatedUsername(),u=isSameBranch(t,n);if(!s)throw new Error("I need a username in order to use this method");if(!u)throw new Error("`link` is only supported on the same tree for now");if(!lookupFilesystemUcan(directory(Branch.Shared)))throw new Error("Not allowed to share private items");return await this.runMutationOnNode(t,{public:async(d,g)=>{if(!BareTree.instanceOf(d))if(PublicTree.instanceOf(d))await this.runOnChildTree(d,g,async _=>(PublicTree.instanceOf(_)&&_.insertSoftLink({path:removeBranch(n),name:i,username:s}),_));else throw new Error("Symlinks not supported in WASM-WNFS yet.")},private:async(d,g)=>{if(isFile(d))throw new Error("Cannot add a soft link to a file");await this.runOnChildTree(d,g,async _=>{if(PrivateTree.instanceOf(_)){const f=await this.runOnNode(n,{public:async()=>{throw new Error("File system hit a public node within a private node. This is not supported/this should not happen.")},private:async(l,h)=>{const p=isFile(l)?l:await l.get(h);if(PrivateTree.instanceOf(p))return p;if(PrivateFile$1.instanceOf(p))return p;throw new Error("`symlink.referringTo` is not of the right type")}});if(!f)throw new Error("Could not find the item the symlink is referring to");_.insertSoftLink({name:i,username:s,key:f.key,privateName:await f.getName()})}return _})}}),this}async publish(){const e=Array.from(Object.entries(this.proofs));this.proofs={};const t=await this.root.put();return e.forEach(([n,i])=>{this.publishHooks.forEach(s=>s(t,i))}),t}async historyStep(){const e=this.root.publicTree;hasProp(e,"historyStep")&&typeof e.historyStep=="function"&&await e.historyStep()}async acceptShare({shareId:e,sharedBy:t}){const n=await this.loadShare({shareId:e,sharedBy:t});return await this.add(directory(Branch.Private,"Shared with me",t),await n.ls([])),this}async loadShare({shareId:e,sharedBy:t}){var le,me,He;const n=await exchange(),i=await root$3(t),s=await create({counter:parseInt(e,10),recipientExchangeDid:n,senderRootDid:i}),u=await lookup(t);if(!u)throw new Error("This user doesn't have a filesystem yet.");const c=await getSimpleLinks(u),d=((le=c[Branch.Shared])==null?void 0:le.cid)||null;if(!d)throw new Error("This user hasn't shared anything yet.");const g=await RootTree.getSharedLinks(decodeCID(d)),_=isObject(g)?g[s]:null;if(!_)throw new Error("Couldn't find a matching share.");const f=isObject(_)?_.cid:null;if(!f)throw new Error("Couldn't find a matching share.");const l=await catBuf(decodeCID(f)),p=await(await get$4()).exchangeKey();if(!p.privateKey)throw new Error("Missing private key in exchange key-pair");const y=await rsa.decrypt(l,p.privateKey),w=decode$c(new Uint8Array(y));if(!hasProp(w,"cid"))throw new Error("Share payload is missing the `cid` property");if(!hasProp(w,"key"))throw new Error("Share payload is missing the `key` property");if(!hasProp(w,"algo"))throw new Error("Share payload is missing the `algo` property");const v=w.cid,C=toString$a(w.key,"base64pad"),P=w.algo;if(!((me=c[Branch.Private])==null?void 0:me.cid))throw new Error("This user's filesystem doesn't have a private branch");const F=await MMPT.fromCID(decodeCID((He=c[Branch.Private])==null?void 0:He.cid)),k=await catBuf(decodeCID(v)),B=await aes.decrypt(k,C,P),H=JSON.parse(toString$a(B,"utf8"));if(!isDecryptedNode(H))throw new Error("The share payload did not point to a valid entry index");return await PrivateTree.fromInfo(F,C,H)}async sharePrivate(e,{sharedBy:t,shareWith:n}){const i=e.filter(c=>isBranch(Branch.Private,c));if(!t){const c=await authenticatedUsername();if(!c)throw new Error("I need a username in order to use this method");t={rootDid:await ownRoot(),username:c}}const s=await i.reduce(async(c,d)=>{const g=await c,_=terminus(d),f=await this.get(d);return _&&(PrivateFile$1.instanceOf(f)||PrivateTree.instanceOf(f))?[...g,[_,f]]:g},Promise.resolve([]));if(!s.length)throw new Error("Didn't find any items to share");const u=await privateNode(this.root,s,{shareWith:n,sharedBy:t});return await this.root.bumpSharedCounter(),await this.root.updatePuttable(Branch.Private,this.root.mmpt),await this.publish(),u}async addPublicExchangeKey(){const e=await exchange();await this.mkdir(combine(EXCHANGE_PATH,directory(e)))}async hasPublicExchangeKey(){const e=await exchange();return this.exists(combine(EXCHANGE_PATH,directory(e)))}resolveSymlink(e){return hasProp(e,"privateName")?PrivateTree.resolveSoftLink(e):PublicTree.resolveSoftLink(e)}async checkMutationPermissionAndAddProof(e,t){const n=t?"make changes to":"query";if(!this.localOnly){const i=await lookupFilesystemUcan(e),s=i&&decode$e(i);if(!i||!s||isExpired(s)||!s.signature)throw new NoPermissionError(`I don't have the necessary permissions to ${n} the file system at "${toPosix(e)}"`);this.proofs[s.signature]=i}}async runMutationOnNode(e,t){const n=unwrap$2(e),i=n[0],s=n.slice(1);if(await this.checkMutationPermissionAndAddProof(e,!0),i===Branch.Public)await t.public(this.root.publicTree,s),await t.public(this.root.prettyTree,s),await Promise.all([this.root.updatePuttable(Branch.Public,this.root.publicTree),this.root.updatePuttable(Branch.Pretty,this.root.prettyTree)]);else if(i===Branch.Private){const[u,c]=this.root.findPrivateNode(e);if(!c)throw new NoPermissionError(`I don't have the necessary permissions to make changes to the file system at "${toPosix(e)}"`);await t.private(c,n.slice(unwrap$2(u).length)),await c.put(),await this.root.updatePuttable(Branch.Private,this.root.mmpt);const d=await this.root.mmpt.put();await this.root.addPrivateLogEntry(d)}else throw i===Branch.Pretty?new Error("The pretty path is read only"):new Error("Not a valid FileSystem path")}async runOnNode(e,t){const n=unwrap$2(e),i=n[0],s=n.slice(1);if(await this.checkMutationPermissionAndAddProof(e,!1),i===Branch.Public)return await t.public(this.root.publicTree,s);if(i===Branch.Private){const[u,c]=this.root.findPrivateNode(e);if(!c)throw new NoPermissionError(`I don't have the necessary permissions to query the file system at "${toPosix(e)}"`);return await t.private(c,n.slice(unwrap$2(u).length))}else{if(i===Branch.Pretty)return await t.public(this.root.prettyTree,s);throw new Error("Not a valid FileSystem path")}}async runOnChildTree(e,t,n){let i=e;if(t.length){await i.exists(t)||await i.mkdir(t);const s=await i.get(t);if(isTree(s))i=s;else throw new Error("Path does not point to a directory")}return i=await n(i),t.length?await e.updateChild(i,t):e}_whenOnline(){const e=[...this._publishWhenOnline];this._publishWhenOnline=[],e.forEach(([t,n])=>{this.publishHooks.forEach(i=>i(t,n))})}_beforeLeaving(e){const t="Are you sure you want to leave? We don't control the browser so you may lose your data.";if(this._publishing||this._publishWhenOnline.length)return(e||globalThis.event).returnValue=t,t}}function appPath(r){if(!r.app)throw Error("Only works with app permissions");const e=appDataPath(r.app);return t=>t?combine(e,t):e}async function loadFileSystem(r,e,t){let n,i;if(e=e||await authenticatedUsername()||void 0,!e)throw new Error("User hasn't authenticated yet");await store([]);const s=navigator.onLine?await lookup(e):null,[u,c]=s?await index$1(s.toString()):[-1,0];if(!navigator.onLine)n=decodeCID(await newest());else if(!s)n=decodeCID(await newest()),n&&log$9("📓 No DNSLink, using local CID:",n.toString());else if(u===0)n=s,log$9("📓 DNSLink is up to date:",n.toString());else if(u>0){n=decodeCID(await newest());const g=u===1?"1 newer local entry":u+" newer local entries";log$9("📓 DNSLink is outdated ("+g+"), using local CID:",n.toString())}else n=s,await add$2(n.toString()),log$9("📓 DNSLink is newer:",n.toString());const d=r||void 0;if(n!=null&&(await checkFileSystemVersion(n),i=await FileSystem.fromCID(n,{permissions:d}),i!=null))return i;if(!t)throw new Error("Can't make new filesystem without a root AES key");return i=await FileSystem.empty({permissions:d,rootKey:t}),await addSampleData(i),i}async function checkFileSystemVersion(r){const e=await getSimpleLinks(r),t=e[Branch.Version]==null?"1.0.0":new TextDecoder().decode(await getFile(decodeCID(e[Branch.Version].cid))),n=async()=>(await setup.userMessages.versionMismatch.newer(t),new Error(`Incompatible filesystem version. Version: ${t} Supported versions: ${supported.map(c=>toString$c(c)).join(", ")}. Please upgrade this app's webnative version.`)),i=async()=>(await setup.userMessages.versionMismatch.older(t),new Error(`Incompatible filesystem version. Version: ${t} Supported versions: ${supported.map(c=>toString$c(c)).join(", ")}. The user should migrate their filesystem.`)),s=fromString$a(t);if(s==null)throw await n();const u=isSupported(s);if(u==="too-high")throw await n();if(u==="too-low")throw await i()}async function addSampleData(r){await r.mkdir({directory:[Branch.Private,"Apps"]}),await r.mkdir({directory:[Branch.Private,"Audio"]}),await r.mkdir({directory:[Branch.Private,"Documents"]}),await r.mkdir({directory:[Branch.Private,"Photos"]}),await r.mkdir({directory:[Branch.Private,"Video"]}),await r.publish()}var PermissionedAppScenario;(function(r){r.NotAuthorised="NOT_AUTHORISED",r.AuthSucceeded="AUTH_SUCCEEDED",r.AuthCancelled="AUTH_CANCELLED",r.Continuation="CONTINUATION"})(PermissionedAppScenario||(PermissionedAppScenario={}));function scenarioAuthSucceeded(r,e,t,n){return{kind:"permissionedAppState",scenario:PermissionedAppScenario.AuthSucceeded,permissions:r,authenticated:!0,throughLobby:!0,fs:n,newUser:e,username:t}}function scenarioAuthCancelled(r,e){return{kind:"permissionedAppState",scenario:PermissionedAppScenario.AuthCancelled,permissions:r,authenticated:!1,throughLobby:!0,cancellationReason:e}}function scenarioNotAuthorised(r){return{kind:"permissionedAppState",scenario:PermissionedAppScenario.NotAuthorised,permissions:r,authenticated:!1}}const USERNAME_BLOCKLIST=["fission","ipfs","ipns","did","id","identity",".htaccess","htaccess",".htpasswd","htpasswd",".well-known","well-known","400","401","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","421","422","423","424","426","428","429","431","500","501","502","503","504","505","506","507","508","509","510","511","_domainkey","about","about-us","abuse","access","account","accounts","ad","add","admin","administration","administrator","ads","ads.txt","advertise","advertising","aes128-ctr","aes128-gcm","aes192-ctr","aes256-ctr","aes256-gcm","affiliate","affiliates","ajax","alert","alerts","alpha","amp","analytics","api","app","app-ads.txt","apps","asc","assets","atom","auth","authentication","authorize","autoconfig","autodiscover","avatar","backup","banner","banners","bbs","beta","billing","billings","blog","blogs","board","bookmark","bookmarks","broadcasthost","business","buy","cache","calendar","campaign","captcha","careers","cart","cas","categories","category","cdn","cgi","cgi-bin","chacha20-poly1305","change","channel","channels","chart","chat","checkout","clear","client","close","cloud","cms","com","comment","comments","community","compare","compose","config","connect","contact","contest","cookies","copy","copyright","count","cp","cpanel","create","crossdomain.xml","css","curve25519-sha256","customer","customers","customize","dashboard","db","deals","debug","delete","desc","destroy","dev","developer","developers","diffie-hellman-group-exchange-sha256","diffie-hellman-group14-sha1","disconnect","discuss","dns","dns0","dns1","dns2","dns3","dns4","docs","documentation","domain","download","downloads","downvote","draft","drop","ecdh-sha2-nistp256","ecdh-sha2-nistp384","ecdh-sha2-nistp521","edit","editor","email","enterprise","error","errors","event","events","example","exception","exit","explore","export","extensions","false","family","faq","faqs","favicon.ico","features","feed","feedback","feeds","file","files","filter","follow","follower","followers","following","fonts","forgot","forgot-password","forgotpassword","form","forms","forum","forums","friend","friends","ftp","get","git","go","graphql","group","groups","guest","guidelines","guides","head","header","help","hide","hmac-sha","hmac-sha1","hmac-sha1-etm","hmac-sha2-256","hmac-sha2-256-etm","hmac-sha2-512","hmac-sha2-512-etm","home","host","hosting","hostmaster","htpasswd","http","httpd","https","humans.txt","icons","images","imap","img","import","index","info","insert","investors","invitations","invite","invites","invoice","is","isatap","issues","it","jobs","join","js","json","keybase.txt","learn","legal","license","licensing","like","limit","live","load","local","localdomain","localhost","lock","login","logout","lost-password","m","mail","mail0","mail1","mail2","mail3","mail4","mail5","mail6","mail7","mail8","mail9","mailer-daemon","mailerdaemon","map","marketing","marketplace","master","me","media","member","members","message","messages","metrics","mis","mobile","moderator","modify","more","mx","mx1","my","net","network","new","news","newsletter","newsletters","next","nil","no-reply","nobody","noc","none","noreply","notification","notifications","ns","ns0","ns1","ns2","ns3","ns4","ns5","ns6","ns7","ns8","ns9","null","oauth","oauth2","offer","offers","online","openid","order","orders","overview","owa","owner","page","pages","partners","passwd","password","pay","payment","payments","photo","photos","pixel","plans","plugins","policies","policy","pop","pop3","popular","portal","portfolio","post","postfix","postmaster","poweruser","preferences","premium","press","previous","pricing","print","privacy","privacy-policy","private","prod","product","production","profile","profiles","project","projects","public","purchase","put","quota","recover","recovery","redirect","reduce","refund","refunds","register","registration","remove","replies","reply","report","request","request-password","reset","reset-password","response","return","returns","review","reviews","robots.txt","root","rootuser","rsa-sha2-2","rsa-sha2-512","rss","rules","sales","save","script","sdk","search","secure","security","select","services","session","sessions","settings","setup","share","shift","shop","signin","signup","site","sitemap","sites","smtp","sort","source","sql","ssh","ssh-rsa","ssl","ssladmin","ssladministrator","sslwebmaster","stage","staging","stat","static","statistics","stats","status","store","style","styles","stylesheet","stylesheets","subdomain","subscribe","sudo","super","superuser","support","survey","sync","sysadmin","system","tablet","tag","tags","team","telnet","terms","terms-of-use","test","testimonials","theme","themes","today","tools","topic","topics","tour","training","translate","translations","trending","trial","true","umac-128","umac-128-etm","umac-64","umac-64-etm","undefined","unfollow","unlike","unsubscribe","update","upgrade","usenet","user","username","users","uucp","var","verify","video","view","void","vote","vpn","webmail","webmaster","website","widget","widgets","wiki","wpad","write","www","www-data","www1","www2","www3","www4","you","yourname","yourusername","zlib"];async function isUsernameAvailable$1(r){const e=setup.getApiEndpoint();return!(await fetch(`${e}/user/data/${r}`)).ok}function isUsernameValid$1(r){return!r.startsWith("-")&&!r.endsWith("-")&&!r.startsWith("_")&&/^[a-zA-Z0-9_-]+$/.test(r)&&!USERNAME_BLOCKLIST.includes(r.toLowerCase())}var LinkingStep;(function(r){r.Broadcast="BROADCAST",r.Negotiation="NEGOTIATION",r.Delegation="DELEGATION"})(LinkingStep||(LinkingStep={}));class LinkingError extends Error{constructor(e){super(e),this.name="LinkingError"}}class LinkingWarning extends Error{constructor(e){super(e),this.name="LinkingWarning"}}const handleLinkingError=r=>{switch(r.name){case"LinkingWarning":warn(r.message);break;case"LinkingError":throw r;default:throw r}},tryParseMessage=(r,e,t)=>{try{const n=JSON.parse(r);return e(n)?{ok:!0,value:n}:{ok:!1,error:new LinkingWarning(`${t.participant} received an unexpected message in ${t.callSite}: ${r}. Ignoring message.`)}}catch{return{ok:!1,error:new LinkingWarning(`${t.participant} received a message in ${t.callSite} that it could not parse: ${r}. Ignoring message.`)}}},createWssChannel=async r=>{const{username:e,handleMessage:t}=r,n=await waitForRootDid(e);if(!n)throw new LinkingError(`Failed to lookup DID for ${e}`);const s=setup.getApiEndpoint().replace(/^https?:\/\//,"wss://"),u=`deviceLink#${n}`;console.log("Opening channel",u);const c=new WebSocket(`${s}/user/link/${n}`);await waitForOpenConnection(c),c.onmessage=t;const d=publishOnWssChannel(c),g=closeWssChannel(c);return{send:d,close:g}},waitForRootDid=async r=>{let e=await root$3(r);return e||new Promise(t=>{let i=0;const s=setInterval(async()=>{if(console.log("Could not fetch root DID. Retrying"),e=await root$3(r).catch(u=>{throw clearInterval(s),u}),!e&&i<3){i++;return}clearInterval(s),t(e)},2e3)})},waitForOpenConnection=async r=>new Promise((e,t)=>{r.onopen=()=>{e()},r.onerror=()=>{t("Websocket channel could not be opened")}}),closeWssChannel=r=>function(){r&&r.close(1e3)},publishOnWssChannel=r=>function(e){const t=typeof e=="string"?new TextEncoder().encode(e).buffer:e;r==null||r.send(t)},init=async r=>{const e=r.permissions||null,{autoRemoveUrlParams:t=!0,rootKey:n}=r,i=async d=>r.loadFileSystem===!1?void 0:await loadFileSystem(e,d,n),s=new URL(window.location.href),u=s.searchParams.get("authorised"),c=s.searchParams.get("cancelled");if(u){const d=s.searchParams.get("newUser")==="t",g=s.searchParams.get("username")||"";return await retry(async()=>importClassifiedInfo(u==="via-postmessage"?await getClassifiedViaPostMessage():JSON.parse(await cat(decodeCID(u)))),{tries:10,timeout:1e4,timeoutMessage:"Trying to retrieve UCAN(s) and readKey(s) from the auth lobby timed out after 10 seconds."}),await setItem(USERNAME_STORAGE_KEY,g),t&&(s.searchParams.delete("authorised"),s.searchParams.delete("newUser"),s.searchParams.delete("username"),history.replaceState(null,document.title,s.toString())),e&&await validateSecrets(e)===!1?(console.warn("Unable to validate filesystem secrets"),scenarioNotAuthorised(e)):e&&validatePermissions(e)===!1?(console.warn("Unable to validate UCAN permissions"),scenarioNotAuthorised(e)):scenarioAuthSucceeded(e,d,g,await i(g))}else if(c){const d=(()=>{switch(c){case"DENIED":return"User denied authorisation";default:return"Unknown reason"}})();return scenarioAuthCancelled(e,d)}else await store([]);return null},register=async r=>new Promise(e=>e({success:!1})),isUsernameValid=async r=>isUsernameValid$1(r),isUsernameAvailable=async r=>isUsernameAvailable$1(r),createChannel=r=>createWssChannel(r),checkCapability=async r=>{if(!await getItem("readKey"))return!1;const t=await root$3(r),n=await getItem("ucan");if(n){const i=rootIssuer(n),s=decode$e(n),{ptc:u}=s.payload;return t===i&&u==="SUPER_USER"}else{const i=await write();return t===i}},delegateAccount=async(r,e)=>{const t=await getItem("readKey"),n=await getItem("ucan"),i=await build({audience:e,issuer:await write(),lifetimeInSeconds:60*60*24*30*12*1e3,potency:"SUPER_USER",proof:n});return{readKey:t,ucan:encode$b(i)}};function isLobbyLinkingData(r){return isObject(r)&&"readKey"in r&&typeof r.readKey=="string"&&"ucan"in r&&typeof r.ucan=="string"}const linkDevice$1=async r=>{if(!isLobbyLinkingData(r))throw new LinkingError(`Consumer received invalid link device response from producer: Expected read key and ucan, but got ${JSON.stringify(r)}`);const{readKey:e,ucan:t}=r,n=decode$e(t);if(await isValid(n))await setItem("ucan",t),await setItem("readKey",e);else throw new LinkingError(`Consumer received invalid link device response from producer. Given ucan is invalid: ${r.ucan}`)},LOBBY_IMPLEMENTATION={auth:{init,register,isUsernameValid,isUsernameAvailable,createChannel,checkCapability,delegateAccount,linkDevice:linkDevice$1}};async function retry(r,e){return await Promise.race([(async()=>{let t=1;for(;t<=e.tries;){try{await r();return}catch(n){if(t==e.tries)throw n}t++}})(),new Promise((t,n)=>setTimeout(()=>n(new Error(e.timeoutMessage)),e.timeout))])}function isAuthLobbyClassifiedInfo(r){return isObject(r)&&isString(r.sessionKey)&&isString(r.secrets)&&isString(r.iv)}async function importClassifiedInfo(r){const e=await keystore.decrypt(r.sessionKey),t=await aes.decryptGCM(r.secrets,e,r.iv),n=JSON.parse(t),i=n.fs,s=n.ucans;await Promise.all(Object.entries(i).map(async([u,{bareNameFilter:c,key:d}])=>{const g=fromPosix(u),_=await readKey({path:g}),f=await bareNameFilter({path:g});await keystore.importSymmKey(d,_),await setItem(f,c)})),await store(s)}async function getClassifiedViaPostMessage(){const r=await new Promise(e=>{const t=document.createElement("iframe");t.id="webnative-secret-exchange",t.style.width="0",t.style.height="0",t.style.border="none",t.style.display="none",document.body.appendChild(t),t.onload=()=>{e(t)},t.src=`${setup.endpoints.lobby}/exchange.html`});try{const e=new Promise((n,i)=>{let s=10;window.addEventListener("message",c);function u(d){console.warn(`When importing UCANs & readKey(s): Can't parse: ${d}. Might be due to extensions.`),--s===0&&(window.removeEventListener("message",c),i(new Error("Couldn't parse message from auth lobby after 10 tries. See warnings above.")))}function c(d){if(new URL(d.origin).host!==new URL(setup.endpoints.lobby).host){console.log(`Got a message from ${d.origin} while waiting for login credentials. Ignoring.`);return}if(d.data==null)return;let g=null;try{g=JSON.parse(d.data)}catch{u(d.data);return}if(!isAuthLobbyClassifiedInfo(g)){u(d.data);return}window.removeEventListener("message",c),n(g)}});if(r.contentWindow==null)throw new Error("Can't import UCANs & readKey(s): No access to its contentWindow");const t={webnative:"exchange-secrets",didExchange:await exchange()};return r.contentWindow.postMessage(t,r.src),await e}finally{document.body.removeChild(r)}}let impl=LOBBY_IMPLEMENTATION.auth;var AppScenario;(function(r){r.NotAuthed="NOT_AUTHORIZED",r.Authed="AUTHORIZED"})(AppScenario||(AppScenario={}));class EventEmitter{constructor(){this.events=new Map}on(e,t){const n=this.events.get(e);n===void 0?this.events.set(e,new Set([t])):n.add(t)}removeListener(e,t){const n=this.events.get(e);n!==void 0&&(n.delete(t),n.size===0&&this.events.delete(e))}emit(e,t){var n;(n=this.events.get(e))==null||n.forEach(i=>{i.apply(this,[t])})}}const createConsumer=async r=>{const{username:e}=r;let t=new EventEmitter;const n={username:e,sessionKey:null,temporaryRsaPair:null,step:LinkingStep.Broadcast},i=async d=>{const{data:g}=d,_=g.arrayBuffer?new TextDecoder().decode(await g.arrayBuffer()):g;if(n.step===LinkingStep.Broadcast)handleLinkingError(new LinkingWarning("Consumer is not ready to start linking"));else if(n.step===LinkingStep.Negotiation)if(n.sessionKey)handleLinkingError(new LinkingWarning("Consumer already received a session key"));else if(!n.temporaryRsaPair||!n.temporaryRsaPair.privateKey)handleLinkingError(new LinkingError("Consumer missing RSA key pair when handling session key message"));else{const f=await handleSessionKey(n.temporaryRsaPair.privateKey,_);if(f.ok){n.sessionKey=f.value;const{pin:l,challenge:h}=await generateUserChallenge(n.sessionKey);u.send(h),t==null||t.emit("challenge",{pin:Array.from(l)}),n.step=LinkingStep.Delegation}else handleLinkingError(f.error)}else if(n.step===LinkingStep.Delegation)if(!n.sessionKey)handleLinkingError(new LinkingError("Consumer was missing session key when linking device"));else if(!n.username)handleLinkingError(new LinkingError("Consumer was missing username when linking device"));else{const f=await linkDevice(n.sessionKey,n.username,_);if(f.ok){const{approved:l}=f.value;t==null||t.emit("link",{approved:l,username:n.username}),await s()}else handleLinkingError(f.error)}},s=async()=>{t==null||t.emit("done",void 0),t=null,u.close(),clearInterval(c)},u=await impl.createChannel({username:e,handleMessage:i}),c=setInterval(async()=>{if(n.sessionKey)clearInterval(c);else{const{temporaryRsaPair:d,temporaryDID:g}=await generateTemporaryExchangeKey();n.temporaryRsaPair=d,n.step=LinkingStep.Negotiation,await u.send(g)}},2e3);return{on:(...d)=>t==null?void 0:t.on(...d),cancel:s}},generateTemporaryExchangeKey=async()=>{const r=config$1.normalize(),{rsaSize:e,hashAlg:t}=r,n=await rsa$1.makeKeypair(e,t,KeyUse.Exchange),i=await rsa$1.getPublicKey(n),s=publicKeyToDid(i,KeyType.RSA);return{temporaryRsaPair:n,temporaryDID:s}},handleSessionKey=async(r,e)=>{const n=tryParseMessage(e,i=>isObject(i)&&"iv"in i&&typeof i.iv=="string"&&"msg"in i&&typeof i.msg=="string"&&"sessionKey"in i&&typeof i.sessionKey=="string",{participant:"Consumer",callSite:"handleSessionKey"});if(n.ok){const{iv:i,msg:s,sessionKey:u}=n.value,c=utils$1.base64ToArrBuf(i);let d,g;try{const p=utils$1.base64ToArrBuf(u);g=await rsa$1.decrypt(p,r),d=await aes$1.importKey(utils$1.arrBufToBase64(g),{alg:SymmAlg.AES_GCM,length:256})}catch{return{ok:!1,error:new LinkingWarning(`Consumer received a session key in handleSessionKey that it could not decrypt: ${e}. Ignoring message`)}}let _=null;try{_=toString$a(await webcrypto.subtle.decrypt({name:"AES-GCM",iv:c},d,utils$1.base64ToArrBuf(s)),"utf8")}catch{return{ok:!1,error:new LinkingError("Consumer could not decrypt closed UCAN with provided session key.")}}const f=decode$e(_);if(await isValid(f)===!1)return{ok:!1,error:new LinkingError("Consumer received an invalid closed UCAN")};if(f.payload.ptc)return{ok:!1,error:new LinkingError("Consumer received a closed UCAN with potency. Closed UCAN must not have potency.")};const l=f.payload.fct[0]&&f.payload.fct[0].sessionKey;if(!l)return{ok:!1,error:new LinkingError("Consumer received a closed UCAN that was missing a session key in facts.")};const h=utils$1.arrBufToBase64(g);return l!==h?{ok:!1,error:new LinkingError("Consumer received a closed UCAN session key does not match the session key")}:{ok:!0,value:d}}else return n},generateUserChallenge=async r=>{const e=Array.from(new Uint8Array(utils$1.randomBuf(6,{max:9}))),t=utils$1.randomBuf(16),n=utils$1.arrBufToBase64(await webcrypto.subtle.encrypt({name:"AES-GCM",iv:t},r,fromString$8(JSON.stringify({did:await write(),pin:e}),"utf8"))),i=JSON.stringify({iv:utils$1.arrBufToBase64(t),msg:n});return{pin:e,challenge:i}},linkDevice=async(r,e,t)=>{const i=tryParseMessage(t,s=>isObject(s)&&"iv"in s&&typeof s.iv=="string"&&"msg"in s&&typeof s.msg=="string",{participant:"Consumer",callSite:"linkDevice"});if(i.ok){const{iv:s,msg:u}=i.value,c=utils$1.base64ToArrBuf(s);let d=null;try{d=toString$a(await webcrypto.subtle.decrypt({name:"AES-GCM",iv:c},r,utils$1.base64ToArrBuf(u)),"utf8")}catch{return{ok:!1,error:new LinkingWarning("Consumer ignoring message that could not be decrypted in linkDevice.")}}const g=tryParseMessage(d,isObject,{participant:"Consumer",callSite:"linkDevice"});return g.ok?g.value.linkStatus==="DENIED"?{ok:!0,value:{approved:!1}}:(await setItem(USERNAME_STORAGE_KEY,e),await impl.linkDevice(g.value),{ok:!0,value:{approved:!0}}):g}else return i},createAccountLinkingConsumer=async r=>await createConsumer({username:r});/*! clipboard-copy. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var clipboardCopy_1,hasRequiredClipboardCopy;function requireClipboardCopy(){if(hasRequiredClipboardCopy)return clipboardCopy_1;hasRequiredClipboardCopy=1,clipboardCopy_1=n;function r(){return new DOMException("The request is not allowed","NotAllowedError")}async function e(i){if(!navigator.clipboard)throw r();return navigator.clipboard.writeText(i)}async function t(i){const s=document.createElement("span");s.textContent=i,s.style.whiteSpace="pre",s.style.webkitUserSelect="auto",s.style.userSelect="all",document.body.appendChild(s);const u=window.getSelection(),c=window.document.createRange();u.removeAllRanges(),c.selectNode(s),u.addRange(c);let d=!1;try{d=window.document.execCommand("copy")}finally{u.removeAllRanges(),window.document.body.removeChild(s)}if(!d)throw r()}async function n(i){try{await e(i)}catch(s){try{await t(i)}catch(u){throw u||s||r()}}}return clipboardCopy_1}var clipboardCopyExports=requireClipboardCopy();const clipboardCopy=getDefaultExportFromCjs(clipboardCopyExports);var root_1=template('<span class="btn text-base-100 hover:text-base-100 bg-base-content hover:bg-base-content border-0 btn-lg rounded-full text-deviceCode tracking-[.18em] w-3/4 cursor-pointer font-mono font-light"> </span>'),root$1=template('<input type="checkbox" id="my-modal-5" checked class="modal-toggle"> <div class="modal"><div class="modal-box w-narrowModal relative text-center dark:border-slate-600 dark:border"><div class="grid grid-flow-row auto-rows-max gap-7"><h3 class="text-base"></h3> <div class="grid grid-flow-row auto-rows-max gap-4 justify-items-center"><!> <span class="text-sm text-left">Enter this code on your connected device.</span> <div class="grid grid-flow-col auto-cols-max gap-4 justify-center items-center text-slate-500"><span class="rounded-lg border-t-2 border-l-2 border-slate-600 dark:border-slate-50 w-4 h-4 block animate-spin"></span> Waiting for a response...</div></div> <div><button class="btn btn-outline text-base mt-4">Cancel Request</button></div></div></div></div>',1);function LinkDevice(r,e){push(e,!1);let t=prop(e,"pin",8);const n=createEventDispatcher(),i=()=>{n("cancel")},s=async()=>{await clipboardCopy(t()),addNotification("Copied to clipboard","success")};init$3();var u=root$1(),c=first_child(u);remove_input_defaults(c);var d=sibling(c,2),g=child(d),_=child(g),f=child(_);f.textContent=`Connect to ${appName}`;var l=sibling(f,2),h=child(l);{var p=v=>{var C=root_1(),P=child(C,!0);reset(C),template_effect(()=>set_text(P,t())),event("click",C,s),append(v,C)};if_block(h,v=>{t()&&v(p)})}next(4),reset(l);var y=sibling(l,2),w=child(y);reset(y),reset(_),reset(g),reset(d),event("click",w,i),append(r,u),pop()}var root=template('<input type="checkbox" id="my-modal-5" checked class="modal-toggle"> <!>',1);function _page(r,e){push(e,!1);const[t,n]=setup_stores(),i=()=>store_get(page,"$page",t);let s=mutable_source("link-device"),u,c=mutable_source("");const d=extractSearchParam(i().url,"username"),g=async()=>{u=await createAccountLinkingConsumer(d),u.on("challenge",({pin:w})=>{set$1(c,w.join(""))}),u.on("link",async({approved:w,username:v})=>{w?(set$1(s,"load-filesystem"),await loadAccount(),addNotification("You're now connected!","success"),goto("/")):(addNotification("The connection attempt was cancelled","info"),goto("/"))})},_=async()=>{addNotification("The connection attempt was cancelled","info"),await(u==null?void 0:u.cancel()),goto("/")};g(),init$3();var f=root(),l=first_child(f);remove_input_defaults(l);var h=sibling(l,2);{var p=w=>{LinkDevice(w,{get pin(){return get$7(c)},$$events:{cancel:_}})},y=(w,v)=>{{var C=P=>{FilesystemActivity(P,{activity:"Loading"})};if_block(w,P=>{get$7(s)==="load-filesystem"&&P(C)},v)}};if_block(h,w=>{get$7(s)==="link-device"?w(p):w(y,!1)})}append(r,f),pop(),n()}export{_page as component};
